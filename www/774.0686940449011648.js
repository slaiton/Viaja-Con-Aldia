"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[774],{774:(I,_,l)=>{l.r(_),l.d(_,{PreformPageModule:()=>S});var v=l(6895),P=l(529),p=l(433),a=l(603),m=l(3599),d=l(7582),f=l(2340),e=l(1571),b=l(5030),x=l(997),C=l(5114);const Z=["preguntaCard"];function A(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label")(2,"strong"),e._uU(3),e.qZA(),e.TgZ(4,"div",12),e._uU(5),e.qZA()(),e.TgZ(6,"ion-button",13),e.NdJ("click",function(){const i=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.marcarSolucionado(i.index))}),e._uU(7," Solucionado "),e.qZA()()}if(2&o){const t=c.$implicit;e.xp6(3),e.AsE("",t.index+1," - ",t.texto,""),e.xp6(2),e.Oqu(t.descripcion)}}function T(o,c){if(1&o&&(e.TgZ(0,"div",9)(1,"h2",10),e._uU(2,"Alerta! Verificar "),e.qZA(),e.TgZ(3,"ion-list"),e.YNc(4,A,8,3,"ion-item",11),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngForOf",t.preguntasNoCumplen)}}function y(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"div",16),e._uU(2),e.qZA(),e.TgZ(3,"ion-radio-group",17),e.NdJ("ionChange",function(n){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.setCategoria(i.categoria.nombre,n))}),e.TgZ(4,"div",18),e._UZ(5,"ion-radio",19),e.TgZ(6,"label"),e._uU(7,"Aplica"),e.qZA()(),e.TgZ(8,"div",18),e._UZ(9,"ion-radio",20),e.TgZ(10,"label"),e._uU(11,"No aplica"),e.qZA()()()()}if(2&o){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",t.categoria.label," ")}}function N(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",15,21)(2,"div",16),e._uU(3),e.qZA(),e.TgZ(4,"div",22),e._uU(5),e.qZA(),e.TgZ(6,"ion-radio-group",23),e.NdJ("ionChange",function(n){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.responder(i.index,n))}),e.TgZ(7,"div",18),e._UZ(8,"ion-radio",24),e.TgZ(9,"label"),e._uU(10,"Cumple"),e.qZA()(),e.TgZ(11,"div",18),e._UZ(12,"ion-radio",25),e.TgZ(13,"label"),e._uU(14,"No Cumple"),e.qZA()()()()}if(2&o){const t=e.oxw().$implicit;e.xp6(3),e.AsE(" ",t.index+1," - ",t.texto," "),e.xp6(2),e.hij(" ",t.descripcion||"Describa cualquier detalle particular si aplica."," "),e.xp6(1),e.Q6J("formControlName","pregunta"+(t.index+1))}}function F(o,c){if(1&o&&(e.ynx(0),e.YNc(1,y,12,1,"div",14),e.YNc(2,N,15,4,"div",14),e.BQk()),2&o){const t=c.$implicit;e.xp6(1),e.Q6J("ngIf","categoria"===t.tipo),e.xp6(1),e.Q6J("ngIf","pregunta"===t.tipo)}}function U(o,c){if(1&o&&e._UZ(0,"ion-img",37),2&o){const t=e.oxw(2);e.Q6J("src",t.car.webviewPath)}}function O(o,c){1&o&&e._UZ(0,"div",38)}function M(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"ion-title",26)(2,"strong"),e._uU(3," Foto Vehiculo "),e.qZA()(),e.TgZ(4,"div",27),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.getPhotoCar())}),e.YNc(5,U,1,1,"ion-img",28),e.YNc(6,O,1,0,"div",29),e.qZA(),e.TgZ(7,"ion-card",30)(8,"ion-card-header")(9,"ion-card-title",31),e._UZ(10,"ion-icon",32),e._uU(11," Recomendaciones Importantes "),e.qZA()(),e.TgZ(12,"ion-card-content",33)(13,"p",34),e._uU(14," Estimado conductor, le pedimos que tenga en cuenta las siguientes recomendaciones: "),e.qZA(),e.TgZ(15,"ul",35)(16,"li"),e._uU(17,"Siempre conduzca de manera defensiva, ya que pueden surgir obst\xe1culos en cualquier momento."),e.qZA(),e.TgZ(18,"li"),e._uU(19,"Recuerde que el exceso de velocidad puede llevar a tragedias."),e.qZA()()()(),e.TgZ(20,"ion-button",36),e._uU(21," Enviar "),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(5),e.Q6J("ngIf",t.car),e.xp6(1),e.Q6J("ngIf",!t.car),e.xp6(14),e.Q6J("disabled",t.isSubmitting)}}const w=[{path:"",component:(()=>{class o{constructor(t,r,n,i,s,u,g){this.router=t,this.formBuilder=r,this.globalService=n,this.userService=i,this.alertController=s,this.route=u,this.photo=g,this.isSubmitting=!1,this.apiError="",this.placa="",this.car="",this.visiblePreguntas=[],this.categoriasOpcionales=[{nombre:"Cisterna",label:"\xbf Su veh\xedculo es tipo cisterna ?",aplica:""},{nombre:"Ninera",label:"Su veh\xedculo es tipo ni\xf1era ?",aplica:""},{nombre:"Refrigeracion",label:"Su veh\xedculo es refrigerado ?",aplica:""}],this.preguntasNoCumplen=[],this.indexActual=0,this.preguntasCompletas=!1,this.preguntas=[],this.secretsAldia={},this.placa=this.userService.getPlaca(),this.preformForm=this.formBuilder.group({}),this.secretsAldia={"X-Client-Id":f.N.aldia.client_id,"X-Client-Secret":f.N.aldia.client_secret}}ngOnInit(){return(0,d.mG)(this,void 0,void 0,function*(){yield this.getPreguntas(),this.preguntas.forEach((t,r)=>{this.preformForm.addControl("pregunta"+(r+1),this.formBuilder.control(""))}),this.route.queryParams.subscribe(t=>(0,d.mG)(this,void 0,void 0,function*(){t&&t.placa&&(this.placa=t.placa,console.log("Placa recibida en preform:",this.placa)),this.cargarPreguntasVisibles()}))})}getPreguntas(){return(0,d.mG)(this,void 0,void 0,function*(){try{const t=yield this.globalService.get(f.N.aldia.uri+"tercero/preoperacional/preguntas?estado=ACTIVO",{},void 0,this.secretsAldia);if(!t||!t.data)return[];const n=t.data.sort((i,s)=>i.subpreope_orden-s.subpreope_orden).map(i=>({id:i.subpreope_codigo,texto:i.subpreope_nombre,descripcion:i.subpreope_descripcion,categoria:i.subpreope_categoria,opcional:"SI"===i.subpreope_restrictivo}));return this.preguntas=n,n}catch(t){this.presentAlert("Error al consumir la API:","Error",t.data,"Volver"),this.apiError="Error al cargar los datos desde el servidor."}})}cargarPreguntasVisibles(){var t;this.visiblePreguntas=[];let r=this.preguntas[this.indexActual];if(r){if(console.log(this.categoriasOpcionales),r.opcional){const i=this.categoriasOpcionales.find(s=>s.nombre===r.categoria);if(console.log(i),i&&""===i.aplica)return void this.visiblePreguntas.push({tipo:"categoria",categoria:i,index:this.indexActual});if(i&&!1===i.aplica)return this.indexActual++,void this.cargarPreguntasVisibles()}this.visiblePreguntas.push({id:r.subpreope_codigo,tipo:"pregunta",texto:r.texto,descripcion:r.descripcion,categoria:r.categoria,index:this.indexActual}),null===(t=this.preformForm.get("pregunta"+(this.indexActual+1)))||void 0===t||t.reset()}}responder(t,r){var n;let i=r.detail.value;if("No Cumple"===i){const u=this.preguntas[t];!this.preguntasNoCumplen.some(h=>h.index===t)&&!u.opcional&&this.preguntasNoCumplen.push({index:t,texto:u.texto,descripcion:u.descripcion})}if(this.indexActual++,null===(n=this.preformForm.get("pregunta"+this.indexActual))||void 0===n||n.setValue(i),this.indexActual>=this.preguntas.length)return this.visiblePreguntas=[],void(this.preguntasCompletas=!0);console.log(this.indexActual),this.cards.find(u=>u.nativeElement.getAttribute("data-index")==t),console.log(this.preformForm.value),this.cargarPreguntasVisibles()}setCategoria(t,r){const n=this.categoriasOpcionales.findIndex(i=>i.nombre===t);-1!==n&&(this.categoriasOpcionales[n].aplica="true"===r.detail.value),console.log(n),this.indexActual++,this.cargarPreguntasVisibles()}marcarSolucionado(t){var r;null===(r=this.preformForm.get("pregunta"+(t+1)))||void 0===r||r.setValue("Cumple"),this.preguntasNoCumplen=this.preguntasNoCumplen.filter(i=>i.index!==t),console.log("Pregunta solucionada:",t)}onFileChange(t){console.log("Archivo seleccionado:",t.target.files[0])}submitForm(){return(0,d.mG)(this,void 0,void 0,function*(){if(this.preformForm.valid){if(console.log("Datos a enviar al servidor:",this.preformForm.value),!this.car)return void this.presentAlert("Por favor, cargue una foto del veh\xedculo.","Click a la camara","","Volver");const r=this.preguntas.map((s,u)=>{var g;const h="pregunta"+(u+1);return{id:this.preguntas[u].id,respuesta:""!=this.preformForm.value[h]?null===(g=this.preformForm.value[h])||void 0===g?void 0:g.toUpperCase():"NO CUMPLE"}}),i={vehiculo:this.placa,empresa:1,confirmacion:0==this.preguntasNoCumplen.length?1:0,imagen:this.car.base64,respuestas:r};this.isSubmitting=!0;try{const s=yield this.globalService.post(f.N.aldia.uri+"tercero/preoperacional",i,void 0,this.secretsAldia);this.presentAlert("Mensaje de Aldia:","",s.data,"Confirmar","/home"),this.apiResponseData=s,this.resetForm()}catch(s){this.isSubmitting=!1,this.presentAlert("Error al consumir la API:","Error",s.data,"Volver"),this.apiError="Error al cargar los datos desde el servidor."}}else this.presentAlert("Error al enviar","","Complete todos los campos","Volver")})}resetForm(){this.preformForm.reset()}validarRespuestas(t){for(const r in t)if(t.hasOwnProperty(r)&&"Cumple"!==t[r])return!1;return!0}getPhotoCar(){this.photo.addNewToAll("car").then(t=>{console.log(t),this.car=t})}presentAlert(t,r,n,i,s){return(0,d.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:""+t,subHeader:""+r,message:""+n,buttons:[{text:""+i,handler:()=>{s&&this.router.navigateByUrl(s)}}]})).present()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.F0),e.Y36(p.qu),e.Y36(b.U),e.Y36(x.K),e.Y36(a.Br),e.Y36(m.gz),e.Y36(C.T))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-preform"]],viewQuery:function(t,r){if(1&t&&e.Gf(Z,5),2&t){let n;e.iGM(n=e.CRH())&&(r.cards=n)}},decls:19,vars:5,consts:[["slot","start"],[1,"ml-3"],[1,"container","panel-turno"],[1,"col-md-12","d-flex","mt-4","mb-4","justify-content-center","text-center","text-white"],[3,"formGroup","ngSubmit"],["class","no-cumple-container",4,"ngIf"],[1,"preguntas-lista"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"no-cumple-container"],[1,"titulo-no-cumple"],[4,"ngFor","ngForOf"],[1,"texto-descripcion"],["color","success","fill","outline","size","small",3,"click"],["class","pregunta-card animate-card",4,"ngIf"],[1,"pregunta-card","animate-card"],[1,"pregunta-titulo"],[1,"radio-group",3,"ionChange"],[1,"radio-option"],["value","true"],["value","false"],["preguntaCard",""],[1,"pregunta-descripcion"],[1,"radio-group",3,"formControlName","ionChange"],["value","Cumple"],["value","No Cumple"],[1,"ml-2","p-2"],[1,"container-upload",3,"click"],[3,"src",4,"ngIf"],["class","camera",4,"ngIf"],[1,"warning-card"],[1,"warning-title"],["name","warning-outline",1,"warning-icon"],[1,"warning-content"],[1,"warning-text"],[1,"warning-list"],["expand","block","color","primary","type","submit","onsubmit","",3,"disabled"],[3,"src"],[1,"camera"]],template:function(t,r){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-menu-button"),e.qZA(),e.TgZ(4,"ion-title",1),e._uU(5,"Pre - operacional"),e.qZA()()(),e.TgZ(6,"div",2)(7,"div",3)(8,"h5"),e._uU(9,"Inspeccion Pre-operacional Vehiculos"),e.qZA()()(),e._UZ(10,"br"),e.TgZ(11,"ion-content")(12,"form",4),e.NdJ("ngSubmit",function(){return r.submitForm()}),e.YNc(13,T,5,1,"div",5),e.TgZ(14,"ion-list",6),e.YNc(15,F,3,2,"ng-container",7),e.qZA(),e._UZ(16,"hr")(17,"hr"),e.YNc(18,M,22,3,"div",8),e.qZA()()),2&t&&(e.xp6(12),e.Q6J("formGroup",r.preformForm),e.xp6(1),e.Q6J("ngIf",r.preguntasNoCumplen.length>0),e.xp6(2),e.Q6J("ngForOf",r.visiblePreguntas)("ngForTrackBy",r.userService.trackByPregunta),e.xp6(3),e.Q6J("ngIf",r.preguntasCompletas))},dependencies:[v.sg,v.O5,p._Y,p.JJ,p.JL,a.YG,a.Sm,a.PM,a.FN,a.Zi,a.Dq,a.W2,a.Gu,a.gu,a.Xz,a.Ie,a.Q$,a.q_,a.fG,a.B7,a.se,a.wd,a.sr,a.U5,a.QI,p.sg,p.u],styles:['@charset "UTF-8";.preguntas-lista[_ngcontent-%COMP%]{padding:0 10px}.pregunta-card[_ngcontent-%COMP%]{background:#ffffff;border-radius:18px;padding:20px;margin:18px 0;box-shadow:0 6px 14px rgba(0,0,0,.1);display:flex;flex-direction:column;animation:_ngcontent-%COMP%_fadeInUp .35s ease}.pregunta-titulo[_ngcontent-%COMP%]{font-size:clamp(1.1rem,6vw,1.6rem);font-weight:700;color:#222;line-height:1.4;margin-bottom:12px}.pregunta-descripcion[_ngcontent-%COMP%]{font-size:clamp(.95rem,4.8vw,1.25rem);color:#444;background:#f5f5f5;padding:14px;border-radius:10px;line-height:1.5;margin-bottom:20px}.radio-group[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;align-items:center;padding-top:14px;border-top:1px solid #e0e0e0}.radio-option[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;font-size:clamp(.9rem,4vw,1.2rem);color:#333}.radio-option[_ngcontent-%COMP%]   ion-radio[_ngcontent-%COMP%]{--size: 28px;--border-radius: 50%}.radio-option[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-top:6px;font-weight:500}.no-cumple-container[_ngcontent-%COMP%]{margin-top:25px;padding:15px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.08)}.titulo-no-cumple[_ngcontent-%COMP%]{font-size:1.3rem;font-weight:700;color:#b30000;margin-bottom:12px}.texto-descripcion[_ngcontent-%COMP%]{font-size:.9rem;color:#555}.card-none[_ngcontent-%COMP%]{background-color:#f17b7b}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}.animate-exit[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeOutDown .3s ease forwards}@keyframes _ngcontent-%COMP%_fadeOutDown{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(20px)}}']}),o})()}];let E=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[m.Bz.forChild(w),m.Bz]}),o})(),S=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[x.K],imports:[v.ez,p.u5,a.Pc,E,P.JF,p.UX]}),o})()}}]);