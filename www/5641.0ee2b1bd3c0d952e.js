(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5641],{5641:(Ky,ps,Ue)=>{"use strict";Ue.r(ps),Ue.d(ps,{DatosPageModule:()=>zy});var ur=Ue(6895),j=Ue(433),ee=Ue(603),Hr=Ue(3599),ue=Ue(7582),l=Ue(1571),Jo=Ue(2263),vs=function(r,n){return(vs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(r,n)};function bt(r,n){function e(){this.constructor=r}vs(r,n),r.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}function X(r,n,e,t){return new(e||(e=Promise))(function(o,a){function i(c){try{u(t.next(c))}catch(h){a(h)}}function s(c){try{u(t.throw(c))}catch(h){a(h)}}function u(c){c.done?o(c.value):new e(function(h){h(c.value)}).then(i,s)}u((t=t.apply(r,n||[])).next())})}function Q(r,n){var e,t,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(c){return function(h){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,t&&(o=2&h[0]?t.return:h[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,h[1])).done)return o;switch(t=0,o&&(h=[2&h[0],o.value]),h[0]){case 0:case 1:o=h;break;case 4:return i.label++,{value:h[1],done:!1};case 5:i.label++,t=h[1],h=[0];continue;case 7:h=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===h[0]||2===h[0])){i=0;continue}if(3===h[0]&&(!o||h[1]>o[0]&&h[1]<o[3])){i.label=h[1];break}if(6===h[0]&&i.label<o[1]){i.label=o[1],o=h;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(h);break}o[2]&&i.ops.pop(),i.trys.pop();continue}h=n.call(r,i)}catch(d){h=[6,d],t=0}finally{e=o=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([u,c])}}}var Fh=function(){function r(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(n,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=n,this.platform=e},r.prototype.registerFlag=function(n,e,t){if(this.flagRegistry[n]={evaluationFn:e,setHook:t},null!=this.urlFlags[n]){var o=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+o+"."),this.set(n,o)}},r.prototype.get=function(n){return n in this.flags||(this.flags[n]=this.evaluateFlag(n)),this.flags[n]},r.prototype.getNumber=function(n){return this.get(n)},r.prototype.getBool=function(n){return this.get(n)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(n,e){if(null==this.flagRegistry[n])throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=e,null!=this.flagRegistry[n].setHook&&this.flagRegistry[n].setHook(e)},r.prototype.evaluateFlag=function(n){if(null==this.flagRegistry[n])throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},r.prototype.setFlags=function(n){this.flags=Object.assign({},n)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var n=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,o=(t={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(a){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];return function Mh(r,n,e){r[decodeURIComponent(n)]=decodeURIComponent(e||"")}(t,i[0],i[1]),i.join("=")}),t);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(a){var i=a.split(":"),s=i[0];n.urlFlags[s]=function(c,h){if("true"===(h=h.toLowerCase())||"false"===h)return"true"===h;if(""+ +h===h)return+h;throw new Error("Could not parse value flag value "+h+" for flag "+c+".")}(s,i[1])})}},r}();function O(){return ms}var ms=null,Bn=new Map,cr=new Map;function gs(r,n){var e=Yo(r,n);return Bn.get(e)}function ys(r){for(var n=Bn.entries(),e=[];;){var t=n.next(),a=t.value;if(t.done)break;var s=a[1];a[0].split("_")[0]===r&&e.push(s)}return e}function xs(r){var n=r.kernelName,e=r.backendName,t=Yo(n,e);if(Bn.has(t))throw new Error("The kernel '"+n+"' for backend '"+e+"' is already registered");Bn.set(t,r)}function Bh(r){var n=r.kernelName;cr.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),cr.set(n,r)}function Yo(r,n){return n+"_"+r}function bs(r){for(var n=r.length,e=0,t=0;n>0;)t=Math.random()*n|0,e=r[--n],r[n]=r[t],r[t]=e}function Zr(r,n,e){return Math.max(r,Math.min(n,e))}function Xo(r){return r%2==0?r:r+1}function _s(r){for(var n=0,e=0;e<r.length;e++)n+=r[e];return n}function E(r,n){if(!r)throw new Error("string"==typeof n?n:n())}function ge(r,n,e){void 0===e&&(e=""),E(Oe(r,n),function(){return e+" Shapes "+r+" and "+n+" must match"})}function bn(r){E(null!=r,function(){return"The input to the tensor constructor must be a non-null value."})}function qt(r,n,e){if(void 0===n&&(n=[]),void 0===e&&(e=!1),null==n&&(n=[]),Array.isArray(r)||Ke(r)&&!e)for(var t=0;t<r.length;++t)qt(r[t],n,e);else n.push(r);return n}function $(r){if(0===r.length)return 1;for(var n=r[0],e=1;e<r.length;e++)n*=r[e];return n}function Oe(r,n){if(r===n)return!0;if(null==r||null==n||r.length!==n.length)return!1;for(var e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}function Ae(r){return r%1==0}function ws(r){if(null!=Math.tanh)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var n=Math.exp(2*r);return(n-1)/(n+1)}function jr(r){var n=Math.ceil(Math.sqrt(r));return[n,Math.ceil(r/n)]}function _n(r,n){return n<=r.length?r:r+" ".repeat(n-r.length)}function Qo(r,n,e){return void 0===n&&(n=function(t){return 0}),new Promise(function(t,o){var a=0,i=function(){if(r())t();else{a++;var s=n(a);null!=e&&a>=e?o():setTimeout(i,s)}};i()})}function Cs(r,n){for(var e=1,t=-1,o=0;o<r.length;++o)if(r[o]>=0)e*=r[o];else if(-1===r[o]){if(-1!==t)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+t+" and dim "+o);t=o}else if(r[o]<0)throw Error("Shapes can not be < 0. Found "+r[o]+" at dim "+o);if(-1===t){if(n>0&&n!==e)throw Error("Size("+n+") must match the product of shape "+r);return r}if(0===e)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(n%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+e);var a=r.slice();return a[t]=n/e,a}function Be(r,n){var e=n.length;return E((r=null==r?n.map(function(t,o){return o}):[].concat(r)).every(function(t){return t>=-e&&t<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+r}),E(r.every(function(t){return Ae(t)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(t){return t<0?e+t:t})}function on(r,n){for(var e=[],t=[],o=null!=n&&Array.isArray(n)&&0===n.length,a=null==n||o?null:Be(n,r).sort(),i=0,s=0;s<r.length;++s){if(null!=a){if(a[i]===s&&1!==r[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(null==a[i]||a[i]>s)&&1===r[s]&&(e.push(r[s]),t.push(s)),a[i]<=s&&i++}1!==r[s]&&(e.push(r[s]),t.push(s))}return{newShape:e,keptDims:t}}function Ln(r,n){var e=null;if(null==r||"float32"===r)e=new Float32Array(n);else if("int32"===r)e=new Int32Array(n);else{if("bool"!==r)throw new Error("Unknown data type "+r);e=new Uint8Array(n)}return e}function lr(r,n){var e=null;if(null==r||"float32"===r)e=new Float32Array(n);else if("int32"===r)e=new Int32Array(n);else if("bool"===r)e=new Uint8Array(n);else{if("string"!==r)throw new Error("Unknown data type "+r);e=new Array(n)}return e}function Ts(r,n){for(var e=0;e<r.length;e++){var t=r[e];if(isNaN(t)||!isFinite(t))throw Error("A tensor of type "+n+" being uploaded contains "+t+".")}}function Es(r){return"bool"===r||"complex64"===r||"float32"===r||"int32"===r||"string"===r}function Is(r,n){return!("complex64"===n||"float32"===n&&"complex64"!==r||"int32"===n&&"float32"!==r&&"complex64"!==r||"bool"===n&&"bool"===r)}function Ke(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function $o(r){if("float32"===r||"int32"===r)return 4;if("complex64"===r)return 8;if("bool"===r)return 1;throw new Error("Unknown dtype "+r)}function Ds(r){if(null==r)return 0;var n=0;return r.forEach(function(e){return n+=e.length}),n}function an(r){return"string"==typeof r||r instanceof String}function ks(r){return"boolean"==typeof r}function As(r){return"number"==typeof r}function Wn(r){return Array.isArray(r)?Wn(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":As(r)?"float32":an(r)?"string":ks(r)?"bool":"float32"}function sn(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Kr(r,n){for(var e=n;e<r;++e)if(r%e==0)return e;return r}function _t(r){var n=r.length;if(n<2)return[];var e=new Array(n-1);e[n-2]=r[n-1];for(var t=n-3;t>=0;--t)e[t]=e[t+1]*r[t+1];return e}function ea(r,n,e){if("string"===n)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=qt(r)),e&&Ts(r,n),i=n,(a=r)instanceof Float32Array&&"float32"===i||a instanceof Int32Array&&"int32"===i||a instanceof Uint8Array&&"bool"===i)return r;var a,i;if(null==n||"float32"===n||"complex64"===n)return new Float32Array(r);if("int32"===n)return new Int32Array(r);if("bool"===n){for(var t=new Uint8Array(r.length),o=0;o<t.length;++o)0!==Math.round(r[o])&&(t[o]=1);return t}throw new Error("Unknown data type "+n)}function ta(r,n){if(0===r.length)return n[0];var e=r.reduce(function(t,o){return t*o});if(0===e)return[];if(e!==n.length)throw new Error("["+r+"] does not match the input size.");return function t(o,a,i){var s=new Array;if(1===a.length)for(var u=a[0],c=0;c<u;c++)s[c]=i[o+c];else{u=a[0];var h=a.slice(1),d=h.reduce(function(f,p){return f*p});for(c=0;c<u;c++)s[c]=t(o+c*d,h,i)}return s}(0,r,n)}function na(r,n){for(var e=Un(r,n),t=0;t<e.length;t++)e[t]=1;return e}function Un(r,n){if(null==n||"float32"===n||"complex64"===n)return new Float32Array(r);if("int32"===n)return new Int32Array(r);if("bool"===n)return new Uint8Array(r);throw new Error("Unknown data type "+n)}function wt(){return O().platform.now()}function ra(r){r.forEach(function(n){E(Number.isInteger(n)&&n>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function Ss(r,n){return void 0===n&&(n="utf-8"),n=n||"utf-8",O().platform.encode(r,n)}function hr(r,n){return void 0===n&&(n="utf-8"),n=n||"utf-8",O().platform.decode(r,n)}function oa(r,n,e){if(0===n)return 0;if(1===n)return r[0];for(var t=r[r.length-1],o=0;o<r.length-1;++o)t+=e[o]*r[o];return t}function Rs(r,n,e){if(0===n)return[];if(1===n)return[r];for(var t=new Array(n),o=0;o<t.length-1;++o)t[o]=Math.floor(r/e[o]),r-=t[o]*e[o];return t[t.length-1]=r,t}Object.freeze({shuffle:bs,clamp:Zr,nearestLargerEven:Xo,sum:_s,randUniform:function(r,n){var e=Math.random();return n*e+(1-e)*r},distSquared:function(r,n){for(var e=0,t=0;t<r.length;t++){var o=Number(r[t])-Number(n[t]);e+=o*o}return e},assert:E,assertShapesMatch:ge,assertNonNull:bn,flatten:qt,sizeFromShape:$,isScalarShape:function(r){return 0===r.length},arraysEqual:Oe,isInt:Ae,tanh:ws,sizeToSquarishShape:jr,createShuffledIndices:function(r){for(var n=new Uint32Array(r),e=0;e<r;++e)n[e]=e;return bs(n),n},rightPad:_n,repeatedTry:Qo,inferFromImplicitShape:Cs,parseAxisParam:Be,squeezeShape:on,getTypedArrayFromDType:Ln,getArrayFromDType:lr,checkConversionForErrors:Ts,isValidDtype:Es,hasEncodingLoss:Is,isTypedArray:Ke,bytesPerElement:$o,bytesFromStringArray:Ds,isString:an,isBoolean:ks,isNumber:As,inferDtype:Wn,isFunction:sn,nearestDivisor:Kr,computeStrides:_t,toTypedArray:ea,toNestedArray:ta,makeOnesTypedArray:na,makeZerosTypedArray:Un,now:wt,assertNonNegativeIntegerDimensions:ra,fetch:function(r,n){return O().platform.fetch(r,n)},encodeString:Ss,decodeString:hr,locToIndex:oa,indexToLoc:Rs});var Lh=function(){function r(n,e){this.backendTimer=n,this.logger=e,null==e&&(this.logger=new Wh)}return r.prototype.profileKernel=function(n,e,t){var o,a=this,i=this.backendTimer.time(function(){o=t()});return o.forEach(function(s){s.data().then(function(u){(function(c,h,d){if("float32"!==h)return!1;for(var f=0;f<c.length;f++){var p=c[f];if(isNaN(p)||!isFinite(p))return console.warn("Found "+p+" in the result of '"+d+"'"),!0}})(u,s.dtype,n),i.then(function(c){var h="";null!=c.getExtraProfileInfo&&(h=c.getExtraProfileInfo()),a.logger.logKernelProfile(n,s,u,c.kernelMs,e,h)})})}),o},r}(),Wh=function(){function r(){}return r.prototype.logKernelProfile=function(n,e,t,o,a,i){var s="number"==typeof o?_n(o+"ms",9):o.error,u=_n(n,25),c=e.rank,h=e.size,d=_n(e.shape.toString(),14),f="";for(var p in a){var v=a[p].shape||e.shape,m=v.length;f+=p+": "+m+"D "+(m>0?v:"")+" "}console.log("%c"+u+"\t%c"+s+"\t%c"+c+"D "+d+"\t%c"+h+"\t%c"+f+"\t%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}(),aa=7;function fr(r,n,e){return _n(Array.isArray(r)?parseFloat(r[0].toFixed(aa))+" + "+parseFloat(r[1].toFixed(aa))+"j":an(r)?"'"+r+"'":"bool"===e?Ns(r):parseFloat(r.toFixed(aa)).toString(),n)}function Ns(r){return 0===r?"false":"true"}function pr(r){for(var n=[],e=0;e<r.length;e+=2)n.push([r[e],r[e+1]]);return n}var vr=function(){function r(n,e,t){var o=this;if(this.dtype=e,this.shape=n.slice(),this.size=$(n),null!=t){var a=t.length;E(a===this.size,function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+o.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=t||lr(e,this.size),this.strides=_t(n)}return r.prototype.set=function(n){for(var e=this,t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];0===t.length&&(t=[0]),E(t.length===this.rank,function(){return"The number of provided coordinates ("+t.length+") must match the rank ("+e.rank+")"});var a=this.locToIndex(t);this.values[a]=n},r.prototype.get=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];0===n.length&&(n=[0]);for(var t=0,o=0,a=n;o<a.length;o++){var i=a[o];if(i<0||i>=this.shape[t])throw new Error("Requested out of range element at "+n+".   Buffer shape="+this.shape);t++}for(var u=n[n.length-1],c=0;c<n.length-1;++c)u+=this.strides[c]*n[c];return this.values[u]},r.prototype.locToIndex=function(n){if(0===this.rank)return 0;if(1===this.rank)return n[0];for(var e=n[n.length-1],t=0;t<n.length-1;++t)e+=this.strides[t]*n[t];return e},r.prototype.indexToLoc=function(n){if(0===this.rank)return[];if(1===this.rank)return[n];for(var e=new Array(this.shape.length),t=0;t<e.length-1;++t)e[t]=Math.floor(n/this.strides[t]),n-=e[t]*this.strides[t];return e[e.length-1]=n,e},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return At().makeTensor(this.values,this.shape,this.dtype)},r}(),At=null,M=null,Fs=null,Ee=function(){function r(n,e,t,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=$(n),this.strides=_t(n),this.dataId=t,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),E(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(n,e){return this.throwIfDisposed(),this.reshape([n,e])},r.prototype.as3D=function(n,e,t){return this.throwIfDisposed(),this.reshape([n,e,t])},r.prototype.as4D=function(n,e,t,o){return this.throwIfDisposed(),this.reshape([n,e,t,o])},r.prototype.as5D=function(n,e,t,o,a){return this.throwIfDisposed(),this.reshape([n,e,t,o,a])},r.prototype.asType=function(n){return this.throwIfDisposed(),M.cast(this,n)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return X(this,void 0,void 0,function(){var n;return Q(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,M.buffer(this.shape,this.dtype,n)]}})})},r.prototype.bufferSync=function(){return M.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return X(this,void 0,void 0,function(){var n;return Q(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,ta(this.shape,n)]}})})},r.prototype.arraySync=function(){return ta(this.shape,this.dataSync())},r.prototype.data=function(){return X(this,void 0,void 0,function(){var n,e;return Q(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),n=At().read(this.dataId),"string"!==this.dtype?[3,2]:[4,n];case 1:e=t.sent();try{return[2,e.map(function(o){return hr(o)})]}catch(o){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}t.label=2;case 2:return[2,n]}})})},r.prototype.dataSync=function(){this.throwIfDisposed();var n=At().readSync(this.dataId);if("string"===this.dtype)try{return n.map(function(e){return hr(e)})}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},r.prototype.bytes=function(){return X(this,void 0,void 0,function(){var n;return Q(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,At().read(this.dataId)];case 1:return n=e.sent(),"string"===this.dtype?[2,n]:[2,new Uint8Array(n.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(At().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(n){return void 0===n&&(n=!1),M.print(this,n)},r.prototype.reshape=function(n){return this.throwIfDisposed(),M.reshape(this,n)},r.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},r.prototype.expandDims=function(n){return void 0===n&&(n=0),M.expandDims(this,n)},r.prototype.cumsum=function(n,e,t){return void 0===n&&(n=0),void 0===e&&(e=!1),void 0===t&&(t=!1),M.cumsum(this,n,e,t)},r.prototype.squeeze=function(n){return this.throwIfDisposed(),M.squeeze(this,n)},r.prototype.clone=function(){return this.throwIfDisposed(),M.clone(this)},r.prototype.oneHot=function(n,e,t){return this.throwIfDisposed(),M.oneHot(this,n,e,t)},r.prototype.toString=function(n){return void 0===n&&(n=!1),function Uh(r,n,e,t){var o=_t(n),a=function(c,h,d,f){var p=$(h),v=f[f.length-1],m=new Array(v).fill(0),g=h.length,y="complex64"===d?pr(c):c;if(g>1)for(var x=0;x<p/v;x++)for(var b=x*v,_=0;_<v;_++)m[_]=Math.max(m[_],fr(y[b+_],0,d).length);return m}(r,n,e,o),i=n.length,s=function c(h,d,f,p,v,m){void 0===m&&(m=!0);var g="complex64"===f?2:1,y=d[0],x=d.length;if(0===x)return"complex64"===f?[fr(pr(h)[0],0,f)]:"bool"===f?[Ns(h[0])]:[h[0].toString()];if(1===x){if(y>20){var _=Array.from(h.slice(0,3*g)),w=Array.from(h.slice((y-3)*g,y*g));return"complex64"===f&&(_=pr(_),w=pr(w)),["["+_.map(function(L,q){return fr(L,v[q],f)}).join(", ")+", ..., "+w.map(function(L,q){return fr(L,v[y-3+q],f)}).join(", ")+"]"]}return["["+("complex64"===f?pr(h):Array.from(h)).map(function(L,q){return fr(L,v[q],f)}).join(", ")+"]"]}var T=d.slice(1),A=p.slice(1),k=p[0]*g,I=[];if(y>20){for(var D=0;D<3;D++){var N=(P=D*k)+k;I.push.apply(I,c(h.slice(P,N),T,f,A,v,!1))}for(I.push("..."),D=y-3;D<y;D++)N=(P=D*k)+k,I.push.apply(I,c(h.slice(P,N),T,f,A,v,D===y-1))}else for(D=0;D<y;D++){var P;N=(P=D*k)+k,I.push.apply(I,c(h.slice(P,N),T,f,A,v,D===y-1))}var W=2===x?",":"";for(I[0]="["+I[0]+W,D=1;D<I.length-1;D++)I[D]=" "+I[D]+W;var B=",\n";for(D=2;D<x;D++)B+="\n";return I[I.length-1]=" "+I[I.length-1]+"]"+(m?"":B),I}(r,n,e,o,a),u=["Tensor"];return t&&(u.push("  dtype: "+e),u.push("  rank: "+i),u.push("  shape: ["+n+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,n)},r.prototype.tile=function(n){return this.throwIfDisposed(),M.tile(this,n)},r.prototype.gather=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),M.gather(this,n,e)},r.prototype.matMul=function(n,e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),this.throwIfDisposed(),M.matMul(this,n,e,t)},r.prototype.dot=function(n){return this.throwIfDisposed(),M.dot(this,n)},r.prototype.norm=function(n,e,t){return void 0===n&&(n="euclidean"),void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),M.norm(this,n,e,t)},r.prototype.slice=function(n,e){return this.throwIfDisposed(),M.slice(this,n,e)},r.prototype.reverse=function(n){return this.throwIfDisposed(),M.reverse(this,n)},r.prototype.concat=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),n instanceof r&&(n=[n]),M.concat([this].concat(n),e)},r.prototype.split=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),M.split(this,n,e)},r.prototype.stack=function(n,e){return void 0===e&&(e=0),M.stack([this,n],e)},r.prototype.unstack=function(n){return void 0===n&&(n=0),M.unstack(this,n)},r.prototype.pad=function(n,e){return void 0===e&&(e=0),M.pad(this,n,e)},r.prototype.batchNormalization=function(n,e,t,o,a){return void 0===t&&(t=.001),Fs("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,e,a,o,t)},r.prototype.batchNorm=function(n,e,t,o,a){return void 0===a&&(a=.001),this.throwIfDisposed(),M.batchNorm(this,n,e,t,o,a)},r.prototype.all=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),M.all(this,n,e)},r.prototype.any=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),M.any(this,n,e)},r.prototype.logSumExp=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),M.logSumExp(this,n,e)},r.prototype.sum=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),M.sum(this,n,e)},r.prototype.prod=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),M.prod(this,n,e)},r.prototype.mean=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),M.mean(this,n,e)},r.prototype.min=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),M.min(this,n,e)},r.prototype.max=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),M.max(this,n,e)},r.prototype.argMin=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),M.argMin(this,n)},r.prototype.argMax=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),M.argMax(this,n)},r.prototype.cast=function(n){return this.throwIfDisposed(),M.cast(this,n)},r.prototype.add=function(n){return this.throwIfDisposed(),M.add(this,n)},r.prototype.addStrict=function(n){return this.throwIfDisposed(),M.addStrict(this,n)},r.prototype.atan2=function(n){return this.throwIfDisposed(),M.atan2(this,n)},r.prototype.sub=function(n){return this.throwIfDisposed(),M.sub(this,n)},r.prototype.subStrict=function(n){return this.throwIfDisposed(),M.subStrict(this,n)},r.prototype.pow=function(n){return this.throwIfDisposed(),M.pow(this,n)},r.prototype.powStrict=function(n){return this.throwIfDisposed(),M.powStrict(this,n)},r.prototype.mul=function(n){return this.throwIfDisposed(),M.mul(this,n)},r.prototype.mulStrict=function(n){return this.throwIfDisposed(),M.mulStrict(this,n)},r.prototype.div=function(n){return this.throwIfDisposed(),M.div(this,n)},r.prototype.divNoNan=function(n){return this.throwIfDisposed(),M.divNoNan(this,n)},r.prototype.floorDiv=function(n){return this.throwIfDisposed(),M.floorDiv(this,n)},r.prototype.divStrict=function(n){return this.throwIfDisposed(),M.divStrict(this,n)},r.prototype.minimum=function(n){return this.throwIfDisposed(),M.minimum(this,n)},r.prototype.minimumStrict=function(n){return this.throwIfDisposed(),M.minimumStrict(this,n)},r.prototype.maximum=function(n){return this.throwIfDisposed(),M.maximum(this,n)},r.prototype.maximumStrict=function(n){return this.throwIfDisposed(),M.maximumStrict(this,n)},r.prototype.mod=function(n){return this.throwIfDisposed(),M.mod(this,n)},r.prototype.modStrict=function(n){return this.throwIfDisposed(),M.modStrict(this,n)},r.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),M.squaredDifferenceStrict(this,n)},r.prototype.transpose=function(n){return this.throwIfDisposed(),M.transpose(this,n)},r.prototype.notEqual=function(n){return this.throwIfDisposed(),M.notEqual(this,n)},r.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),M.notEqualStrict(this,n)},r.prototype.less=function(n){return this.throwIfDisposed(),M.less(this,n)},r.prototype.lessStrict=function(n){return this.throwIfDisposed(),M.lessStrict(this,n)},r.prototype.equal=function(n){return this.throwIfDisposed(),M.equal(this,n)},r.prototype.equalStrict=function(n){return this.throwIfDisposed(),M.equalStrict(this,n)},r.prototype.lessEqual=function(n){return this.throwIfDisposed(),M.lessEqual(this,n)},r.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),M.lessEqualStrict(this,n)},r.prototype.greater=function(n){return this.throwIfDisposed(),M.greater(this,n)},r.prototype.greaterStrict=function(n){return this.throwIfDisposed(),M.greaterStrict(this,n)},r.prototype.greaterEqual=function(n){return this.throwIfDisposed(),M.greaterEqual(this,n)},r.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),M.greaterEqualStrict(this,n)},r.prototype.logicalAnd=function(n){return this.throwIfDisposed(),M.logicalAnd(this,n)},r.prototype.logicalOr=function(n){return this.throwIfDisposed(),M.logicalOr(this,n)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),M.logicalNot(this)},r.prototype.logicalXor=function(n){return this.throwIfDisposed(),M.logicalXor(this,n)},r.prototype.where=function(n,e){return this.throwIfDisposed(),M.where(n,this,e)},r.prototype.neg=function(){return this.throwIfDisposed(),M.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),M.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),M.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),M.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),M.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),M.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),M.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),M.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),M.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),M.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),M.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),M.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),M.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),M.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),M.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),M.abs(this)},r.prototype.clipByValue=function(n,e){return this.throwIfDisposed(),M.clipByValue(this,n,e)},r.prototype.relu=function(){return this.throwIfDisposed(),M.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),M.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),M.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),M.selu(this)},r.prototype.leakyRelu=function(n){return void 0===n&&(n=.2),this.throwIfDisposed(),M.leakyRelu(this,n)},r.prototype.prelu=function(n){return this.throwIfDisposed(),M.prelu(this,n)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),M.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),M.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),M.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),M.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),M.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),M.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),M.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),M.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),M.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),M.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),M.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),M.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),M.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),M.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),M.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),M.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),M.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),M.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),M.round(this)},r.prototype.step=function(n){return void 0===n&&(n=0),this.throwIfDisposed(),M.step(this,n)},r.prototype.softmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),M.softmax(this,n)},r.prototype.logSoftmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),M.logSoftmax(this,n)},r.prototype.resizeBilinear=function(n,e){return void 0===e&&(e=!1),this.throwIfDisposed(),M.image.resizeBilinear(this,n,e)},r.prototype.resizeNearestNeighbor=function(n,e){return void 0===e&&(e=!1),this.throwIfDisposed(),M.image.resizeNearestNeighbor(this,n,e)},r.prototype.conv1d=function(n,e,t,o,a,i){return void 0===o&&(o="NWC"),void 0===a&&(a=1),this.throwIfDisposed(),M.conv1d(this,n,e,t,o,a,i)},r.prototype.conv2d=function(n,e,t,o,a,i){return void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]),this.throwIfDisposed(),M.conv2d(this,n,e,t,o,a,i)},r.prototype.conv2dTranspose=function(n,e,t,o,a){return this.throwIfDisposed(),M.conv2dTranspose(this,n,e,t,o,a)},r.prototype.depthwiseConv2D=function(n,e,t,o,a,i){return void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]),this.throwIfDisposed(),M.depthwiseConv2d(this,n,e,t,o,a,i)},r.prototype.separableConv2d=function(n,e,t,o,a,i){return void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),M.separableConv2d(this,n,e,t,o,a,i)},r.prototype.avgPool=function(n,e,t,o){return this.throwIfDisposed(),M.avgPool(this,n,e,t,o)},r.prototype.maxPool=function(n,e,t,o){return this.throwIfDisposed(),M.maxPool(this,n,e,t,o)},r.prototype.localResponseNormalization=function(n,e,t,o){return void 0===n&&(n=5),void 0===e&&(e=1),void 0===t&&(t=1),void 0===o&&(o=.5),M.localResponseNormalization(this,n,e,t,o)},r.prototype.pool=function(n,e,t,o,a){return this.throwIfDisposed(),M.pool(this,n,e,t,o,a)},r.prototype.variable=function(n,e,t){return void 0===n&&(n=!0),this.throwIfDisposed(),At().makeVariable(this,n,e,t)},r.prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),M.unsortedSegmentSum(this,n,e)},r.prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),M.batchToSpaceND(this,n,e)},r.prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),M.spaceToBatchND(this,n,e)},r.prototype.topk=function(n,e){return void 0===n&&(n=1),void 0===e&&(e=!0),this.throwIfDisposed(),M.topk(this,n,e)},r.prototype.stridedSlice=function(n,e,t,o,a,i,s,u){return void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),this.throwIfDisposed(),M.stridedSlice(this,n,e,t,o,a,i,s,u)},r.prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),M.depthToSpace(this,n,e)},r.prototype.fft=function(){return this.throwIfDisposed(),M.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),M.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),M.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),M.spectral.irfft(this)},r}();Object.defineProperty(Ee,Symbol.hasInstance,{value:function(r){return!!r&&null!=r.dataId&&null!=r.shape&&null!=r.dtype}});var Ms,ia,sa,ua,ca,r,Vn=function(r){function n(e,t,o,a){var i=r.call(this,e.shape,e.dtype,e.dataId,a)||this;return i.trainable=t,i.name=o,i}return bt(n,r),n.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Oe(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");At().disposeTensor(this),this.dataId=e.dataId,At().incRef(this,null)},n.prototype.dispose=function(){At().disposeVariable(this),this.isDisposedInternal=!0},n}(Ee);Object.defineProperty(Vn,Symbol.hasInstance,{value:function(r){return r instanceof Ee&&null!=r.assign&&r.assign instanceof Function}}),(r=Ms||(Ms={})).R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6",function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"}(ia||(ia={})),function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"}(sa||(sa={})),function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"}(ua||(ua={})),function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"}(ca||(ca={}));var Vh={float32:ua,int32:ia,bool:sa,complex64:ca};function He(r,n){if("string"===r||"string"===n){if("string"===r&&"string"===n)return"string";throw new Error("Can not upcast "+r+" with "+n)}return Vh[r][n]}function la(r){return He(r,"int32")}function ke(r,n){if(r.dtype===n.dtype)return[r,n];var e=He(r.dtype,n.dtype);return[r.cast(e),n.cast(e)]}function Os(r,n){E(r.dtype===n.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+n.dtype+") input must match"})}function ha(r){var n=[];return function e(t,o,a){if(null!=t){if(t instanceof Ee)return void o.push(t);if(i=t,Array.isArray(i)||"object"==typeof i){var i,s=t;for(var u in s){var c=s[u];a.has(c)||(a.add(c),e(c,o,a))}}}}(r,n,new Set),n}Object.freeze({makeTypesMatch:ke,assertTypesMatch:Os,isTensorInList:function(r,n){return n.some(function(e){return e.id===r.id})},getTensorsInContainer:ha});var da,Bs=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},r}(),Gh=function(){function r(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Bs}return r.prototype.ready=function(){return X(this,void 0,void 0,function(){var n,e,t;return Q(this,function(o){switch(o.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];n=this.getSortedBackends(),e=0,o.label=1;case 1:return e<n.length?[4,this.initializeBackend(t=n[e]).success]:[3,5];case 2:return o.sent()?[4,this.setBackend(t)]:[3,4];case 3:return o.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var n=this.initializeBackendsAndReturnBest(),e=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(n){return n in this.registry||n in this.registryFactory&&!this.initializeBackend(n).asyncInit?this.registry[n]:null},r.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},r.prototype.registerBackend=function(n,e,t){return void 0===t&&(t=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:e,priority:t},!0)},r.prototype.setBackend=function(n){return X(this,void 0,void 0,function(){var e,t,o;return Q(this,function(a){switch(a.label){case 0:if(null==this.registryFactory[n])throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,null!=this.registry[n]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(n),t=e.success,e.asyncInit?[4,t]:[3,2]);case 1:return o=a.sent(),[3,3];case 2:o=t,a.label=3;case 3:if(!o)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new Lh(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var n=this;ys(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(n.backendInstance)})},r.prototype.disposeRegisteredKernels=function(n){var e=this;ys(n).forEach(function(t){null!=t.disposeFunc&&t.disposeFunc(e.registry[n])})},r.prototype.initializeBackend=function(n){var e=this,t=this.registryFactory[n];if(null==t)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var o=t.factory();if(Promise.resolve(o)===o){var a=++this.pendingBackendInitId,i=o.then(function(s){return!(a<e.pendingBackendInitId||(e.registry[n]=s,e.pendingBackendInit=null,0))}).catch(function(s){return!(a<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),1))});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[n]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var n=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,t){return n.registryFactory[t].priority-n.registryFactory[e].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),e=0;e<n.length;e++){var t=n[e],o=this.initializeBackend(t),i=o.asyncInit;if(i||o.success)return{name:t,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(n,e){var t=this.state.tensorInfo.get(e),o=t.backend,a=this.readSync(e);o.disposeData(e),t.backend=n,n.move(e,a,t.shape,t.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(n,e){var t,o=this,a=null;if(null==e){if("function"!=typeof n)throw new Error("Please provide a function to tidy()");e=n}else{if("string"!=typeof n&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=n}return this.scopedRun(function(){return o.startScope(a)},function(){return o.endScope(t)},function(){return(t=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),t})},r.prototype.scopedRun=function(n,e,t){n();try{var o=t();return e(),o}catch(a){throw e(),a}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(n){var e=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype);return this.addTapeNode(this.state.activeScope.name,{x:n},[e],function(o){return{x:function(){return o.toFloat()}}},[]),e},r.prototype.runKernel=function(n,e,t,o,a){return this.runKernelFunc(null,e,null,n,t,o,a)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(n,e,t){var o=this.backend.numDataIds(),a=0;t.forEach(function(u){a+="complex64"===u.dtype?3:1});var s=o-e-a-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+n+"'")},r.prototype.runKernelFunc=function(n,e,t,o,a,i,s){var u,c=this;void 0===i&&(i=[]),void 0===s&&(s=[]);var h=[],d=this.isTapeOn();null==o&&(o=null!=this.state.activeScope?this.state.activeScope.name:"");var f,p=function(x){d&&(h=x.map(function(b){return c.keep(c.clone(b))}))},v=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,y=gs(o,this.backendName);return f=null!=y?function(){var x=c.backend.numDataIds();g=y.kernelFunc({inputs:e,attrs:a,backend:c.backend});var b=Array.isArray(g)?g:[g];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,x,b);var _=b.map(function(T){return c.makeTensorFromDataId(T.dataId,T.shape,T.dtype)}),w=_.filter(function(T,A){return s[A]});return p((i||[]).slice().concat(w)),_}:function(){var x=c.backend.numDataIds();g=c.tidy(function(){return n(c.backend,p)});var b=Array.isArray(g)?g:[g];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,x,b),b},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(o,e,function(){return f()}):f()}),d&&this.addTapeNode(o,e,u,t,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-v,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(x){return e[x].shape}),outputShapes:u.map(function(x){return x.shape})}),Array.isArray(g)?u:u[0]},r.prototype.makeTensor=function(n,e,t,o){if(null==n)throw new Error("Values passed to engine.makeTensor() are null");o=o||this.backend;var a=n;"string"===(t=t||"float32")&&an(n[0])&&(a=n.map(function(h){return Ss(h)}));var i=o.write(a,e,t),s=new Ee(e,t,i,this.nextTensorId());if(this.incRef(s,o),"string"===t){var u=this.state.tensorInfo.get(i),c=Ds(a);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(n,e,t,o){var a=new Ee(e,t=t||"float32",n,this.nextTensorId());return this.incRef(a,o),a},r.prototype.makeVariable=function(n,e,t,o){void 0===e&&(e=!0),t=t||this.nextVariableId().toString(),null!=o&&o!==n.dtype&&(n=n.asType(o));var a=new Vn(n,e,t,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},r.prototype.incRef=function(n,e){var t=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,"string"===n.dtype&&this.state.numStringTensors++,0===t){this.state.numDataBuffers++;var o=0;"complex64"!==n.dtype&&"string"!==n.dtype&&(o=n.size*$o(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:e||this.backend,dtype:n.dtype,shape:n.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof Vn||this.track(n)},r.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,"string"===n.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(n.dataId);e.refCount<=1?("complex64"!==n.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[n])},r.prototype.disposeVariable=function(n){this.disposeTensor(n),null!=this.state.registeredVariables[n.name]&&delete this.state.registeredVariables[n.name]},r.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,null==n.reasons&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},r.prototype.profile=function(n){return X(this,void 0,void 0,function(){var e,t;return Q(this,function(o){return this.state.profiling=!0,e=this.state.numBytes,t=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(a){return a.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-t,[2,this.state.activeProfile]})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},r.prototype.addTapeNode=function(n,e,t,o,a){var i=this,s={id:this.state.nextTapeNodeId++,kernelName:n,inputs:e,outputs:t,saved:a},u=function Oh(r){return cr.get(r)}(n);null!=u&&(o=u.gradFunc),null!=o&&(s.gradient=function(c){return c=c.map(function(h,d){if(null==h){var f=t[d],p=Un(f.size,f.dtype);return i.makeTensor(p,f.shape,f.dtype)}return h}),o(c.length>1?c:c[0],a)}),this.state.activeTape.push(s)},r.prototype.keep=function(n){return n.kept=!0,n},r.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(n){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(e.name=n),this.state.scopeStack.push(e),this.state.activeScope=e},r.prototype.endScope=function(n){for(var e=this,t=ha(n),o=new Set(t.map(function(u){return u.id})),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||o.has(i.id)||i.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(function(u){u.kept||u.scopeId!==s.id||e.track(u)})},r.prototype.gradients=function(n,e,t,o){var a=this;if(void 0===o&&(o=!1),E(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=t&&"float32"!==t.dtype)throw new Error("dy must have 'float32' dtype, but has '"+t.dtype+"'");var i=this.scopedRun(function(){return a.startTape()},function(){return a.endTape()},function(){return a.tidy("forward",n)});E(i instanceof Ee,function(){return"The result y returned by f() must be a tensor."});var s=function(u,c,h){for(var d={},f={},p=0;p<c.length;p++)d[c[p].id]=!0;for(p=0;p<u.length;p++){var v=(T=u[p]).inputs;for(var m in v){for(var g=v[m],y=!1,x=0;x<c.length;x++)if(d[g.id]){T.outputs.forEach(function(D){return d[D.id]=!0}),y=!0,f[T.id]=!0;break}if(y)break}}var b={};b[h.id]=!0;var _={};for(p=u.length-1;p>=0;p--)for(v=(T=u[p]).inputs,x=0;x<T.outputs.length;x++)if(b[T.outputs[x].id]){for(var m in v)b[v[m].id]=!0,_[T.id]=!0;break}var w=[];for(p=0;p<u.length;p++){var T;if(f[(T=u[p]).id]&&_[T.id]){var A={};for(var m in T.inputs){var k=T.inputs[m];d[k.id]&&(A[m]=k)}var I=Object.assign({},T);I.inputs=A,I.outputs=T.outputs,w.push(I)}}return w}(this.state.activeTape,e,i);if(!o&&0===s.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,h={};h[i.id]=null==t?(c=na($(u=i.shape),"float32"),S.makeTensor(c,u,"float32")):t,function(f,p,v){for(var m=function(y){var x=p[y],b=[];if(x.outputs.forEach(function(A){var k=f[A.id];b.push(null!=k?k:null)}),null==x.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+x.kernelName+".");var _=x.gradient(b),w=function(A){if(!(A in _))throw new Error("Cannot backprop through input "+A+". Available gradients found: "+Object.keys(_)+".");var k=a.tidy(function(){return _[A]()});if("float32"!==k.dtype)throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input "+A+" must have 'float32' dtype, but has '"+k.dtype+"'");var I=x.inputs[A];if(!Oe(k.shape,I.shape))throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input '"+A+"' has shape '"+k.shape+"', which does not match the shape of the input '"+I.shape+"'");if(null==f[I.id])f[I.id]=k;else{var D=f[I.id];f[I.id]=D.add(k),D.dispose()}};for(var T in x.inputs)w(T)},g=p.length-1;g>=0;g--)m(g)}(h,s);var d=e.map(function(f){return h[f.id]});return 0===a.state.gradientDepth&&(a.state.activeTape.forEach(function(f){for(var p=0,v=f.saved;p<v.length;p++)v[p].dispose()}),a.state.activeTape=null),{value:i,grads:d}})},r.prototype.customGrad=function(n){var e=this;return E(sn(n),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var t,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];E(o.every(function(s){return s instanceof Ee}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return o.forEach(function(s,u){i[u]=s}),e.runKernelFunc(function(s,u){return E((t=n.apply(void 0,o.concat([u]))).value instanceof Ee,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),E(sn(t.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),t.value},i,function(s,u){var c=t.gradFunc(s,u),h=Array.isArray(c)?c:[c];E(h.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),E(h.every(function(f){return f instanceof Ee}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return h.forEach(function(f,p){d[p]=function(){return f}}),d})}},r.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},r.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},r.prototype.time=function(n){return X(this,void 0,void 0,function(){var e,t;return Q(this,function(o){switch(o.label){case 0:return e=wt(),[4,this.backend.time(n)];case 1:return(t=o.sent()).wallMs=wt()-e,[2,t]}})})},r.prototype.track=function(n){return null!=this.state.activeScope&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Bs,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r}(),S=function(){var r=function(){if(null==da){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}da=e}return da}();if(null==r._tfengine){var n=new Fh(r);r._tfengine=new Gh(n)}return ms=r._tfengine.ENV,At=function(){return r._tfengine},r._tfengine}();function Ls(){return typeof window<"u"&&null!=window.document||typeof WorkerGlobalScope<"u"}var zt=O();zt.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),zt.registerFlag("IS_BROWSER",function(){return Ls()}),zt.registerFlag("IS_NODE",function(){return typeof process<"u"&&void 0!==process.versions&&void 0!==process.versions.node}),zt.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),zt.registerFlag("PROD",function(){return!1}),zt.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return zt.getBool("DEBUG")}),zt.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),zt.registerFlag("IS_TEST",function(){return!1});var mr,ct,lt,wn={},fa={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Ws(r,n){wn[r]=n}function St(r){r in wn||(wn[r]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(o){if(typeof OffscreenCanvas<"u"&&2===o)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete wn[e]},!1),1===e?t.getContext("webgl",fa)||t.getContext("experimental-webgl",fa):t.getContext("webgl2",fa)}(r));var n=wn[r];return n.isContextLost()?(delete wn[r],St(r)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),wn[r])}function Jr(r,n){return[n,r]}function gr(r){var n=$(r);return jr(Math.ceil(n/4))}function yr(r,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(r/2))]}function pa(r,n){var e,t,o,a,i,s,u,c,h,d=r;return 2===O().getNumber("WEBGL_VERSION")?(e=d.R32F,t=d.R16F,o=d.RGBA16F,a=d.RGBA32F,i=d.RED,s=4,u=1,c=d.HALF_FLOAT,h=d.FLOAT):(e=r.RGBA,t=r.RGBA,o=r.RGBA,a=d.RGBA,i=r.RGBA,s=4,u=4,c=null!=n?n.HALF_FLOAT_OES:null,h=r.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:t,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:h}}function Y(r,n,e){var t=e();return n&&function(o){var a=o.getError();if(a!==o.NO_ERROR)throw new Error("WebGL Error: "+Vs(o,a))}(r),t}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(mr||(mr={})),function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"}(ct||(ct={})),function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(lt||(lt={}));var qh=5.96e-8,zh=65504;function Us(r){return!!(O().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===r||qh<Math.abs(r)&&Math.abs(r)<zh)}function Vs(r,n){switch(n){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function xr(r,n,e){return Ht(r,n,function(){return r.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function Gs(r,n,e){var t=Ht(r,n,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Y(r,n,function(){return r.shaderSource(t,e)}),Y(r,n,function(){return r.compileShader(t)}),!1===r.getShaderParameter(t,r.COMPILE_STATUS))throw console.log(r.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function qs(r,n,e){var t=Ht(r,n,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Y(r,n,function(){return r.shaderSource(t,e)}),Y(r,n,function(){return r.compileShader(t)}),!1===r.getShaderParameter(t,r.COMPILE_STATUS))throw function(o,a){var i=Hh.exec(a);if(null==i)return console.log("Couldn't parse line number in error: "+a),void console.log(o);for(var s=+i[1],u=o.split("\n"),c=u.length.toString().length+2,h=u.map(function(g,y){return _n((y+1).toString(),c)+g}),d=0,f=0;f<h.length;f++)d=Math.max(h[f].length,d);var p=h.slice(0,s-1),v=h.slice(s-1,s),m=h.slice(s);console.log(p.join("\n")),console.log(a.split("\n")[0]),console.log("%c "+_n(v[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(m.join("\n"))}(e,r.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var Yr,Xr,Hh=/ERROR: [0-9]+:([0-9]+):/g;function zs(r,n){return Ht(r,n,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function Hs(r,n,e){if(Y(r,n,function(){return r.linkProgram(e)}),!1===r.getProgramParameter(e,r.LINK_STATUS))throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Qr(r,n,e){if(Y(r,n,function(){return r.validateProgram(e)}),!1===r.getProgramParameter(e,r.VALIDATE_STATUS))throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Zs(r,n,e){var t=Ht(r,n,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Y(r,n,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)}),Y(r,n,function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function js(r,n,e){var t=Ht(r,n,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Y(r,n,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t)}),Y(r,n,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function Ks(r,n){return Ht(r,n,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function Js(r,n){var e=O().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||n<=0){var t="["+r+"x"+n+"]";throw new Error("Requested texture size "+t+" is invalid.")}if(r>e||n>e)throw t="["+r+"x"+n+"]",new Error("Requested texture size "+t+" greater than WebGL maximum on this browser / GPU ["+e+"x"+e+"].")}function Ys(r,n){return Ht(r,n,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function va(r,n,e,t,o,a,i,s){var u=r.getAttribLocation(e,t);return-1!==u&&(Y(r,n,function(){return r.bindBuffer(r.ARRAY_BUFFER,o)}),Y(r,n,function(){return r.vertexAttribPointer(u,a,r.FLOAT,!1,i,s)}),Y(r,n,function(){return r.enableVertexAttribArray(u)}),!0)}function Xs(r,n,e,t){nu(r,t),Y(r,n,function(){return r.activeTexture(r.TEXTURE0+t)}),Y(r,n,function(){return r.bindTexture(r.TEXTURE_2D,e)})}function Qs(r,n,e,t){return Ht(r,n,function(){return r.getUniformLocation(e,t)},'uniform "'+t+'" not present in program.')}function $s(r,n,e){return r.getUniformLocation(n,e)}function eu(r,n,e,t,o,a){Y(r,n,function(){return Xs(r,n,t,a)}),Y(r,n,function(){return r.uniform1i(o,a)})}function $r(r,n,e,t){Y(r,n,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),Y(r,n,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)})}function ma(r,n,e){Y(r,n,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),Y(r,n,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function br(r){var n=r.checkFramebufferStatus(r.FRAMEBUFFER);if(n!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+tu(r,n))}function tu(r,n){switch(n){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function Ht(r,n,e,t){var o=Y(r,n,function(){return e()});if(null==o)throw new Error(t);return o}function nu(r,n){var e=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,t=n+r.TEXTURE0;if(t<r.TEXTURE0||t>e)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+e+"].")}function _r(r,n){return void 0===n&&(n=2),$(r.slice(0,r.length-n))}function wr(r){if(0===r.length)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function eo(r){var n=[1,1,1];return 0===r.length||1===r.length&&1===r[0]||(n=[_r(r)].concat(wr(r))),n}function ru(r,n){var e;void 0===n&&(n=!1);var t=O().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(t*=2,1===(r=r.map(function(c,h){return h>=r.length-2?Xo(r[h]):r[h]})).length&&(r=[2,r[0]])),2!==r.length){var o=on(r);r=o.newShape}var a=$(r);if(r.length<=1&&a<=t)return[1,a];if(2===r.length&&r[0]<=t&&r[1]<=t)return r;if(3===r.length&&r[0]*r[1]<=t&&r[2]<=t)return[r[0]*r[1],r[2]];if(3===r.length&&r[0]<=t&&r[1]*r[2]<=t)return[r[0],r[1]*r[2]];if(4===r.length&&r[0]*r[1]*r[2]<=t&&r[3]<=t)return[r[0]*r[1]*r[2],r[3]];if(4===r.length&&r[0]<=t&&r[1]*r[2]*r[3]<=t)return[r[0],r[1]*r[2]*r[3]];if(n){var i=_r(r),s=2,u=2;return r.length&&(s=(e=wr(r))[0],u=e[1]),jr(a=i*(s/2)*(u/2)).map(function(c){return 2*c})}return jr(a)}function to(r){return r%2==0}function Cr(r,n){if(Oe(r=r.slice(-2),n=n.slice(-2))||!r.length||!n.length||0===r[0]||0===r[1]||0===n[0]||0===n[1])return!0;if(r.length!==n.length){var e=r.slice(-1)[0],t=n.slice(-1)[0];if(e===t||to(e)&&to(t)&&(1===r[0]||1===n[0]))return!0}return r[1]===n[1]&&to(r[0])&&to(n[0])}function ou(r){if(null==Yr){var n=St(r);Yr=n.getParameter(n.MAX_TEXTURE_SIZE)}return Yr}function au(r){if(null==Xr){var n=St(r);Xr=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Xr)}function iu(r){if(0===r)return 0;var n=St(r);return ht(n,"EXT_disjoint_timer_query_webgl2")&&2===r?2:ht(n,"EXT_disjoint_timer_query")?1:0}function ht(r,n){return null!=r.getExtension(n)}function ga(r){try{if(null!=St(r))return!0}catch(n){return!1}return!1}function su(r){if(0===r)return!1;var n=St(r);if(1===r){if(!ht(n,"OES_texture_float"))return!1}else if(!ht(n,"EXT_color_buffer_float"))return!1;return ya(n)}function uu(r){if(0===r)return!1;var n=St(r);if(1!==r){if(ht(n,"EXT_color_buffer_float"))return ya(n);if(ht(n,"EXT_color_buffer_half_float")){var e=n.getExtension("EXT_color_buffer_half_float");return function(t,o){var a=pa(t,o),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,a.internalFormatHalfFloat,1,1,0,a.textureFormatFloat,a.textureTypeHalfFloat,null);var s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);var u=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(i),t.deleteFramebuffer(s),u}(n,e)}return!1}return!!ht(n,"OES_texture_float")&&!!ht(n,"WEBGL_color_buffer_float")&&ya(n)}function ya(r){var n=pa(r),e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e),r.texImage2D(r.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var t=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,t),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);var o=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(e),r.deleteFramebuffer(t),o}function cu(r){return 2===r&&null!=St(r).fenceSync}var Zh=Object.freeze({callAndCheck:Y,canBeRepresented:Us,getWebGLErrorMessage:Vs,getExtensionOrThrow:xr,createVertexShader:Gs,createFragmentShader:qs,createProgram:zs,linkProgram:Hs,validateProgram:Qr,createStaticVertexBuffer:Zs,createStaticIndexBuffer:js,getNumChannels:function(){return 2===O().getNumber("WEBGL_VERSION")?1:4},createTexture:Ks,validateTextureSize:Js,createFramebuffer:Ys,bindVertexBufferToProgramAttribute:va,bindTextureUnit:Xs,unbindTextureUnit:function(r,n,e){nu(r,e),Y(r,n,function(){return r.activeTexture(r.TEXTURE0+e)}),Y(r,n,function(){return r.bindTexture(r.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Qs,getProgramUniformLocation:$s,bindTextureToProgramUniformSampler:eu,bindCanvasToFramebuffer:function(r,n){Y(r,n,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),Y(r,n,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),Y(r,n,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})},bindColorTextureToFramebuffer:$r,unbindColorTextureFromFramebuffer:ma,validateFramebuffer:br,getFramebufferErrorMessage:tu,getBatchDim:_r,getRowsCols:wr,getShapeAs3D:eo,getTextureShapeFromLogicalShape:ru,isReshapeFree:Cr,getWebGLMaxTextureSize:ou,resetMaxTextureSize:function(){Yr=null},resetMaxTexturesInShader:function(){Xr=null},getMaxTexturesInShader:au,getWebGLDisjointQueryTimerVersion:iu,hasExtension:ht,isWebGLVersionEnabled:ga,isCapableOfRenderingToFloatTexture:su,isDownloadFloatTextureEnabled:uu,isWebGLFenceEnabled:cu}),ae=O();function lu(r){O().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function J(r,n){return S.tidy(r,n)}function at(r){ha(r).forEach(function(n){return n.dispose()})}function no(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];O().getBool("IS_TEST")||console.warn.apply(console,r)}function Rt(r,n){var e=r;if(Ke(r))return"string"===n?[]:[r.length];if(!Array.isArray(r))return[];for(var t=[];Array.isArray(e)||Ke(e)&&"string"!==n;)t.push(e.length),e=e[0];return Array.isArray(r)&&O().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(a,i,s){if(s=s||[],Array.isArray(a)||Ke(a)){E(i.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"}),E(a.length===i[0],function(){return"Element arr["+s.join("][")+"] should have "+i[0]+" elements, but has "+a.length+" elements"});for(var u=i.slice(1),c=0;c<a.length;++c)o(a[c],u,s.concat(c))}else E(0===i.length,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+i[0]+" elements"})}(r,t,[]),t}function hu(r,n,e,t){if(null!=r&&("numeric"!==r&&r!==n||"numeric"===r&&"string"===n))throw new Error("Argument '"+e+"' passed to '"+t+"' must be "+r+" tensor, but got "+n+" tensor")}function C(r,n,e,t){if(void 0===t&&(t="numeric"),r instanceof Ee)return hu(t,r.dtype,n,e),r;var o=Wn(r);if("string"!==o&&["bool","int32","float32"].indexOf(t)>=0&&(o=t),hu(t,o,n,e),null==r||!Ke(r)&&!Array.isArray(r)&&"number"!=typeof r&&"boolean"!=typeof r&&"string"!=typeof r)throw new Error("Argument '"+n+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+(null==r?"null":r.constructor.name)+"'");var i=Rt(r,o);Ke(r)||Array.isArray(r)||(r=[r]);var s="string"!==o?ea(r,o,O().getBool("DEBUG")):qt(r,[],!0);return S.makeTensor(s,i,o)}function Tr(r,n,e,t){if(void 0===t&&(t="numeric"),!Array.isArray(r))throw new Error("Argument "+n+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(o,a){return C(o,n+"["+a+"]",e)},t)}function xa(r,n){for(var e=0;e<r.length;++e)if(r[r.length-e-1]!==n-1-e)return!1;return!0}function du(r,n,e){for(var t=r.length+n.length,o=[],a=0,i=0,s=0;s<t;s++)-1===e.indexOf(s)?o.push(r[a++]):o.push(n[i++]);return o}function Je(r,n){for(var e=[],t=r.length,o=0;o<t;o++)-1===n.indexOf(o)&&e.push(r[o]);return[e,n.map(function(a){return r[a]})]}function rt(r,n){return du(r,n.map(function(e){return 1}),n)}function it(r,n,e){E(xa(n,e),function(){return r+" supports only inner-most axes for now. Got axes "+n+" and rank-"+e+" input."})}function Ct(r,n){if(xa(r,n))return null;for(var e=[],t=0;t<n;++t)-1===r.indexOf(t)&&e.push(t);return r.forEach(function(o){return e.push(o)}),e}function ro(r){return r.map(function(n,e){return[e,n]}).sort(function(n,e){return n[1]-e[1]}).map(function(n){return n[0]})}function Tt(r,n){for(var e=[],t=n-r;t<n;++t)e.push(t);return e}function fu(r,n){var e=r[0].length;r.forEach(function(o,a){E(o.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+a+"] must be the same as the rank of the rest ("+e+")"})}),E(n>=0&&n<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var t=r[0];r.forEach(function(o,a){for(var i=0;i<e;i++)E(i===n||o[i]===t[i],function(){return"Error in concat"+e+"D: Shape of tensors["+a+"] ("+o+") does not match the shape of the rest ("+t+") along the non-concatenated axis "+a+"."})})}function Cn(r,n){for(var e=r[0].slice(),t=1;t<r.length;t++)e[n]+=r[t][n];return e}function R(r){var n=Object.keys(r);if(1!==n.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var e=n[0],t=r[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var o=function(){for(var a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];S.startScope(e);try{var s=t.apply(void 0,a);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),S.endScope(s),s}catch(u){throw S.endScope(null),u}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}ae.registerFlag("HAS_WEBGL",function(){return ae.getNumber("WEBGL_VERSION")>0}),ae.registerFlag("WEBGL_VERSION",function(){return ga(2)?2:ga(1)?1:0}),ae.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===ae.get("WEBGL_VERSION")}),ae.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),ae.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),ae.registerFlag("WEBGL_PACK",function(){return ae.getBool("HAS_WEBGL")}),ae.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return ae.getBool("WEBGL_PACK")}),ae.registerFlag("WEBGL_PACK_CLIP",function(){return ae.getBool("WEBGL_PACK")}),ae.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),ae.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return ae.getBool("WEBGL_PACK")}),ae.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return ae.getBool("WEBGL_PACK")}),ae.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return ae.getBool("WEBGL_PACK")}),ae.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return ae.getBool("WEBGL_PACK")}),ae.registerFlag("WEBGL_PACK_REDUCE",function(){return ae.getBool("WEBGL_PACK")}),ae.registerFlag("WEBGL_LAZILY_UNPACK",function(){return ae.getBool("WEBGL_PACK")}),ae.registerFlag("WEBGL_CONV_IM2COL",function(){return ae.getBool("WEBGL_PACK")}),ae.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return ou(ae.getNumber("WEBGL_VERSION"))}),ae.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return au(ae.getNumber("WEBGL_VERSION"))}),ae.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=ae.getNumber("WEBGL_VERSION");return 0===r?0:iu(r)}),ae.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return ae.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r}),ae.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return su(ae.getNumber("WEBGL_VERSION"))}),ae.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!ae.getBool("WEBGL_FORCE_F16_TEXTURES")&&ae.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),ae.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return uu(ae.getNumber("WEBGL_VERSION"))}),ae.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return cu(ae.getNumber("WEBGL_VERSION"))}),ae.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return ae.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Fs=lu;var Ye=R({complex_:function(r,n){var e=C(r,"real","complex"),t=C(n,"imag","complex");return ge(e.shape,t.shape,"real and imag shapes, "+e.shape+" and "+t.shape+", must match in call to tf.complex()."),S.runKernelFunc(function(o){return o.complex(e,t)},{$real:e,$imag:t})}}),gt=R({real_:function(r){var n=C(r,"input","real");return S.runKernelFunc(function(e){return e.real(n)},{$input:n})}}),Pt=R({imag_:function(r){var n=C(r,"input","imag");return S.runKernelFunc(function(e){return e.imag(n)},{$input:n})}});function Xe(r,n,e){return un(r,n,Rt(r,e),e)}function un(r,n,e,t){if(null==t&&(t=Wn(r)),"complex64"===t)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ke(r)&&!Array.isArray(r)&&"number"!=typeof r&&"boolean"!=typeof r&&"string"!=typeof r)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=n){ra(n);var o=$(n),a=$(e);E(o===a,function(){return"Based on the provided shape, ["+n+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<e.length;++i){var u=i!==e.length-1||e[i]!==$(n.slice(i));E(e[i]===n[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+n+"). "})}}return Ke(r)||Array.isArray(r)||(r=[r]),n=n||e,r="string"!==t?ea(r,t,O().getBool("DEBUG")):qt(r,[],!0),S.makeTensor(r,n,t)}function Z(r,n){if((Ke(r)&&"string"!==n||Array.isArray(r))&&"complex64"!==n)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===n&&Ke(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return un(r,[],[],n)}function Le(r,n){bn(r);var e=Rt(r,n);if(1!==e.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return un(r,null,e,n)}function cn(r,n,e){if(bn(r),null!=n&&2!==n.length)throw new Error("tensor2d() requires shape to have two numbers");var t=Rt(r,e);if(2!==t.length&&1!==t.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===t.length&&null==n)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return un(r,n,t,e)}function ba(r,n,e){if(bn(r),null!=n&&3!==n.length)throw new Error("tensor3d() requires shape to have three numbers");var t=Rt(r,e);if(3!==t.length&&1!==t.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===t.length&&null==n)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return un(r,n,t,e)}function st(r,n,e){if(bn(r),null!=n&&4!==n.length)throw new Error("tensor4d() requires shape to have four numbers");var t=Rt(r,e);if(4!==t.length&&1!==t.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===t.length&&null==n)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return un(r,n,t,e)}function Gn(r,n){if(void 0===n&&(n="float32"),"complex64"===n){var e=Gn(r,"float32"),t=De(r,"float32");return Ye(e,t)}var o=na($(r),n);return S.makeTensor(o,r,n)}function De(r,n){if(void 0===n&&(n="float32"),"complex64"===n){var e=De(r,"float32"),t=De(r,"float32");return Ye(e,t)}var o=Un($(r),n);return S.makeTensor(o,r,n)}function Nt(r,n,e){return S.runKernelFunc(function(t){return t.fill(r,n,e)},{})}function oo(r,n,e,t){if(void 0===e&&(e=1),void 0===t&&(t="float32"),0===e)throw new Error("Cannot have a step of zero");if(r===n||r<n&&e<0||n<r&&e>1)return De([0],t);var o=Un(Math.abs(Math.ceil((n-r)/e)),t);n<r&&1===e&&(e=-1),o[0]=r;for(var a=1;a<o.length;a++)o[a]=o[a-1]+e;return Le(o,t)}var pu=R({onesLike_:function(r){var n=C(r,"x","onesLike");if("complex64"===n.dtype){var e=pu(gt(n)),t=ye(Pt(n));return Ye(e,t)}return S.runKernelFunc(function(o){return o.onesLike(n)},{$x:n},function(o,a){return{$x:function(){return ye(o)}}})}}),ye=R({zerosLike_:function(r){var n=C(r,"x","zerosLike");return S.runKernelFunc(function(e){return e.zerosLike(n)},{$x:n},function(e,t){return{$x:function(){return ye(e)}}})}}),Ve=R({concat_:function(r,n){void 0===n&&(n=0),E(r.length>=1,function(){return"Pass at least one tensor to concat"});var e=Tr(r,"tensors","concat");"complex64"===e[0].dtype&&e.forEach(function(s){if("complex64"!==s.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+s.dtype+". ")}),n=Be(n,e[0].shape)[0];var t=Cn(e.map(function(s){return s.shape}),n);if(0===$(t))return Xe([],t);if(1===(e=e.filter(function(s){return s.size>0})).length)return e[0];var o=e.map(function(s){return s.shape});return fu(o,n),S.runKernelFunc(function(s){return s.concat(e,n)},e,function(s){var u=o.map(function(c){return c[n]});return _a(s,u,n).map(function(c){return function(){return c}})},"Concat",{axis:n})}}),Qh=R({concat1d_:function(r){return Ve(r,0)}}),$h=R({concat2d_:function(r,n){return Ve(r,n)}}),ed=R({concat3d_:function(r,n){return Ve(r,n)}}),td=R({concat4d_:function(r,n){return Ve(r,n)}}),_a=R({split_:function(r,n,e){void 0===e&&(e=0);var t,o=C(r,"x","split");return e=Be(e,o.shape)[0],"number"==typeof n?(E(o.shape[e]%n==0,function(){return"Number of splits must evenly divide the axis."}),t=new Array(n).fill(o.shape[e]/n)):(E(o.shape[e]===n.reduce(function(a,i){return a+i}),function(){return"The sum of sizes must match the size of the axis dimension."}),t=n),S.runKernelFunc(function(a){return a.split(o,t,e)},{$x:o},function(a){return{$x:function(){return Ve(a,e)}}})}});function Tn(r,n){return r(n={exports:{}},n.exports),n.exports}typeof globalThis<"u"||typeof window<"u"||typeof global<"u"&&global;var nd=Tn(function(r){!function(n,e,t){function o(s){var u,c=this,h=(u=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var p=.02519603282416938*(u+=d.charCodeAt(f));p-=u=p>>>0,u=(p*=u)>>>0,u+=4294967296*(p-=u)}return 2.3283064365386963e-10*(u>>>0)});c.next=function(){var d=2091639*c.s0+2.3283064365386963e-10*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=0|d)},c.c=1,c.s0=h(" "),c.s1=h(" "),c.s2=h(" "),c.s0-=h(s),c.s0<0&&(c.s0+=1),c.s1-=h(s),c.s1<0&&(c.s1+=1),c.s2-=h(s),c.s2<0&&(c.s2+=1),h=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var c=new o(s),h=u&&u.state,d=c.next;return d.int32=function(){return 4294967296*c.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,h&&("object"==typeof h&&a(h,c),d.state=function(){return a(c,{})}),d}e&&e.exports?e.exports=i:this.alea=i}(0,r)}),rd=Tn(function(r){!function(n,e,t){function o(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},s===(0|s)?u.x=s:c+=s;for(var h=0;h<c.length+64;h++)u.x^=0|c.charCodeAt(h),u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function i(s,u){var c=new o(s),h=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,h&&("object"==typeof h&&a(h,c),d.state=function(){return a(c,{})}),d}e&&e.exports?e.exports=i:this.xor128=i}(0,r)}),od=Tn(function(r){!function(n,e,t){function o(s){var u=this,c="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var h=0;h<c.length+64;h++)u.x^=0|c.charCodeAt(h),h==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function i(s,u){var c=new o(s),h=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,h&&("object"==typeof h&&a(h,c),d.state=function(){return a(c,{})}),d}e&&e.exports?e.exports=i:this.xorwow=i}(0,r)}),ad=Tn(function(r){!function(n,e,t){function o(s){var u=this;u.next=function(){var c,h,d=u.x,f=u.i;return c=d[f],h=(c^=c>>>7)^c<<24,h^=(c=d[f+1&7])^c>>>10,h^=(c=d[f+3&7])^c>>>3,h^=(c=d[f+4&7])^c<<7,c=d[f+7&7],h^=(c^=c<<13)^c<<9,d[f]=h,u.i=f+1&7,h},function(c,h){var d,f=[];if(h===(0|h))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[7&d]=f[7&d]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&0===f[d];++d);for(8==d&&(f[7]=-1),c.x=f,c.i=0,d=256;d>0;--d)c.next()}(u,s)}function a(s,u){return u.x=s.x.slice(),u.i=s.i,u}function i(s,u){null==s&&(s=+new Date);var c=new o(s),h=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,h&&(h.x&&a(h,c),d.state=function(){return a(c,{})}),d}e&&e.exports?e.exports=i:this.xorshift7=i}(0,r)}),id=Tn(function(r){!function(n,e,t){function o(s){var u=this;u.next=function(){var c,h,d=u.w,f=u.X,p=u.i;return u.w=d=d+1640531527|0,h=f[p+34&127],c=f[p=p+1&127],h^=h<<13,c^=c<<17,h=f[p]=(h^=h>>>15)^(c^=c>>>12),u.i=p,h+(d^d>>>16)|0},function(c,h){var d,f,p,v,m,g=[],y=128;for(h===(0|h)?(f=h,h=null):(h+="\0",f=0,y=Math.max(y,h.length)),p=0,v=-32;v<y;++v)h&&(f^=h.charCodeAt((v+32)%h.length)),0===v&&(m=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,v>=0&&(p=0==(d=g[127&v]^=f+(m=m+1640531527|0))?p+1:0);for(p>=128&&(g[127&(h&&h.length||0)]=-1),p=127,v=512;v>0;--v)f=g[p+34&127],d=g[p=p+1&127],f^=f<<13,d^=d<<17,g[p]=(f^=f>>>15)^(d^=d>>>12);c.w=m,c.X=g,c.i=p}(u,s)}function a(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function i(s,u){null==s&&(s=+new Date);var c=new o(s),h=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,h&&(h.X&&a(h,c),d.state=function(){return a(c,{})}),d}e&&e.exports?e.exports=i:this.xor4096=i}(0,r)}),sd=Tn(function(r){!function(n,e,t){function o(s){var u=this,c="";u.next=function(){var d=u.b,f=u.c,p=u.d,v=u.a;return d=d<<25^d>>>7^f,f=f-p|0,p=p<<24^p>>>8^v,v=v-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-p|0,u.d=p<<16^f>>>16^v,u.a=v-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var h=0;h<c.length+20;h++)u.b^=0|c.charCodeAt(h),u.next()}function a(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function i(s,u){var c=new o(s),h=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,h&&("object"==typeof h&&a(h,c),d.state=function(){return a(c,{})}),d}e&&e.exports?e.exports=i:this.tychei=i}(0,r)}),En=Tn(function(r){!function(n,e){var t,o=this,a=256,i=6,s="random",u=e.pow(a,i),c=e.pow(2,52),h=2*c,d=a-1;function f(y,x,b){var _=[],w=m(function k(I,D){var N,P=[],W=typeof I;if(D&&"object"==W)for(N in I)try{P.push(k(I[N],D-1))}catch(B){}return P.length?P:"string"==W?I:I+"\0"}((x=1==x?{entropy:!0}:x||{}).entropy?[y,g(n)]:null==y?function(){try{var k;return t&&(k=t.randomBytes)?k=k(a):(k=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(k)),g(k)}catch(N){var I=o.navigator,D=I&&I.plugins;return[+new Date,o,D,o.screen,g(n)]}}():y,3),_),T=new p(_),A=function(){for(var k=T.g(i),I=u,D=0;k<c;)k=(k+D)*a,I*=a,D=T.g(1);for(;k>=h;)k/=2,I/=2,D>>>=1;return(k+D)/I};return A.int32=function(){return 0|T.g(4)},A.quick=function(){return T.g(4)/4294967296},A.double=A,m(g(T.S),n),(x.pass||b||function(k,I,D,N){return N&&(N.S&&v(N,T),k.state=function(){return v(T,{})}),D?(e[s]=k,I):k})(A,w,"global"in x?x.global:this==e,x.state)}function p(y){var x,b=y.length,_=this,w=0,T=_.i=_.j=0,A=_.S=[];for(b||(y=[b++]);w<a;)A[w]=w++;for(w=0;w<a;w++)A[w]=A[T=d&T+y[w%b]+(x=A[w])],A[T]=x;(_.g=function(k){for(var I,D=0,N=_.i,P=_.j,W=_.S;k--;)I=W[N=d&N+1],D=D*a+W[d&(W[N]=W[P=d&P+I])+(W[P]=I)];return _.i=N,_.j=P,D})(a)}function v(y,x){return x.i=y.i,x.j=y.j,x.S=y.S.slice(),x}function m(y,x){for(var b,_=y+"",w=0;w<_.length;)x[d&w]=d&(b^=19*x[d&w])+_.charCodeAt(w++);return g(x)}function g(y){return String.fromCharCode.apply(0,y)}if(e["seed"+s]=f,m(e.random(),n),r.exports){r.exports=f;try{t=Ue(8369)}catch(y){}}}([],Math)});En.alea=nd,En.xor128=rd,En.xorwow=od,En.xorshift7=ad,En.xor4096=id,En.tychei=sd;var ao=En.alea,wa=function(){function r(n,e,t,o,a){this.mean=n,this.stdDev=e,this.dtype=t,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=a||Math.random();this.random=ao(i.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var e,t,o=!1;!o;){var a=void 0,i=void 0,s=void 0;do{s=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(s>=1||0===s);var u=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*a*u,t=this.mean+this.stdDev*i*u,this.truncated&&!this.isValidTruncated(e)||(o=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)},r.prototype.convertValue=function(n){return null==this.dtype||"float32"===this.dtype?n:Math.round(n)},r.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},r}(),ud=function(){function r(n,e,t,o){this.alpha=n,this.beta=1/e,this.dtype=t;var a=o||Math.random();this.randu=ao(a.toString()),this.randn=new wa(0,1,t,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var n,e,t,o,a,i;;){do{o=this.randn.nextValue(),i=1+this.c*o}while(i<=0);if(e=1-.331*(n=o*o)*n,t=.5*n+this.d*(1-(i*=i*i)+Math.log(i)),(a=this.randu())<e||Math.log(a)<t)break}return i*=1/this.beta*this.d,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},r.prototype.convertValue=function(n){return"float32"===this.dtype?n:Math.round(n)},r}(),cd=function(){function r(n,e,t,o){var a=this;if(void 0===n&&(n=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==a.dtype||"float32"===a.dtype},this.min=n,this.range=e-n,this.dtype=t,null==o&&(o=Math.random()),"number"==typeof o&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+e+" <= 1 and dtype is not float");this.random=ao(o)}return r.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function se(r,n,e){return void 0===n&&(n="float32"),n=n||"float32",ra(r),new vr(r,n,e)}var vu=R({batchToSpaceND_:function(r,n,e){var t=C(r,"x","batchToSpaceND"),o=n.reduce(function(a,i){return a*i});return E(t.rank>=1+n.length,function(){return"input rank is "+t.rank+" but should be > than blockShape.length "+n.length}),E(e.length===n.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+n.length}),E(t.shape[0]%o==0,function(){return"input tensor batch is "+t.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+o}),S.runKernelFunc(function(a){return a.batchToSpaceND(t,n,e)},{$x:t},function(a){return{$x:function(){return a.spaceToBatchND(n,e)}}})}}),hd=R({broadcastTo_:function(r,n){var e=C(r,"broadcastTo","x"),t=e.shape;if(n.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<e.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+e.rank+".");if(n.length>e.rank){for(var o=e.shape.slice();o.length<n.length;)o.unshift(1);e=e.reshape(o)}for(var a=Array.from(n),i=n.length-1;i>=0;i--)if(e.shape[i]===n[i])a[i]=1;else if(1!==e.shape[i])throw new Error("broadcastTo(): ["+t+"] cannot be broadcast to ["+n+"].");var s=a.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return 0===s.length?e.clone():S.runKernelFunc(function(u){return u.tile(e,a)},{input:e},function(u){return{input:function(){return u.sum(s,!0)}}})}}),dd=R({cast_:function(r,n){var e=C(r,"x","cast");if(!Es(n))throw new Error("Failed to cast to unknown dtype "+n);if("string"===n&&"string"!==e.dtype||"string"!==n&&"string"===e.dtype)throw new Error("Only strings can be casted to strings");return S.runKernelFunc(function(o){return o.cast(e,n)},{x:e},function(o){return{x:function(){return o.clone()}}},"Cast",{dtype:n})}}),fd=R({clone_:function(r){var n=C(r,"x","clone",null);return S.runKernelFunc(function(){return S.makeTensorFromDataId(n.dataId,n.shape,n.dtype)},{$x:n},function(e){return{$x:function(){return e.toFloat()}}})}}),pd=R({cumsum_:function(r,n,e,t){void 0===n&&(n=0),void 0===e&&(e=!1),void 0===t&&(t=!1);var o=C(r,"x","cumsum"),a=Ct([n|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=Tt(1,o.rank)[0],u=S.runKernelFunc(function(c){return c.cumsum(i,s,e,t)},{permutedX:i},function(c){return{permutedX:function(){return c.cumsum(n,e,!t)}}});return null!=a&&(u=u.transpose(a)),u}}),vd=R({depthToSpace_:function(r,n,e){void 0===e&&(e="NHWC");var t=C(r,"x","depthToSpace"),o="NHWC"===e?t.shape[1]:t.shape[2],a="NHWC"===e?t.shape[2]:t.shape[3],i="NHWC"===e?t.shape[3]:t.shape[1];return E(o*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+n+"  for depthToSpace with input shape\n      "+t.shape}),E(a*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+n+" for depthToSpace with input shape\n          "+t.shape}),E(i%(n*n)==0,function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+i+" for depthToSpace with input shape "+t.shape}),S.runKernelFunc(function(s){return s.depthToSpace(t,n,e)},{$x:t})}}),yt=R({expandDims_:function(r,n){void 0===n&&(n=0);var e=C(r,"x","expandDims",null);E(n<=e.rank,function(){return"Axis must be <= rank of the tensor"});var t=e.shape.slice();return n<0&&(E(-(e.rank+1)<=n,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),n=e.rank+n+1),t.splice(n,0,1),Et(e,t)}}),mu=R({eye_:function(r,n,e,t){void 0===t&&(t="float32"),null==n&&(n=r);for(var o=se([r,n],t),a=r<=n?r:n,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(r,n);if(null==e)return s;if(1===e.length)return qn(yt(s,0),[e[0],1,1]);if(2===e.length)return qn(yt(yt(s,0),0),[e[0],e[1],1,1]);if(3===e.length)return qn(yt(yt(yt(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),md=R({multinomial_:function(r,n,e,t){void 0===t&&(t=!1);var o=C(r,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);e=e||Math.random();var s=1===i?o.as2D(1,-1):o,u=S.runKernelFunc(function(c){return c.multinomial(s,t,n,e)},{logits2D:s});return 1===i?u.as1D():u}}),Ca=R({oneHot_:function(r,n,e,t){if(void 0===e&&(e=1),void 0===t&&(t=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var o=C(r,"indices","oneHot","int32"),a=o.shape.concat([n]);return o=o.flatten(),S.runKernelFunc(function(i){return i.oneHot(o,n,e,t)},{$indices:o},function(i){return{$indices:function(){return De(o.shape,"float32")}}}).reshape(a)}}),In=R({pad_:function(r,n,e){void 0===e&&(e=0);var t=C(r,"x","pad");if(0===t.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return S.runKernelFunc(function(a){return a.pad(t,n,e)},{x:t},function(a){var i=n.map(function(s){return s[0]});return{x:function(){return a.slice(i,t.shape)}}},"PadV2",{paddings:n,constantValue:e})}}),gd=R({pad1d_:function(r,n,e){return void 0===e&&(e=0),E(2===n.length,function(){return"Invalid number of paddings. Must be length of 2."}),In(r,[n],e)}}),yd=R({pad2d_:function(r,n,e){return void 0===e&&(e=0),E(2===n.length&&2===n[0].length&&2===n[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),In(r,n,e)}}),xd=R({pad3d_:function(r,n,e){return void 0===e&&(e=0),E(3===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),In(r,n,e)}}),bd=R({pad4d_:function(r,n,e){return void 0===e&&(e=0),E(4===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length&&2===n[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),In(r,n,e)}}),_d=R({rand_:function(r,n,e){var t=$(r),o=null;if(null==e||"float32"===e)o=new Float32Array(t);else if("int32"===e)o=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);o=new Uint8Array(t)}for(var a=0;a<t;a++)o[a]=n();return S.makeTensor(o,r,e)}}),wd=R({randomNormal_:function(r,n,e,t,o){if(void 0===n&&(n=0),void 0===e&&(e=1),null!=t&&"bool"===t)throw new Error("Unsupported data type "+t);for(var a=new wa(n,e,t,!1,o),i=se(r,t),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Cd=R({randomGamma_:function(r,n,e,t,o){if(void 0===e&&(e=1),void 0===t&&(t="float32"),null==e&&(e=1),null==t&&(t="float32"),"float32"!==t&&"int32"!==t)throw new Error("Unsupported data type "+t);for(var a=new ud(n,e,t,o),i=se(r,t),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),gu=R({randomUniform_:function(r,n,e,t,o){void 0===n&&(n=0),void 0===e&&(e=1),void 0===t&&(t="float32");for(var a=se(r,t),i=new cd(n,e,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Et=R({reshape_:function(r,n){var e=C(r,"x","reshape",null);return n=Cs(n,e.size),E(e.size===$(n),function(){return"new shape and old shape must have the same number of elements."}),S.runKernelFunc(function(o){return o.reshape(e,n)},{x:e},function(o){return{x:function(){return o.reshape(e.shape)}}},"Reshape",{shape:n})}}),yu=R({spaceToBatchND_:function(r,n,e){var t=C(r,"x","spaceToBatchND");return E(t.rank>=1+n.length,function(){return"input rank "+t.rank+" should be > than [blockShape] "+n.length}),E(e.length===n.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+n.length}),E(t.shape.reduce(function(o,a,i){return i>0&&i<=n.length?o&&(a+e[i-1][0]+e[i-1][1])%n[i-1]==0:o},!0),function(){return"input spatial dimensions "+t.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+n.toString()}),S.runKernelFunc(function(o){return o.spaceToBatchND(t,n,e)},{$x:t},function(o){return{$x:function(){return o.batchToSpaceND(n,e)}}})}}),xu=R({squeeze_:function(r,n){var e=C(r,"x","squeeze");return Et(e,on(e.shape,n).newShape)}}),dt=R({stack_:function(r,n){void 0===n&&(n=0);var e=Tr(r,"tensors","stack");if(E(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===e.length)return e[0].expandDims(n);var o=e[0].shape,a=e[0].dtype;E(n<=e[0].rank,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(s){ge(o,s.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(s){E(a===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=e.map(function(s){return s.expandDims(n)});return Ve(i,n)}}),qn=R({tile_:function(r,n){var e=C(r,"x","tile",null);return E(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+n+"."}),S.runKernelFunc(function(a,i){var s=a.tile(e,n);return i([e]),s},{x:e},function(a,i){var s=i[0];return{x:function(){var u=ye(s);if(1===s.rank)for(var c=0;c<n[0];++c)u=u.add(a.slice([c*s.shape[0]],[s.shape[0]]));else if(2===s.rank)for(c=0;c<n[0];++c)for(var h=0;h<n[1];++h)u=u.add(a.slice([c*s.shape[0],h*s.shape[1]],[s.shape[0],s.shape[1]]));else if(3===s.rank)for(c=0;c<n[0];++c)for(h=0;h<n[1];++h)for(var d=0;d<n[2];++d)u=u.add(a.slice([c*s.shape[0],h*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(4!==s.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(c=0;c<n[0];++c)for(h=0;h<n[1];++h)for(d=0;d<n[2];++d)for(var f=0;f<n[3];++f)u=u.add(a.slice([c*s.shape[0],h*s.shape[1],d*s.shape[2],f*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",{reps:n},[e])}}),Td=R({truncatedNormal_:function(r,n,e,t,o){if(void 0===n&&(n=0),void 0===e&&(e=1),null!=t&&"bool"===t)throw new Error("Unsupported data type "+t);for(var a=new wa(n,e,t,!0,o),i=se(r,t),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Ge=R({unstack_:function(r,n){void 0===n&&(n=0),n=n||0;var e=C(r,"x","unstack");return E(n>=-e.shape.length&&n<e.shape.length,function(){return"Axis = "+n+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),n<0&&(n+=e.shape.length),S.runKernelFunc(function(o){return o.unstack(e,n)},{x:e},function(o){return{x:function(){return dt(o,n)}}},"Unpack",{axis:n})}});function io(r,n,e,t){void 0===t&&(t=!0);var o=[];if(t)(o=o.concat(n.slice(0))).push(r[0]/e),o=o.concat(r.slice(1));else{o=o.concat(r[0]);for(var a=n.length,i=0;i<a;++i)o=o.concat([r[i+1]/n[i],n[i]]);o=o.concat(r.slice(a+1))}return o}function so(r,n,e){void 0===e&&(e=!0);var t=[];if(e){t.push(n);for(var o=n+1;o<r;++o)o<=2*n?(t.push(o),t.push(o-(n+1))):t.push(o)}else{var a=[],i=[];for(o=1;o<r;++o)o>=2*n+1||o%2==1?i.push(o):a.push(o);t.push.apply(t,a),t.push(0),t.push.apply(t,i)}return t}function uo(r,n,e,t){void 0===t&&(t=!0);var o=[];o.push(t?r[0]/e:r[0]*e);for(var a=1;a<r.length;++a)o.push(a<=n.length?t?n[a-1]*r[a]:r[a]/n[a-1]:r[a]);return o}function bu(r,n){for(var e=[0],t=0;t<n;++t)e.push(r[t][0]);return e}function _u(r,n,e){for(var t=r.slice(0,1),o=0;o<e;++o)t.push(r[o+1]-n[o][0]-n[o][1]);return t}function Ta(r,n){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==n.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+r.rank);if(0===r.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var e=n.shape,t=e[e.length-1],o=1,a=0;a<e.length-1;++a)o*=e[a];var i=r.shape,s=e.slice();s.pop();var u=1;for(a=t;a<r.rank;++a)u*=i[a],s.push(i[a]);var c=_t(r.shape).map(function(h){return h/u}).concat([1]).slice(0,t);return[s,o,u,c]}Object.freeze({prepareAndValidate:Ta});var Ea=30;function co(r){return r<=Ea?r:Kr(r,Math.floor(Math.sqrt(r)))}function wu(r,n,e){var t=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+n.shape+", shape: "+r+", sliceDim: "+t+", and batchDim: "+o+".";if(e.rank<o)throw new Error(a+" update.rank < "+o+". ");if(r.length<t+(e.rank-o))throw new Error(a+" Output shape length < "+(t+(e.rank-o)));if(e.rank!==o+r.length-t)throw new Error(a+" update.rank != "+(o+r.length-t));for(var i=0;i<o;++i)if(e.shape[i]!==n.shape[i])throw new Error(a+" updates.shape["+i+"] ("+e.shape[i]+") != indices.shape["+i+"] ("+n.shape[i]+").");for(i=0;i<e.rank-o;++i)if(e.shape[i+o]!==r[i+t])throw new Error(a+" updates.shape["+(i+o)+"] ("+e.shape[i+o]+") != shape["+(i+o)+"] ("+r[i+o]+")")}function Cu(r,n,e){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if("int32"!==n.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(0===e.length){if(0===n.size)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(0===r.size)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}wu(e,n,r)}function Er(r,n,e){for(var t=n.shape.length,o=t>1?n.shape[t-1]:1,a=e.length,i=1,s=o;s<a;++s)i*=e[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:$(n.shape)/u,sliceSize:i,strides:_t(e.slice(0,o)).concat([1]),outputSize:$(e)}}function Tu(r,n,e){E(r.rank===n.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+n+" must match the rank of the array ("+r.rank+")."}),E(r.rank===e.length,function(){return"Error in slice"+r.rank+"D: Length of size "+e+" must match the rank of the array ("+r.rank+")."});for(var t=function(a){E(n[a]+e[a]<=r.shape[a],function(){return"Error in slice"+r.rank+"D: begin["+a+"] + size["+a+"] ("+(n[a]+e[a])+") would overflow input.shape["+a+"] ("+r.shape[a]+")"})},o=0;o<r.rank;++o)t(o)}function Ia(r){for(var n=[],e=0;r>0;)1&r&&n.push(e),r/=2,e++;return n}function lo(r,n,e){for(var t=[],o=0;o<r.length;o++)t[o]=Math.ceil((n[o]-r[o])/e[o]);return t}function Eu(r,n,e,t,o){var a=n[o];(r&1<<o||null==a)&&(a=(e[o]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=t[o];return a<0&&(a+=s),Zr(0,a,s-1)}function Iu(r,n,e,t,o){var a=n[o],i=e[o]||1;(r&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=t[o];return a<0&&(a+=s),i>0?Zr(0,a,s):Zr(-1,a,s-1)}function Da(r,n,e){for(var t=e.length,o=0;o<e.length;o++)if(e[o]>1){t=o;break}for(o=t+1;o<e.length;o++)if(n[o]>0||e[o]!==r[o])return!1;return!0}function ka(r,n){for(var e=r.length>0?r[r.length-1]:1,t=0;t<r.length-1;t++)e+=r[t]*n[t];return e}function ho(r){return S.customGrad(r)}Object.freeze({validateUpdateShape:wu,validateInput:Cu,calculateShapes:Er}),Object.freeze({assertParamsValid:Tu,maskToAxes:Ia,computeOutShape:lo,startForAxis:Eu,stopForAxis:Iu,isSliceContinous:Da,computeFlatOffset:ka});var Zt=R({softmax_:function(r,n){void 0===n&&(n=-1);var e=C(r,"logits","softmax","float32");if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+n);return S.runKernelFunc(function(t,o){var a=t.softmax(e,n);return o([a]),a},{logits:e},function(t,o){var a=o[0],i=t.mul(a);return{logits:function(){return i.sub(i.sum([n],!0).mul(a))}}},"Softmax",{dim:n},[],[!0])}}),Dd=R({logSoftmax_:function(r,n){void 0===n&&(n=-1);var e=C(r,"logits","logSoftmax");if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+n);return ho(function(t,o){var a=t.max(n,!0),i=t.sub(a),s=i.toFloat().sub(i.exp().sum(n,!0).log());return o([s]),{value:s,gradFunc:function(u,c){var h=c[0].exp();return u.sub(u.sum(n,!0).mul(h))}}})(e)}}),Du=function(){function r(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},r.prototype.set=function(n,e){this.dataIdsCount++,this.data.set(n,e)},r.prototype.has=function(n){return this.data.has(n)},r.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),ku=function(){function r(){}return r.prototype.time=function(n){return F("time")},r.prototype.read=function(n){return F("read")},r.prototype.readSync=function(n){return F("readSync")},r.prototype.numDataIds=function(){return F("numDataIds")},r.prototype.disposeData=function(n){return F("disposeData")},r.prototype.write=function(n,e,t){return F("write")},r.prototype.move=function(n,e,t,o){return F("move")},r.prototype.memory=function(){return F("memory")},r.prototype.floatPrecision=function(){return F("floatPrecision")},r.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},r.prototype.batchMatMul=function(n,e,t,o){return F("batchMatMul")},r.prototype.fusedBatchMatMul=function(n){return F("fusedBatchMatMul")},r.prototype.slice=function(n,e,t){return F("slice")},r.prototype.stridedSlice=function(n,e,t,o){return F("stridedSlice")},r.prototype.unstack=function(n,e){return F("unstack")},r.prototype.reverse=function(n,e){return F("reverse")},r.prototype.concat=function(n,e){return F("concat")},r.prototype.neg=function(n){return F("neg")},r.prototype.add=function(n,e){return F("add")},r.prototype.addN=function(n){return F("addN")},r.prototype.subtract=function(n,e){return F("subtract")},r.prototype.multiply=function(n,e){return F("multiply")},r.prototype.realDivide=function(n,e){return F("realDivide")},r.prototype.floorDiv=function(n,e){return F("floorDiv")},r.prototype.sum=function(n,e){return F("sum")},r.prototype.prod=function(n,e){return F("prod")},r.prototype.unsortedSegmentSum=function(n,e,t){return F("unsortedSegmentSum")},r.prototype.argMin=function(n,e){return F("argMin")},r.prototype.argMax=function(n,e){return F("argMax")},r.prototype.equal=function(n,e){return F("equal")},r.prototype.notEqual=function(n,e){return F("notEqual")},r.prototype.less=function(n,e){return F("less")},r.prototype.lessEqual=function(n,e){return F("lessEqual")},r.prototype.greater=function(n,e){return F("greater")},r.prototype.greaterEqual=function(n,e){return F("greaterEqual")},r.prototype.logicalNot=function(n){return F("logicalNot")},r.prototype.logicalAnd=function(n,e){return F("logicalAnd")},r.prototype.logicalOr=function(n,e){return F("logicalOr")},r.prototype.where=function(n){return F("where")},r.prototype.select=function(n,e,t){return F("select")},r.prototype.topk=function(n,e,t){return F("topk")},r.prototype.min=function(n,e){return F("min")},r.prototype.minimum=function(n,e){return F("minimum")},r.prototype.mod=function(n,e){return F("mod")},r.prototype.max=function(n,e){return F("max")},r.prototype.maximum=function(n,e){return F("maximum")},r.prototype.all=function(n,e){return F("all")},r.prototype.any=function(n,e){return F("any")},r.prototype.squaredDifference=function(n,e){return F("squaredDifference")},r.prototype.ceil=function(n){return F("ceil")},r.prototype.floor=function(n){return F("floor")},r.prototype.round=function(n){return F("round")},r.prototype.sign=function(n){return F("sign")},r.prototype.isNaN=function(n){return F("isNaN")},r.prototype.isInf=function(n){return F("isInf")},r.prototype.isFinite=function(n){return F("isFinite")},r.prototype.pow=function(n,e){return F("pow")},r.prototype.exp=function(n){return F("exp")},r.prototype.expm1=function(n){return F("expm1")},r.prototype.softmax=function(n,e){return F("softmax")},r.prototype.log=function(n){return F("log")},r.prototype.log1p=function(n){return F("log1p")},r.prototype.sqrt=function(n){return F("sqrt")},r.prototype.rsqrt=function(n){return F("rsqrt")},r.prototype.square=function(n){return F("square")},r.prototype.reciprocal=function(n){return F("reciprocal")},r.prototype.relu=function(n){return F("relu")},r.prototype.relu6=function(n){return F("relu6")},r.prototype.prelu=function(n,e){return F("prelu")},r.prototype.elu=function(n){return F("elu")},r.prototype.eluDer=function(n,e){return F("eluDer")},r.prototype.selu=function(n){return F("selu")},r.prototype.int=function(n){return F("int")},r.prototype.clip=function(n,e,t){return F("clip")},r.prototype.abs=function(n){return F("abs")},r.prototype.complexAbs=function(n){return F("complexAbs")},r.prototype.sigmoid=function(n){return F("sigmoid")},r.prototype.softplus=function(n){return F("softplus")},r.prototype.sin=function(n){return F("sin")},r.prototype.cos=function(n){return F("cos")},r.prototype.tan=function(n){return F("tan")},r.prototype.asin=function(n){return F("asin")},r.prototype.acos=function(n){return F("acos")},r.prototype.atan=function(n){return F("atan")},r.prototype.atan2=function(n,e){return F("atan2")},r.prototype.sinh=function(n){return F("sinh")},r.prototype.cosh=function(n){return F("cosh")},r.prototype.tanh=function(n){return F("tanh")},r.prototype.asinh=function(n){return F("asinh")},r.prototype.acosh=function(n){return F("acosh")},r.prototype.atanh=function(n){return F("atanh")},r.prototype.erf=function(n){return F("erf")},r.prototype.step=function(n,e){return F("step")},r.prototype.fusedConv2d=function(n){return F("fusedConv2d")},r.prototype.conv2d=function(n,e,t){return F("conv2d")},r.prototype.conv2dDerInput=function(n,e,t){return F("conv2dDerInput")},r.prototype.conv2dDerFilter=function(n,e,t){return F("conv2dDerFilter")},r.prototype.fusedDepthwiseConv2D=function(n){return F("fusedDepthwiseConv2D")},r.prototype.depthwiseConv2D=function(n,e,t){return F("depthwiseConv2D")},r.prototype.depthwiseConv2DDerInput=function(n,e,t){return F("depthwiseConv2DDerInput")},r.prototype.depthwiseConv2DDerFilter=function(n,e,t){return F("depthwiseConv2DDerFilter")},r.prototype.conv3d=function(n,e,t){return F("conv3d")},r.prototype.conv3dDerInput=function(n,e,t){return F("conv3dDerInput")},r.prototype.conv3dDerFilter=function(n,e,t){return F("conv3dDerFilter")},r.prototype.maxPool=function(n,e){return F("maxPool")},r.prototype.maxPoolBackprop=function(n,e,t,o){return F("maxPoolBackprop")},r.prototype.avgPool=function(n,e){return F("avgPool")},r.prototype.avgPoolBackprop=function(n,e,t){return F("avgPoolBackprop")},r.prototype.avgPool3d=function(n,e){return F("avgPool3d")},r.prototype.avgPool3dBackprop=function(n,e,t){return F("avgPool3dBackprop")},r.prototype.maxPool3d=function(n,e){return F("maxPool3d")},r.prototype.maxPool3dBackprop=function(n,e,t,o){return F("maxPool3dBackprop")},r.prototype.reshape=function(n,e){return F("reshape")},r.prototype.cast=function(n,e){return F("cast")},r.prototype.tile=function(n,e){return F("tile")},r.prototype.pad=function(n,e,t){return F("pad")},r.prototype.transpose=function(n,e){return F("transpose")},r.prototype.gather=function(n,e,t){return F("gather")},r.prototype.gatherND=function(n,e){return F("gatherND")},r.prototype.scatterND=function(n,e,t){return F("scatterND")},r.prototype.batchToSpaceND=function(n,e,t){return F("batchToSpaceND")},r.prototype.spaceToBatchND=function(n,e,t){return F("spaceToBatchND")},r.prototype.resizeBilinear=function(n,e,t,o){return F("resizeBilinear")},r.prototype.resizeBilinearBackprop=function(n,e,t){return F("resizeBilinearBackprop")},r.prototype.resizeNearestNeighbor=function(n,e,t,o){return F("resizeNearestNeighbor")},r.prototype.resizeNearestNeighborBackprop=function(n,e,t){return F("resizeNearestNeighborBackprop")},r.prototype.batchNormalization=function(n,e,t,o,a,i){return F("batchNormalization")},r.prototype.localResponseNormalization4D=function(n,e,t,o,a){return F("localResponseNormalization4D")},r.prototype.LRNGrad=function(n,e,t,o,a,i,s){return F("LRNGrad")},r.prototype.multinomial=function(n,e,t,o){return F("multinomial")},r.prototype.oneHot=function(n,e,t,o){return F("oneHot")},r.prototype.cumsum=function(n,e,t,o){return F("cumsum")},r.prototype.nonMaxSuppression=function(n,e,t,o,a){return F("nonMaxSuppression")},r.prototype.fft=function(n){return F("fft")},r.prototype.ifft=function(n){return F("ifft")},r.prototype.complex=function(n,e){return F("complex")},r.prototype.real=function(n){return F("real")},r.prototype.imag=function(n){return F("imag")},r.prototype.cropAndResize=function(n,e,t,o,a,i){return F("cropAndResize")},r.prototype.depthToSpace=function(n,e,t){return F("depthToSpace")},r.prototype.split=function(n,e,t){return F("split")},r.prototype.sparseToDense=function(n,e,t,o){return F("sparseToDense")},r.prototype.diag=function(n){return F("diag")},r.prototype.fill=function(n,e,t){return F("fill")},r.prototype.onesLike=function(n){return F("onesLike")},r.prototype.zerosLike=function(n){return F("zerosLike")},r.prototype.linspace=function(n,e,t){return F("linspace")},r.prototype.dispose=function(){return F("dispose")},r}();function F(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function jt(r,n){for(var e=r.length,t=[],o=0;o<e;o++){var a=e-1-o;(n[n.length-1-o]||1)>1&&1===(r[a]||1)&&t.unshift(a)}return t}function We(r,n){for(var e=[],t=0;t<n.length;t++){var o=r[r.length-t-1],a=n.length-t-1;(null==o||1===o&&n[a]>1)&&e.unshift(a)}return e}function de(r,n){for(var e=[],t=Math.max(r.length,n.length),o=0;o<t;o++){var a=r[r.length-o-1];null==a&&(a=1);var i=n[n.length-o-1];if(null==i&&(i=1),1===a)e.unshift(i);else if(1===i)e.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+r+" and "+n+".");e.unshift(a)}}return e}function zn(r,n,e,t,o,a,i){void 0===i&&(i="channelsLast");var s,u=po(n),c=u[0],h=u[1];if("channelsLast"===i)s=[c,h,r[3],r[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[c,h,r[1],r[1]]}return ln(r,s,e,t,o,a,!1,i)}function Ir(r,n,e,t,o,a,i){void 0===i&&(i="NDHWC");var s,u,c=Sa(n),h=c[0],d=c[1],f=c[2];if("NDHWC"===i)u="channelsLast",s=[h,d,f,r[4],r[4]];else{if("NCDHW"!==i)throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[h,d,f,r[1],r[1]]}return Dr(r,s,e,t,o,!1,u,a)}function ln(r,n,e,t,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],h=u[1],d=u[2],f=u[3];if("channelsLast"===s)c=r[0],h=r[1],d=r[2],f=r[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=r[0],f=r[1],h=r[2],d=r[3]}var p,v=n[0],m=n[1],g=n[3],y=po(e),x=y[0],b=y[1],_=po(t),w=_[0],T=_[1],A=Hn(v,w),k=Hn(m,T),I=function(B,L,q,V,U,z,H,K){var re,oe,le;if("number"==typeof B){re={top:B,bottom:B,left:B,right:B,type:0===B?"VALID":"NUMBER"};var he=function(me,Te,Ce,Fe,Re){null==Fe&&(Fe=Aa(me,Te,Ce));var Ut=me[1],Vt=kr((me[0]-Te+2*Fe)/Ce+1,Re);E(Ae(Vt),function(){return"The output # of rows ("+Vt+") must be an integer. Change the stride and/or zero pad parameters"});var mt=kr((Ut-Te+2*Fe)/Ce+1,Re);return E(Ae(mt),function(){return"The output # of columns ("+mt+") must be an integer. Change the stride and/or zero pad parameters"}),[Vt,mt]}([L,q],z,V,B,K);oe=he[0],le=he[1]}else if("same"===B){oe=Math.ceil(L/V),le=Math.ceil(q/U);var pe=Math.max(0,(oe-1)*V+z-L),be=Math.max(0,(le-1)*U+H-q),ve=Math.floor(pe/2),_e=pe-ve,Me=Math.floor(be/2);re={top:ve,bottom:_e,left:Me,right:be-Me,type:"SAME"}}else{if("valid"!==B)throw Error("Unknown padding parameter: "+B);re={top:0,bottom:0,left:0,right:0,type:"VALID"},oe=Math.ceil((L-z+1)/V),le=Math.ceil((q-H+1)/U)}return{padInfo:re,outHeight:oe,outWidth:le}}(o,h,d,x,b,A,k,a),N=I.outHeight,P=I.outWidth,W=i?g*f:g;return"channelsFirst"===s?p=[c,W,N,P]:"channelsLast"===s&&(p=[c,N,P,W]),{batchSize:c,dataFormat:s,inHeight:h,inWidth:d,inChannels:f,outHeight:N,outWidth:P,outChannels:W,padInfo:I.padInfo,strideHeight:x,strideWidth:b,filterHeight:v,filterWidth:m,effectiveFilterHeight:A,effectiveFilterWidth:k,dilationHeight:w,dilationWidth:T,inShape:r,outShape:p,filterShape:n}}function Dr(r,n,e,t,o,a,i,s){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],h=u[1],d=u[2],f=u[3],p=u[4];if("channelsLast"===i)c=r[0],h=r[1],d=r[2],f=r[3],p=r[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);c=r[0],p=r[1],h=r[2],d=r[3],f=r[4]}var v,m=n[0],g=n[1],y=n[2],x=n[4],b=Sa(e),_=b[0],w=b[1],T=b[2],A=Sa(t),k=A[0],I=A[1],D=A[2],N=Hn(m,k),P=Hn(g,I),W=Hn(y,D),B=function(H,K,re,oe,le,he,pe,be,ve,_e,Me){var me,Te,Ce,Fe;if("number"==typeof H){me={top:H,bottom:H,left:H,right:H,front:H,back:H,type:0===H?"VALID":"NUMBER"};var Re=function(ir,rn,cs,sr,Gt,ls){null==Gt&&(Gt=Aa(ir,rn,sr));var Zy=ir[1],jy=ir[2],hs=kr((ir[0]-rn+2*Gt)/sr+1,ls);E(Ae(hs),function(){return"The output # of depths ("+hs+") must be an integer. Change the stride and/or zero pad parameters"});var ds=kr((Zy-rn+2*Gt)/sr+1,ls);E(Ae(ds),function(){return"The output # of rows ("+ds+") must be an integer. Change the stride and/or zero pad parameters"});var fs=kr((jy-rn+2*Gt)/sr+1,ls);return E(Ae(fs),function(){return"The output # of columns ("+fs+") must be an integer. Change the stride and/or zero pad parameters"}),[hs,ds,fs,1]}([K,re,oe,1],be,0,le,H,Me);Te=Re[0],Ce=Re[1],Fe=Re[2]}else if("same"===H){var Pe=((Te=Math.ceil(K/le))-1)*le+be-K,Ut=((Ce=Math.ceil(re/he))-1)*he+ve-re,Vt=((Fe=Math.ceil(oe/pe))-1)*pe+_e-oe,mt=Math.floor(Pe/2),ar=Pe-mt,tn=Math.floor(Ut/2),xn=Ut-tn,nn=Math.floor(Vt/2);me={top:tn,bottom:xn,left:nn,right:Vt-nn,front:mt,back:ar,type:"SAME"}}else{if("valid"!==H)throw Error("Unknown padding parameter: "+H);me={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Te=Math.ceil((K-be+1)/le),Ce=Math.ceil((re-ve+1)/he),Fe=Math.ceil((oe-_e+1)/pe)}return{padInfo:me,outDepth:Te,outHeight:Ce,outWidth:Fe}}(o,h,d,f,_,w,T,N,P,W,s),q=B.outDepth,V=B.outHeight,U=B.outWidth,z=a?x*p:x;return"channelsFirst"===i?v=[c,z,q,V,U]:"channelsLast"===i&&(v=[c,q,V,U,z]),{batchSize:c,dataFormat:i,inDepth:h,inHeight:d,inWidth:f,inChannels:p,outDepth:q,outHeight:V,outWidth:U,outChannels:z,padInfo:B.padInfo,strideDepth:_,strideHeight:w,strideWidth:T,filterDepth:m,filterHeight:g,filterWidth:y,effectiveFilterDepth:N,effectiveFilterHeight:P,effectiveFilterWidth:W,dilationDepth:k,dilationHeight:I,dilationWidth:D,inShape:r,outShape:v,filterShape:n}}function Aa(r,n,e,t){void 0===t&&(t=1);var o=Hn(n,t);return Math.floor((r[0]*(e-1)-e+o)/2)}function po(r){return"number"==typeof r?[r,r,r]:2===r.length?[r[0],r[1],1]:r}function Sa(r){return"number"==typeof r?[r,r,r]:r}function Hn(r,n){return n<=1?r:r+(r-1)*(n-1)}function kr(r,n){if(!n)return r;switch(n){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+n)}}function Dn(r){var n=po(r);return 1===n[0]&&1===n[1]&&1===n[2]}function ot(r,n){return Dn(r)||Dn(n)}function vo(r){if("NHWC"===r)return"channelsLast";if("NCHW"===r)return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function Ra(r,n,e){if("complex64"===n){if("complex64"===r.dtype)return r.clone();var t=De(r.shape),o=r.toFloat(),a=e.complex(o,t);return t.dispose(),o.dispose(),a}if(!Is(r.dtype,n))return S.makeTensorFromDataId(r.dataId,r.shape,n);if("complex64"===r.dtype){var i=e.real(r);return a=i.cast(n),i.dispose(),a}if("int32"===n)return e.int(r);if("bool"===n){var s=Z(0,r.dtype);return a=e.notEqual(r,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+n)}function mo(r,n){return S.makeTensorFromDataId(r.dataId,n,r.dtype)}function Pa(r,n,e){var t=(n-r)/(e-1),o=Un(e,"float32");o[0]=r;for(var a=1;a<o.length;a++)o[a]=o[a-1]+t;return Le(o,"float32")}function Na(r,n){if(r.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+n.length+".");for(var e=new Float32Array(2*r.length),t=0;t<e.length;t+=2)e[t]=r[t/2],e[t+1]=n[t/2];return e}function Au(r,n){return{real:r[2*n],imag:r[2*n+1]}}function kd(r,n,e,t){r[2*t]=n,r[2*t+1]=e}function Ad(r,n,e){var t=(e?2:-2)*Math.PI*(r/n);return{real:Math.cos(t),imag:Math.sin(t)}}function Sd(r,n,e){var t=function(u,c,h){for(var d=0,f=u.length,p=0,v=!1;d<f;){var m=h(c,u[p=d+(f-d>>>1)]);m>0?d=p+1:(f=p,v=!m)}return v?d:-d-1}(r,n,e||Rd);r.splice(t<0?-(t+1):t,0,n)}function Rd(r,n){return r>n?1:r<n?-1:0}function Fa(r,n,e,t,o){return Su(r,n,e,t,o,0).selectedIndices}function Ma(r,n,e,t,o,a){var i=Su(r,n,e,t,o,a,!0);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function Su(r,n,e,t,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);for(var u=Array.from(n).map(function(_,w){return{score:_,boxIndex:w,suppressBeginIndex:0}}).filter(function(_){return _.score>o}).sort(Ru),c=a>0?-.5/a:0,h=[],d=[];h.length<e&&u.length>0;){var f=u.pop(),p=f.score,v=f.boxIndex,m=f.suppressBeginIndex;if(p<o)break;for(var g=!1,y=h.length-1;y>=m;--y){var x=Pd(r,v,h[y]);if(x>=t){g=!0;break}if(f.score=f.score*Nd(t,c,x),f.score<=o)break}f.suppressBeginIndex=h.length,g||(f.score===p?(h.push(v),d.push(f.score)):f.score>o&&Sd(u,f,Ru))}var b=h.length;return s&&(h.fill(0,b),d.fill(0,b)),{selectedIndices:Le(h,"int32"),selectedScores:Le(d,"float32"),numValidOutputs:Z(b,"int32")}}function Pd(r,n,e){var t=r.subarray(4*n,4*n+4),o=r.subarray(4*e,4*e+4),a=Math.min(t[0],t[2]),i=Math.min(t[1],t[3]),s=Math.max(t[0],t[2]),u=Math.max(t[1],t[3]),c=Math.min(o[0],o[2]),h=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),p=(s-a)*(u-i),v=(d-c)*(f-h);if(p<=0||v<=0)return 0;var m=Math.max(a,c),g=Math.max(i,h),y=Math.min(s,d),x=Math.min(u,f),b=Math.max(y-m,0)*Math.max(x-g,0);return b/(p+v-b)}function Nd(r,n,e){var t=Math.exp(n*e*e);return e<=r?t:0}function Ru(r,n){return r.score-n.score||r.score===n.score&&n.boxIndex-r.boxIndex}function Pu(r,n,e){var t=new Array(r.rank).fill(0),o=r.shape.slice();return n.map(function(a){o[e]=a;var i=r.slice(t,o);return t[e]+=a,i})}function Nu(r,n){for(var e=new Array(r.rank),t=0;t<e.length;t++)e[t]=r.shape[t]*n[t];var o=se(e,r.dtype);for(t=0;t<o.values.length;++t){for(var a=o.indexToLoc(t),i=new Array(r.rank),s=0;s<i.length;s++)i[s]=a[s]%r.shape[s];var u=r.locToIndex(i);o.values[t]=r.values[u]}return o.toTensor()}function Fu(r,n,e,t,o){for(var a=n[n.length-1],i=[r.length/a,a],s=i[0],u=i[1],c=Ln(e,s*t),h=Ln("int32",s*t),d=0;d<s;d++){for(var f=d*u,p=r.subarray(f,f+u),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});v.sort(function(_,w){return w.value-_.value});var g=d*t,y=c.subarray(g,g+t),x=h.subarray(g,g+t);for(m=0;m<t;m++)y[m]=v[m].value,x[m]=v[m].index}var b=n.slice();return b[b.length-1]=t,[Xe(c,b,e),Xe(h,b,"int32")]}function Oa(r,n){for(var e=[],t=0;t<n.length;t++)n[t]&&e.push(t);var o=se(r,"int32"),a=se([e.length,r.length],"int32");for(t=0;t<e.length;t++){var i=o.indexToLoc(e[t]);a.values.set(i,t*r.length)}return a.toTensor()}Object.freeze({castTensor:Ra,reshapeTensor:mo,linspaceImpl:Pa,upcastType:He,axesAreInnerMostDims:xa,combineLocations:du,computeOutAndReduceShapes:Je,expandShapeToKeepDim:rt,assertAxesAreInnerMostDims:it,getAxesPermutation:Ct,getUndoAxesPermutation:ro,getInnerMostAxes:Tt,getBroadcastDims:jt,getReductionAxes:We,assertAndGetBroadcastShape:de,assertParamsConsistent:fu,computeOutShape:Cn,computePool2DInfo:zn,computePool3DInfo:Ir,computeConv2DInfo:ln,computeConv3DInfo:Dr,computeDefaultPad:Aa,tupleValuesAreOne:Dn,eitherStridesOrDilationsAreOne:ot,convertConv2DDataFormat:vo,PARALLELIZE_THRESHOLD:Ea,computeOptimalWindowSize:co});var Fd=function(r,n){this.outputShape=[],this.outputShape=r,this.variableNames=n.map(function(o,a){return"T"+a});var e=[];this.variableNames.forEach(function(o){e.push("float v"+o+" = get"+o+"AtOutCoords();")});var t=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        float result = "+t+";\n        setOutput(result);\n      }\n    "},Md=function(r,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=n.map(function(o,a){return"T"+a});var e=[];this.variableNames.forEach(function(o){e.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var t=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        vec4 result = "+t+";\n        setOutput(result);\n      }\n    "},Od=function(r,n,e){this.variableNames=["A"];var t=r.windowSize,o=r.batchSize,i=Math.ceil(r.inSize/t);e||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+t+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+t+"; i++) {\n          int inIdx = "+(e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===n?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function Mu(r,n){return["x","y","z","w","u","v"].slice(0,n).map(function(e){return r+"."+e})}function ut(r,n){return 1===n?[r]:Mu(r,n)}function Qe(){var r,n,e,t,o,a,i,s,u,c;return 2===O().getNumber("WEBGL_VERSION")?(r="#version 300 es",n="in",e="out",t="in",o="texture",a="outputColor",i="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(r="",n="attribute",e="varying",t="varying",o="texture2D",a="gl_FragColor",i="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:r,attribute:n,varyingVs:e,varyingFs:t,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function kn(r,n,e){void 0===e&&(e="index");var t=_t(n);return t.map(function(o,a){return"int "+r[a]+" = "+e+" / "+o+"; "+(a===t.length-1?"int "+r[a+1]+" = "+e+" - "+r[a]+" * "+o:"index -= "+r[a]+" * "+o)+";"}).join("")}function Ba(r){var n=_t(r).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+n[0]+" + coords.y * "+n[1]+" + coords.z;\n  }\n"}var Ou="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Bd(r,n,e,t){var o=[];r.forEach(function(p){var v=$(p.shapeInfo.logicalShape);p.shapeInfo.isUniform?o.push("uniform float "+p.name+(v>1?"["+v+"]":"")+";"):(o.push("uniform sampler2D "+p.name+";"),o.push("uniform int offset"+p.name+";"))});var a,i,p,s=o.join("\n"),u=r.map(function(p){return function(v,m,g){void 0===g&&(g=!1);var y="";return y+=g?Bu(v):Zn(v),v.shapeInfo.logicalShape.length<=m.logicalShape.length&&(y+=g?function(_,w){var T,q,A=_.name,k=A.charAt(0).toUpperCase()+A.slice(1),I="get"+k+"AtOutCoords",D=_.shapeInfo.logicalShape.length,N=w.logicalShape.length,P=jt(_.shapeInfo.logicalShape,w.logicalShape),W=Ie(N),B=N-D,L=["x","y","z","w","u","v"];T=0===D?"":N<2&&P.length>=1?"coords = 0;":P.map(function(re){return"coords."+L[re+B]+" = 0;"}).join("\n"),q=N<2&&D>0?"coords":_.shapeInfo.logicalShape.map(function(re,oe){return"coords."+L[oe+B]}).join(", ");var V="return outputValue;",U=1===$(_.shapeInfo.logicalShape),z=1===$(w.logicalShape);if(1!==D||U||z){if(U&&!z)V=1===N?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(P.length){var H=D-2,K=D-1;P.indexOf(H)>-1&&P.indexOf(K)>-1?V="return vec4(outputValue.x);":P.indexOf(H)>-1?V="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":P.indexOf(K)>-1&&(V="return vec4(outputValue.xx, outputValue.zz);")}}else V="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+I+"() {\n      "+W+" coords = getOutputCoords();\n      "+T+"\n      vec4 outputValue = get"+k+"("+q+");\n      "+V+"\n    }\n  "}(v,m):function(_,w){var T=_.name,A=T.charAt(0).toUpperCase()+T.slice(1),k="get"+A+"AtOutCoords",N=_.shapeInfo.logicalShape.length,P=w.logicalShape.length;if(!_.shapeInfo.isUniform&&N===P&&null==_.shapeInfo.flatOffset&&Oe(_.shapeInfo.texShape,w.texShape))return"\n      float "+k+"() {\n        return sampleTexture("+T+", resultUV);\n      }\n    ";var B=Ie(P),L=jt(_.shapeInfo.logicalShape,w.logicalShape),q=P-N,V=["x","y","z","w","u","v"];return"\n    float "+k+"() {\n      "+B+" coords = getOutputCoords();\n      "+(0===N?"":P<2&&L.length>=1?"coords = 0;":L.map(function(z){return"coords."+V[z+q]+" = 0;"}).join("\n"))+"\n      return get"+A+"("+(P<2&&N>0?"coords":_.shapeInfo.logicalShape.map(function(z,H){return"coords."+V[H+q]}).join(", "))+");\n    }\n  "}(v,m)),y}(p,n,t)}).join("\n"),c=n.texShape,h=Qe(),d="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+h.texture2D+"(textureSampler, uv).r;\n    }\n  ",f=(p=h).version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+p.varyingFs+" vec2 resultUV;\n    "+p.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+p.defineSpecialNaN+"\n    "+p.defineSpecialInf+"\n    "+p.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Ld+"\n    "+Wd+"\n    "+Ud+"\n  ";return n.isPacked?(a=function(p,v){switch(p.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return w=v,1===(T=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+T[1]+".0);\n      }\n    ":1===T[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+T[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+T[0]+", "+T[1]+"));\n      return 2 * (resTexRC.x * "+T[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(_,w){var T=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)];if(Oe(_,w))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+T[0]+", "+T[1]+"));\n      }\n    ";var A=Math.ceil(_[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+T[0]+", "+T[1]+"));\n\n      int index = resTexRC.x * "+T[1]+" + resTexRC.y;\n      int r = 2 * (index / "+A+");\n      int c = imod(index, "+A+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(p,v);case 3:return m=p,g=v,y=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],b=(x=Math.ceil(m[2]/2))*Math.ceil(m[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+y[0]+", "+y[1]+"));\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n\n      int b = index / "+b+";\n      index -= b * "+b+";\n\n      int r = 2 * (index / "+x+");\n      int c = imod(index, "+x+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(_,w){for(var T=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)],A=Math.ceil(_[_.length-1]/2),k=A*Math.ceil(_[_.length-2]/2),I=k,D="",N="b, r, c",P=2;P<_.length-1;P++)D="\n      int b"+P+" = index / "+(I*=_[_.length-P-1])+";\n      index -= b"+P+" * "+I+";\n    "+D,N="b"+P+", "+N;return"\n    ivec"+_.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+T[0]+", "+T[1]+"));\n      int index = resTexRC.x * "+T[1]+" + resTexRC.y;\n\n      "+D+"\n\n      int b = index / "+k+";\n      index -= b * "+k+";\n\n      int r = 2 * (index / "+A+");\n      int c = imod(index, "+A+") * 2;\n\n      return ivec"+_.length+"("+N+");\n    }\n  "}(p,v)}var w,T,m,g,y,x,b}(n.logicalShape,c),i=function(p){return"\n    void setOutput(vec4 val) {\n      "+p.output+" = val;\n    }\n  "}(h)):(a=function(p,v){switch(p.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(x=v)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+x[1]+".0);\n      }\n    ":1===x[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+x[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+x[0]+", "+x[1]+"));\n      return resTexRC.x * "+x[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(y,x){return Oe(y,x)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+x[0]+", "+x[1]+"));\n      }\n    ":1===y[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+x[0]+", "+x[1]+"));\n        int index = resTexRC.x * "+x[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===y[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+x[0]+", "+x[1]+"));\n        int index = resTexRC.x * "+x[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+x[0]+", "+x[1]+"));\n      int index = resTexRC.x * "+x[1]+" + resTexRC.y;\n      int r = index / "+y[1]+";\n      int c = index - r * "+y[1]+";\n      return ivec2(r, c);\n    }\n  "}(p,v);case 3:return m=v,g=kn(["r","c","d"],p),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+m[0]+", "+m[1]+"));\n      int index = resTexRC.x * "+m[1]+" + resTexRC.y;\n      "+g+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(y,x){var b=kn(["r","c","d","d2"],y);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+x[0]+", "+x[1]+"));\n      int index = resTexRC.x * "+x[1]+" + resTexRC.y;\n      "+b+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(p,v);case 5:return function(y,x){var b=kn(["r","c","d","d2","d3"],y);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+x[0]+",\n                             "+x[1]+"));\n\n      int index = resTexRC.x * "+x[1]+" + resTexRC.y;\n\n      "+b+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(p,v);case 6:return function(y,x){var b=kn(["r","c","d","d2","d3","d4"],y);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+x[0]+", "+x[1]+"));\n      int index = resTexRC.x * "+x[1]+" + resTexRC.y;\n\n      "+b+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(p,v);default:throw new Error(p.length+"-D output sampling is not yet supported")}var x,m,g}(n.logicalShape,c),i=function(p){return"\n    void setOutput(float val) {\n      "+p.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(h)),t&&(f+=Vd),[f,d,i,s,a,u,e].join("\n")}function Zn(r){var n=r.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var t=e.name,o="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+o+"() {return "+t+";}";var a=e.shapeInfo.texShape;if(1===a[0]&&1===a[1])return"\n      float "+o+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var u=e.shapeInfo.texShape;return"\n    float "+o+"() {\n      vec2 uv = uvFromFlat("+u[0]+", "+u[1]+", "+An(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(r);case 1:return function(e){var t=e.name,o="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+o+"(int index) {\n        "+jn(e)+"\n      }\n    ";var a=e.shapeInfo.texShape,i=a[0],s=a[1];if(1===s&&1===i)return"\n      float "+o+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var u=An(t);return 1===s?"\n      float "+o+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+u+") + 0.5) / "+i+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===i?"\n      float "+o+"(int index) {\n        vec2 uv = vec2((float(index + "+u+") + 0.5) / "+s+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+o+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+s+", index + "+u+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(r);case 2:return function(e){var t=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=e.shapeInfo.texShape;if(null!=i&&Oe(t,i))return"\n    float "+a+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+i[0]+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ";var c=on(t),h=c.newShape,d=c.keptDims;if(h.length<t.length)return"\n      "+Zn(Kn(e,h))+"\n      float "+a+"(int row, int col) {\n        return "+a+"("+Jn(["row","col"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+a+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+jn(e)+"\n      }\n    ";var v=i[0],m=i[1],g=An(o);return 1===m?"\n    float "+a+"(int row, int col) {\n      float index = dot(vec3(row, col, "+g+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+v+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":1===v?"\n    float "+a+"(int row, int col) {\n      float index = dot(vec3(row, col, "+g+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+m+".0, 0.5);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n  float "+a+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+g+";\n    vec2 uv = uvFromFlat("+v+", "+m+", index);\n    return sampleTexture("+o+", uv);\n  }\n"}(r);case 3:return function(e){var t=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=t[1]*t[2],s=t[2],u=on(t),c=u.newShape,h=u.keptDims;if(c.length<t.length)return"\n        "+Zn(Kn(e,c))+"\n        float "+a+"(int row, int col, int depth) {\n          return "+a+"("+Jn(["row","col","depth"],h)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+a+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+i+", "+s+", 1)));\n        "+jn(e)+"\n      }\n    ";var p=e.shapeInfo.texShape,v=p[0],m=p[1],g=e.shapeInfo.flatOffset;return m===i&&null==g?"\n        float "+a+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+s+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+m+".0, "+v+".0);\n          return sampleTexture("+o+", uv);\n        }\n      ":m===s&&null==g?"\n    float "+a+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+m+".0, "+v+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n      float "+a+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+i+" + col * "+s+" + depth + "+An(o)+";\n        vec2 uv = uvFromFlat("+v+", "+m+", index);\n        return sampleTexture("+o+", uv);\n      }\n  "}(r);case 4:return function(e){var t=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=t[3],s=t[2]*i,u=t[1]*s,c=on(t),h=c.newShape,d=c.keptDims;if(h.length<t.length)return"\n      "+Zn(Kn(e,h))+"\n      float "+a+"(int row, int col, int depth, int depth2) {\n        return "+a+"("+Jn(["row","col","depth","depth2"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+a+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+u+", "+s+", "+i+", 1)));\n        "+jn(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,m=v[0],g=v[1];return g===u&&null==p?"\n      float "+a+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+s+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":g===i&&null==p?"\n      float "+a+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+a+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" +\n          depth * "+i+" + depth2;\n      vec2 uv = uvFromFlat("+m+", "+g+", index + "+An(o)+");\n      return sampleTexture("+o+", uv);\n    }\n  "}(r);case 5:return function(e){var t=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=t[4],s=t[3]*i,u=t[2]*s,c=t[1]*u,h=on(t),d=h.newShape,f=h.keptDims;if(d.length<t.length)return"\n      "+Zn(Kn(e,d))+"\n      float "+a+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+a+"("+Jn(["row","col","depth","depth2","depth3"],f)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+a+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+c+", "+u+", "+s+", "+i+")) +\n          depth3;\n        "+jn(e)+"\n      }\n    ";var v=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,g=m[0],y=m[1];return y===c&&null==v?"\n      float "+a+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+u+", "+s+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+y+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":y===i&&null==v?"\n      float "+a+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+y+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+a+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+c+" + col * "+u+" + depth * "+s+" +\n          depth2 * "+i+" + depth3 + "+An(o)+";\n      vec2 uv = uvFromFlat("+g+", "+y+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(r);case 6:return function(e){var t=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=on(t),s=i.newShape,u=i.keptDims;if(s.length<t.length)return"\n      "+Zn(Kn(e,s))+"\n      float "+a+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+a+"("+Jn(["row","col","depth","depth2","depth3","depth4"],u)+");\n      }\n    ";var h=t[5],d=t[4]*h,f=t[3]*d,p=t[2]*f,v=t[1]*p;if(e.shapeInfo.isUniform)return"\n      float "+a+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+v+", "+p+", "+f+", "+d+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+h+", 1)));\n        "+jn(e)+"\n      }\n    ";var m=e.shapeInfo.flatOffset,g=e.shapeInfo.texShape,y=g[0],x=g[1];return x===v&&null==m?"\n      float "+a+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+p+", "+f+", "+d+", "+h+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+x+".0, "+y+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":x===h&&null==m?"\n      float "+a+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+x+".0, "+y+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+a+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+v+" + col * "+p+" + depth * "+f+" +\n          depth2 * "+d+" + depth3 * "+h+" + depth4 + "+An(o)+";\n      vec2 uv = uvFromFlat("+y+", "+x+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(r);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function Bu(r){var n,o,a,i,s,u,c;switch(r.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=r.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+Qe().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return i="get"+(a=(o=r).name).charAt(0).toUpperCase()+a.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Qe(),"\n    vec4 "+i+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+u[0]+", "+u[1]+", index);\n      return "+c.texture2D+"("+a+", uv);\n    }\n  ";case 2:return function(o){var a=o.shapeInfo.logicalShape,i=o.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),u=o.shapeInfo.texShape,c=u[0],h=u[1],d=Qe();if(null!=u&&Oe(a,u))return"\n      vec4 "+s+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+h+".0, "+c+".0);\n\n        return "+d.texture2D+"("+i+", uv);\n      }\n    ";var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];return"\n    vec4 "+s+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(a[1]/2)+", "+f[0]+", "+f[1]+", row, col);\n      return "+d.texture2D+"("+i+", uv);\n    }\n  "}(r);case 3:return function(o){var a=o.shapeInfo.logicalShape,i=o.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),u=o.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(1===a[0])return"\n        "+Bu(Kn(o,a.slice(1)))+"\n        vec4 "+s+"(int b, int row, int col) {\n          return "+s+"("+Jn(["b","row","col"],[1,2])+");\n        }\n      ";var f=c[0],p=c[1],v=Math.ceil(a[2]/2);return"\n    vec4 "+s+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+f+", "+p+", "+v*Math.ceil(a[1]/2)+", "+v+", b, row, col);\n      return "+Qe().texture2D+"("+i+", uv);\n    }\n  "}(r);default:return function(o){for(var a=o.shapeInfo.logicalShape,i=a.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,h=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],d=h[0],f=h[1],p=Math.ceil(a[i-1]/2),v=p*Math.ceil(a[i-2]/2),m="int b, int row, int col",g="b * "+v+" + (row / 2) * "+p+" + (col / 2)",y=2;y<i-1;y++)m="int b"+y+", "+m,g="b"+y+" * "+(v*=a[i-y-1])+" + "+g;return"\n    vec4 "+u+"("+m+") {\n      int index = "+g+";\n      int texR = index / "+f+";\n      int texC = index - texR * "+f+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+", "+d+");\n      return "+Qe().texture2D+"("+s+", uv);\n    }\n  "}(r)}}var Ld="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Wd="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ud="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Vd="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function An(r){return"offset"+r}function jn(r){var n=r.name,e=$(r.shapeInfo.logicalShape);return e<2?"return "+n+";":"\n    for (int i = 0; i < "+e+"; i++) {\n      if (i == index) {\n        return "+n+"[i];\n      }\n    }\n  "}function Ie(r){if(r<=1)return"int";if(2===r)return"ivec2";if(3===r)return"ivec3";if(4===r)return"ivec4";if(5===r)return"ivec5";if(6===r)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function Kn(r,n){var e=JSON.parse(JSON.stringify(r));return e.shapeInfo.logicalShape=n,e}function Jn(r,n){return n.map(function(e){return r[e]}).join(", ")}var Gd=function(r,n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,E(r.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var a=Math.ceil(r[r.length-1]/n);this.outputShape=r.slice(0,-1),a>1&&this.outputShape.push(a),t||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,c=u.length,h=Ie(c),d=ut("coords",c);if(1===a){var f=Ie(s=c+1);i="\n        "+f+" sourceLocR = "+f+"("+d.join()+", 0);\n        ++"+d[c-1]+";\n        "+f+" sourceLocG = "+f+"("+d.join()+", 0);\n        ++"+d[c-2]+";\n        "+f+" sourceLocA = "+f+"("+d.join()+", 0);\n        --"+d[c-1]+";\n        "+f+" sourceLocB = "+f+"("+d.join()+", 0);\n        --"+d[c-2]+";"}else s=c,i="\n        "+h+" sourceLocR = coords;\n        ++"+d[c-1]+";\n        "+h+" sourceLocG = coords;\n        ++"+d[c-2]+";\n        "+h+" sourceLocA = coords;\n        --"+d[c-1]+";\n        "+h+" sourceLocB = coords;\n        --"+d[c-2]+";";var p=["x","y","z","w","u","v"].slice(0,s),v="."+p[s-1],m=p.map(function(k){return"int "+k}),g=ut("sourceLocR",s-1).concat("inIdx.r"),y=ut("sourceLocG",s-1).concat("inIdx.g"),x=ut("sourceLocB",s-1).concat("inIdx.b"),b=ut("sourceLocA",s-1).concat("inIdx.a"),_="max"===e?"greaterThan":"lessThan",w=t?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+x.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",T="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+y.join()+") : 0.,\n            hasNextRow ? getAChannel("+x.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",A=t?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+p.join()+"),\n                                          vec2("+p.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+p.join()+"),\n                               vec2("+p.slice(-2).join()+"));\n      }\n      "+A+"\n      void main() {\n        "+h+" coords = getOutputCoords();\n        bool hasNextCol = "+d[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+d[c-2]+" < "+(u[c-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+v+", sourceLocG"+v+",\n          sourceLocB"+v+", sourceLocA"+v+") * "+n+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+T+";\n\n        for (int i = 0; i < "+n+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+T+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+_+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},qd=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var s=r.effectiveFilterHeight,u=r.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(s-1-r.padInfo.top)+", "+(u-1-r.padInfo.left)+");\n      const float avgMultiplier = float("+1/(r.filterHeight*r.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+r.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+r.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+r.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+r.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+r.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+r.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},zd=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(h-1-r.padInfo.front)+", "+(d-1-r.padInfo.top)+", "+(f-1-r.padInfo.left)+");\n      const float avgMultiplier = float("+1/(r.filterDepth*r.filterHeight*r.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+h+";\n            wD += "+r.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+r.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+r.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+d+";\n              wR += "+r.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+r.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+r.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+r.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+r.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+r.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Hd=function(r,n,e,t,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],de(r,n),de(r,e);var i="0.0";null!=t&&(de(r,t),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(de(r,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Zd=function(r,n,e,t,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],de(r,n),de(r,e);var i="vec4(0.0)";null!=t&&(de(r,t),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(de(r,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Lu=function(r,n,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=de(n,e),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+r+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},La="return a + b;",Wa="return a - b;",Wu="return a * b;",Uu="return (a < 0.) ? b * a : a;",Ne=function(r,n,e){this.variableNames=["A","B"],this.outputShape=de(n,e),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+r+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Vu="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Kt=function(r,n,e,t){void 0===t&&(t=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=de(n,e);var o=this.outputShape.length,a="";if(t)if(0===o||1===$(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+Ie(o)+" coords = getOutputCoords();\n        ",1===o)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var i=ut("coords",o);a+="\n            bool nextRowOutOfBounds =\n              ("+i[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+i[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+r+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},Jd=function(){function r(n){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return r.prototype.getCustomSetupFunc=function(n,e){var t=this;return function(o,a){null==t.minLoc&&(t.minLoc=o.getUniformLocationNoThrow(a,"minVal"),t.maxLoc=o.getUniformLocationNoThrow(a,"maxVal")),o.gl.uniform1f(t.minLoc,n),o.gl.uniform1f(t.maxLoc,e)}},r}(),Yd=function(){function r(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return r.prototype.getCustomSetupFunc=function(n,e){var t=this;return function(o,a){null==t.minLoc&&(t.minLoc=o.getUniformLocationNoThrow(a,"minVal"),t.maxLoc=o.getUniformLocationNoThrow(a,"maxVal")),o.gl.uniform1f(t.minLoc,n),o.gl.uniform1f(t.maxLoc,e)}},r}(),Xd=function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Qd=function(r){this.outputShape=[],this.outputShape=Cn(r,1),this.variableNames=r.map(function(s,u){return"T"+u});var n=new Array(r.length-1);n[0]=r[0][1];for(var e=1;e<n.length;e++)n[e]=n[e-1]+r[e][1];var t=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<n.length;e++)t.push("else if (yC < "+n[e]+") setOutput(getT"+e+"(yR, yC-"+n[e-1]+"));");t.push("else setOutput(getT"+n.length+"(yR, yC-"+n[n.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+t.join("\n        ")+"\n      }\n    "},$d=function(r,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Cn(r,n);var e=this.outputShape,t=e.length,o=Ie(t),a=ut("coords",t),i=["x","y","z","w","u","v"].slice(0,t);this.variableNames=r.map(function(g,y){return"T"+y});var s=new Array(r.length-1);s[0]=r[0][n];for(var u=1;u<s.length;u++)s[u]=s[u-1]+r[u][n];var c=i[n],h=i.slice(-2),d=i.join(),f="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+d+"), vec2("+h.join()+"));\n        }";for(u=1;u<s.length;u++){var p=s[u-1];f+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+go(i,c,p)+"),\n            vec2("+go(h,c,p)+"));\n        }"}var m=s[s.length-1];f+="\n        return getChannel(\n          getT"+s.length+"("+go(i,c,m)+"),\n          vec2("+go(h,c,m)+"));",this.userCode="\n      float getValue("+i.map(function(g){return"int "+g})+") {\n        "+f+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[t-1]+" = "+a[t-1]+" + 1;\n        if ("+a[t-1]+" < "+e[t-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[t-2]+" = "+a[t-2]+" + 1;\n        if ("+a[t-2]+" < "+e[t-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[t-1]+" = "+a[t-1]+" - 1;\n        if ("+a[t-2]+" < "+e[t-2]+" &&\n            "+a[t-1]+" < "+e[t-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function go(r,n,e){var t=r.indexOf(n);return r.map(function(o,a){return a===t?o+" - "+e:o}).join()}var ef=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+r.batchSize+"; b++) {\n          for (int yR = 0; yR < "+r.outHeight+"; yR++) {\n            int xR = wR + yR * "+r.strideHeight+" - "+r.padInfo.top+";\n\n            if (xR < 0 || xR >= "+r.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+r.outWidth+"; yC++) {\n              int xC = wC + yC * "+r.strideWidth+" - "+r.padInfo.left+";\n\n              if (xC < 0 || xC >= "+r.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===r.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},tf=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterHeight,e=r.filterWidth,a="channelsLast"===r.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(n-1-r.padInfo.top)+", "+(e-1-r.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(a?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(a?1:2)+"], coords["+(a?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+n+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+r.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+n+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+r.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+r.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+r.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},nf=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+r.batchSize+"; b++) {\n          for (int yF = 0; yF < "+r.outDepth+"; yF++) {\n            int xF = wF + yF * "+r.strideDepth+" - "+r.padInfo.front+";\n\n            if (xF < 0 || xF >= "+r.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+r.outHeight+"; yR++) {\n              int xR = wR + yR * "+r.strideHeight+" - "+r.padInfo.top+";\n\n              if (xR < 0 || xR >= "+r.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+r.outWidth+"; yC++) {\n                int xC = wC + yC * "+r.strideWidth+" - "+r.padInfo.left+";\n\n                if (xC < 0 || xC >= "+r.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},rf=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterDepth,e=r.filterHeight,t=r.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(n-1-r.padInfo.front)+", "+(e-1-r.padInfo.top)+", "+(t-1-r.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+n+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+r.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+r.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+n+" - 1 - wF;\n\n          for (int wR = 0; wR < "+e+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+r.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+r.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+e+" - 1 - wR;\n\n            for (int wC = 0; wC < "+t+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+r.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+r.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+t+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+r.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},of=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+r.outChannels/r.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+r.batchSize+"; b++) {\n          for (int yR = 0; yR < "+r.outHeight+"; yR++) {\n            int xR = wR + yR * "+r.strideHeight+" - "+r.padInfo.top+";\n\n            if (xR < 0 || xR >= "+r.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+r.outWidth+"; yC++) {\n              int xC = wC + yC * "+r.strideWidth+" - "+r.padInfo.left+";\n\n              if (xC < 0 || xC >= "+r.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},af=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterHeight,e=r.filterWidth,s=r.outChannels/r.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(n-1-r.padInfo.top)+", "+(e-1-r.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+n+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+r.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+n+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+r.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+r.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Gu=function(r,n,e,t){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===t&&(t=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var o=r.padInfo.top,a=r.padInfo.left,i=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,h=r.filterHeight,d=r.filterWidth,f=4*Math.floor(r.inChannels/4),p=r.inChannels%4,v="channelsLast"===r.dataFormat,m=v?1:2,g=v?2:3,y=v?3:1,x="",b="";e&&(x=t?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",b="result = activation(result);");var _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),t&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+y+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+g+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+h+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+r.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+r.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+v+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===p)+") {\n\n              if ("+v+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+f+") *\n                    getW(wR, wC, "+f+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+f+", xR, xC) *\n                    getW(wR, wC, "+f+", d2);\n              }\n\n            } else if ("+(2===p)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2)\n              );\n\n              if ("+v+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===p)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2),\n                getW(wR, wC, "+f+" + 2, d2)\n              );\n\n              if ("+v+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1),\n                  getX(batch, xR, xC, "+f+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC),\n                  getX(batch, "+f+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+_+"\n        "+b+"\n        setOutput(result);\n      }\n    "},sf=function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var n=r.padInfo.front,e=r.padInfo.top,t=r.padInfo.left,o=r.strideDepth,a=r.strideHeight,i=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,h=r.filterDepth,d=r.filterHeight,f=r.filterWidth,p=4*Math.floor(r.inChannels/4),v=r.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+n+", "+e+", "+t+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+h+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+r.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+r.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+r.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+p+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===v)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+p+") *\n                  getW(wF, wR, wC, "+p+", d2);\n              } else if ("+(2===v)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===v)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1),\n                  getX(batch, xF, xR, xC, "+p+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2),\n                  getW(wF, wR, wC, "+p+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},qu=function(r,n,e,t){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===t&&(t=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var o=r.inHeight,a=r.inWidth,i=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,c=r.strideWidth,h=r.dilationHeight,d=r.dilationWidth,f=r.filterHeight,p=r.filterWidth,v=r.outChannels/r.inChannels,m="",g="";e&&(m=t?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",g="result = activation(result);");var y=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),t&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+v+";\n        int q = d2 - d1 * "+v+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+f+"; wR++) {\n          int xR = xRCorner + wR * "+h+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+p+"; wC++) {\n            int xC = xCCorner + wC * "+d+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+y+"\n        "+g+"\n        setOutput(result);\n      }\n    "},zu=function(r,n,e,t){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===t&&(t=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var o=r.inHeight,a=r.inWidth,i=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,c=r.strideWidth,h=r.dilationHeight,d=r.dilationWidth,f=r.filterHeight,p=r.filterWidth,v=p,m="int xR; int xC; int xCOffset;",g=0;g<f;g++)for(var y=0;y<p;y++)m+="\n          vec4 xTexelR"+g+"C"+2*y+" = vec4(0.);\n          vec4 wR"+g+"C"+y+" = vec4(0.);\n          vec4 xR"+g+"C"+y+" = vec4(0.);";for(g=0;g<f;g++)for(var x=0;x<v;x++){if(m+="\n          xR = xRCorner + "+g*h+";\n          xC = xCCorner + "+(y=2*x)*d+";\n        ",1===c){if(y<p&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+y+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+g+"C"+y+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+g+"C"+y+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+g+"C"+y+" = vec4(previous.zw, xTexelR"+g+"C"+y+".xy);\n                } else {\n                  xR"+g+"C"+y+" = vec4(0, 0, xTexelR"+g+"C"+y+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+y+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+y+" = vec4(0.);\n                }\n\n                xR"+g+"C"+y+" = xTexelR"+g+"C"+y+";\n              ",y+1<p)){var b=s%2==0?Xo(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(y+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",d>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+g+"C"+y+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+g+"C"+y+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+g+"C"+(y+1)+" = vec4(\n                    xTexelR"+g+"C"+y+".zw, xTexelR"+g+"C"+(y+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(y+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+g+"C"+(y+1)+" = xTexelR"+g+"C"+(y+2)+";\n                "}}else y<p&&(m+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+y+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+y+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+g+"C"+(y+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+g+"C"+(y+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+y+" = vec4(\n                  xTexelR"+g+"C"+y+".zw, xTexelR"+g+"C"+(y+2)+".zw);\n              ",y+1<p&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+g+"C"+(y+1)+" = vec4(xTexelR"+g+"C"+(y+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+y+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+y+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+(y+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+(y+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+y+" = vec4(\n                  xTexelR"+g+"C"+y+".xy, xTexelR"+g+"C"+(y+2)+".xy);\n              ",y+1<p&&(m+="\n                  xR"+g+"C"+(y+1)+" = vec4(\n                    xTexelR"+g+"C"+y+".zw, xTexelR"+g+"C"+(y+2)+".zw);\n                ")),m+="}");y<p&&(m+="\n            vec4 wTexelR"+g+"C"+y+" = getW("+g+", "+y+", d1, q);\n            wR"+g+"C"+y+" = vec4(wTexelR"+g+"C"+y+".xz, wTexelR"+g+"C"+y+".xz);\n          ",y+1<p&&(m+="\n              vec4 wTexelR"+g+"C"+(y+1)+" = getW("+g+", "+(y+1)+", d1, q);\n              wR"+g+"C"+(y+1)+" =\n                vec4(wTexelR"+g+"C"+(y+1)+".xz, wTexelR"+g+"C"+(y+1)+".xz);"))}for(g=0;g<f;g++)for(y=0;y<p;y++)m+="dotProd += xR"+g+"C"+y+" * wR"+g+"C"+y+";";var _="",w="";e&&(_=t?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"vec4 activation(vec4 x) {\n          "+e+"\n        }",w="result = activation(result);");var T=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),t&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+_+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+T+"\n        "+w+"\n        setOutput(result);\n      }\n    "},uf=function(r,n,e,t,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=r[0],i=r[1],s=r[2],h=e[0],d=e[1];this.outputShape=[n[0],h,d,r[3]];var p=[i-1+".0",s-1+".0"],v=p[0],m=p[1],g=h>1?[""+(i-1)/(h-1),"(y2-y1) * height_ratio","y1*"+v+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+v],_=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m];this.userCode="\n      const float height_ratio = float("+g[0]+");\n      const float width_ratio = float("+_[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+g[1]+";\n        float width_scale = "+_[1]+";\n\n        float in_y = "+g[2]+";\n        if( in_y < 0.0 || in_y > "+v+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+_[2]+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===t?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},cf=function(r,n,e){this.variableNames=["x"],this.outputShape=r;var t=r.length,o=r[r.length-1],a=e?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(e?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Ie(t)+" coords = getOutputCoords();\n        int end = "+Hu(t,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+n+") {\n            continue;\n          }\n          "+Hu(t,"coords")+" = idx;\n          val += getX("+function(i,s){if(1===i)return""+s;if(2===i)return s+".x, "+s+".y";if(3===i)return s+".x, "+s+".y, "+s+".z";if(4===i)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+i+" is not yet supported")}(t,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Hu(r,n){if(1===r)return""+n;if(2===r)return n+".y";if(3===r)return n+".z";if(4===r)return n+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var lf=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=mr.DENSE;var n=gr(r),e=Qe();this.outputShape=r,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+kn(["r","c","d"],r)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+n[0]+", "+n[1]+"));\n        int index = 4 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+e.output+" = result;\n      }\n    "},hf=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=mr.DENSE;var n=gr(r),e=Qe();this.outputShape=r,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+kn(["r","c","d"],r)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+n[0]+", "+n[1]+"));\n        int index = 4 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+e.output+" = result;\n      }\n    "},df=function(){function r(n,e,t){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=t,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return r.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}(),ff=function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},pf=function(r){this.variableNames=["A"],this.outTexUsage=ct.DOWNLOAD;var n=Qe();this.outputShape=r,this.userCode="\n      "+Ou+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+n.output+" = encode_float(x);\n      }\n    "},vf=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ct.DOWNLOAD;var n=Qe();this.outputShape=r,this.userCode="\n      "+Ou+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+n.output+" = encode_float(x);\n      }\n    "},mf=function(r,n,e){void 0===e&&(e=!1),this.variableNames=["A"];var t=Qe(),o=n[0],a=n[1];this.outputShape=r;var i="result";e&&(i="floor(result * 255. + 0.5)"),this.userCode="\n      "+Ba(r)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n        vec4 values = "+t.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+t.output+" = vec4("+i+", 0., 0., 0.);\n      }\n    "},gf=function(r,n,e){void 0===e&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Qe(),o=n[0],a=n[1];this.outputShape=r;var i="",s="result";e&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var h=2*u+c;i+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+r[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+r[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n              values = "+t.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+h+"] = values[0];\n              } else if(offset == 1) {\n                result["+h+"] = values[1];\n              } else if(offset == 2) {\n                result["+h+"] = values[2];\n              } else {\n                result["+h+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Ba(r)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+i+"\n\n        "+t.output+" = "+s+";\n      }\n    "},Zu=function(r,n,e){this.variableNames=["real","imag"];var t=n[1];this.outputShape=n;var o=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+r+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+t+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+t+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(e?t+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},bf=function(){function r(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return r.prototype.getCustomSetupFunc=function(n){var e=this;return function(t,o){null==e.valueLoc&&(e.valueLoc=t.getUniformLocationNoThrow(o,"value")),t.gl.uniform1f(e.valueLoc,n)}},r}(),_f=function(r,n,e){this.variableNames=["A","indices"];var t=r.slice();t[e]=n,this.outputShape=t,this.rank=t.length;var o=Ie(this.rank),a=function(i,s){var u=i.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(1===u)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],h=[],d=0;d<i.length;d++)h.push(d===s?"int(getIndices("+c[d]+"))":""+c[d]);return h.join()}(r,e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},wf=function(r,n,e){this.sliceDim=r,this.strides=n,this.variableNames=["x","indices"],this.outputShape=e;var t=Ie(n.length),o=Ie(e.length);this.userCode="\n        "+t+" strides = "+t+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function ju(r,n){var e=Qe();return Gs(r,n,e.version+"\n    precision highp float;\n    "+e.attribute+" vec3 clipSpacePos;\n    "+e.attribute+" vec2 uv;\n    "+e.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Ku(r,n){return Zs(r,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Ju(r,n){return js(r,n,new Uint16Array([0,1,2,2,1,3]))}function Ar(r,n,e,t,o,a,i){Js(e,t);var s=Ks(r,n),u=r.TEXTURE_2D;return Y(r,n,function(){return r.bindTexture(u,s)}),Y(r,n,function(){return r.texParameteri(u,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Y(r,n,function(){return r.texParameteri(u,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Y(r,n,function(){return r.texParameteri(u,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Y(r,n,function(){return r.texParameteri(u,r.TEXTURE_MAG_FILTER,r.NEAREST)}),Y(r,n,function(){return r.texImage2D(u,0,o,e,t,0,a,i,null)}),Y(r,n,function(){return r.bindTexture(r.TEXTURE_2D,null)}),s}function Yu(r,n,e,t,o){var a=Jr(e,t);return Ar(r,n,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,r.FLOAT)}function Xu(r,n,e,t,o){var a=Jr(e,t);return Ar(r,n,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function Qu(r,n,e,t,o){var a=Jr(e,t);return Ar(r,n,a[0],a[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function $u(r,n,e,t,o){var a=yr(e,t);return Ar(r,n,a[0],a[1],o.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function ec(r,n,e,t,o){var a=yr(e,t);return Ar(r,n,a[0],a[1],o.internalFormatPackedHalfFloat,r.RGBA,o.textureTypeHalfFloat)}function tc(r,n,e,t){return Y(r,n,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)}),va(r,n,e,"clipSpacePos",t,3,20,0)&&va(r,n,e,"uv",t,2,20,12)}function nc(r,n,e,t,o,a,i){var s,u,c;Y(r,n,function(){return r.bindTexture(r.TEXTURE_2D,e)}),a instanceof Uint8Array?(s=new Uint8Array(t*o*4),u=r.UNSIGNED_BYTE,c=r.RGBA):(s=new Float32Array(t*o*4),u=r.FLOAT,c=i.internalFormatPackedFloat),s.set(a),Y(r,n,function(){return r.texImage2D(r.TEXTURE_2D,0,c,t,o,0,r.RGBA,u,s)}),Y(r,n,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function rc(r,n,e,t){Y(r,n,function(){return r.bindTexture(r.TEXTURE_2D,e)}),t.data instanceof Uint8Array?Y(r,n,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width,t.height,0,r.RGBA,r.UNSIGNED_BYTE,t.data)}):Y(r,n,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}),Y(r,n,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function oc(r,n,e,t,o){var a=r.createBuffer();Y(r,n,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,a)});var i=16*e*t;return Y(r,n,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,i,r.STREAM_READ)}),Y(r,n,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,0)}),Y(r,n,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),a}function ac(r,n,e){var t=r,o=new Float32Array(e);return t.bindBuffer(t.PIXEL_PACK_BUFFER,n),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,o),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),o}function ic(r,n,e,t,o){var a=Jr(e,t),i=a[0],s=a[1],u=new Uint8Array(e*t*4);return Y(r,n,function(){return r.readPixels(0,0,i,s,o.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function sc(r,n,e,t,o,a,i,s){var f,u=r,c=new Float32Array((f=yr(a,i))[0]*f[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,n),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function uc(r,n,e,t){var o=new Float32Array(e*t*4);return Y(r,n,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,o)}),o}var Cf=Object.freeze({createVertexShader:ju,createVertexBuffer:Ku,createIndexBuffer:Ju,createFloat32MatrixTexture:Yu,createFloat16MatrixTexture:Xu,createUnsignedBytesMatrixTexture:Qu,createPackedMatrixTexture:$u,createFloat16PackedMatrixTexture:ec,bindVertexProgramAttributeStreams:tc,uploadDenseMatrixToTexture:nc,uploadPixelDataToTexture:rc,createBufferFromOutputTexture:oc,downloadFloat32MatrixFromBuffer:ac,downloadByteEncodedFloatMatrixFromOutputTexture:ic,downloadPackedMatrixFromBuffer:sc,downloadMatrixFromPackedOutputTexture:uc}),cc=function(){function r(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=O().getNumber("WEBGL_VERSION");null!=n?(this.gl=n,Ws(e,n)):this.gl=St(e);var t="WEBGL_color_buffer_float";if(1===O().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=xr(this.gl,this.debug,"OES_texture_float"),ht(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=xr(this.gl,this.debug,"OES_texture_half_float");else if(O().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(t),ht(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=xr(this.gl,this.debug,"EXT_color_buffer_half_float");else if(O().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(ht(this.gl,t="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(t);else{if(!ht(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Ku(this.gl,this.debug),this.indexBuffer=Ju(this.gl,this.debug),this.framebuffer=Ys(this.gl,this.debug),this.textureConfig=pa(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return O().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var n=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Y(e,this.debug,function(){return e.finish()}),Y(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Y(e,this.debug,function(){return e.deleteFramebuffer(n.framebuffer)}),Y(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Y(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Y(e,this.debug,function(){return e.deleteBuffer(n.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(n,e){return this.throwIfDisposed(),Yu(this.gl,this.debug,n,e,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(n,e){return this.throwIfDisposed(),Xu(this.gl,this.debug,n,e,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(n,e){return this.throwIfDisposed(),Qu(this.gl,this.debug,n,e)},r.prototype.uploadPixelDataToTexture=function(n,e){this.throwIfDisposed(),rc(this.gl,this.debug,n,e)},r.prototype.uploadDenseMatrixToTexture=function(n,e,t,o){this.throwIfDisposed(),nc(this.gl,this.debug,n,e,t,o,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(n,e){return this.throwIfDisposed(),ec(this.gl,this.debug,n,e,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(n,e){return this.throwIfDisposed(),$u(this.gl,this.debug,n,e,this.textureConfig)},r.prototype.deleteMatrixTexture=function(n){var e=this;this.throwIfDisposed(),this.outputTexture===n&&(ma(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Y(this.gl,this.debug,function(){return e.gl.deleteTexture(n)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,e,t){var o=this;return this.downloadMatrixDriver(n,function(){return ic(o.gl,o.debug,e,t,o.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(n,e,t,o,a,i){return sc(this.gl,n,0,0,0,a,i)},r.prototype.downloadFloat32MatrixFromBuffer=function(n,e){return ac(this.gl,n,e)},r.prototype.createBufferFromTexture=function(n,e,t){this.bindTextureToFrameBuffer(n);var o=oc(this.gl,this.debug,e,t);return this.unbindTextureToFrameBuffer(),o},r.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},r.prototype.createFence=function(n){var e,t,o=this;if(O().getBool("WEBGL_FENCE_API_ENABLED")){var a=n,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),t=function(){var s=a.clientWaitSync(i,0,0);return s===a.ALREADY_SIGNALED||s===a.CONDITION_SATISFIED},e=i}else O().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),t=function(){return o.isQueryAvailable(e,O().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):t=function(){return!0};return{query:e,isFencePassed:t}},r.prototype.downloadMatrixFromPackedTexture=function(n,e,t){var o=this;return this.downloadMatrixDriver(n,function(){return uc(o.gl,o.debug,e,t)})},r.prototype.createProgram=function(n){this.throwIfDisposed();var e=this.gl,t=qs(e,this.debug,n),o=ju(e,this.debug),a=zs(e,this.debug);return Y(e,this.debug,function(){return e.attachShader(a,o)}),Y(e,this.debug,function(){return e.attachShader(a,t)}),Hs(e,this.debug,a),this.debug&&Qr(e,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=tc(e,this.debug,this.program,this.vertexBuffer)),a},r.prototype.deleteProgram=function(n){var e=this;this.throwIfDisposed(),n===this.program&&(this.program=null),null!=n&&Y(this.gl,this.debug,function(){return e.gl.deleteProgram(n)})},r.prototype.setProgram=function(n){var e=this;this.throwIfDisposed(),this.program=n,null!=this.program&&this.debug&&Qr(this.gl,this.debug,this.program),Y(this.gl,this.debug,function(){return e.gl.useProgram(n)})},r.prototype.getUniformLocation=function(n,e,t){return void 0===t&&(t=!0),this.throwIfDisposed(),t?Qs(this.gl,this.debug,n,e):$s(this.gl,n,e)},r.prototype.getAttributeLocation=function(n,e){var t=this;return this.throwIfDisposed(),Y(this.gl,this.debug,function(){return t.gl.getAttribLocation(n,e)})},r.prototype.getUniformLocationNoThrow=function(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)},r.prototype.setInputMatrixTexture=function(n,e,t){this.throwIfDisposed(),this.throwIfNoProgram(),eu(this.gl,this.debug,0,n,e,t)},r.prototype.setOutputMatrixTexture=function(n,e,t){this.setOutputMatrixTextureDriver(n,t,e)},r.prototype.setOutputPackedMatrixTexture=function(n,e,t){this.throwIfDisposed();var o=yr(e,t);this.setOutputMatrixTextureDriver(n,o[0],o[1])},r.prototype.setOutputMatrixWriteRegion=function(n,e,t,o){this.setOutputMatrixWriteRegionDriver(t,n,o,e)},r.prototype.setOutputPackedMatrixWriteRegion=function(n,e,t,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){null!=this.program&&Qr(this.gl,this.debug,this.program),br(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),Y(n,this.debug,function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),Y(this.gl,this.debug,function(){return n.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=xr(this.gl,this.debug,2===O().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(2===O().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.gl,e=this.getQueryTimerExtensionWebGL2(),t=n.createQuery();return n.beginQuery(e.TIME_ELAPSED_EXT,t),t}var o=this.getQueryTimerExtensionWebGL1(),a=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,a),a},r.prototype.endQuery=function(){if(2!==O().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(n){return X(this,void 0,void 0,function(){var e=this;return Q(this,function(t){switch(t.label){case 0:return[4,Qo(function(){return e.disposed||e.isQueryAvailable(n,O().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return t.sent(),[2,this.getQueryTime(n,O().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(n,e){if(0===e)return null;if(2===e){var t=this.gl;return t.getQueryParameter(n,t.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(n,e){if(0===e)return!0;if(2===e){var t=this.gl,o=this.getQueryTimerExtensionWebGL2(),a=t.getQueryParameter(n,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,o.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint},r.prototype.pollFence=function(n){var e=this;return new Promise(function(t){e.addItemToPoll(function(){return n.isFencePassed()},function(){return t()})})},r.prototype.pollItems=function(){for(var n=function(t){for(var o=0;o<t.length&&t[o]();++o);return o-1}(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=n;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},r.prototype.addItemToPoll=function(n,e){var t=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),this.itemsToPoll.length>1||Qo(function(){return t.pollItems(),0===t.itemsToPoll.length})},r.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),$r(this.gl,this.debug,n,this.framebuffer),this.debug&&br(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?($r(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&br(this.gl)):ma(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(n,e){this.bindTextureToFrameBuffer(n);var t=e();return this.unbindTextureToFrameBuffer(),t},r.prototype.setOutputMatrixTextureDriver=function(n,e,t){this.throwIfDisposed();var o=this.gl;$r(o,this.debug,n,this.framebuffer),this.debug&&br(o),this.outputTexture=n,Y(o,this.debug,function(){return o.viewport(0,0,e,t)}),Y(o,this.debug,function(){return o.scissor(0,0,e,t)})},r.prototype.setOutputMatrixWriteRegionDriver=function(n,e,t,o){var a=this;this.throwIfDisposed(),Y(this.gl,this.debug,function(){return a.gl.scissor(n,e,t,o)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},r}();function lc(r,n){if(r.length!==n.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+n.length+" inputs");r.forEach(function(e,t){var o=e.logicalShape,a=n[t],i=a.shape;if(!Oe(o,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+i+" must match");if(!e.isUniform||!a.isUniform){var s=e.texShape,u=a.isUniform?null:a.texData.texShape;if(!Oe(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var Tf=function(r,n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var o=e.inChannels,a=e.strideWidth,i=e.strideHeight,s=e.padInfo,u=e.outWidth,c=e.dilationWidth,h=e.dilationHeight,d=e.dataFormat,f=s.left,p=s.top,v=o*e.filterWidth,m=Qe(),g="channelsLast"===d,y=g?0:1,x=g?1:2,b="",_=0;_<=1;_++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+_+";\n\n          if(blockIndex < "+r[1]+" && pos < "+r[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+i+" - "+p+";\n            d0 = offsetY + "+h+" * (pos / "+v+");\n\n            if(d0 < "+n[y]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+f+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+v+".) / "+o+".));\n\n              if(d1 < "+n[x]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+g+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*_+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*_+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+m.output+" = result;\n      }\n    "},Ef=function(r,n,e,t,o){this.variableNames=["x"],this.outputShape=[];var i=n,s=r[3]-1;this.outputShape=r;var u="float("+e+") + float("+t+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},If=function(r,n,e,t,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=n,this.bias=e,this.alpha=t,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+n+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+n+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+t+") * norm + float("+e+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+t+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Df=function(r,n,e,t,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i=n,s=r[3]-1;this.outputShape=r;var u="float("+e+") + float("+t+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(result);\n      }\n    "},kf=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var o=r.effectiveFilterHeight,a=r.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(o-1-r.padInfo.top)+", "+(a-1-r.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+r.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+r.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+r.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+r.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(o*a-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Af=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var s=r.effectiveFilterDepth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(s-1-r.padInfo.front)+", "+(u-1-r.padInfo.top)+", "+(c-1-r.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+r.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+r.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+r.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+r.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+r.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+r.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+r.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+r.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+r.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(s*u*c-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ua=function(r,n,e,t,o,a,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var u=Math.ceil((e?r[1]:r[2])/2),c=e?"i * 2, rc.y":"rc.y, i * 2",h=t?"rc.z, i * 2":"i * 2, rc.z",d=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=t?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",v="";a&&(p=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",v="result = activation(result);");var m=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+p+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+h+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+d[0]+" * "+f[0]+");\n          result += ("+d[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+v+"\n\n        setOutput(result);\n      }\n    "},Sf=function(){function r(n,e,t){this.variableNames=["probs"],this.outputShape=[n,t],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return r.prototype.getCustomSetupFunc=function(n){var e=this;return function(t,o){null==e.seedLoc&&(e.seedLoc=t.getUniformLocation(o,"seed")),t.gl.uniform1f(e.seedLoc,n)}},r}(),Rf=function(r,n,e,t){this.variableNames=["indices"],this.outputShape=[r,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+t+"), float("+e+"),\n                      float(index == coords.y)));\n      }\n    "},Pf=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var s,c,h,n=r.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var e=ut("rc",n),t=Ie(n),o=function(s,u,c){if(1===s)return"rc > "+u[0];for(var h="",d=s-2;d<s;d++)h+=c[d]+" >= "+u[d],d<s-1&&(h+="||");return h}(n,r,e),a=function(s,u,c,h){if(1===s)return"";var d=h.slice(-2);return"\n    int r = "+d[0]+";\n    int c = "+d[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+u+";\n    bool rEdge = rp1 >= "+c+";\n  "}(n,r[r.length-1],r[r.length-2],e),i=(h=function(d,f){for(var p=[],v=0;v<=1;v++)for(var m=0;m<=1;m++){for(var g=(0===v?"r":"rp1")+", "+(0===m?"c":"cp1"),y=2;y<d;y++)g=f[f.length-1-y]+","+g;p.push(g)}return p}(c=(s=r).length,e),1===c?"getA(rc),\n            rc + 1 >= "+s[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+h[0]+"),\n          cEdge ? 0. : getA("+h[1]+"),\n          rEdge ? 0. : getA("+h[2]+"),\n          rEdge || cEdge ? 0. : getA("+h[3]+")");this.userCode="\n        void main() {\n          "+t+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}},Nf=function(r,n,e){this.variableNames=["x"],this.outputShape=n.map(function(u,c){return u[0]+r[c]+u[1]});var t=r.length,o=Ie(t),a=n.map(function(u){return u[0]}).join(","),i=n.map(function(u,c){return u[0]+r[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,t);this.userCode=1!==t?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+e+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+e+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Ff=function(r,n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map(function(g,y){return g[0]+r[y]+g[1]});for(var t=r.length,o=Ie(t),a=n.map(function(g){return g[0]}).join(","),i=n.map(function(g,y){return g[0]+r[y]}).join(","),s=ut("rc",t),u=ut("source",t),c=s[t-1]+" < "+this.outputShape[t-1],h=1===t?"source":"vec2("+u.slice(-2).join()+")",d=[o+" rc = outputLoc;",s[t-1]+" += 1;\n       if("+c+") {\n      ",1===t?"":"}\n       rc = outputLoc;\n       "+s[t-2]+" += 1;\n       if("+s[t-2]+" < "+this.outputShape[t-2]+") {",1===t?"":"  "+s[t-1]+" += 1;\n         if("+c+") {"],f=1===t?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",v=0,m=1===t?2:4;v<m;v++)p+="\n        "+d[v]+"\n        if ("+f+") {\n          result["+v+"] = float("+e+");\n        } else {\n          "+o+" source = rc - start;\n          result["+v+"] = getChannel(getX("+u.join()+"), "+h+");\n        }\n      ";this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(p+=1===t?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},Va=function(r,n,e){if(this.variableNames=["x"],"avg"===n&&e)throw new Error("Cannot compute positions for average pool.");var t=r.filterWidth,o=r.strideHeight,a=r.strideWidth,i=r.dilationHeight,s=r.dilationWidth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=r.padInfo.top,d=r.padInfo.left;this.outputShape=r.outShape;var f="avg"===n,p="0.0";if(f||(p="-1.0 / 1e-20"),e)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+a+");\n        const ivec2 pads = ivec2("+h+", "+d+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+i+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+r.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+r.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var v=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(v="avgValue / count");var m=4*Math.floor(t/4),g=t%4,y="\n      if ("+f+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+h+", "+d+");\n      const float initializationValue = "+p+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+r.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+p+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+i+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+r.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+y+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+y+"\n          } else if ("+(2===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+y+"\n          } else if ("+(3===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+y+"\n          }\n        }\n        setOutput("+v+");\n      }\n    "}},Ga=function(r,n,e){if(this.variableNames=["x"],"avg"===n&&e)throw new Error("Cannot compute positions for average pool.");var t=r.filterWidth,o=r.strideDepth,a=r.strideHeight,i=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.front,v=r.padInfo.top,m=r.padInfo.left;this.outputShape=r.outShape;var g="avg"===n,y="0.0";if(g||(y="-1.0 / 1e-20"),e)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+a+", "+i+");\n        const ivec3 pads = ivec3("+p+", "+v+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+h+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+r.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+d+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+r.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+f+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+r.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+d+" * "+f+" +\n                      wR * "+f+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var x=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(x="avgValue / count");var b=4*Math.floor(t/4),_=t%4,w="\n      if ("+g+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+p+", "+v+", "+m+");\n      const float initializationValue = "+y+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+r.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+y+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+h+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+r.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+r.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+x+");\n        }\n      }\n    "}},Mf=function(r,n){this.variableNames=["x"];var e=r.windowSize,t=r.batchSize,o=r.inSize,a=Math.ceil(o/e);this.outputShape=[t,a];var i="0.0",s="";"prod"===n?i="1.0":"min"===n?(i="1.0 / 1e-20",s="min"):"max"===n&&(i="-1.0 / 1e-20",s="max");var u=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?u="sumValue":"prod"===n?u="prodValue":"all"===n?u="allValue":"any"===n&&(u="anyValue");var c=4*Math.floor(e/4),h=e%4,d="\n      if ("+("sum"===n)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===n)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",f="vec4";"all"===n?(i="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(i="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var p="";o%e>0&&(p="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+p+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+e+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===h)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(2===h)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(3===h)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+d+"\n        }\n        setOutput("+u+");\n      }\n    "},Of=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var e="",t=0;t<4;t++){var o="thisRC = rc;";t%2==1&&(o+="thisRC.z += 1;"),t>1&&(o+="thisRC.y += 1;"),e+="\n        "+o+"\n        "+(t>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+t+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(t>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+kn(["r","c","d"],n)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Ba(r)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+r[1]+";\n        int cols = "+r[2]+";\n\n        "+e+"\n\n        setOutput(result);\n      }\n    "},Bf=function(r,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var t=n.shape,o=t[1],a=t[2],i=r.shape,s=i[1],u=i[2],c=[e&&s>1?o-1:o,e&&u>1?a-1:a],h=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/h[0],f=c[1]/h[1],p=1/d,v=1/f,m=2*Math.ceil(p)+2,g=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+v+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Lf=function(r,n,e,t){this.variableNames=["A"],this.outputShape=[];var a=r[1],i=r[2];this.outputShape=[r[0],n,e,r[3]];var u=[t&&n>1?a-1:a,t&&e>1?i-1:i],c=[t&&n>1?n-1:n,t&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Wf=function(r,n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=r[1],i=r[2],s=r[3];this.outputShape=[r[0],n,e,s];var u=[t&&n>1?a-1:a,t&&e>1?i-1:i],c=[t&&n>1?n-1:n,t&&e>1?e-1:e];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(e-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Uf=function(r,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var t=n.shape,o=t[1],a=t[2],i=r.shape,s=i[1],u=i[2],c=[e&&s>1?o-1:o,e&&u>1?a-1:a],h=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/h[0],f=c[1]/h[1],p=1/d,v=1/f,m=2*Math.ceil(p)+2,g=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+v+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+h[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+h[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+e+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+e+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Vf=function(r,n,e,t){this.variableNames=["A"],this.outputShape=[];var a=r[1],i=r[2];this.outputShape=[r[0],n,e,r[3]];var u=[t&&n>1?a-1:a,t&&e>1?i-1:i],c=[t&&n>1?n-1:n,t&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(t?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Gf=function(r,n){this.variableNames=["x"];var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=r,1!==e){var t=r.map(function(a,i){return-1!==n.indexOf(s=i)&&1!==r[s]?r[s]+" - coords["+s+"] - 1":"coords["+s+"]";var s}).join(","),o=Ie(e);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+t+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+r[0]+" - coord - 1));\n        }\n      "},qf=function(r,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=r;var u,t=ut("rc",e),o=t[e-1]+" + 1 < "+this.outputShape[e-1],a=t[e-2]+" + 1 < "+this.outputShape[e-2],i=Ie(e);function s(u){var c=r.map(function(h,d){return p=u,-1!==n.indexOf(f=d)&&1!==r[f]?r[f]+" - "+p[f]+" - 1":""+p[f];var f,p});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=1===e?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+r[0]+" - rc - 1),\n            "+r[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+r[0]+" - (rc  + 1) - 1),\n                "+r[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(t.slice())+";\n          if("+o+"){\n            result.g = "+((u=t.slice())[e-1]="("+u[e-1]+" + 1)",s(u)+";\n          }\n          if(")+a+") {\n            result.b = "+function(u){return u[e-2]="("+u[e-2]+" + 1)",s(u)}(t.slice())+";\n            if("+o+") {\n              result.a = "+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",s(u)}(t.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},hc=function(r,n,e,t,o,a,i){void 0===i&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=Ie(o.length),u=Ie(a.length),c="";1===e?c="i":2===e&&(c="i, j");var d="";1===t?d="i":2===t&&(d="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+r+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+n+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(n>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+d+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},zf=function(r,n){this.variableNames=["x","segmentIds"];var e=r.windowSize,t=r.batchSize,o=r.inSize,a=r.numSegments,i=a*Math.ceil(o/e);this.outputShape=[t,i];var s=4*Math.floor(e/4),u=e%4,c="\n        sumValue += dot(values, segFilter);\n    ",h="";o%e>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var d="";o%e>0&&(d="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+d+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+e+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},Hf=function(r,n,e){var t,o;if(this.variableNames=["c","a","b"],this.outputShape=n,e>4)throw Error("Where for rank "+e+" is not yet supported");if(1===e)o="resRC",t="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<n.length;u++)s.push(""+a[u]),u<r&&i.push(""+a[u]);t=i.join(),o=s.join()}var c=Ie(e);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+t+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},Zf=function(){function r(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var e,t=Ie(this.rank),o="uniform int start["+this.rank+"];",a=function(i){if(1===i)return"sourceLoc";if(i<=6)return qa.slice(0,i).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+i+" is not yet supported")}(this.rank);e="\n        "+t+" sourceLoc;\n        "+t+" coords = getOutputCoords();\n        "+n.map(function(i,s){return"sourceLoc."+qa[s]+" = start["+s+"] + coords."+qa[s]+";"}).join("\n")+"\n      ",this.userCode="\n      "+o+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+a+"));\n      }\n    "}return r.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(t,o){null==e.startLoc&&(e.startLoc=t.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||t.gl.uniform1iv(e.startLoc,n)}},r}(),qa=["x","y","z","w","u","v"],jf=function(){function r(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var e=Ie(this.rank),t=ut("coords",this.rank),o=ut("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":"vec2("+o.slice(-2).join()+")",i="getChannel(getSource("+o.join()+"), "+a+")",s="\n      result.x = "+i+";\n      if (++"+t[this.rank-1]+" < "+n[this.rank-1]+") {\n        ++"+o[this.rank-1]+";\n        result.y = "+i+";\n        --"+o[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+t[this.rank-1]+";\n      if (++"+t[this.rank-2]+" < "+n[this.rank-2]+") {\n        ++"+o[this.rank-2]+";\n        result.z = "+i+";\n        if (++"+t[this.rank-1]+" < "+n[this.rank-1]+") {\n          ++"+o[this.rank-1]+";\n          result.w = "+i+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+n.map(function(h,d){return"start["+d+"]"}).join()+");":n.map(function(h,d){return o[d]+" = "+t[d]+" + start["+d+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+c+"\n        vec4 result = vec4(0.);\n        "+s+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return r.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(t,o){null==e.startLoc&&(e.startLoc=t.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||t.gl.uniform1iv(e.startLoc,n)}},r}(),Kf=function(r,n,e){this.variableNames=["x"],this.outputShape=e;var t=e.length,o=Ie(e.length),a=Ie(e.length),i="";if(1===t)i="coords * strides + begin";else{var s=0;i=e.map(function(u,c){return s++,1===e.length?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+r+");\n      "+o+" strides = "+o+"("+n+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+i+"));\n      }\n    "},Jf=function(){function r(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(n,e,t){var o,a=dc(e,t),i=fc(n,a,t);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[i].shift();return this.usedTextures[i].push(s),s}return this.numUsedTextures++,this.log(),a===lt.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):a===lt.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):a===lt.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):a===lt.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):a===lt.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[i].push(o),o},r.prototype.releaseTexture=function(n,e,t,o){if(null!=this.freeTextures){var a=fc(e,dc(t,o),o);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(n),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[a],s=i.indexOf(n);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(s,1),this.log()}},r.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var n=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(t){n.gpgpu.deleteMatrixTexture(t)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(o){n.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r}();function dc(r,n){if(r===ct.UPLOAD)return lt.PACKED_2X2_FLOAT32;if(r===ct.RENDER||null==r)return e=n,O().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?lt.PACKED_2X2_FLOAT32:lt.UNPACKED_FLOAT32:e?lt.PACKED_2X2_FLOAT16:lt.UNPACKED_FLOAT16;var e;if(r===ct.DOWNLOAD||r===ct.PIXELS)return lt.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function fc(r,n,e){return r[0]+"_"+r[1]+"_"+n+"_"+e}var Yf=function(r,n){this.variableNames=["A"];for(var e=new Array(r.length),t=0;t<e.length;t++)e[t]=r[t]*n[t];this.outputShape=e,this.rank=e.length;var o=Ie(this.rank),a=function(i){var s=i.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(1===s)return"imod(resRC, "+i[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],h=0;h<i.length;h++)c.push("imod("+u[h]+", "+i[h]+")");return c.join()}(r);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},Xf=function(r,n){this.variableNames=["A"];for(var e=new Array(r.length),t=0;t<e.length;t++)e[t]=r[n[t]];this.outputShape=e,this.rank=e.length;var o=Ie(this.rank),a=function(i){var s=i.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),h=0;h<i.length;h++)c[i[h]]=u[h];return c.join()}(n);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},Qf=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(r.length),t=0;t<e.length;t++)e[t]=r[n[t]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Ie(this.rank),a=Mu("rc",this.rank),i=new Array(this.rank);for(t=0;t<n.length;t++)i[n[t]]=a[t];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+e[this.rank-1],c="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+e[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},za=1.7580993408473768,Ha=1.0507009873554805,ce=function(r,n){this.variableNames=["A"],this.outputShape=r,this.userCode="\n      float unaryOperation(float x) {\n        "+n+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},It="if (isnan(x)) return x;",$f="return x;",pc="return abs(x);",vc=It+"\n  return (x < 0.0) ? 0.0 : x;\n",mc=It+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",gc="return (x >= 0.0) ? x : (exp(x) - 1.0);",ep="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+za+";\n  float scale = "+Ha+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",yc="return -x;",xc="return ceil(x);",bc="return floor(x);",_c="return exp(x);",wc="return exp(x) - 1.0;",tp=It+"\n  return sin(x);\n",np=It+"\n  return cos(x);\n",rp=It+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",op=It+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",ap=It+"\n  return atan(x);\n",ip=It+"return log(x + sqrt(x * x + 1.0));",sp=It+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",up=It+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",yo="return x;",cp="return x;",Cc="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Tc="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ec="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Sr=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},lp=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var n=r.length,e=ut("rc",n),t=Ie(n),o=function(s,u){if(1===s)return"rc";for(var c="",h=0;h<s;h++)c+=u[h],h<s-1&&(c+=",");return c}(n,e),a=e.slice(-2),i=n<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+t+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "},xo={};function bo(r,n){if(void 0===n&&(n=!1),"linear"===r)return n?cp:$f;if("relu"===r)return n?Cc:vc;if("elu"===r)return n?Ec:gc;if("relu6"===r)return n?Tc:mc;if("prelu"===r)return n?Vu:Uu;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var hp=600,Ic=function(r){function n(e){var t,o=r.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!O().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var a=St(O().getNumber("WEBGL_VERSION"));o.binaryCache=((t=O().getNumber("WEBGL_VERSION"))in xo||(xo[t]={}),xo[t]),o.gpgpu=new cc(a),o.canvas=a.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=e,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=e.gl.canvas;return o.textureManager=new Jf(o.gpgpu),o.numMBBeforeWarning=null==O().global.screen?1024:O().global.screen.height*O().global.screen.width*window.devicePixelRatio*hp/1024/1024,o.texData=new Du(o,S),o}return bt(n,r),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(e,t,o){if(O().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===o&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var a={};return this.texData.set(a,{shape:t,dtype:o,values:e,usage:ct.UPLOAD}),a},n.prototype.move=function(e,t,o,a){if(O().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===a)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:a,values:t,usage:ct.UPLOAD})},n.prototype.readSync=function(e){var t=this.texData.get(e),o=t.values,a=t.dtype,i=t.complexTensors,u=t.shape;if(null!=t.slice){var h;h=t.isPacked?new Sr(u,yo):new ce(u,yo);var d=this.runWebGLProgram(h,[{dataId:e,shape:u,dtype:a}],a),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(null!=o)return this.convertAndCacheOnCPU(e);if("string"===a)return o;var p,v,m=null!=this.activeTimers;return m&&(p=wt()),v="complex64"===a?Na(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(e),m&&(this.downloadWaitMs+=wt()-p),this.convertAndCacheOnCPU(e,v)},n.prototype.read=function(e){return X(this,void 0,void 0,function(){var t,o,a,i,u,c,h,d,f,p,v,m,g,y,x,w,T,A,k;return Q(this,function(I){switch(I.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise(function(D){return t.push(D)})];if(o=this.texData.get(e),a=o.values,i=o.shape,u=o.dtype,c=o.complexTensors,h=o.isPacked,null!=o.slice)return d=h?new Sr(i,yo):new ce(i,yo),f=this.runWebGLProgram(d,[{dataId:e,shape:i,dtype:u}],u),p=this.read(f.dataId),this.disposeData(f.dataId),[2,p];if(null!=a)return[2,this.convertAndCacheOnCPU(e)];if(!O().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===O().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return v=null,"complex64"!==u&&O().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(e),g=this.texData.get(m.dataId),v=(k=this.gpgpu).createBufferFromTexture.apply(k,[g.texture].concat(gr(i)))),this.pendingRead.set(e,[]),"complex64"===u?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:I.sent(),I.label=2;case 2:return"complex64"!==u?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return x=I.sent(),y=Na(x[0],x[1]),[3,5];case 4:null==v?y=this.getValuesFromTexture(e):(w=$(i),y=this.gpgpu.downloadFloat32MatrixFromBuffer(v,w)),I.label=5;case 5:return null!=m&&this.disposeData(m.dataId),T=this.convertAndCacheOnCPU(e,y),A=this.pendingRead.get(e),this.pendingRead.delete(e),A.forEach(function(D){return D(T)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,T]}})})},n.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var o=e[t];if(!Us(o))throw O().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(e){var t,o=this.texData.get(e),a=o.shape,i=o.dtype,s=o.isPacked,u=$(a);if(O().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(e),h=this.texData.get(c.dataId),d=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[h.texture].concat(gr(a))).subarray(0,u);return this.disposeData(c.dataId),d}var f=O().getBool("WEBGL_PACK")&&!0===s,p=f?eo(a):a,v=f?new vf(p):new pf(p),m=this.runWebGLProgram(v,[{shape:p,dtype:i,dataId:e}],"float32"),g=this.texData.get(m.dataId),y=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,u);return this.disposeData(m.dataId),y},n.prototype.time=function(e){return X(this,void 0,void 0,function(){var t,o,a,i,s,u,c;return Q(this,function(h){switch(h.label){case 0:return t=this.activeTimers,o=[],a=!1,null==this.programTimersStack?(this.programTimersStack=o,a=!0):this.activeTimers.push(o),this.activeTimers=o,e(),i=qt(this.activeTimers.map(function(d){return d.query})).filter(function(d){return null!=d}),s=qt(this.activeTimers.map(function(d){return d.name})).filter(function(d){return null!=d}),this.activeTimers=t,a&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},O().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return c=h.sent(),u.kernelMs=_s(c),u.getExtraProfileInfo=function(){return c.map(function(d,f){return{name:s[f],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},h.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return O().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:wt(),endMs:null}},n.prototype.endTimer=function(e){return O().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=wt(),e)},n.prototype.getQueryTime=function(e){return X(this,void 0,void 0,function(){var t;return Q(this,function(o){return O().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},n.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},n.prototype.releaseGPUData=function(e){var t=this.texData.get(e),o=t.texture,a=t.dtype,i=t.texShape,s=t.usage,u=t.isPacked,c=t.slice,h=c&&c.origDataId||e,d=this.dataRefCount.get(h);d>1?this.dataRefCount.set(h,d-1):(this.dataRefCount.delete(h),null!=o&&(this.numBytesInGPU-=this.computeBytes(i,a),this.textureManager.releaseTexture(o,i,s,u)));var f=this.texData.get(e);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},n.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},n.prototype.getDataInfo=function(e){return this.texData.get(e)},n.prototype.getCPUBackend=function(){return O().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=S.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(e,t){var o=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(a){return null==o.texData.get(a.dataId).texture&&a.size<t})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(e,t){var o=this.makeOutput(e.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:S.keep(e.clone()),imag:S.keep(t.clone())},o},n.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,t,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,o);if(0===$(o))return Xe([],o,e.dtype);var a=this.texData.get(e.dataId).isPacked,i=Da(e.shape,t,o);if(a||!i){var s=O().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jf(o):new Zf(o),u=s.getCustomSetupFunc(t);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,o)},n.prototype.shallowSlice=function(e,t,o){var a=this.texData.get(e.dataId),i=this.makeOutput(o,e.dtype),s=this.texData.get(i.dataId);Object.assign(s,a),s.shape=o,s.dtype=e.dtype;var u=ka(t,e.strides);a.slice&&(u+=a.slice.flatOffset),s.slice={flatOffset:u,origDataId:a.slice&&a.slice.origDataId||e.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),i},n.prototype.stridedSlice=function(e,t,o,a){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,o,a);var i=lo(t,o,a);if(i.some(function(u){return 0===u}))return Xe([],i);var s=new Kf(t,a,i);return this.compileAndRun(s,[e])},n.prototype.reverse=function(e,t){var o=O().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qf(e.shape,t):new Gf(e.shape,t);return this.compileAndRun(o,[e])},n.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var o=e.map(function(p){return gt(p)}),a=e.map(function(p){return Pt(p)});return Ye(this.concat(o,t),this.concat(a,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>O().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),s=this.concat(e.slice(0,i),t),u=this.concat(e.slice(i),t);return this.concat([s,u],t)}if(O().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var c=new $d(e.map(function(p){return p.shape}),t);return this.compileAndRun(c,e)}var h=Cn(e.map(function(p){return p.shape}),t),d=e.map(function(p){return p.as2D(-1,$(p.shape.slice(t)))}),f=new Qd(d.map(function(p){return p.shape}));return this.compileAndRun(f,d).reshape(h)},n.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(O().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,yc,e.dtype);var t=new ce(e.shape,yc);return this.compileAndRun(t,[e])},n.prototype.batchMatMul=function(e,t,o,a){var i=o?e.shape[2]:e.shape[1],s=a?t.shape[1]:t.shape[2],u=o?e.shape[1]:e.shape[2],c=e.shape[0];if((1===i||1===s)&&u>1e3){o&&(e=e.transpose([0,2,1])),a&&(t=t.transpose([0,2,1]));var h=1===s?e:e.as3D(c,u,1),d=1===s?2:1,f=1===s?t.as3D(c,1,u):t;return this.multiply(h,f).sum(d,!0)}var p=He(e.dtype,t.dtype),v=new Ua(e.shape,[c,i,s],o,a);return this.compileAndRun(v,[e,t],p)},n.prototype.fusedBatchMatMul=function(e){var t=e.a,o=e.b,a=e.transposeA,i=e.transposeB,s=e.bias,u=e.activation,c=e.preluActivationWeights,h=a?t.shape[2]:t.shape[1],d=i?o.shape[1]:o.shape[2],f=t.shape[0],p=He(t.dtype,o.dtype),v=null!=s,m=null!=c,g=u?bo(u,!0):null,y=new Ua(t.shape,[f,h,d],a,i,v,g,m),x=[t,o];return s&&x.push(s),c&&x.push(c),this.compileAndRun(y,x,p)},n.prototype.multiply=function(e,t){if("complex64"===e.dtype){var o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),i=new Lu("return areal * breal - aimag * bimag;",e.shape,t.shape),s=new Lu("return areal * bimag + aimag * breal;",e.shape,t.shape),u=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag),this.makeComplexComponentTensorInfo(t,a.complexTensors.real),this.makeComplexComponentTensorInfo(t,a.complexTensors.imag)],c=this.compileAndRun(i,u),h=this.compileAndRun(s,u),d=this.complex(c,h);return c.dispose(),h.dispose(),d}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Wu,e.dtype);var f=new Ne(Wu,e.shape,t.shape);return this.compileAndRun(f,[e,t],e.dtype)},n.prototype.batchNormalization=function(e,t,o,a,i,s){var u=[e,t,o],c=null;null!=s&&(c=s.shape,u.push(s));var h=null;if(null!=i&&(h=i.shape,u.push(i)),O().getBool("WEBGL_PACK_NORMALIZATION")){var d=new Zd(e.shape,t.shape,o.shape,c,h,a);return this.compileAndRun(d,u)}var f=new Hd(e.shape,t.shape,o.shape,c,h,a);return this.compileAndRun(f,u)},n.prototype.localResponseNormalization4D=function(e,t,o,a,i){var s=O().getBool("WEBGL_PACK_NORMALIZATION")?new Df(e.shape,t,o,a,i):new Ef(e.shape,t,o,a,i);return this.compileAndRun(s,[e])},n.prototype.LRNGrad=function(e,t,o,a,i,s,u){var c=new If(t.shape,a,i,s,u);return this.compileAndRun(c,[t,o,e])},n.prototype.tile=function(e,t){if("string"===e.dtype){var o=this.readSync(e.dataId).map(function(i){return hr(i)});return Nu(se(e.shape,e.dtype,o),t)}var a=new Yf(e.shape,t);return this.compileAndRun(a,[e])},n.prototype.pad=function(e,t,o){var a=O().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ff(e.shape,t,o):new Nf(e.shape,t,o);return this.compileAndRun(a,[e])},n.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var o=O().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Qf(e.shape,t):new Xf(e.shape,t);return this.compileAndRun(o,[e])},n.prototype.gather=function(e,t,o){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,o);var a=new _f(e.shape,t.size,o);return this.compileAndRun(a,[e,t])},n.prototype.batchToSpaceND=function(e,t,o){E(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var a=t.reduce(function(d,f){return d*f}),i=io(e.shape,t,a),s=so(i.length,t.length),u=uo(e.shape,t,a),c=bu(o,t.length),h=_u(u,o,t.length);return e.reshape(i).transpose(s).reshape(u).slice(c,h)},n.prototype.spaceToBatchND=function(e,t,o){E(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var a=t.reduce(function(f,p){return f*p}),i=[[0,0]];i.push.apply(i,o);for(var s=1+t.length;s<e.shape.length;++s)i.push([0,0]);var u=e.pad(i),c=io(u.shape,t,a,!1),h=so(c.length,t.length,!1),d=uo(u.shape,t,a,!1);return u.reshape(c).transpose(h).reshape(d)},n.prototype.reduce=function(e,t,o){var a=e.shape[0],i=e.shape[1],s=co(i),u=new Mf({windowSize:s,inSize:i,batchSize:a},t),c=this.compileAndRun(u,[e],o);return 1===c.shape[1]?c:this.reduce(c,t,o)},n.prototype.argReduce=function(e,t,o){void 0===o&&(o=null);var a=e.shape[0],i=e.shape[1];null!=o&&(a=o.shape[0],i=o.shape[1]);var s=co(i),u=new Od({windowSize:s,inSize:i,batchSize:a},t,null==o),c=[e];null!=o&&c.push(o);var h=this.compileAndRun(u,c,"int32");return 1===h.shape[1]?h:this.argReduce(e,t,h)},n.prototype.argReducePacked=function(e,t,o){void 0===o&&(o=null);var a=null!=o?o.shape:e.shape,i=co(a[a.length-1]),s=new Gd(a,i,t,null==o),c=this.compileAndRun(s,null==o?[e]:[e,o],"int32");return c.rank===e.rank?this.argReducePacked(e,t,c):c},n.prototype.sum=function(e,t){it("sum",t,e.rank);var o=Je(e.shape,t),a=o[0],i=$(o[1]),s=e.as2D(-1,i),u=la(e.dtype);return this.reduce(s,"sum",u).reshape(a)},n.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var o=Je(e.shape,t),a=o[0],i=$(o[1]),s=e.as2D(-1,i),u=la(e.dtype);return this.reduce(s,"prod",u).reshape(a)},n.prototype.unsortedSegmentSum=function(e,t,o){var a=0,i=Ct([a],e.rank),s=e;null!=i&&(s=e.transpose(i),a=Tt(1,e.rank)[0]);var u=function(p,v,m){for(var g=[],y=p.length,x=0;x<y;x++)g.push(x!==v?p[x]:m);return g}(s.shape,a,o),c=$([s.shape[a]]),h=s.as2D(-1,c),d=la(e.dtype),f=this.segOpCompute(h,"unsortedSegmentSum",t,d,o).reshape(u);return null!=i&&(f=f.transpose(ro(i))),f},n.prototype.segOpCompute=function(e,t,o,a,i){var s=e.shape[0],u=e.shape[1],c=function(f,p){var v,m=!1;for(f<=Ea?(v=f,m=!0):v=Kr(f,Math.floor(Math.sqrt(f)));!m;)v>p||v===f?m=!0:v=Kr(f,v+1);return v}(u,i),h=new zf({windowSize:c,inSize:u,batchSize:s,numSegments:i},t),d=this.compileAndRun(h,[e,o],a);return d.shape[1]===i?d:(o=oo(0,i).tile([u/c]),this.segOpCompute(d,t,o,a,i))},n.prototype.argMinMaxReduce=function(e,t,o){var a=[t];if(it("arg"+o.charAt(0).toUpperCase()+o.slice(1),a,e.rank),!O().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=Je(e.shape,a),s=i[0],u=$(i[1]),c=e.as2D(-1,u);return this.argReduce(c,o).reshape(s)}return this.argReducePacked(e,o)},n.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},n.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},n.prototype.cumsum=function(e,t,o,a){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new cf(e.shape,o,a);return this.compileAndRun(i,[e])},n.prototype.equal=function(e,t){if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var o=new Ne("return float(a == b);",e.shape,t.shape);return this.compileAndRun(o,[e,t],"bool")},n.prototype.notEqual=function(e,t){if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var o=new Ne("return float(a != b);",e.shape,t.shape);return this.compileAndRun(o,[e,t],"bool")},n.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var o=new Ne("return float(a < b);",e.shape,t.shape);return this.compileAndRun(o,[e,t],"bool")},n.prototype.lessEqual=function(e,t){if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var o=new Ne("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(o,[e,t],"bool")},n.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var o=new Ne("return float(a > b);",e.shape,t.shape);return this.compileAndRun(o,[e,t],"bool")},n.prototype.greaterEqual=function(e,t){if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var o=new Ne("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(o,[e,t],"bool")},n.prototype.logicalNot=function(e){var t=new ce(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},n.prototype.logicalAnd=function(e,t){if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var o=new Ne("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(o,[e,t],"bool")},n.prototype.logicalOr=function(e,t){if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var o=new Ne("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(o,[e,t],"bool")},n.prototype.select=function(e,t,o){var a=new Hf(e.rank,t.shape,t.rank);return this.compileAndRun(a,[e,t,o],He(t.dtype,o.dtype))},n.prototype.where=function(e){no("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Oa(e.shape,t)},n.prototype.topk=function(e,t,o){return Fu(e.dataSync(),e.shape,e.dtype,t)},n.prototype.min=function(e,t){it("min",t,e.rank);var o=Je(e.shape,t),a=o[0],i=$(o[1]),s=e.as2D(-1,i);return this.reduce(s,"min",s.dtype).reshape(a)},n.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var o=O().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Kt("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ne("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(o,[e,t])},n.prototype.mod=function(e,t){var o=O().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Kt("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ne("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(o,[e,t])},n.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);it("max",t,e.rank);var o=Je(e.shape,t),a=o[0],i=$(o[1]),s=e.as2D(-1,i);return this.reduce(s,"max",s.dtype).reshape(a)},n.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var o=O().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Kt("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ne("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(o,[e,t])},n.prototype.all=function(e,t){it("all",t,e.rank);var o=Je(e.shape,t),a=o[0],i=$(o[1]),s=e.as2D(-1,i);return this.reduce(s,"all",s.dtype).reshape(a)},n.prototype.any=function(e,t){it("any",t,e.rank);var o=Je(e.shape,t),a=o[0],i=$(o[1]),s=e.as2D(-1,i);return this.reduce(s,"any",s.dtype).reshape(a)},n.prototype.realDivide=function(e,t){if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var o=new Ne("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(o,[e,t],"float32")},n.prototype.floorDiv=function(e,t){if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var o=new Ne("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(o,[e,t],"int32")},n.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,La);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var o=He(e.dtype,t.dtype);if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,La,o);var a=new Ne(La,e.shape,t.shape);return this.compileAndRun(a,[e,t],o)},n.prototype.packedUnaryOp=function(e,t,o){var a=new Sr(e.shape,t);return this.compileAndRun(a,[e],o)},n.prototype.packedBinaryOp=function(e,t,o,a,i){void 0===i&&(i=!1);var s=new Kt(o,e.shape,t.shape,i);return this.compileAndRun(s,[e,t],a)},n.prototype.complexSeparableBinaryOp=function(e,t,o){var a=this,i=this.texData.get(e.dataId),s=this.texData.get(t.dataId),u=[[i.complexTensors.real,s.complexTensors.real],[i.complexTensors.imag,s.complexTensors.imag]].map(function(f){var p=f[0],v=f[1],m=a.makeComplexComponentTensorInfo(e,p),g=a.makeComplexComponentTensorInfo(t,v),y=new Ne(o,e.shape,t.shape);return a.compileAndRun(y,[m,g],He(p.dtype,v.dtype))}),c=u[0],h=u[1],d=this.complex(c,h);return c.dispose(),h.dispose(),d},n.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},n.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>O().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),o=this.addN(e.slice(0,t)),a=this.addN(e.slice(t));return this.addN([o,a])}var i=e.map(function(c){return c.dtype}).reduce(function(c,h){return He(c,h)}),s=e.map(function(c){return c.shape}),u=O().getBool("WEBGL_PACK")?new Md(e[0].shape,s):new Fd(e[0].shape,s);return this.compileAndRun(u,e,i)},n.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Wa);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var o=He(e.dtype,t.dtype);if(O().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Wa,e.dtype);var a=new Ne(Wa,e.shape,t.shape);return this.compileAndRun(a,[e,t],o)},n.prototype.pow=function(e,t){var o=O().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Kt("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ne("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),a=He(e.dtype,t.dtype);return this.compileAndRun(o,[e,t],a)},n.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(O().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,xc,e.dtype);var t=new ce(e.shape,xc);return this.compileAndRun(t,[e])},n.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(O().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,bc,e.dtype);var t=new ce(e.shape,bc);return this.compileAndRun(t,[e])},n.prototype.sign=function(e){var t=new ce(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},n.prototype.isNaN=function(e){var t=new ce(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},n.prototype.isInf=function(e){var t=new ce(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},n.prototype.isFinite=function(e){var t=new ce(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},n.prototype.round=function(e){var t=new ce(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},n.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(O().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,_c,e.dtype);var t=new ce(e.shape,_c);return this.compileAndRun(t,[e])},n.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(O().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,wc,e.dtype);var t=new ce(e.shape,wc);return this.compileAndRun(t,[e])},n.prototype.softmax=function(e,t){var o=Be([t],e.shape),a=this.max(e,o),i=rt(a.shape,o),s=this.subtract(e,a.reshape(i)),u=this.exp(s),c=this.sum(u,o).reshape(i);return this.realDivide(u,c)},n.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(O().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new ce(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},n.prototype.log1p=function(e){var t=new ce(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},n.prototype.sqrt=function(e){var t=new ce(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},n.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new ce(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},n.prototype.reciprocal=function(e){var t=new ce(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},n.prototype.relu=function(e){var t;return t=O().getBool("WEBGL_PACK")?new Sr(e.shape,Cc):new ce(e.shape,vc),this.compileAndRun(t,[e])},n.prototype.relu6=function(e){var t;return t=O().getBool("WEBGL_PACK")?new Sr(e.shape,Tc):new ce(e.shape,mc),this.compileAndRun(t,[e])},n.prototype.prelu=function(e,t){var o=O().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Kt(Vu,e.shape,t.shape):new Ne(Uu,e.shape,t.shape);return this.compileAndRun(o,[e,t])},n.prototype.elu=function(e){if(O().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ec,e.dtype);var t=new ce(e.shape,gc);return this.compileAndRun(t,[e])},n.prototype.eluDer=function(e,t){var o=O().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Kt("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new Ne("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(o,[e,t])},n.prototype.selu=function(e){var t=new ce(e.shape,ep);return this.compileAndRun(t,[e])},n.prototype.int=function(e){var t=new ce(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},n.prototype.clip=function(e,t,o){var a,i=(a=O().getBool("WEBGL_PACK_CLIP")?new Yd(e.shape):new Jd(e.shape)).getCustomSetupFunc(t,o);return this.compileAndRun(a,[e],null,i)},n.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(O().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,pc,e.dtype);var t=new ce(e.shape,pc);return this.compileAndRun(t,[e])},n.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),o=new Xd(e.shape),a=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(o,a)},n.prototype.sigmoid=function(e){var t=new ce(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},n.prototype.softplus=function(e){var t=new ce(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},n.prototype.sin=function(e){var t=new ce(e.shape,tp);return this.compileAndRun(t,[e])},n.prototype.cos=function(e){var t=new ce(e.shape,np);return this.compileAndRun(t,[e])},n.prototype.tan=function(e){var t=new ce(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},n.prototype.asin=function(e){var t=new ce(e.shape,rp);return this.compileAndRun(t,[e])},n.prototype.acos=function(e){var t=new ce(e.shape,op);return this.compileAndRun(t,[e])},n.prototype.atan=function(e){var t=new ce(e.shape,ap);return this.compileAndRun(t,[e])},n.prototype.atan2=function(e,t){var o=O().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Kt("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ne("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(o,[e,t])},n.prototype.sinh=function(e){var t=new ce(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},n.prototype.cosh=function(e){var t=new ce(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},n.prototype.tanh=function(e){var t=new ce(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},n.prototype.asinh=function(e){var t=new ce(e.shape,ip);return this.compileAndRun(t,[e])},n.prototype.acosh=function(e){var t=new ce(e.shape,sp);return this.compileAndRun(t,[e])},n.prototype.atanh=function(e){var t=new ce(e.shape,up);return this.compileAndRun(t,[e])},n.prototype.erf=function(e){var t=new ce(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},n.prototype.step=function(e,t){var a,o=new ce(e.shape,(void 0===(a=t)&&(a=0),It+"\n    return x > 0.0 ? 1.0 : float("+a+");\n  "));return this.compileAndRun(o,[e])},n.prototype.conv2dByMatMul=function(e,t,o,a,i,s){var u=e.shape,c=this.texData.get(e.dataId),p="channelsLast"===o.dataFormat,m=u[2]%2!=0&&!!c.isPacked;if((1==u[0]*u[1]*u[2]||1===o.outChannels)&&o.inChannels>1e3||!O().getBool("WEBGL_LAZILY_UNPACK")||!O().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!m){var y=this.reshape(e,[1,p?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],o.inChannels]),x=this.reshape(t,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:y,b:x,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:s}),o.outShape)}var _={dataId:e.dataId,shape:[1,p?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),o.inChannels],dtype:e.dtype},w=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,E(Cr(c.shape,_.shape),function(){return"packed reshape "+c.shape+" to "+_.shape+" isn't free"});var T=this.reshape(t,[1,o.inChannels,o.outChannels]),A=this.fusedBatchMatMul({a:_,b:T,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:s}),k=this.texData.get(A.dataId);return E(k.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=w,k.shape=o.outShape,S.makeTensorFromDataId(A.dataId,o.outShape,A.dtype)},n.prototype.conv2dWithIm2Row=function(e,t,o,a,i,s){var d=o.outWidth,f=o.outHeight,p="channelsLast"===o.dataFormat,v=o.filterWidth*o.filterHeight*o.inChannels,m=f*d,g=[v,m],y=e.squeeze([0]),x=t.reshape([1,v,-1]),b=new Tf(g,y.shape,o),_=this.compileAndRun(b,[y]).reshape([1,g[0],g[1]]),w=null!=a,T=null!=s,A=i?bo(i,!0):null,k=new Ua(_.shape,[1,m,o.outChannels],!0,!1,w,A,T),I=[_,x];return a&&I.push(a),T&&I.push(s),this.compileAndRun(k,I).reshape(p?[1,f,d,o.outChannels]:[1,o.outChannels,f,d])},n.prototype.fusedConv2d=function(e){var t=e.input,o=e.filter,a=e.convInfo,i=e.bias,s=e.activation,u=e.preluActivationWeights;if(1===a.filterHeight&&1===a.filterWidth&&1===a.dilationHeight&&1===a.dilationWidth&&1===a.strideHeight&&1===a.strideWidth&&("SAME"===a.padInfo.type||"VALID"===a.padInfo.type))return this.conv2dByMatMul(t,o,a,i,s,u);if(O().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,o,a,i,s,u);var c=null!=i,h=null!=u,d=s?bo(s,!1):null,f=new Gu(a,c,d,h),p=[t,o];return i&&p.push(i),u&&p.push(u),this.compileAndRun(f,p)},n.prototype.conv2d=function(e,t,o){if(1===o.filterHeight&&1===o.filterWidth&&1===o.dilationHeight&&1===o.dilationWidth&&1===o.strideHeight&&1===o.strideWidth&&("SAME"===o.padInfo.type||"VALID"===o.padInfo.type))return this.conv2dByMatMul(e,t,o);if(O().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,o);var a=new Gu(o);return this.compileAndRun(a,[e,t])},n.prototype.conv2dDerInput=function(e,t,o){var a=new tf(o);return this.compileAndRun(a,[e,t])},n.prototype.conv2dDerFilter=function(e,t,o){var a=new ef(o);return this.compileAndRun(a,[e,t])},n.prototype.fusedDepthwiseConv2D=function(e){var t,o=e.input,a=e.filter,i=e.convInfo,s=e.bias,u=e.activation,c=e.preluActivationWeights,h=O().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,d=u?bo(u,h):null,f=[o,a],p=null!=s,v=null!=c;return p&&f.push(s),v&&f.push(c),h?(t=new zu(i,p,d,v),this.compileAndRun(t,f)):(t=new qu(i,p,d,v),this.compileAndRun(t,f))},n.prototype.depthwiseConv2D=function(e,t,o){var a;return O().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(a=new zu(o),this.compileAndRun(a,[e,t])):(a=new qu(o),this.compileAndRun(a,[e,t]))},n.prototype.depthwiseConv2DDerInput=function(e,t,o){var a=new af(o);return this.compileAndRun(a,[e,t])},n.prototype.depthwiseConv2DDerFilter=function(e,t,o){var a=new of(o);return this.compileAndRun(a,[e,t])},n.prototype.conv3d=function(e,t,o){var a=new sf(o);return this.compileAndRun(a,[e,t])},n.prototype.conv3dDerInput=function(e,t,o){var a=new rf(o);return this.compileAndRun(a,[e,t])},n.prototype.conv3dDerFilter=function(e,t,o){var a=new nf(o);return this.compileAndRun(a,[e,t])},n.prototype.maxPool=function(e,t){var o=new Va(t,"max",!1);return this.compileAndRun(o,[e])},n.prototype.avgPool=function(e,t){var o=new Va(t,"avg",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.maxPoolBackprop=function(e,t,o,a){var i=new Va(a,"max",!0),s=this.compileAndRun(i,[t]),u=new kf(a),c=this.compileAndRun(u,[e,s],t.dtype);return s.dispose(),c},n.prototype.avgPoolBackprop=function(e,t,o){var a=new qd(o);return this.compileAndRun(a,[e],t.dtype)},n.prototype.cast=function(e,t){return Ra(e,t,this)},n.prototype.unstack=function(e,t){for(var o=e.shape[t],a=new Array(e.rank-1),i=0,s=0;s<e.rank;s++)s!==t&&(a[i++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[t]=1;var h=new Array(o);for(s=0;s<h.length;s++)u[t]=s,h[s]=this.slice(e,u,c).reshape(a);return h},n.prototype.avgPool3d=function(e,t){var o=new Ga(t,"avg",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.avgPool3dBackprop=function(e,t,o){var a=new zd(o);return this.compileAndRun(a,[e],t.dtype)},n.prototype.maxPool3d=function(e,t){var o=new Ga(t,"max",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.maxPool3dBackprop=function(e,t,o,a){var i=new Ga(a,"max",!0),s=this.compileAndRun(i,[t]),u=new Af(a),c=this.compileAndRun(u,[e,s],t.dtype);return s.dispose(),c},n.prototype.reshape=function(e,t){var o=this.texData.get(e.dataId);if(o.isPacked&&!Cr(e.shape,t)&&(null===o.texture||!Cr(o.shape,t))){var a=this.packedReshape(e,t);return S.makeTensorFromDataId(a.dataId,a.shape,a.dtype)}return mo(e,t)},n.prototype.resizeBilinear=function(e,t,o,a){var i=O().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Wf(e.shape,t,o,a):new Lf(e.shape,t,o,a);return this.compileAndRun(i,[e],"float32")},n.prototype.resizeBilinearBackprop=function(e,t,o){var a=new Bf(e,t,o);return this.compileAndRun(a,[e])},n.prototype.resizeNearestNeighbor=function(e,t,o,a){var i=new Vf(e.shape,t,o,a);return this.compileAndRun(i,[e])},n.prototype.resizeNearestNeighborBackprop=function(e,t,o){var a=new Uf(e,t,o);return this.compileAndRun(a,[e])},n.prototype.multinomial=function(e,t,o,a){var i=t?e:Zt(e),c=new Sf(i.shape[0],i.shape[1],o),h=c.getCustomSetupFunc(a);return this.compileAndRun(c,[i],"int32",h)},n.prototype.oneHot=function(e,t,o,a){var i=new Rf(e.size,t,o,a);return this.compileAndRun(i,[e])},n.prototype.diag=function(e){var t=new ff(e.size);return this.compileAndRun(t,[e])},n.prototype.nonMaxSuppression=function(e,t,o,a,i){return no("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Fa(e.dataSync(),t.dataSync(),o,a,i)},n.prototype.cropAndResize=function(e,t,o,a,i,s){var u=new uf(e.shape,t.shape,a,i,s);return this.compileAndRun(u,[e,t,o],"float32")},n.prototype.depthToSpace=function(e,t,o){E(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var a=e.shape[0],c=("NHWC"===o?e.shape[1]:e.shape[2])*t,h=("NHWC"===o?e.shape[2]:e.shape[3])*t,d=("NHWC"===o?e.shape[3]:e.shape[1])/(t*t),f=new df("NHWC"===o?[a,c,h,d]:[a,d,c,h],t,o);return this.compileAndRun(f,[e])},n.prototype.split=function(e,t,o){return Pu(e,t,o)},n.prototype.scatterND=function(e,t,o){var a=Er(0,e,o),i=a.sliceRank,s=a.numUpdates,u=a.sliceSize,c=a.strides,h=a.outputSize,d=[h/u,u],f=e.reshape([s,i]),p=t.reshape([s,u]);if(0===h)return mo(Xe([]),o);var v=Z(0),m=new hc(s,i,f.rank,p.rank,c,d);return this.compileAndRun(m,[p,f,v]).reshape(o)},n.prototype.sparseToDense=function(e,t,o,a){var i=Er(0,e,o),d=new hc(i.numUpdates,i.sliceRank,e.rank,t.rank,i.strides,[i.outputSize,1],!1);return this.compileAndRun(d,[t,e,a]).reshape(o)},n.prototype.fft=function(e){return this.fftImpl(e,!1)},n.prototype.ifft=function(e){return this.fftImpl(e,!0)},n.prototype.fftImpl=function(e,t){var o=this.texData.get(e.dataId),a=new Zu("return real * expR - imag * expI;",e.shape,t),i=new Zu("return real * expI + imag * expR;",e.shape,t),s=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag)],u=this.compileAndRun(a,s),c=this.compileAndRun(i,s),h=this.complex(u,c).as2D(e.shape[0],e.shape[1]);return u.dispose(),c.dispose(),h},n.prototype.gatherND=function(e,t){var o=t.shape,a=o[o.length-1],i=Ta(e,t),s=i[0],u=i[1],c=i[2],h=i[3],d=t.reshape([u,a]),f=e.reshape([e.size/c,c]),p=new wf(a,h,[u,c]);return this.compileAndRun(p,[f,d]).reshape(s)},n.prototype.fill=function(e,t,o){if("string"===(o=o||Wn(t))){var a=lr(o,$(e));return a.fill(t),S.makeTensor(a,e,o,this)}var i=new bf(e,t),s=i.getCustomSetupFunc(t);return this.compileAndRun(i,[],o,s)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},n.prototype.linspace=function(e,t,o){return Pa(e,t,o)},n.prototype.makeTensorInfo=function(e,t){var o=this.write(null,e,t);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:t}},n.prototype.makeOutput=function(e,t){var o=this.makeTensorInfo(e,t).dataId;return S.makeTensorFromDataId(o,e,t,this)},n.prototype.unpackTensor=function(e){var t=new lp(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},n.prototype.packTensor=function(e){var t=new Pf(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},n.prototype.packedReshape=function(e,t){var o=[_r(e.shape)].concat(wr(e.shape)),a={dtype:e.dtype,shape:o,dataId:e.dataId},i=[_r(t)].concat(wr(t)),s=new Of(i,o),u=this.runWebGLProgram(s,[a],e.dtype,null,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}},n.prototype.decode=function(e){var t,o=this.texData.get(e),a=o.isPacked,i=o.shape,s=o.dtype,u=eo(i);return t=a?new hf(u):new lf(u),{dtype:s,shape:i,dataId:this.runWebGLProgram(t,[{shape:u,dtype:s,dataId:e}],s,null,!0).dataId}},n.prototype.runWebGLProgram=function(e,t,o,a,i){var s=this;void 0===i&&(i=!1);var u=this.makeTensorInfo(e.outputShape,o),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===mr.DENSE){var h=gr(e.outputShape);c.texShape=h.map(function(b){return 2*b})}if(null!=e.outTexUsage&&(c.usage=e.outTexUsage),0===$(u.shape))return c.values=Ln(u.dtype,0),u;var d=[],f=t.map(function(b){if("complex64"===b.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var _=s.texData.get(b.dataId);if(null==_.texture){if(!e.packedInputs&&$(b.shape)<=O().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:_.values};e.packedInputs&&(_.isPacked=!0,_.shape=b.shape)}else if(!!_.isPacked!=!!e.packedInputs)b=_.isPacked?s.unpackTensor(b):s.packTensor(b),d.push(b),_=s.texData.get(b.dataId);else if(_.isPacked&&!Cr(_.shape,b.shape)){var w=b,T=b.shape;b.shape=_.shape,b=s.packedReshape(b,T),d.push(b),_=s.texData.get(b.dataId),w.shape=T}return s.uploadToGPU(b.dataId),{shape:b.shape,texData:_,isUniform:!1}});this.uploadToGPU(u.dataId);var p,b,T,v={shape:u.shape,texData:c,isUniform:!1},m=(b=e,T="",f.concat(v).forEach(function(I){T+=I.shape+"_"+(I.isUniform?"uniform":I.texData.texShape)+"_"+(null!=I.texData&&null!=I.texData.slice&&I.texData.slice.flatOffset>0)}),b.constructor.name+"_"+T+"_"+b.userCode),g=this.getAndSaveBinary(m,function(){return function(b,_,w,T){var A=_.userCode,k=w.map(function(U,z){var H={logicalShape:U.shape,texShape:U.isUniform?null:U.texData.texShape,isUniform:U.isUniform,isPacked:!U.isUniform&&U.texData.isPacked,flatOffset:null};return null!=U.texData&&null!=U.texData.slice&&U.texData.slice.flatOffset>0&&(H.flatOffset=U.texData.slice.flatOffset),{name:_.variableNames[z],shapeInfo:H}}),I=k.map(function(U){return U.shapeInfo}),D={logicalShape:T.shape,texShape:T.texData.texShape,isUniform:!1,isPacked:T.texData.isPacked,flatOffset:null},N=Bd(k,D,A,_.packedInputs),P=b.createProgram(N),W=null,B=b.getUniformLocation(P,"NAN",!1);1===O().getNumber("WEBGL_VERSION")&&(W=b.getUniformLocation(P,"INFINITY",!1));for(var L={},q=0;q<_.variableNames.length;q++){var V=_.variableNames[q];L[V]=b.getUniformLocation(P,V,!1),L["offset"+V]=b.getUniformLocation(P,"offset"+V,!1)}return{program:_,source:N,webGLProgram:P,uniformLocations:L,inShapeInfos:I,outShapeInfo:D,infLoc:W,nanLoc:B}}(s.gpgpu,e,f,v)}),y=null!=this.activeTimers;if(y&&(p=this.startTimer()),function(b,_,w,T,A){lc(_.inShapeInfos,w),lc([_.outShapeInfo],[T]);var k=T.texData.texture,I=T.texData.texShape;T.texData.isPacked?b.setOutputPackedMatrixTexture(k,I[0],I[1]):b.setOutputMatrixTexture(k,I[0],I[1]),b.setProgram(_.webGLProgram),1===O().getNumber("WEBGL_VERSION")&&null!==_.infLoc&&b.gl.uniform1f(_.infLoc,1/0),null!==_.nanLoc&&b.gl.uniform1f(_.nanLoc,NaN),w.forEach(function(D,N){var P=_.program.variableNames[N],W=_.uniformLocations[P],B=_.uniformLocations["offset"+P];if(null!=W)if(D.isUniform)if($(D.shape)<2)b.gl.uniform1f(W,D.uniformValues[0]);else{var L=D.uniformValues;L instanceof Float32Array||(L=new Float32Array(L)),b.gl.uniform1fv(W,L)}else null!=D.texData.slice&&null!=B&&b.gl.uniform1i(B,D.texData.slice.flatOffset),b.setInputMatrixTexture(D.texData.texture,W,N)}),null!=A&&A(b,_.webGLProgram),b.executeProgram()}(this.gpgpu,g,f,v,a),d.forEach(function(b){return s.disposeData(b.dataId)}),y&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)})),!O().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&!1===i){var x=this.unpackTensor(u);return this.disposeData(u.dataId),x}return u},n.prototype.compileAndRun=function(e,t,o,a,i){void 0===i&&(i=!1);var s=this.runWebGLProgram(e,t,o=o||t[0].dtype,a,i);return S.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},n.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var e=this;this.disposed||(O().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}),this.textureManager.dispose(),null!=this.canvas&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=J(function(){if(!O().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=O().getBool("DEBUG");O().set("DEBUG",!1);var o=e.abs(Z(1e-8)).dataSync()[0];if(O().set("DEBUG",t),o>0)return 32}return 16})),this.floatPrecisionValue},n.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},n.prototype.uploadToGPU=function(e){var t,o=this.texData.get(e),a=o.shape,i=o.dtype,s=o.values,c=o.usage,h=o.isPacked;if(null==o.texture){var d,f=null!=this.activeTimers;f&&(d=wt());var p=o.texShape;if(null==p&&(p=ru(a,h),o.texShape=p),null!=s){var v=eo(a),m=void 0,g=p[1],y=p[0],x=s instanceof Uint8Array;h?(g=(t=yr(p[0],p[1]))[0],m=new gf(v,[y=t[1],g],x)):m=new mf(v,[y,g],x);var b=this.makeTensorInfo([y,g],i);this.texData.get(b.dataId).usage=x?ct.PIXELS:ct.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),g,y,s);var _=this.runWebGLProgram(m,[b],i,null,!0),w=this.texData.get(_.dataId);o.texture=w.texture,o.texShape=w.texShape,o.isPacked=w.isPacked,o.usage=w.usage,this.disposeData(b.dataId),this.texData.delete(_.dataId),o.values=null,f&&(this.uploadWaitMs+=wt()-d)}else{var T=this.acquireTexture(p,c,i,h);o.texture=T}}},n.prototype.convertAndCacheOnCPU=function(e,t){var o=this.texData.get(e),a=o.dtype;return this.releaseGPUData(e),null!=t&&(o.values=function(i,s){if("float32"===s||"complex64"===s)return i;if("int32"===s||"bool"===s){for(var u="int32"===s?new Int32Array(i.length):new Uint8Array(i.length),c=0;c<u.length;++c)u[c]=Math.round(i[c]);return u}throw new Error("Unknown dtype "+s)}(t,a)),o.values},n.prototype.acquireTexture=function(e,t,o,a){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,a)},n.prototype.computeBytes=function(e,t){return e[0]*e[1]*$o(t)},n}(ku);Ls()&&S.registerBackend("webgl",function(){return new Ic},2);var dp=R({square_:function(r){var n=C(r,"x","square");return S.runKernelFunc(function(t,o){return o([n]),t.square(n)},{x:n},null,"Square",{},[n],[])}}),Rr="SquaredDifference",Dc=R({squaredDifference_:function(r,n){var e,t=C(r,"a","squaredDifference"),o=C(n,"b","squaredDifference");return e=ke(t,o),de((t=e[0]).shape,(o=e[1]).shape),S.runKernelFunc(function(s,u){var c=s.squaredDifference(t,o);return u([t,o]),c},{a:t,b:o},function(s,u){var c=u[0],h=u[1],d=Z(2);return{a:function(){return s.mul(c.sub(h).mul(d))},b:function(){return s.mul(h.sub(c).mul(d))}}},Rr,{},[t,o],[])}}),fp=R({abs_:function(r){var n=C(r,"x","abs");return"complex64"===n.dtype?S.runKernelFunc(function(e){return e.complexAbs(n)},{$x:n}):S.runKernelFunc(function(e,t){var o=e.abs(n);return t([n]),o},{x:n},function(e,t){var o=t[0];return{x:function(){return e.mul(o.toFloat().step(-1))}}},"Abs")}}),pp=R({acos_:function(r){var n=C(r,"x","acos");return S.runKernelFunc(function(e,t){var o=e.acos(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.divStrict(Z(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),vp=R({acosh_:function(r){var n=C(r,"x","acosh");return S.runKernelFunc(function(e,t){var o=e.acosh(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),mp=R({asin_:function(r){var n=C(r,"x","asin");return S.runKernelFunc(function(e,t){var o=e.asin(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.divStrict(Z(1).sub(o.toFloat().square()).sqrt())}}})}}),gp=R({asinh_:function(r){var n=C(r,"x","asinh");return S.runKernelFunc(function(e,t){var o=e.asinh(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.divStrict(Z(1).add(o.toFloat().square()).sqrt())}}})}}),yp=R({atan_:function(r){var n=C(r,"x","atan");return S.runKernelFunc(function(e,t){var o=e.atan(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.div(o.toFloat().square().add(1))}}})}}),xp=R({atanh_:function(r){var n=C(r,"x","atanh");return S.runKernelFunc(function(e,t){var o=e.atanh(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.div(Z(1).sub(o.toFloat().square()))}}})}}),bp=R({ceil_:function(r){var n=C(r,"x","ceil");return S.runKernelFunc(function(e){return e.ceil(n)},{$x:n},function(e){return{$x:function(){return ye(e)}}})}}),Za=R({clipByValue_:function(r,n,e){var t=C(r,"x","clipByValue");return E(n<=e,function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+e+")."}),S.runKernelFunc(function(i,s){var u=i.clip(t,n,e);return s([t]),u},{x:t},function(i,s){var u=s[0];return{x:function(){return i.where(u.greaterEqual(n).logicalAnd(u.lessEqual(e)),ye(i))}}},"ClipByValue",{min:n,max:e},[t])}}),_p=R({cos_:function(r){var n=C(r,"x","cos");return S.runKernelFunc(function(t,o){var a=t.cos(n);return o([n]),a},{x:n},function(t,o){var a=o[0];return{x:function(){return a.toFloat().sin().neg().mul(t)}}},"Cos",{},[n])}}),wp=R({cosh_:function(r){var n=C(r,"x","cosh");return S.runKernelFunc(function(e,t){var o=e.cosh(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return o.toFloat().sinh().mulStrict(e)}}})}}),Cp=R({erf_:function(r){var n=C(r,"x","erf");return E("int32"===n.dtype||"float32"===n.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===n.dtype&&(n=n.toFloat()),S.runKernelFunc(function(e,t){var o=e.erf(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),ja=R({exp_:function(r){var n=C(r,"x","exp");return S.runKernelFunc(function(e,t){var o=e.exp(n);return t([o]),o},{x:n},function(e,t){return{x:function(){return e.mulStrict(t[0])}}},"Exp",{},[],[!0])}}),Tp=R({expm1_:function(r){var n=C(r,"x","expm1");return S.runKernelFunc(function(e,t){var o=e.expm1(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.mul(o.exp())}}})}}),Ep=R({floor_:function(r){var n=C(r,"x","floor");return S.runKernelFunc(function(e){return e.floor(n)},{$x:n},function(e){return{$x:function(){return ye(e)}}})}}),Ip=R({log_:function(r){var n=C(r,"x","log");return S.runKernelFunc(function(t,o){var a=t.log(n);return o([n]),a},{x:n},function(t,o){var a=o[0];return{x:function(){return t.div(a.toFloat())}}},"Log",{},[n])}}),Dp=R({log1p_:function(r){var n=C(r,"x","log1p");return S.runKernelFunc(function(e,t){var o=e.log1p(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.div(o.add(1))}}})}}),kp=R({logSigmoid_:function(r){var n=C(r,"x","logSigmoid");return S.runKernelFunc(function(e,t){var o=e.softplus(n.neg()).neg();return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.mul(o.neg().sigmoid())}}})}}),_o=R({neg_:function(r){var n=C(r,"x","neg");return S.runKernelFunc(function(t){return t.neg(n)},{x:n},function(t){return{x:function(){return t.neg()}}},"Neg",{},[n])}}),Ap=R({reciprocal_:function(r){var n=C(r,"x","reciprocal");return S.runKernelFunc(function(e,t){var o=e.reciprocal(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.div(o.square().neg())}}})}}),Sp=R({round_:function(r){var n=C(r,"x","round");return S.runKernelFunc(function(e){return e.round(n)},{$x:n},function(e){return{$x:function(){return ye(e)}}})}}),kc=R({rsqrt_:function(r){var n=C(r,"x","rsqrt");return S.runKernelFunc(function(t,o){var a=t.rsqrt(n);return o([n]),a},{x:n},function(t,o){var a=o[0];return{x:function(){return t.div(a.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},[n])}}),Ac=R({sigmoid_:function(r){var n=C(r,"x","sigmoid");return S.runKernelFunc(function(e,t){var o=e.sigmoid(n);return t([o]),o},{x:n},function(e,t){var o=t[0];return{x:function(){return e.mul(o.mul(Z(1).sub(o)))}}},"Sigmoid")}}),Rp=R({sign_:function(r){var n=C(r,"x","sign");return S.runKernelFunc(function(e){return e.sign(n)},{$x:n},function(e){return{$x:function(){return ye(e)}}})}}),Pp=R({isNaN_:function(r){var n=C(r,"x","isNaN");return S.runKernelFunc(function(e){return e.isNaN(n)},{$x:n},function(e){return{$x:function(){return ye(e)}}})}}),Np=R({isInf_:function(r){var n=C(r,"x","isInf");return S.runKernelFunc(function(e){return e.isInf(n)},{$x:n},function(e){return{$x:function(){return ye(e)}}})}}),Fp=R({isFinite_:function(r){var n=C(r,"x","isFinite");return S.runKernelFunc(function(e){return e.isFinite(n)},{$x:n},function(e){return{$x:function(){return ye(e)}}})}}),Mp=R({sin_:function(r){var n=C(r,"x","sin");return S.runKernelFunc(function(t,o){var a=t.sin(n);return o([n]),a},{x:n},function(t,o){var a=o[0];return{x:function(){return a.toFloat().cos().mul(t)}}},"Sin",{},[n])}}),Op=R({sinh_:function(r){var n=C(r,"x","sinh");return S.runKernelFunc(function(e,t){var o=e.sinh(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return o.toFloat().cosh().mulStrict(e)}}})}}),Bp=R({softplus_:function(r){var n=C(r,"x","softplus");return S.runKernelFunc(function(e,t){var o=e.softplus(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.mul(o.sigmoid())}}})}}),Lp=R({sqrt_:function(r){var n=C(r,"x","sqrt");return S.runKernelFunc(function(e,t){var o=e.sqrt(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.div(o.toFloat().sqrt().mul(2))}}})}}),Wp=R({step_:function(r,n){void 0===n&&(n=0);var e=C(r,"x","step");return S.runKernelFunc(function(t){return t.step(e,n)},{$x:e},function(t){return{$x:function(){return ye(t)}}})}}),Up=R({tan_:function(r){var n=C(r,"x","tan");return S.runKernelFunc(function(e,t){var o=e.tan(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return e.div(o.cos().square())}}})}}),Vp=R({tanh_:function(r){var n=C(r,"x","tanh");return S.runKernelFunc(function(e,t){var o=e.tanh(n);return t([o]),o},{x:n},function(e,t){var o=t[0];return{x:function(){return Z(1).sub(o.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function Sc(r,n,e,t,o,a){var i,s,u=C(r,"x","batchNorm"),c=C(n,"mean","batchNorm"),h=C(e,"variance","batchNorm");return null!=o&&(i=C(o,"scale","batchNorm")),null!=t&&(s=C(t,"offset","batchNorm")),E(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),E(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),E(2===h.rank||1===h.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+h.rank+"."}),null!=i&&E(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),null!=s&&E(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Pr(u,c,h,s,i,a)}function Rc(r,n,e,t,o,a){var i,s,u=C(r,"x","batchNorm"),c=C(n,"mean","batchNorm"),h=C(e,"variance","batchNorm");return null!=o&&(i=C(o,"scale","batchNorm")),null!=t&&(s=C(t,"offset","batchNorm")),E(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),E(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),E(3===h.rank||1===h.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+h.rank+"."}),null!=i&&E(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),null!=s&&E(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Pr(u,c,h,s,i,a)}function Pc(r,n,e,t,o,a){var i,s,u=C(r,"x","batchNorm"),c=C(n,"mean","batchNorm"),h=C(e,"variance","batchNorm");return null!=o&&(i=C(o,"scale","batchNorm")),null!=t&&(s=C(t,"offset","batchNorm")),E(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),E(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),E(4===h.rank||1===h.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+h.rank+"."}),null!=i&&E(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),null!=s&&E(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Pr(u,c,h,s,i,a)}function Pr(r,n,e,t,o,a){null==a&&(a=.001);var i,s,u,c=C(r,"x","batchNorm"),h=C(n,"mean","batchNorm"),d=C(e,"variance","batchNorm");return null!=o&&(i=C(o,"scale","batchNorm")),null!=t&&(s=C(t,"offset","batchNorm")),E(h.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),E(null==s||h.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),E(null==i||h.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c,S.runKernelFunc(function(p,v){var m=p.batchNormalization(u,wo(h),wo(d),a,wo(i),wo(s));return v([c,h,d,i]),m},{x:c,mean:h,variance:d,scale:i,offset:s},function(p,v){var g=v[0],y=v[1],x=v[2],b=v[3],_=null==b?Z(1):b,w=We(y.shape,u.shape),T=[];if(1===y.rank){for(var A=0;A<u.shape.length-1;++A)T.push(u.shape[A]);T.push(1)}var k=g.sub(y),I=p.mul(_),D=kc(x.add(Z(a))),N=D.mul(D).mul(D).mul(Z(-.5));return{x:function(){return 1===y.rank?p.mul(qn(D.as4D(1,1,1,y.shape[0]),T)).mul(_).reshape(g.shape):p.mul(D).mul(_).reshape(g.shape)},mean:function(){var P=D.mul(Z(-1)).mul(I);return 1===y.rank&&(P=P.sum(w)),P.reshape(y.shape)},variance:function(){var P=N.mul(k).mul(I);return 1===y.rank&&(P=P.sum(w)),P.reshape(y.shape)},scale:function(){var P=k.mul(D),W=p.mul(P);return 1===y.rank&&(W=W.sum(w)),W.reshape(y.shape)},offset:function(){var P=p;return 1===y.rank&&(P=P.sum(w)),P.reshape(y.shape)}}},"BatchNormalization",{varianceEpsilon:a},[c,h,d,i]).reshape(c.shape)}function wo(r){return null==r?null:0===r.rank?r.as1D():1===r.rank?r:2===r.rank?r.as4D(1,1,r.shape[0],r.shape[1]):3===r.rank?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function Co(){lu("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Gp=R({batchNormalization2d_:function(r,n,e,t,o,a){return void 0===t&&(t=.001),Co(),Sc(r,n,e,a,o,t)}}),qp=R({batchNormalization3d_:function(r,n,e,t,o,a){return void 0===t&&(t=.001),Co(),Rc(r,n,e,a,o,t)}}),zp=R({batchNormalization4d_:function(r,n,e,t,o,a){return void 0===t&&(t=.001),Co(),Pc(r,n,e,a,o,t)}}),Hp=R({batchNormalization_:function(r,n,e,t,o,a){return void 0===t&&(t=.001),Co(),Pr(r,n,e,a,o,t)}}),Nc=R({batchNorm_:Pr}),Zp=R({batchNorm2d_:Sc}),jp=R({batchNorm3d_:Rc}),Kp=R({batchNorm4d_:Pc}),To=R({logicalAnd_:function(r,n){var e=C(r,"a","logicalAnd","bool"),t=C(n,"b","logicalAnd","bool");return de(e.shape,t.shape),S.runKernelFunc(function(o){return o.logicalAnd(e,t)},{a:e,b:t},null,"LogicalAnd")}}),Jp=R({logicalNot_:function(r){var n=C(r,"x","logicalNot","bool");return S.runKernelFunc(function(e){return e.logicalNot(n)},{$x:n})}}),Fc=R({logicalOr_:function(r,n){var e=C(r,"a","logicalOr","bool"),t=C(n,"b","logicalOr","bool");return de(e.shape,t.shape),S.runKernelFunc(function(o){return o.logicalOr(e,t)},{$a:e,$b:t})}}),Yp=R({logicalXor_:function(r,n){var e=C(r,"a","logicalXor","bool"),t=C(n,"b","logicalXor","bool");return de(e.shape,t.shape),Fc(r,n).logicalAnd(To(r,n).logicalNot())}}),Sn=R({where_:function(r,n,e){var t=C(n,"a","where"),o=C(e,"b","where"),a=C(r,"condition","where","bool");return ge(t.shape,o.shape,"Error in where: "),1===a.rank?E(a.shape[0]===t.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):ge(a.shape,o.shape,"Error in where: "),S.runKernelFunc(function(i,s){var u=i.select(a,t,o);return s([a]),u},{$condition:a,$a:t,$b:o},function(i,s){var u=s[0];return{$condition:function(){return ye(u).toFloat()},$a:function(){return i.mul(u.cast(i.dtype))},$b:function(){return i.mul(u.logicalNot().cast(i.dtype))}}})}}),Mc=function(r){return X(this,void 0,void 0,function(){var n,e,t;return Q(this,function(o){switch(o.label){case 0:return[4,(n=C(r,"condition","whereAsync","bool")).data()];case 1:return e=o.sent(),t=Oa(n.shape,e),r!==n&&n.dispose(),[2,t]}})})},fe=R({add_:function(r,n){var e,t=C(r,"a","add"),o=C(n,"b","add");e=ke(t,o);var a=de((t=e[0]).shape,(o=e[1]).shape);return S.runKernelFunc(function(i){return i.add(t,o)},{a:t,b:o},function(i){return{a:function(){var s=i,u=We(t.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(t.shape)},b:function(){var s=i,u=We(o.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}},"Add")}}),Xp=R({addN_:function(r){E(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),E(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var n=r.map(function(o,a){return C(o,"tensors"+a,"addN")}),e=n[0];return n.forEach(function(o){if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),n.forEach(function(o){if(!Oe(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),S.runKernelFunc(function(o){return o.addN(n)},n,function(o){var a={};return n.forEach(function(i,s){a[s]=function(){return o.clone()}}),a},"AddN")}}),Qp=R({addStrict_:function(r,n){var e=C(r,"a","addStrict"),t=C(n,"b","addStrict");return ge(e.shape,t.shape,"Error in addStrict: "),e.add(t)}}),$p=R({atan2_:function(r,n){var e,t=C(r,"a","atan2"),o=C(n,"b","atan2");e=ke(t,o);var a=de((t=e[0]).shape,(o=e[1]).shape);return S.runKernelFunc(function(i,s){var u=i.atan2(t,o);return s([t,o]),u},{$a:t,$b:o},function(i,s){var u=s[0],c=s[1];return{$a:function(){var h=fe(u.square(),c.square()),d=i.mul(c.div(h)),f=We(u.shape,a);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)},$b:function(){var h=fe(u.square(),c.square()),d=_o(i.mul(u.div(h))),f=We(c.shape,a);return f.length>0&&(d=d.sum(f)),d.reshape(c.shape)}}})}}),Dt=R({div_:function(r,n){var e,t=C(r,"a","div"),o=C(n,"b","div");if(e=ke(t,o),o=e[1],"int32"===(t=e[0]).dtype&&"int32"===o.dtype)return Oc(t,o);var a=de(t.shape,o.shape);return S.runKernelFunc(function(i,s){var u=i.realDivide(t,o);return s([t,o]),u},{a:t,b:o},function(i,s){var u=s[0],c=s[1];return{a:function(){var h=i.div(c.toFloat()),d=We(u.shape,a);return d.length>0?h.sum(d).reshape(u.shape):h},b:function(){var h=i.mul(u.toFloat()),d=We(c.shape,a);d.length>0&&(h=h.sum(d).reshape(c.shape));var f=c.square();return h.div(f.toFloat()).neg()}}},"Div")}}),ev=R({divNoNan_:function(r,n){var e,t=C(r,"a","div"),o=C(n,"b","div");t=(e=ke(t,o))[0];var a=Dt(t,o=e[1]),i=ye(a),s=o.equal(i);return Sn(s,i,a)}}),tv=R({divStrict_:function(r,n){var e=C(r,"a","div"),t=C(n,"b","div");return ge(e.shape,t.shape,"Error in divideStrict: "),e.div(t)}}),Oc=R({floorDiv_:function(r,n){var e,t=C(r,"a","floorDiv"),o=C(n,"b","floorDiv");e=ke(t,o);var a=de((t=e[0]).shape,(o=e[1]).shape);return S.runKernelFunc(function(i,s){var u=i.floorDiv(t,o);return s([t,o]),u},{a:t,b:o},function(i,s){var u=s[0],c=s[1];return{a:function(){var h=i.div(c.toFloat()),d=We(u.shape,a);return d.length>0?h.sum(d).reshape(u.shape):h},b:function(){var h=i.mul(u.toFloat()),d=We(c.shape,a);d.length>0&&(h=h.sum(d).reshape(c.shape));var f=c.square();return h.div(f.toFloat()).neg()}}},"FloorDiv")}}),Ka=R({maximum_:function(r,n){var e,t=C(r,"a","maximum"),o=C(n,"b","maximum");return e=ke(t,o),o=e[1],"bool"===(t=e[0]).dtype&&(t=t.toInt(),o=o.toInt()),de(t.shape,o.shape),S.runKernelFunc(function(a,i){var s=a.maximum(t,o);return i([t,o]),s},{a:t,b:o},function(a,i){var s=i[0],u=i[1];return{a:function(){return a.mul(s.greaterEqual(u).toFloat())},b:function(){return a.mul(s.less(u).toFloat())}}},"Maximum")}}),nv=R({maximumStrict_:function(r,n){var e=C(r,"a","maximumStrict"),t=C(n,"b","maximumStrict");return ge(e.shape,t.shape,"Error in maximumStrict: "),e.maximum(t)}}),Bc=R({minimum_:function(r,n){var e,t=C(r,"a","minimum"),o=C(n,"b","minimum");return e=ke(t,o),o=e[1],"bool"===(t=e[0]).dtype&&(t=t.toInt(),o=o.toInt()),de(t.shape,o.shape),S.runKernelFunc(function(a,i){var s=a.minimum(t,o);return i([t,o]),s},{a:t,b:o},function(a,i){var s=i[0],u=i[1];return{a:function(){return a.mul(s.lessEqual(u).toFloat())},b:function(){return a.mul(s.greater(u).toFloat())}}},"Minimum")}}),rv=R({minimumStrict_:function(r,n){var e=C(r,"a","minimumStrict"),t=C(n,"b","minimumStrict");return ge(e.shape,t.shape,"Error in minimumStrict: "),e.minimum(t)}}),ov=R({mod_:function(r,n){var e,t=C(r,"a","mod"),o=C(n,"b","mod");e=ke(t,o);var a=de((t=e[0]).shape,(o=e[1]).shape);return S.runKernelFunc(function(i,s){var u=i.mod(t,o);return s([t,o]),u},{$a:t,$b:o},function(i,s){var u=s[0],c=s[1];return{$a:function(){var h=We(u.shape,a);return h.length>0?i.sum(h).reshape(u.shape):i},$b:function(){var h=i.mul(u.div(c).floor().neg()),d=We(c.shape,a);return d.length>0?h.sum(d).reshape(c.shape):h}}})}}),av=R({modStrict_:function(r,n){var e=C(r,"a","modStrict"),t=C(n,"b","modStrict");return ge(e.shape,t.shape,"Error in modStrict: "),e.mod(t)}}),$e=R({mul_:function(r,n){var e,t=C(r,"a","mul"),o=C(n,"b","mul");e=ke(t,o);var a=de((t=e[0]).shape,(o=e[1]).shape);return S.runKernelFunc(function(i,s){var u=i.multiply(t,o);return s([t,o]),u},{a:t,b:o},function(i,s){var u=s[0],c=s[1];return{a:function(){var h=i.mul(c.toFloat()),d=We(u.shape,a);return d.length>0?h.sum(d).reshape(u.shape):h},b:function(){var h=i.mul(u.toFloat()),d=We(c.shape,a);return d.length>0?h.sum(d).reshape(c.shape):h}}},"Mul")}}),iv=R({mulStrict_:function(r,n){var e=C(r,"a","mul"),t=C(n,"b","mul");return ge(e.shape,t.shape,"Error in multiplyStrict: "),e.mul(t)}}),Eo=R({pow_:function(r,n){var e,t=C(r,"base","pow"),o=C(n,"exp","pow");e=ke(t,o);var a=de((t=e[0]).shape,(o=e[1]).shape);return S.runKernelFunc(function(s,u){var c=s.pow(t,o);return u([t,o,c]),c},{a:t,b:o},function(s,u){var c=u[0],h=u[1],d=u[2];return{a:function(){var f=h.toFloat(),p=s.mul(f.mul(c.pow(f.sub(Z(1))))),v=We(c.shape,a);return v.length>0&&(p=p.sum(v)),p.reshape(c.shape)},b:function(){var f=c.greater(0),p=c.log().where(f,ye(c)),v=s.mul(d.mul(p)),m=We(h.shape,a);return m.length>0&&(v=v.sum(m)),v.reshape(h.shape)}}},"Pow",{},[t,o],[!0])}}),sv=R({powStrict_:function(r,n){return ge(r.shape,n.shape,"Error in powStrict: "),r.pow(n)}}),uv=R({squaredDifferenceStrict_:function(r,n){var e=C(r,"a","squaredDifferenceStrict"),t=C(n,"b","squaredDifferenceStrict");return ge(e.shape,t.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(t)}}),qe=R({sub_:function(r,n){var e,t=C(r,"a","sub"),o=C(n,"b","sub");e=ke(t,o);var a=de((t=e[0]).shape,(o=e[1]).shape);return S.runKernelFunc(function(i){return i.subtract(t,o)},{a:t,b:o},function(i){return{a:function(){var s=i,u=We(t.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(t.shape)},b:function(){var s=i,u=We(o.shape,a);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),cv=R({subStrict_:function(r,n){var e=C(r,"a","subStrict"),t=C(n,"b","subStrict");return ge(e.shape,t.shape,"Error in subStrict: "),e.sub(t)}}),Lc=R({equal_:function(r,n){var e,t=C(r,"a","equal"),o=C(n,"b","equal");return e=ke(t,o),de((t=e[0]).shape,(o=e[1]).shape),S.runKernelFunc(function(a){return a.equal(t,o)},{$a:t,$b:o})}}),lv=R({equalStrict_:function(r,n){var e=C(r,"a","equalStrict"),t=C(n,"b","equalStrict");return ge(e.shape,t.shape,"Error in equalStrict: "),e.equal(t)}}),hv=R({greater_:function(r,n){var e,t=C(r,"a","greater"),o=C(n,"b","greater");return e=ke(t,o),de((t=e[0]).shape,(o=e[1]).shape),S.runKernelFunc(function(a){return a.greater(t,o)},{a:t,b:o},null,"Greater")}}),Wc=R({greaterEqual_:function(r,n){var e,t=C(r,"a","greaterEqual"),o=C(n,"b","greaterEqual");return e=ke(t,o),de((t=e[0]).shape,(o=e[1]).shape),S.runKernelFunc(function(a,i){var s=a.greaterEqual(t,o);return i([t,o]),s},{a:t,b:o},function(a,i){var s=i[0],u=i[1];return{a:function(){return ye(s)},b:function(){return ye(u)}}},"GreaterEqual")}}),dv=R({greaterEqualStrict_:function(r,n){var e=C(r,"a","greaterEqualStrict"),t=C(n,"b","greaterEqualStrict");return ge(e.shape,t.shape,"Error in greaterEqualStrict: "),e.greaterEqual(t)}}),fv=R({greaterStrict_:function(r,n){var e=C(r,"a","greaterStrict"),t=C(n,"b","greaterStrict");return ge(e.shape,t.shape,"Error in greaterStrict: "),e.greater(t)}}),pv=R({less_:function(r,n){var e,t=C(r,"a","less"),o=C(n,"b","less");return e=ke(t,o),de((t=e[0]).shape,(o=e[1]).shape),S.runKernelFunc(function(a){return a.less(t,o)},{a:t,b:o},null,"Less")}}),vv=R({lessEqual_:function(r,n){var e,t=C(r,"a","lessEqual"),o=C(n,"b","lessEqual");return e=ke(t,o),de((t=e[0]).shape,(o=e[1]).shape),S.runKernelFunc(function(a,i){var s=a.lessEqual(t,o);return i([t,o]),s},{a:t,b:o},null,"LessEqual")}}),mv=R({lessEqualStrict_:function(r,n){var e=C(r,"a","lessEqualStrict"),t=C(n,"b","lessEqualStrict");return ge(e.shape,t.shape,"Error in lessEqualStrict: "),e.lessEqual(t)}}),gv=R({lessStrict_:function(r,n){var e=C(r,"a","lessStrict"),t=C(n,"b","lessStrict");return ge(e.shape,t.shape,"Error in lessStrict: "),e.less(t)}}),yv=R({notEqual_:function(r,n){var e,t=C(r,"a","notEqual"),o=C(n,"b","notEqual");return e=ke(t,o),de((t=e[0]).shape,(o=e[1]).shape),S.runKernelFunc(function(a){return a.notEqual(t,o)},{a:t,b:o},null,"NotEqual")}}),xv=R({notEqualStrict_:function(r,n){var e=C(r,"a","notEqualStrict"),t=C(n,"b","notEqualStrict");return ge(e.shape,t.shape,"Error in notEqualStrict: "),e.notEqual(t)}});function Uc(r,n){for(var e=[],t=r;t<n;++t)e.push(t);return e}function Vc(r){for(var n=[],e=0;e<r.length;++e)for(var t=0;t<r[e].length;++t)n.push(r[e][t]);return n}var Ja=R({gather_:function(r,n,e){void 0===e&&(e=0);var t=C(r,"x","gather"),o=C(n,"indices","gather","int32");e=Be(e,t.shape)[0];var a=function(i,s,u){for(var c=i.shape[u],h=[],d=1,f=1,p=0;p<u;p++)h.push(i.shape[p]),d*=i.shape[p];for(p=0;p<s.rank;p++)h.push(s.shape[p]);for(p=u+1;p<i.rank;p++)h.push(i.shape[p]),f*=i.shape[p];return{batchSize:d,sliceSize:f,dimSize:c,outputShape:h}}(t,o,e);return S.runKernelFunc(function(i,s){var u=i.gather(t,o.flatten(),e);return s([o]),u},{x:t,indices:o},function(i,s){var u=s[0];return{x:function(){var c=t.shape,h=u.size,d=c.slice(0,e),f=d.length,p=c.slice(e,c.length).slice(1),v=p.length,m=Uc(0,f),g=Uc(f+1,f+1+v),y=Vc([d,[h],p]),x=i.reshape(y),b=u.reshape([h]),_=Vc([[f],m,g]),w=x.transpose(_),T=Gc(w,b,t.shape[e]),A=ro(_);return T.transpose(A)},indices:function(){return u}}},"Gather",{axis:e}).reshape(a.outputShape)}}),Gc=R({unsortedSegmentSum_:function(r,n,e){var t=C(r,"x","unsortedSegmentSum"),o=C(n,"segmentIds","unsortedSegmentSum","int32");return E(Ae(e),function(){return"numSegments must be of dtype int"}),S.runKernelFunc(function(a,i){var s=a.unsortedSegmentSum(t,o,e);return i([o]),s},{$x:t},function(a,i){var s=i[0];return{$x:function(){return function(u,c){for(var h=Ka(c,ye(c)),d=Ja(u,h),f=Wc(c,Z(0,"int32")),p=d.rank-f.rank,v=0;v<p;++v)f=yt(f,v+1);f=To(f,Gn(d.shape,"bool"));var m=ye(d);return Sn(f,d,m)}(a,s)}}})}});function qc(r,n,e,t,o,a,i){void 0===a&&(a="NHWC"),E(r.length===n.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+n.rank+") must match"});var s=r,u=n,c=!1;3===n.rank&&(c=!0,u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,r[0],r[1],r[2]]),E(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),E(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),E(4===e.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var h="NHWC"===a?s[3]:s[1],d="NHWC"===a?u.shape[3]:u.shape[1];E(h===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+h+") must match input depth for filter "+e.shape[2]+"."}),E(d===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+e.shape[3]+"."}),null!=i&&E(Ae(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var f=vo(a),p=ln(s,e.shape,t,1,o,i,!1,f),v=S.runKernelFunc(function(m,g){var y=m.conv2dDerInput(u,e,p);return g([e,u]),y},{dy4D:u,filter:e},function(m,g){var y=g[0],x=g[1];return{dy4D:function(){return xt(m,y,t,o,a,1,i)},filter:function(){return Xa(m,x,y.shape,t,o,a,i)}}});return c?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function Ya(r){var a,n="number"==typeof(a=r)?[a,a,a]:2===a.length?[a[0],a[1],1]:a;return 1===n[0]&&1===n[1]&&1===n[2]}function zc(r,n,e,t,o){E(r.length===n.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+n.rank+") must match"});var a=r,i=n,s=!1;4===n.rank&&(s=!0,i=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),a=[1,r[0],r[1],r[2],r[3]]);var u=a[4],c=i.shape[4];E(5===a.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),E(5===i.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),E(5===e.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),E(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),E(c===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+e.shape[4]+"."});var h=Dr(a,e.shape,t,1,o),d=S.runKernelFunc(function(f){return f.conv3dDerInput(i,e,h)},{dy5D:i});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var _v=R({conv1d_:function(r,n,e,t,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=C(r,"x","conv1d"),u=C(n,"filter","conv1d"),c=s,h=!1;2===s.rank&&(h=!0,c=s.as3D(1,s.shape[0],s.shape[1])),E(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),E(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=i&&E(Ae(t),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+t+"."}),E(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),E(ot(e,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+a+"'"}),E("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),p=xt(f,d,[1,e],t,"NHWC",[1,a],i);return h?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),xt=R({conv2d_:function(r,n,e,t,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=C(r,"x","conv2d"),u=C(n,"filter","conv2d"),c=s,h=!1;3===s.rank&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),E(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),E(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=i&&E(Ae(t),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+t+"."});var d="NHWC"===o?c.shape[3]:c.shape[1];E(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),E(ot(e,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"});var f=vo(o),p=ln(c.shape,u.shape,e,a,t,i,!1,f),m=S.runKernelFunc(function(g,y){var x=g.conv2d(c,u,p);return y([u,c]),x},{x:c,filter:u},function(g,y){var b=y[0],_=y[1];return E(Dn(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return Hc(_.shape,g,b,e,t,o)},filter:function(){return Xa(_,g,b.shape,e,t,o)}}},"Conv2D",p,[u,c]);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),wv=R({conv3d_:function(r,n,e,t,o,a){void 0===o&&(o="NDHWC"),void 0===a&&(a=[1,1,1]);var p,i=C(r,"x","conv3d"),s=C(n,"filter","conv3d"),u=i,c=!1;4===i.rank&&(c=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),E(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),E(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),E(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),E((p=a,Ya(e)||Ya(p)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),E("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var h=Dr(u.shape,s.shape,e,a,t),d=S.runKernelFunc(function(f,p){var v=f.conv3d(u,s,h);return p([u,s]),v},{x:u,$filter:s},function(f,p){E(Ya(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var v=p[0],m=p[1];return{x:function(){return zc(v.shape,f,m,e,t)},$filter:function(){return function(g,y,x,b,_){var w=g;4===g.rank&&(w=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var T=y;4===T.rank&&(T=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3])),E(5===w.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+w.shape+"."}),E(5===T.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+T.shape+"."}),E(5===x.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+x+"."}),E(w.shape[4]===x[3],function(){return"Error in conv3dDerFilter: depth of input "+w.shape[4]+") must match input depth in filter ("+x[3]+"."}),E(T.shape[4]===x[4],function(){return"Error in conv3dDerFilter: depth of dy ("+T.shape[4]+") must match output depth for filter ("+x[4]+")."});var A=Dr(w.shape,x,b,1,_);return S.runKernelFunc(function(k){return k.conv3dDerFilter(w,T,A)},{x5D:w,dy5D:T})}(v,f,m.shape,e,t)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Xa=R({conv2dDerFilter_:function(r,n,e,t,o,a,i){void 0===a&&(a="NHWC");var s=r;3===r.rank&&(s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var u=n;3===u.rank&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),E(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),E(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),E(4===e.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var c="NHWC"===a?s.shape[3]:s.shape[1],h="NHWC"===a?u.shape[3]:u.shape[1];E(c===e[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+e[2]+"."}),E(h===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+h+") must match output depth for filter ("+e[3]+")."}),null!=i&&E(Ae(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var d=vo(a),f=ln(s.shape,e,t,1,o,i,!1,d);return S.runKernelFunc(function(p){return p.conv2dDerFilter(s,u,f)},{x4D:s,dy4D:u})}}),Hc=R({conv2dDerInput_:qc}),Io=R({depthwiseConv2d_:function(r,n,e,t,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=C(r,"x","depthwiseConv2d"),u=C(n,"filter","depthwiseConv2d"),c=s,h=!1;3===s.rank&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),E(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),E(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),E(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==a&&(a=[1,1]),E(ot(e,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),null!=i&&E(Ae(t),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+t+"."});var d=ln(c.shape,u.shape,e,a,t,i,!0),p=S.runKernelFunc(function(v,m){var g=v.depthwiseConv2D(c,u,d);return m([c,u]),g},{x:c,filter:u},function(v,m){E(Dn(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var g=m[0],y=m[1];return{x:function(){return Zc(g.shape,v,y,d)},filter:function(){return jc(g,v,y.shape,d)}}},"DepthwiseConv2dNative",d,[c,u]);return h?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),Zc=R({depthwiseConv2dDerInput_:function(r,n,e,t){var o=n,a=!1;3===n.rank&&(a=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var i=S.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,e,t)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),jc=R({depthwiseConv2dDerFilter_:function(r,n,e,t){var o=r;3===r.rank&&(o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n;return 3===a.rank&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),S.runKernelFunc(function(i){return i.depthwiseConv2DDerFilter(o,a,t)},{x4D:o,dy4D:a})}}),Qa=R({separableConv2d_:function(r,n,e,t,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=C(r,"x","separableConv2d"),u=C(n,"depthwiseFilter","separableConv2d"),c=C(e,"pointwiseFilter","separableConv2d"),h=s,d=!1;if(3===s.rank&&(d=!0,h=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");E(4===h.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+h.rank+"."}),E(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),E(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),E(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),E(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var f=u.shape[2],p=u.shape[3];E(c.shape[2]===f*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*p+", but got "+c.shape[2]+"."});var v=Io(h,u,t,o,i,a),m=xt(v,c,1,"valid",i);return d?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Cv=R({conv2dTranspose_:function(r,n,e,t,o,a){return qc(e,C(r,"x","conv2dTranspose"),C(n,"filter","conv2dTranspose"),t,o,"NHWC",a)}}),Tv=R({conv3dTranspose_:function(r,n,e,t,o){return zc(e,C(r,"x","conv3dTranspose"),C(n,"filter","conv3dTranspose"),t,o)}}),Do=R({matMul_:function(r,n,e,t){var o;void 0===e&&(e=!1),void 0===t&&(t=!1);var a=C(r,"a","matMul"),i=C(n,"b","matMul");o=ke(a,i),a=o[0],i=o[1];var s=e?a.shape[a.rank-2]:a.shape[a.rank-1],u=t?i.shape[i.rank-1]:i.shape[i.rank-2],c=e?a.shape[a.rank-1]:a.shape[a.rank-2],h=t?i.shape[i.rank-2]:i.shape[i.rank-1],d=a.shape.slice(0,-2),f=i.shape.slice(0,-2),p=$(d),v=$(f);E(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),E(Oe(d,f),function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),E(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+e+" and transposeB="+t+" must match."});var m=a.shape.slice(0,-2).concat([c,h]),g=e?a.as3D(p,s,c):a.as3D(p,c,s),y=t?i.as3D(v,h,u):i.as3D(v,u,h);return S.runKernelFunc(function(b,_){var w=b.batchMatMul(g,y,e,t);return _([g,y]),w},{a:g,b:y},function(b,_){var T=_[0],A=_[1];return e||t?!e&&t?{a:function(){return b.matMul(A,!1,!1)},b:function(){return b.matMul(T,!0,!1)}}:e&&!t?{a:function(){return A.matMul(b,!1,!0)},b:function(){return T.matMul(b,!1,!1)}}:{a:function(){return A.matMul(b,!0,!0)},b:function(){return b.matMul(T,!0,!0)}}:{a:function(){return b.matMul(A,!1,!0)},b:function(){return T.matMul(b,!0,!1)}}},"BatchMatMul",{transposeA:e,transposeB:t}).reshape(m)}}),Ev=R({dot_:function(r,n){var e=C(r,"t1","dot"),t=C(n,"t2","dot");E(!(1!==e.rank&&2!==e.rank||1!==t.rank&&2!==t.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+t.rank+"."});var o=1===e.rank?e.size:e.shape[1],a=1===t.rank?t.size:t.shape[0];return E(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),1===e.rank&&1===t.rank?e.as2D(1,-1).matMul(t.as2D(-1,1)).asScalar():1===e.rank&&2===t.rank?e.as2D(1,-1).matMul(t.as2D(t.shape[0],t.shape[1])).as1D():2===e.rank&&1===t.rank?e.matMul(t.as2D(-1,1)).as1D():e.matMul(t.as2D(t.shape[0],t.shape[1]))}}),Iv=R({outerProduct_:function(r,n){var e=C(r,"v1","outerProduct"),t=C(n,"v2","outerProduct");return E(1===e.rank&&1===t.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+t.rank+"."}),e.as2D(-1,1).matMul(t.as2D(1,-1))}}),Nr=R({reverse_:function(r,n){var e=C(r,"x","reverse");if(0===e.rank)return e.clone();var t=Be(n,e.shape);return S.runKernelFunc(function(o){return o.reverse(e,t)},{$x:e},function(o){return{$x:function(){return o.reverse(t)}}}).reshapeAs(e)}}),Dv=R({reverse1d_:function(r){var n=C(r,"x","reverse");return E(1===n.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."}),Nr(n,0)}}),kv=R({reverse2d_:function(r,n){var e=C(r,"x","reverse");return E(2===e.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),Nr(e,n)}}),Av=R({reverse3d_:function(r,n){var e=C(r,"x","reverse");return E(3===e.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),Nr(e,n)}}),Sv=R({reverse4d_:function(r,n){var e=C(r,"x","reverse");return E(4===e.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),Nr(e,n)}});function Kc(r,n,e,t,o,a){var i=C(r,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==t&&(t=[1,1]),E(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),E(ot(e,t),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+t+"'"}),null!=a&&E(Ae(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var c=zn(s.shape,n,e,t,o,a);if(1===c.filterWidth&&1===c.filterHeight&&Oe(c.inShape,c.outShape))return i.clone();var d=S.runKernelFunc(function(f,p){var v=f.maxPool(s,c);return p([s,v]),v},{x:s},function(f,p){var v=p[0],m=p[1];return{x:function(){return function(g,y,x,b,_,w,T,A){var k=C(g,"dy","maxPoolBackprop"),I=C(y,"input","maxPoolBackprop"),D=C(x,"output","maxPoolBackprop");E(I.rank===k.rank,function(){return"Rank of input ("+I.rank+") does not match rank of dy ("+k.rank+")"}),null==w&&(w=[1,1]),E(ot(_,w),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+w+"'"}),E(4===k.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."}),E(4===I.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+I.rank+"."});var N=zn(I.shape,b,_,w,T,void 0);return S.runKernelFunc(function(P){return P.maxPoolBackprop(k,I,D,N)},{$dy:k,$input:I})}(f,v,m,n,e,t,o)}}},"MaxPool",c,[s]);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function Jc(r,n,e,t,o,a){var i=C(r,"x","avgPool","float32");null==t&&(t=[1,1]),E(ot(e,t),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+t+"'"});var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),E(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=a&&E(Ae(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var c=zn(s.shape,n,e,t,o,a);if(1===c.filterWidth&&1===c.filterHeight&&Oe(c.inShape,c.outShape))return i.clone();var h=S.runKernelFunc(function(d){return d.avgPool(s,c)},{x:s},function(d){return{x:function(){return function(f,p,v,m,g,y){var x=C(f,"dy","avgPoolBackprop"),b=C(p,"input","avgPoolBackprop");E(b.rank===x.rank,function(){return"Rank of input ("+b.rank+") does not match rank of dy ("+x.rank+")"}),null==g&&(g=[1,1]),E(ot(m,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"});var _=b,w=x,T=!1;3===b.rank&&(T=!0,_=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]),w=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),E(4===w.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+w.rank+"."}),E(4===_.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+_.rank+"."});var A=zn(_.shape,v,m,g,y),k=S.runKernelFunc(function(I){return I.avgPoolBackprop(w,_,A)},{dy4D:w,input4D:_});return T?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}(d,s,n,e,t,o)}}},"AvgPool",c);return h=h.cast(i.dtype),u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}var Ze=R({maxPool_:function(r,n,e,t,o){return Kc(r,n,e,1,t,o)}}),Fr=R({avgPool_:function(r,n,e,t,o){return Jc(r,n,e,1,t,o)}}),Rv=R({pool_:function(r,n,e,t,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===t&&(t="valid");var i=C(r,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),E(ot(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var c,w,T,A,k,h=zn(s.shape,n,a,o,t),d=[h.dilationHeight,h.dilationWidth];c="same"===t?(w=d,T=[h.filterHeight,h.filterWidth].map(function(I,D){return I+(I-1)*(w[D]-1)}).map(function(I){return I-1}),A=T.map(function(I){return Math.floor(I/2)}),k=T.map(function(I,D){return I-A[D]}),T.map(function(I,D){return[A[D],k[D]]})):[[0,0],[0,0]];var f=1===d[0]&&1===d[1],p=function(_,w,T){var A=T.map(function(B){return B[0]}),k=T.map(function(B){return B[1]}),I=_.concat(A,k),D=w.map(function(B,L){return(B-I[L]%B)%B}),N=k.map(function(B,L){return B+D[L]});return[w.map(function(B,L){return[A[L],N[L]]}),w.map(function(B,L){return[0,D[L]]})]}([h.inHeight,h.inWidth],d,c),m=p[1],g=f?t:"valid",y=f?s:yu(s,d,p[0]),x=("avg"===e?function(){return Jc(y,n,a,1,g)}:function(){return Kc(y,n,a,1,g)})(),b=f?x:vu(x,d,m);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),Pv=R({maxPool3d_:function(r,n,e,t,o,a,i){void 0===a&&(a="NDHWC");var s=C(r,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),E(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),E("NDHWC"===a,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),E(ot(e,i),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),null!=o&&E(Ae(t),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+t+"."});var h=Ir(u.shape,n,e,i,t,o,a),d=S.runKernelFunc(function(f,p){var v=f.maxPool3d(u,h);return p([u,v]),v},{x:u},function(f,p){var v=p[0],m=p[1];return{x:function(){return function(g,y,x,b,_,w,T,A){var k=C(g,"dy","maxPool3dBackprop"),I=C(y,"input","maxPool3dBackprop"),D=C(x,"output","maxPool3dBackprop"),N=k,P=I,W=D,B=!1;4===I.rank&&(B=!0,N=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3]),P=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),W=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3])),E(5===N.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."}),E(5===P.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+P.rank+"."}),E(5===W.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+W.rank+"."}),null==w&&(w=[1,1,1]),E(ot(_,w),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+w+"'"}),null!=A&&E(Ae(T),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+A+" but got pad "+T+"."});var L=Ir(P.shape,b,_,w,T,A),q=S.runKernelFunc(function(V){return V.maxPool3dBackprop(N,P,W,L)},{dy5D:N,input5D:P});return B?q.as4D(q.shape[1],q.shape[2],q.shape[3],q.shape[4]):q}(f,v,m,n,e,i,t,o)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Nv=R({avgPool3d_:function(r,n,e,t,o,a,i){void 0===a&&(a="NDHWC");var s=C(r,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),E(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),E("NDHWC"===a,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),E(ot(e,i),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),null!=o&&E(Ae(t),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+t+"."});var h=Ir(u.shape,n,e,i,t,o,a),d=S.runKernelFunc(function(f){return f.avgPool3d(u,h)},{x:u},function(f){return{x:function(){return function(p,v,m,g,y,x,b){var _=C(p,"dy","avgPool3dBackprop"),w=C(v,"input","avgPool3dBackprop"),T=_,A=w,k=!1;4===w.rank&&(k=!0,T=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]),A=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3])),E(5===T.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+T.rank+"."}),E(5===A.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+A.rank+"."}),null==y&&(y=[1,1,1]),E(ot(g,y),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+y+"'"}),null!=b&&E(Ae(x),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+b+" but got pad "+x+"."});var I=Ir(A.shape,m,g,y,x,b),D=S.runKernelFunc(function(N){return N.avgPool3dBackprop(T,A,I)},{dy5D:T,input5D:A});return k?D.as4D(D.shape[1],D.shape[2],D.shape[3],D.shape[4]):D}(f,u,n,e,i,t,o)}}});return d=d.cast(u.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Ft=R({slice_:function(r,n,e){var t,o,a=C(r,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(t="number"==typeof n?[n].concat(new Array(a.rank-1).fill(0)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(0)):n.slice()).forEach(function(u){E(-1!==u,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==e?new Array(a.rank).fill(-1):"number"==typeof e?[e].concat(new Array(a.rank-1).fill(-1)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(-1)):e).map(function(u,c){return u>=0?u:(E(-1===u,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),a.shape[c]-t[c])}),Tu(a,t,o);var i=a.shape;return S.runKernelFunc(function(u){return u.slice(a,t,o)},{x:a},function(u){for(var c=[],h=0;h<u.rank;h++)c.push([t[h],i[h]-t[h]-o[h]]);return{x:function(){return u.pad(c)}}},"Slice",{begin:t,size:o})}}),Fv=R({slice1d_:function(r,n,e){var t=C(r,"x","slice1d");return E(1===t.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+t.rank+" tensor"}),Ft(t,[n],[e])}}),Mv=R({slice2d_:function(r,n,e){var t=C(r,"x","slice2d");return E(2===t.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+t.rank+" tensor"}),Ft(t,n,e)}}),Yc=R({slice3d_:function(r,n,e){var t=C(r,"x","slice3d");return E(3===t.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+t.rank+" tensor"}),Ft(t,n,e)}}),Ov=R({slice4d_:function(r,n,e){var t=C(r,"x","slice4d");return E(4===t.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+t.rank+" tensor"}),Ft(t,n,e)}});function Xc(r,n,e,t,o){return n.rank<e.rank&&(n=n.reshape(rt(n.shape,t))),r.rank<e.rank&&(r=r.reshape(rt(r.shape,t))),{x:function(){var a=r.mul(e.equal(n).cast(r.dtype));return null==o?a:a.transpose(o)}}}var Bv=R({all_:function(r,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var t=C(r,"x","all","bool"),o=Be(n,t.shape),a=o,i=Ct(a,t.rank);null!=i&&(t=t.transpose(i),a=Tt(a.length,t.rank));var s=S.runKernelFunc(function(c){return c.all(t,a)},{$x:t});if(e){var u=rt(s.shape,o);return s.reshape(u)}return s}}),Lv=R({any_:function(r,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var t=C(r,"x","any","bool"),o=Be(n,t.shape),a=o,i=Ct(a,t.rank);null!=i&&(t=t.transpose(i),a=Tt(a.length,t.rank));var s=S.runKernelFunc(function(c){return c.any(t,a)},{$x:t});if(e){var u=rt(s.shape,o);return s.reshape(u)}return s}}),Wv=R({argMax_:function(r,n){void 0===n&&(n=0);var e=C(r,"x","argMax");null==n&&(n=0);var t=Be(n,e.shape),o=Ct(t,e.rank);return null!=o&&(e=e.transpose(o),t=Tt(t.length,e.rank)),S.runKernelFunc(function(s,u){var c=s.argMax(e,t[0]);return u([e]),c},{x:e},function(s,u){var c=u[0];return{x:function(){return ye(c)}}},"ArgMax",{axis:t[0]},[e])}}),Uv=R({argMin_:function(r,n){void 0===n&&(n=0);var e=C(r,"x","argMin");null==n&&(n=0);var t=Be(n,e.shape),o=Ct(t,e.rank);return null!=o&&(e=e.transpose(o),t=Tt(t.length,e.rank)),S.runKernelFunc(function(a,i){var s=a.argMin(e,t[0]);return i([e]),s},{$x:e},function(a,i){var s=i[0];return{$x:function(){return ye(s)}}})}}),Vv=R({logSumExp_:function(r,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var t=C(r,"x","logSumExp"),o=Be(n,t.shape),a=t.max(o,!0),i=t.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(e){var u=rt(s.shape,o);return s.reshape(u)}return s}}),ko=R({max_:function(r,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var t=C(r,"x","max"),o=t,a=Be(n,t.shape),i=a,s=Ct(i,t.rank);null!=s&&(t=t.transpose(s),i=Tt(i.length,t.rank));var c=S.runKernelFunc(function(d,f){var p=d.max(t,i);return f([o,p]),p},{x:t},function(d,f){return Xc(d,f[1],f[0],a,s)},"Max",{axes:i},[t],[!0]);if(e){var h=rt(c.shape,a);c=c.reshape(h)}return c}}),Gv=R({mean_:function(r,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var t=C(r,"x","mean"),o=Be(n,t.shape),a=$(Je(t.shape,o)[1]);return ho(function(i){var s=Z(a);return{value:(s.dtype===i.dtype?i:i.cast(s.dtype)).div(s).sum(n,e),gradFunc:function(u){var c=i.shape.slice();return o.forEach(function(h){c[h]=1}),u.reshape(c).mul(Gn(i.shape,"float32")).div(a)}}})(t)}}),qv=R({min_:function(r,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var t=C(r,"x","min"),o=t,a=Be(n,t.shape),i=a,s=Ct(i,t.rank);null!=s&&(t=t.transpose(s),i=Tt(i.length,t.rank));var c=S.runKernelFunc(function(d,f){var p=d.min(t,i);return f([o,p]),p},{x:t},function(d,f){return Xc(d,f[1],f[0],a,s)},"Min",{axes:i},[t],[!0]);if(e){var h=rt(c.shape,a);c=c.reshape(h)}return c}}),zv=R({moments_:function(r,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var t=Be(n,(r=C(r,"x","moments")).shape),o=r.mean(t,e),a=o.shape;e||(a=rt(o.shape,t));var i=r.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(t,e)}}}),Qc=R({sum_:function(r,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var t=C(r,"x","sum");"bool"===t.dtype&&(t=t.toInt());var o=Be(n,t.shape);return ho(function(a){var i=Ct(o,a.rank),s=o,u=a;null!=i&&(u=a.transpose(i),s=Tt(s.length,a.rank));var c=function(p){var v=a.shape.slice();return o.forEach(function(m){v[m]=1}),p.reshape(v).mul(Gn(a.shape,"float32"))},d=S.runKernelFunc(function(p){return p.sum(u,s)},{x:u},function(p){return{x:function(){return c(p)}}},"Sum",{axes:s});if(e){var f=rt(d.shape,o);d=d.reshape(f)}return{value:d,gradFunc:c}})(t)}}),Hv=R({prod_:function(r,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var t=C(r,"x","prod");"bool"===t.dtype&&(t=t.toInt());var o=Be(n,t.shape),a=Ct(o,t.rank),i=o,s=t;null!=a&&(s=t.transpose(a),i=Tt(i.length,t.rank));var u=S.runKernelFunc(function(h){return h.prod(s,i)},{permutedX:s});if(e){var c=rt(u.shape,o);u=u.reshape(c)}return u}}),$c=R({elu_:function(r){var n=C(r,"x","elu");return S.runKernelFunc(function(e,t){var o=e.elu(n);return t([o]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){return S.runKernelFunc(function(a){return a.eluDer(e,o)},{dy:e,y:o})}}})}}),Zv=R({leakyRelu_:function(r,n){void 0===n&&(n=.2);var e=C(r,"x","leakyRelu");return Ka(Z(n).mul(e),e)}}),el=R({prelu_:function(r,n){var e=C(r,"x","prelu"),t=C(n,"alpha","prelu");return S.runKernelFunc(function(o,a){var i=o.prelu(e,t);return a([e,t]),i},{x:e,alpha:t},function(o,a){var i=a[0],s=a[1],u=i.greater(0);return{x:function(){return Sn(u,o,o.mul(s))},alpha:function(){var c=Sn(u,ye(o),o.mul(i)),h=We(s.shape,o.shape);return h.length>0&&(c=c.sum(h)),c.reshape(s.shape)}}},"Prelu")}}),Se=R({relu_:function(r){var n=C(r,"x","relu");return"bool"===n.dtype?n.toInt():S.runKernelFunc(function(e,t){var o=e.relu(n);return t([n]),o},{x:n},function(e,t){var o=t[0];return{x:function(){return e.mulStrict(o.step().toFloat())}}},"Relu")}}),tl=R({relu6_:function(r){var n=C(r,"x","relu6");return"bool"===n.dtype?n.toInt():S.runKernelFunc(function(e,t){var o=e.relu6(n);return t([n]),o},{x:n},function(e,t){var o=t[0],a=o.lessEqual(6).mul(o.step());return{x:function(){return e.mulStrict(a.toFloat())}}},"Relu6")}}),jv=R({selu_:function(r){var n=C(r,"x","selu");return S.runKernelFunc(function(e,t){var o=e.selu(n);return t([n]),o},{$x:n},function(e,t){var o=t[0];return{$x:function(){var a=o.greater(Z(0)),i=Z(za),s=Z(Ha),u=e.mul(s),c=e.mul(i).mul(o.toFloat().exp());return Sn(a,u,c)}}})}}),hn=R({transpose_:function(r,n){var e=C(r,"x","transpose");return null==n&&(n=e.shape.map(function(o,a){return a}).reverse()),E(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+n+"."}),n.forEach(function(o){E(o>=0&&o<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+n})}),e.rank<=1?e.clone():S.runKernelFunc(function(o){return o.transpose(e,n)},{x:e},function(o){var a=ro(n);return{x:function(){return o.transpose(a)}}},"Transpose",{perm:n})}}),Kv=R({localResponseNormalization_:function(r,n,e,t,o){void 0===n&&(n=5),void 0===e&&(e=1),void 0===t&&(t=1),void 0===o&&(o=.5);var a=C(r,"x","localResponseNormalization");E(4===a.rank||3===a.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."}),E(Ae(n),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."});var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=S.runKernelFunc(function(c,h){var d=c.localResponseNormalization4D(i,n,e,t,o);return h([i,d]),d},{x4D:i},function(c,h){var d=h[0],f=h[1];return{x4D:function(){return S.runKernelFunc(function(p){return p.LRNGrad(c,d,f,n,e,t,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),nl=R({norm_:function(r,n,e,t){void 0===n&&(n="euclidean"),void 0===e&&(e=null),void 0===t&&(t=!1);var o=function s(u,c,h){if(void 0===h&&(h=null),0===u.rank)return u.abs();if(1!==u.rank&&null===h)return s(u.reshape([-1]),c,h);if(1===u.rank||"number"==typeof h||Array.isArray(h)&&1===h.length){if(1===c)return u.abs().sum(h);if(c===1/0)return u.abs().max(h);if(c===-1/0)return u.abs().min(h);if("euclidean"===c||2===c)return u.abs().pow(Z(2,"int32")).sum(h).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(h)&&2===h.length){if(1===c)return u.abs().sum(h[0]).max(h[1]-1);if(c===1/0)return u.abs().sum(h[1]).max(h[0]);if(c===-1/0)return u.abs().sum(h[1]).min(h[0]);if("fro"===c||"euclidean"===c)return u.square().sum(h).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+h)}(r=C(r,"x","norm"),n,e),a=o.shape;if(t){var i=Be(e,r.shape);a=rt(o.shape,i)}return o.reshape(a)}}),Jv=R({basicLSTMCell_:function(r,n,e,t,o,a){var i=C(r,"forgetBias","basicLSTMCell"),s=C(n,"lstmKernel","basicLSTMCell"),u=C(e,"lstmBias","basicLSTMCell"),c=C(t,"data","basicLSTMCell"),h=C(o,"c","basicLSTMCell"),d=C(a,"h","basicLSTMCell"),f=c.concat(d,1).matMul(s).add(u),v=f.shape[1]/4,m=[f.shape[0],v],g=f.slice([0,0],m),y=f.slice([0,v],m),x=f.slice([0,2*v],m),b=f.slice([0,3*v],m),_=g.sigmoid().mulStrict(y.tanh()).addStrict(h.mulStrict(i.add(x).sigmoid())),w=_.tanh().mulStrict(b.sigmoid());return[_,w]}}),Yv=R({multiRNNCell_:function(r,n,e,t){for(var o=C(n,"data","multiRNNCell"),a=Tr(e,"c","multiRNNCell"),i=Tr(t,"h","multiRNNCell"),s=o,u=[],c=0;c<r.length;c++){var h=r[c](s,a[c],i[c]);u.push(h[0]),u.push(h[1]),s=h[1]}var d=[],f=[];for(c=0;c<u.length;c+=2)d.push(u[c]),f.push(u[c+1]);return[d,f]}}),Xv=R({movingAverage_:function(r,n,e,t,o){void 0===o&&(o=!0);var a=C(r,"v","movingAverage"),i=C(n,"x","movingAverage"),s=C(e,"decay","movingAverage");Os(a,i),E(Oe(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=Z(1),c=u.sub(s),h=i.sub(a).mul(c);if(o){E(null!=t,function(){return"When using zeroDebias: true, step is required."});var d=C(t,"step","movingAverage");h=h.div(u.sub(Eo(s,d)))}return a.add(h)}}),Qv=R({stridedSlice_:function(r,n,e,t,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),null==t&&(t=new Array(n.length)),0!==i)throw new Error("ellipsis mask is not yet supported");var c=C(r,"x","stridedSlice"),h=Ia(s),d=c.shape.slice();h.forEach(function(g){n[g]=0,e[g]=1,d.splice(g,0,1)}),c=c.reshape(d);for(var f=0;f<c.rank;f++)n[f]=Eu(o,n,t,c.shape,f),e[f]=Iu(a,e,t,c.shape,f),t[f]=t[f]||1;var p=Ia(u);p.forEach(function(g){e[g]=n[g]+1,t[g]=1});var v=lo(n,e,t),m=v.filter(function(g,y){return-1===p.indexOf(y)});return t.every(function(g){return 1===g})?Ft(c,n,v).reshape(m):S.runKernelFunc(function(g){return g.stridedSlice(c,n,e,t)},{$x:c}).reshape(m)}}),$v=R({topk_:function(r,n,e){void 0===n&&(n=1),void 0===e&&(e=!0);var t=C(r,"x","topk");if(0===t.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=t.shape[t.shape.length-1];if(n>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+n);var a=S.runKernelFunc(function(i){return i.topk(t,n,e)},{$x:t});return{values:a[0],indices:a[1]}}}),em=R({scatterND_:function(r,n,e){var t=C(r,"indices","scatterND","int32"),o=C(n,"updates","scatterND");return Cu(o,t,e),S.runKernelFunc(function(a){return a.scatterND(t,o,e)},{indices:t,updates:o},null,"ScatterNd",{shape:e})}}),$a=R({fft_:function(r){E("complex64"===r.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var n=r.shape[r.shape.length-1],t=r.as2D(r.size/n,n);return S.runKernelFunc(function(o){return o.fft(t)},{input:r}).reshape(r.shape)}}),Ao=R({ifft_:function(r){E("complex64"===r.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var n=r.shape[r.shape.length-1],t=r.as2D(r.size/n,n);return S.runKernelFunc(function(o){return o.ifft(t)},{input:r}).reshape(r.shape)}}),ei=R({rfft_:function(r,n){E("float32"===r.dtype,function(){return"The dtype for rfft() must be real value but got "+r.dtype});var e,t=r.shape[r.shape.length-1],o=r.size/t;if(null!=n&&n<t){var a=r.shape.map(function(y){return 0}),i=r.shape.map(function(y){return y});i[r.shape.length-1]=n,e=r.slice(a,i),t=n}else if(null!=n&&n>t){var s=r.shape.map(function(y){return y});s[r.shape.length-1]=n-t,e=r.concat(De(s),r.shape.length-1),t=n}else e=r;var u=e.zerosLike(),c=Ye(e,u).as2D(o,t),h=$a(c),d=Math.floor(t/2)+1,f=gt(h),p=Pt(h),v=f.split([d,t-d],f.shape.length-1),m=p.split([d,t-d],p.shape.length-1),g=e.shape.slice();return g[e.shape.length-1]=d,Ye(v[0],m[0]).reshape(g)}}),rl=R({irfft_:function(r){var n=r.shape[r.shape.length-1],e=r.size/n;if(n<=2){var t=r.as2D(e,n),o=Ao(t);return gt(o)}var a=[e,2*(n-1)],i=gt(r).as2D(e,n),s=Pt(r).as2D(e,n),u=i.slice([0,1],[e,n-2]).reverse(1),c=s.slice([0,1],[e,n-2]).reverse(1).mul(Z(-1)),h=i.concat(u,1),d=s.concat(c,1);return t=Ye(h,d).as2D(a[0],a[1]),o=Ao(t),gt(o)}}),tm=Object.freeze({fft:$a,ifft:Ao,rfft:ei,irfft:rl}),nm=R({sparseToDense_:function(r,n,e,t){void 0===t&&(t=0);var o=C(r,"sparseIndices","sparseToDense","int32"),a=C(n,"sparseValues","sparseToDense"),i=C(t,"defaultValue","sparseToDense",a.dtype);return function(s,u,c,h){if("int32"!==s.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(c.length!==f)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+f+".");if(0!==u.rank&&(1!==u.rank||u.size!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==h.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,e,i),S.runKernelFunc(function(s){return s.sparseToDense(o,a,e,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),rm=R({gatherND_:function(r,n){var e=C(n,"indices","gatherND","int32"),t=C(r,"x","gatherND");return S.runKernelFunc(function(o){return o.gatherND(t,e)},{x:t,indices:e},null,"GatherNd")}}),om=R({diag_:function(r){var n=C(r,"x","diag").flatten(),e=r.shape.concat(r.shape);return S.runKernelFunc(function(t){return t.diag(n)},{$x:n}).reshape(e)}}),am=R({dropout_:function(r,n,e,t){var o=C(r,"x","dropout");if(E("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),E(n>=0&&n<1,function(){return"rate must be a float in the range [0, 1), but got "+n+"."}),0===n)return r instanceof Ee?o.clone():o;var a=function(u,c){if(null==c)return u.shape.slice();if(Oe(u.shape,c))return c;if(u.shape.length===c.length){for(var h=[],d=0;d<u.shape.length;d++)h.push(null==c[d]&&null!=u.shape[d]?u.shape[d]:c[d]);return h}return c}(o,e),i=1-n,s=gu(a,0,1,"float32",t).add(i).floor().div(i);return o.mul(s)}});function ol(r,n,e){for(var t=1-r%2,o=new Float32Array(r),a=0;a<r;++a){var i=2*Math.PI*a/(r+t-1);o[a]=n-e*Math.cos(i)}return Le(o,"float32")}var et,ti=R({hannWindow_:function(r){return ol(r,.5,.5)}}),al=R({hammingWindow_:function(r){return ol(r,.54,.46)}}),ni=R({frame_:function(r,n,e,t,o){void 0===t&&(t=!1),void 0===o&&(o=0);for(var a=0,i=[];a+n<=r.size;)i.push(Ft(r,a,n)),a+=e;if(t)for(;a<r.size;){var s=a+n-r.size,u=Ve([Ft(r,a,n-s),Nt([s],o)]);i.push(u),a+=e}return 0===i.length?cn([],[0,n]):Ve(i).as2D(i.length,n)}}),il=R({stft_:function(r,n,e,t,o){void 0===o&&(o=ti),null==t&&(t=Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)))));for(var i=ni(r,n,e),s=$e(i,o(n)),u=[],c=0;c<i.shape[0];c++)u.push(ei(s.slice([c,0],[1,n]),t));return Ve(u)}}),im=Object.freeze({hannWindow:ti,hammingWindow:al,frame:ni,stft:il});!function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(et||(et={}));var um=R({absoluteDifference_:function(r,n,e,t){void 0===t&&(t=et.SUM_BY_NONZERO_WEIGHTS);var o=C(r,"labels","absoluteDifference"),a=C(n,"predictions","absoluteDifference"),i=null;null!=e&&(i=C(e,"weights","absoluteDifference")),ge(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return Jt(s,i,t)}}),Jt=R({computeWeightedLoss_:function(r,n,e){void 0===e&&(e=et.SUM_BY_NONZERO_WEIGHTS);var t=C(r,"losses","computeWeightedLoss"),o=null;null!=n&&(o=C(n,"weights","computeWeightedLoss"));var a=null==o?t:t.mul(o);if(e===et.NONE)return a;if(e===et.SUM)return a.sum();if(e===et.MEAN){if(null==o)return a.mean();var i=t.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(Z(i)):s}if(e===et.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(Z(t.size));var u=o.mul(Gn(t.shape)).notEqual(Z(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+e)}}),cm=R({cosineDistance_:function(r,n,e,t,o){void 0===o&&(o=et.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"labels","cosineDistance"),i=C(n,"predictions","cosineDistance"),s=null;null!=t&&(s=C(t,"weights","cosineDistance")),ge(a.shape,i.shape,"Error in cosineDistance: ");var u=Z(1).sub(a.mul(i).sum(e,!0));return Jt(u,s,o)}}),lm=R({hingeLoss_:function(r,n,e,t){void 0===t&&(t=et.SUM_BY_NONZERO_WEIGHTS);var o=C(r,"labels","hingeLoss"),a=C(n,"predictions","hingeLoss"),i=null;null!=e&&(i=C(e,"weights","hingeLoss")),ge(o.shape,a.shape,"Error in hingeLoss: ");var s=Z(1);o=Z(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return Jt(u,i,t)}}),hm=R({huberLoss_:function(r,n,e,t,o){void 0===t&&(t=1),void 0===o&&(o=et.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"labels","huberLoss"),i=C(n,"predictions","huberLoss"),s=null;null!=e&&(s=C(e,"weights","huberLoss")),ge(a.shape,i.shape,"Error in huberLoss: ");var u=Z(t),c=i.sub(a).abs(),h=Bc(c,u),d=c.sub(h),f=Z(.5).mul(h.square()).add(u.mul(d));return Jt(f,s,o)}}),dm=R({logLoss_:function(r,n,e,t,o){void 0===t&&(t=1e-7),void 0===o&&(o=et.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"labels","logLoss"),i=C(n,"predictions","logLoss"),s=null;null!=e&&(s=C(e,"weights","logLoss")),ge(a.shape,i.shape,"Error in logLoss: ");var u=Z(1),c=Z(t),h=a.mul(i.add(c).log()).neg().sub(u.sub(a).mul(u.sub(i).add(c).log()));return Jt(h,s,o)}}),fm=R({meanSquaredError_:function(r,n,e,t){void 0===t&&(t=et.SUM_BY_NONZERO_WEIGHTS);var o=C(r,"labels","meanSquaredError"),a=C(n,"predictions","meanSquaredError"),i=null;null!=e&&(i=C(e,"weights","meanSquaredError")),ge(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return Jt(s,i,t)}}),pm=R({sigmoidCrossEntropy_:function(r,n,e,t,o){void 0===t&&(t=0),void 0===o&&(o=et.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"multiClassLabels","sigmoidCrossEntropy"),i=C(n,"logits","sigmoidCrossEntropy"),s=null;if(null!=e&&(s=C(e,"weights","sigmoidCrossEntropy")),ge(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),t>0){var u=Z(t),c=Z(1),h=Z(.5);a=a.mul(c.sub(u)).add(h.mul(u))}var d=function(f,p){var v=C(f,"labels","sigmoidCrossEntropyWithLogits"),m=C(p,"logits","sigmoidCrossEntropyWithLogits");ge(v.shape,m.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=m.relu(),y=m.mul(v),x=m.abs().neg().exp().log1p();return g.sub(y).add(x)}(a,i);return Jt(d,s,o)}}),vm=R({softmaxCrossEntropy_:function(r,n,e,t,o){void 0===t&&(t=0),void 0===o&&(o=et.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"onehotLabels","softmaxCrossEntropy"),i=C(n,"logits","softmaxCrossEntropy"),s=null;if(null!=e&&(s=C(e,"weights","softmaxCrossEntropy")),ge(a.shape,i.shape,"Error in softmaxCrossEntropy: "),t>0){var u=Z(t),c=Z(1),h=Z(a.shape[1]);a=a.mul(c.sub(u)).add(u.div(h))}var d=function(f,p,v){if(void 0===v&&(v=-1),-1===v&&(v=p.rank-1),v!==p.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+p.rank+" and dim was "+v);return ho(function(m,g,y){var x=g.logSumExp([v],!0),b=g.toFloat().sub(x);return y([m,b]),{value:b.mul(m).neg().sum([v]),gradFunc:function(_,w){var T=w[0],A=w[1],k=rt(_.shape,[v]);return[_.reshape(k).mul(T.toFloat().sub(A.exp())),_.reshape(k).mul(A.exp().sub(T.toFloat()))]}}})(f,p)}(a,i);return Jt(d,s,o)}}),mm=Object.freeze({get Reduction(){return et},absoluteDifference:um,computeWeightedLoss:Jt,cosineDistance:cm,hingeLoss:lm,huberLoss:hm,logLoss:dm,meanSquaredError:fm,sigmoidCrossEntropy:pm,softmaxCrossEntropy:vm});function sl(r,n){return void 0===n&&(n=!1),S.tidy(function(){if(2!==r.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var e=r.shape[0],t=r.shape[1],o=mu(e),a=r.clone(),i=cn([[1]],[1,1]),s=i.clone(),u=e>=t?t:e,c=function(d){var f,p=a,v=s,m=o;f=S.tidy(function(){var g=a.slice([d,d],[e-d,1]),y=g.norm(),x=a.slice([d,d],[1,1]),b=cn([[-1]]).where(x.greater(0),cn([[1]])),_=x.sub(b.mul(y)),w=g.div(_);s=1===w.shape[0]?i.clone():i.concat(w.slice([1,0],[w.shape[0]-1,w.shape[1]]),0);var T=b.matMul(_).div(y).neg(),A=a.slice([d,0],[e-d,t]),k=T.mul(s);if(0===d)a=A.sub(k.matMul(s.transpose().matMul(A)));else{var I=A.sub(k.matMul(s.transpose().matMul(A)));a=a.slice([0,0],[d,t]).concat(I,0)}var D=o.slice([0,d],[e,o.shape[1]-d]);if(0===d)o=D.sub(D.matMul(s).matMul(k.transpose()));else{var N=D.sub(D.matMul(s).matMul(k.transpose()));o=o.slice([0,0],[e,d]).concat(N,1)}return[s,a,o]}),s=f[0],a=f[1],o=f[2],at([p,v,m])},h=0;h<u;++h)c(h);return!n&&e>t&&(o=o.slice([0,0],[e,t]),a=a.slice([0,0],[t,t])),[o,a]})}var gm=R({bandPart_:function(r,n,e){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var t=C(r,"a","bandPart");if(t.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+t.rank+".");var o=t.shape,a=t.shape.slice(-2),i=a[0],s=a[1];if(!(n<=i))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+i+").");if(!(e<=s))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+s+").");n<0&&(n=i),e<0&&(e=s);var u=oo(0,i,1,"int32").reshape([-1,1]),c=oo(0,s,1,"int32"),h=qe(u,c),d=To(h.lessEqual(Z(+n,"int32")),h.greaterEqual(Z(-e,"int32"))),f=De([i,s],t.dtype);return dt(Ge(t.reshape([-1,i,s])).map(function(p){return Sn(d,p,f)})).reshape(o)}}),ym=R({gramSchmidt_:function(r){var n;if(Array.isArray(r)){n=!1,E(null!=r&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=r[0].shape[0],t=function(u){E(r[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[u].shape[0]+" vs. "+e+")"})},o=1;o<r.length;++o)t(o)}else n=!0,r=_a(r,r.shape[0],0).map(function(u){return xu(u,[0])});E(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var a=[],i=r,s=function(u){a.push(S.tidy(function(){var c=i[u];if(u>0)for(var h=0;h<u;++h){var d=Qc(a[h].mulStrict(c)).mul(a[h]);c=c.sub(d)}return c.div(nl(c,"euclidean"))}))};for(o=0;o<r.length;++o)s(o);return n?dt(a,0):a}}),xm=R({qr_:function(r,n){if(void 0===n&&(n=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(2===r.rank)return sl(r,n);var e=r.shape.slice(0,r.shape.length-2).reduce(function(i,s){return i*s}),t=Ge(r.reshape([e,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),o=[],a=[];return t.forEach(function(i){var s=sl(i,n),c=s[1];o.push(s[0]),a.push(c)}),[dt(o,0).reshape(r.shape),dt(a,0).reshape(r.shape)]}}),bm=Object.freeze({bandPart:gm,gramSchmidt:ym,qr:xm});function So(r,n,e,t,o,a){null==t&&(t=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==a&&(a=0);var i=r.shape[0];return e=Math.min(e,i),E(0<=t&&t<=1,function(){return"iouThreshold must be in [0, 1], but was '"+t+"'"}),E(2===r.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),E(4===r.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),E(1===n.rank,function(){return"scores must be a 1D tensor"}),E(n.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+n.shape[0]}),E(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:e,iouThreshold:t,scoreThreshold:o,softNmsSigma:a}}var _m=R({resizeBilinear_:function(r,n,e){void 0===e&&(e=!1);var t=C(r,"images","resizeBilinear");E(3===t.rank||4===t.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+t.rank+"."}),E(2===n.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."});var o=t,a=!1;3===t.rank&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=n[0],s=n[1],u=S.runKernelFunc(function(c,h){return h([o]),c.resizeBilinear(o,i,s,e)},{x:o},function(c,h){return{x:function(){return S.runKernelFunc(function(d){return d.resizeBilinearBackprop(c,h[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:i,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),wm=R({resizeNearestNeighbor_:function(r,n,e){void 0===e&&(e=!1);var t=C(r,"images","resizeNearestNeighbor");E(3===t.rank||4===t.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+t.rank+"."}),E(2===n.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."}),E("float32"===t.dtype||"int32"===t.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=t,a=!1;3===t.rank&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=n[0],s=n[1],u=S.runKernelFunc(function(c,h){return h([o]),c.resizeNearestNeighbor(o,i,s,e)},{batchImages:o},function(c,h){return{batchImages:function(){return S.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(c,h[0],e)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Cm=R({nonMaxSuppression_:function(r,n,e,t,o){void 0===t&&(t=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=C(r,"boxes","nonMaxSuppression"),i=C(n,"scores","nonMaxSuppression"),s=So(a,i,e,t,o);return S.runKernelFunc(function(c){return c.nonMaxSuppression(a,i,e,t,o)},{boxes:a,scores:i},null,"NonMaxSuppressionV3",{maxOutputSize:e=s.maxOutputSize,iouThreshold:t=s.iouThreshold,scoreThreshold:o=s.scoreThreshold})}}),Em=R({nonMaxSuppressionWithScore_:function(r,n,e,t,o,a){void 0===t&&(t=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var i=C(r,"boxes","nonMaxSuppression"),s=C(n,"scores","nonMaxSuppression"),u=So(i,s,e,t,o,a),c={maxOutputSize:e=u.maxOutputSize,iouThreshold:t=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},h=S.runKernel("NonMaxSuppressionV5",{boxes:i,scores:s},c);return{selectedIndices:h[0],selectedScores:h[1]}}}),Dm=R({cropAndResize_:function(r,n,e,t,o,a){var i=C(r,"image","cropAndResize"),s=C(n,"boxes","cropAndResize","float32"),u=C(e,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var c=s.shape[0];return E(4===i.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),E(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),E(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),E(2===t.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+t.length+"."}),E(t[0]>=1&&t[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+t}),E("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),S.runKernelFunc(function(h,d){return h.cropAndResize(i,s,u,t,o,a)},{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:t})}}),ri=Object.freeze({resizeBilinear:_m,resizeNearestNeighbor:wm,nonMaxSuppression:Cm,nonMaxSuppressionAsync:function(r,n,e,t,o){return void 0===t&&(t=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),X(this,void 0,void 0,function(){var a,i,s,u,d;return Q(this,function(f){switch(f.label){case 0:return a=C(r,"boxes","nonMaxSuppressionAsync"),i=C(n,"scores","nonMaxSuppressionAsync"),s=So(a,i,e,t,o),e=s.maxOutputSize,t=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([a.data(),i.data()])];case 1:return u=f.sent(),d=Fa(u[0],u[1],e,t,o),a!==r&&a.dispose(),i!==n&&i.dispose(),[2,d]}})})},nonMaxSuppressionWithScore:Em,nonMaxSuppressionWithScoreAsync:function(r,n,e,t,o,a){return void 0===t&&(t=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),X(this,void 0,void 0,function(){var i,s,u,c,f;return Q(this,function(p){switch(p.label){case 0:return i=C(r,"boxes","nonMaxSuppressionAsync"),s=C(n,"scores","nonMaxSuppressionAsync"),u=So(i,s,e,t,o,a),e=u.maxOutputSize,t=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([i.data(),s.data()])];case 1:return c=p.sent(),f=Ma(c[0],c[1],e,t,o,a),i!==r&&i.dispose(),s!==n&&s.dispose(),[2,f]}})})},cropAndResize:Dm}),oi=function(r,n){return!(r>0)||"linear"===n},ai=function(r,n,e){if(null==e||"linear"===e)return r;if("relu"===e)return r.mul(n.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},ii=function(r,n){var e=n,t=We(r.shape,n.shape);return t.length>0&&(e=e.sum(t)),e.reshape(r.shape)},si=function(r,n,e){if("linear"===n)return r;if("relu"===n)return Se(r);if("elu"===n)return $c(r);if("relu6"===n)return tl(r);if("prelu"===n)return el(r,e);throw new Error("Unknown fused activation "+n+".")},km=R({fusedMatMul_:function(r){var n,e=r.a,t=r.b,o=r.transposeA,a=void 0!==o&&o,i=r.transposeB,s=void 0!==i&&i,u=r.bias,c=r.activation,h=void 0===c?"linear":c,d=r.preluActivationWeights;if(!1===oi(S.state.gradientDepth,h)){var f=Do(e,t,a,s);return null!=u&&(f=fe(f,u)),si(f,h,d)}var p=C(e,"a","fused matMul"),v=C(t,"b","fused matMul");n=ke(p,v),p=n[0],v=n[1];var m=a?p.shape[p.rank-2]:p.shape[p.rank-1],g=s?v.shape[v.rank-1]:v.shape[v.rank-2],y=a?p.shape[p.rank-1]:p.shape[p.rank-2],x=s?v.shape[v.rank-2]:v.shape[v.rank-1],b=p.shape.slice(0,-2),_=v.shape.slice(0,-2),w=$(b),T=$(_);E(p.rank>=2&&v.rank>=2&&p.rank===v.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+v.rank+"."}),E(Oe(b,_),function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+_+") of Tensors with shapes "+p.shape+" and "+v.shape+" must match."}),E(m===g,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+p.shape+" and "+v.shape+" and transposeA="+a+" and transposeB="+s+" must match."});var A,k,I=p.shape.slice(0,-2).concat([y,x]),D=a?p.as3D(w,m,y):p.as3D(w,y,m),N=s?v.as3D(T,x,g):v.as3D(T,g,x);null!=u&&de(I,(A=ke(A=C(u,"bias","fused matMul"),p)[0]).shape),null!=d&&(k=C(d,"prelu weights","fused matMul"));var P={a:D,b:N};return null!=u&&(P.bias=A),null!=d&&(P.preluActivationWeights=k),S.runKernelFunc(function(B,L){var q=B.fusedBatchMatMul({a:D,b:N,transposeA:a,transposeB:s,bias:A,activation:h,preluActivationWeights:k});return L([D,N,q]),q},P,function(B,L){var q=L[0],V=L[1],z=ai(B,L[2],h),H={};return null!=u&&(H={bias:function(){return ii(A,z)}}),Object.assign(a||s?!a&&s?{a:function(){return z.matMul(V,!1,!1)},b:function(){return z.matMul(q,!0,!1)}}:a&&!s?{a:function(){return V.matMul(z,!1,!0)},b:function(){return q.matMul(z,!1,!1)}}:{a:function(){return V.matMul(z,!0,!0)},b:function(){return z.matMul(q,!0,!0)}}:{a:function(){return z.matMul(V,!1,!0)},b:function(){return q.matMul(z,!0,!1)}},H)},"_FusedMatMul",{transposeA:a,transposeB:s,activation:h},[D,N],[!0]).reshape(I)}}),Am=R({fusedConv2d_:function(r){var n=r.x,e=r.filter,t=r.strides,o=r.pad,a=r.dataFormat,i=void 0===a?"NHWC":a,s=r.dilations,u=void 0===s?[1,1]:s,c=r.dimRoundingMode,h=r.bias,d=r.activation,f=void 0===d?"linear":d,p=r.preluActivationWeights;if(!1===oi(S.state.gradientDepth,f=f||"linear")){var v=xt(n,e,t,o,i,u,c);return null!=h&&(v=fe(v,h)),si(v,f,p)}var m=C(n,"x","conv2d"),g=C(e,"filter","conv2d"),y=m,x=!1;3===m.rank&&(x=!0,y=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),E(4===y.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+y.rank+"."}),E(4===g.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),null!=c&&E(Ae(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."}),E(y.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+y.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),E(ot(t,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+u+"'"}),E("NHWC"===i,function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var b,_,w=ln(y.shape,g.shape,t,u,o,c);null!=h&&(b=ke(b=C(h,"bias","fused conv2d"),m)[0],de(w.outShape,b.shape)),null!=p&&(_=C(p,"prelu weights","fused conv2d"));var T={x:y,filter:g};null!=h&&(T.bias=b),null!=p&&(T.preluActivationWeights=_);var k=S.runKernelFunc(function(I,D){var N=I.fusedConv2d({input:y,filter:g,convInfo:w,bias:b,activation:f,preluActivationWeights:_});return D([g,y,N]),N},T,function(I,D){var P=D[0],W=D[1],L=ai(I,D[2],f);E(Dn(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var q={};return null!=h&&(q={bias:function(){return ii(b,L)}}),Object.assign({x:function(){return Hc(W.shape,L,P,t,o)},filter:function(){return Xa(W,L,P.shape,t,o)}},q)},"FusedConv2D",{convInfo:w,activation:f},[g,y],[!0]);return x?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),Sm=R({fusedDepthwiseConv2d_:function(r){var n=r.x,e=r.filter,t=r.strides,o=r.pad,a=r.dataFormat,i=void 0===a?"NHWC":a,s=r.dilations,u=void 0===s?[1,1]:s,c=r.dimRoundingMode,h=r.bias,d=r.activation,f=void 0===d?"linear":d,p=r.preluActivationWeights;if(!1===oi(S.state.gradientDepth,f)){var v=Io(n,e,t,o,i,u,c);return null!=h&&(v=fe(v,h)),si(v,f,p)}var m=C(n,"x","depthwiseConv2d"),g=C(e,"filter","depthwiseConv2d"),y=m,x=!1;3===m.rank&&(x=!0,y=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),E(4===y.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+y.rank+"."}),E(4===g.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),E(y.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+y.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),null==u&&(u=[1,1]),E(ot(t,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+u+"'"}),null!=c&&E(Ae(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."});var b,_,w=ln(y.shape,g.shape,t,u,o,c,!0);null!=h&&(b=ke(b=C(h,"bias","fused conv2d"),m)[0],de(w.outShape,b.shape)),null!=p&&(_=C(p,"prelu weights","fused depthwiseConv2d"));var T={x:y,filter:g};null!=h&&(T.bias=b),null!=p&&(T.preluActivationWeights=_);var k=S.runKernelFunc(function(I,D){var N=I.fusedDepthwiseConv2D({input:y,filter:g,convInfo:w,bias:b,activation:f,preluActivationWeights:_});return D([g,y,N]),N},T,function(I,D){E(Dn(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var N=D[0],P=D[1],B=ai(I,D[2],f),L={};return null!=h&&(L={bias:function(){return ii(b,B)}}),Object.assign({x:function(){return Zc(P.shape,B,N,w)},filter:function(){return jc(P,B,N.shape,w)}},L)},"FusedDepthwiseConv2D",{convInfo:w,activation:f},[g,y],[!0]);return x?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),Rm=Object.freeze({matMul:km,conv2d:Am,depthwiseConv2d:Sm}),Pm=Object.freeze({image:ri,linalg:bm,losses:mm,spectral:tm,fused:Rm,signal:im,square:dp,squaredDifference:Dc,conv1d:_v,conv2d:xt,conv3d:wv,depthwiseConv2d:Io,separableConv2d:Qa,conv2dTranspose:Cv,conv3dTranspose:Tv,op:R,batchNormalization2d:Gp,batchNormalization3d:qp,batchNormalization4d:zp,batchNormalization:Hp,batchNorm:Nc,batchNorm2d:Zp,batchNorm3d:jp,batchNorm4d:Kp,booleanMaskAsync:function(r,n,e){return X(this,void 0,void 0,function(){var t,o,a,i,s,u,c,h,d,f,p,v,m;return Q(this,function(g){switch(g.label){case 0:for(t=C(r,"tensor","boolMask"),o=C(n,"mask","boolMask","bool"),a=null==e?0:e,s=t.shape,E((i=o.rank)>0,function(){return"mask cannot be scalar"}),ge(s.slice(a,a+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=a;c<a+i;c++)u*=s[c];return h=s.slice(0,a).concat([u],s.slice(a+i)),d=t.reshape(h),f=o.reshape([-1]),[4,Mc(f)];case 1:return p=g.sent(),v=p.squeeze([1]),m=Ja(d,v,a),r!==t&&t.dispose(),n!==o&&o.dispose(),v.dispose(),d.dispose(),f.dispose(),p.dispose(),[2,m]}})})},complex:Ye,real:gt,imag:Pt,concat:Ve,concat1d:Qh,concat2d:$h,concat3d:ed,concat4d:td,split:_a,matMul:Do,dot:Ev,outerProduct:Iv,reverse:Nr,reverse1d:Dv,reverse2d:kv,reverse3d:Av,reverse4d:Sv,maxPool:Ze,avgPool:Fr,pool:Rv,maxPool3d:Pv,avgPool3d:Nv,slice:Ft,slice1d:Fv,slice2d:Mv,slice3d:Yc,slice4d:Ov,abs:fp,acos:pp,acosh:vp,asin:mp,asinh:gp,atan:yp,atanh:xp,ceil:bp,clipByValue:Za,cos:_p,cosh:wp,erf:Cp,exp:ja,expm1:Tp,floor:Ep,log:Ip,log1p:Dp,logSigmoid:kp,neg:_o,reciprocal:Ap,round:Sp,rsqrt:kc,sigmoid:Ac,sign:Rp,isNaN:Pp,isInf:Np,isFinite:Fp,sin:Mp,sinh:Op,softplus:Bp,sqrt:Lp,step:Wp,tan:Up,tanh:Vp,all:Bv,any:Lv,argMax:Wv,argMin:Uv,logSumExp:Vv,max:ko,mean:Gv,min:qv,moments:zv,sum:Qc,prod:Hv,equal:Lc,equalStrict:lv,greater:hv,greaterEqual:Wc,greaterEqualStrict:dv,greaterStrict:fv,less:pv,lessEqual:vv,lessEqualStrict:mv,lessStrict:gv,notEqual:yv,notEqualStrict:xv,add:fe,addN:Xp,addStrict:Qp,atan2:$p,div:Dt,divNoNan:ev,divStrict:tv,floorDiv:Oc,maximum:Ka,maximumStrict:nv,minimum:Bc,minimumStrict:rv,mod:ov,modStrict:av,mul:$e,mulStrict:iv,pow:Eo,powStrict:sv,squaredDifferenceStrict:uv,sub:qe,subStrict:cv,elu:$c,leakyRelu:Zv,prelu:el,relu:Se,relu6:tl,selu:jv,logicalAnd:To,logicalNot:Jp,logicalOr:Fc,logicalXor:Yp,where:Sn,whereAsync:Mc,buffer:se,print:function ld(r,n){void 0===n&&(n=!1),console.log(r.toString(n))},batchToSpaceND:vu,broadcastTo:hd,cast:dd,clone:fd,cumsum:pd,depthToSpace:vd,expandDims:yt,eye:mu,multinomial:md,oneHot:Ca,pad:In,pad1d:gd,pad2d:yd,pad3d:xd,pad4d:bd,rand:_d,randomNormal:wd,randomGamma:Cd,randomUniform:gu,reshape:Et,spaceToBatchND:yu,squeeze:xu,stack:dt,tile:qn,truncatedNormal:Td,unstack:Ge,setdiff1dAsync:function(r,n){return X(this,void 0,void 0,function(){var e,t,o,a,i,s,u,c,h,d;return Q(this,function(f){switch(f.label){case 0:return e=C(r,"x","setdiff1d"),t=C(n,"y","setdiff1d"),E(e.dtype===t.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+t.dtype+")."}),E(1===e.rank,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),E(1===t.rank,function(){return"y should be 1D tensor, but got y ("+t.shape+")."}),[4,e.data()];case 1:return o=f.sent(),[4,t.data()];case 2:for(a=f.sent(),i=new Set(a),s=0,h=0;h<o.length;h++)i.has(o[h])||s++;for(u=new vr([s],e.dtype),c=new vr([s],"int32"),h=0,d=0;h<o.length;h++)i.has(o[h])||(u.values[d]=o[h],c.values[d]=h,d++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:Nt,linspace:function Xh(r,n,e){if(e<=0)throw new Error("The number of values should be positive.");return S.runKernelFunc(function(t){return t.linspace(r,n,e)},{})},ones:Gn,range:oo,scalar:Z,tensor:Xe,tensor1d:Le,tensor2d:cn,tensor3d:ba,tensor4d:st,tensor5d:function Kh(r,n,e){if(bn(r),null!=n&&5!==n.length)throw new Error("tensor5d() requires shape to have five numbers");var t=Rt(r,e);if(5!==t.length&&1!==t.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===t.length&&null==n)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return un(r,n,t,e)},tensor6d:function Jh(r,n,e){if(bn(r),null!=n&&6!==n.length)throw new Error("tensor6d() requires shape to have six numbers");var t=Rt(r,e);if(6!==t.length&&1!==t.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===t.length&&null==n)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return un(r,n=n||t,t,e)},variable:function Yh(r,n,e,t){return void 0===n&&(n=!0),S.makeVariable(r,n,e,t)},zeros:De,onesLike:pu,zerosLike:ye,transpose:hn,softmax:Zt,logSoftmax:Dd,localResponseNormalization:Kv,norm:nl,gather:Ja,unsortedSegmentSum:Gc,basicLSTMCell:Jv,multiRNNCell:Yv,movingAverage:Xv,stridedSlice:Qv,topk:$v,scatterND:em,fft:$a,ifft:Ao,rfft:ei,irfft:rl,sparseToDense:nm,gatherND:rm,diag:om,dropout:am,hannWindow:ti,hammingWindow:al,frame:ni,stft:il,inTopKAsync:function(r,n,e){return void 0===e&&(e=1),X(this,void 0,void 0,function(){var t,o,a,i,s,u,c,h,d,f,p,v,m,g;return Q(this,function(y){switch(y.label){case 0:return t=C(r,"predictions","inTopK"),o=C(n,"targets","inTopK"),E(t.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+t.rank}),E(t.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+t.rank+" and targets rank "+o.rank}),ge(t.shape.slice(0,t.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=t.shape[t.shape.length-1],E(e>0&&e<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+e}),[4,t.data()];case 1:return i=y.sent(),[4,o.data()];case 2:for(s=y.sent(),h=(u=[i.length/a,a])[1],d=Ln("bool",c=u[0]),f=0;f<c;f++){for(v=i.subarray(p=f*h,p+h),m=[],g=0;g<v.length;g++)m.push({value:v[g],index:g});for(m.sort(function(x,b){return b.value-x.value}),d[f]=0,g=0;g<e;g++)if(m[g].index===s[f]){d[f]=1;break}}return r!==t&&t.dispose(),n!==o&&o.dispose(),[2,Xe(d,o.shape,"bool")]}})})}});function G(r,n){Array.isArray(r)||(r=[r]),r.forEach(function(e){null!=e&&E("complex64"!==e.dtype,function(){return n+" does not support complex64 tensors."})})}function ui(r,n,e,t){if("linear"===e)return r.linear(n);if("relu"===e)return r.relu(n);if("elu"===e)return r.elu(n);if("relu6"===e)return r.relu6(n);if("prelu"===e)return r.prelu(n,t);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var Nm=function(r){function n(){var e=r.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new Du(e,S),e}return bt(n,r),n.prototype.write=function(e,t,o){this.firstUse&&(this.firstUse=!1,O().get("IS_NODE")&&no("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var a={};return this.data.set(a,{values:e,dtype:o}),a},n.prototype.move=function(e,t,o,a){this.data.set(e,{values:t,dtype:a})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(e){return X(this,void 0,void 0,function(){return Q(this,function(t){return[2,this.readSync(e)]})})},n.prototype.readSync=function(e){var t=this.data.get(e),a=t.complexTensors;return"complex64"===t.dtype?Na(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.data.get(e).values},n.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),o=t;if("string"===e.dtype)try{o=t.map(function(a){return hr(a)})}catch(a){throw new Error("Failed to decode encoded string bytes into utf-8")}return se(e.shape,e.dtype,o)},n.prototype.makeOutput=function(e,t,o){var a=this.write(e,t,o);return S.makeTensorFromDataId(a,t,o,this)},n.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},n.prototype.time=function(e){return X(this,void 0,void 0,function(){var t;return Q(this,function(o){return t=wt(),e(),[2,{kernelMs:wt()-t}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(e,t){var o=this.makeOutput(null,e.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:S.keep(e.clone()),imag:S.keep(t.clone())},o},n.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,t,o){if(G(e,"slice"),Da(e.shape,t,o)){var a=ka(t,e.strides),i=$(o);return Xe(this.readSync(e.dataId).subarray(a,a+i),o,e.dtype)}for(var s=se(o,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var h=s.indexToLoc(c).map(function(d,f){return d+t[f]});s.values[c]=u.get.apply(u,h)}return s.toTensor()},n.prototype.stridedSlice=function(e,t,o,a){G(e,"stridedSlice");var i=lo(t,o,a);if(i.some(function(p){return 0===p}))return Xe([],i);for(var s=se(i,e.dtype),u=this.bufferSync(e),c=0;c<s.size;c++){for(var h=s.indexToLoc(c),d=new Array(h.length),f=0;f<d.length;f++)d[f]=h[f]*a[f]+t[f];s.set.apply(s,[u.get.apply(u,d)].concat(h))}return s.toTensor()},n.prototype.diag=function(e){for(var t=this.readSync(e.dataId),o=se([e.size,e.size],e.dtype),a=o.values,i=0;i<t.length;i++)a[i*e.size+i]=t[i];return o.toTensor()},n.prototype.unstack=function(e,t){for(var o=e.shape[t],a=new Array(e.rank-1),i=0,s=0;s<e.rank;s++)s!==t&&(a[i++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[t]=1;var h=new Array(o);for(s=0;s<h.length;s++)u[t]=s,h[s]=this.slice(e,u,c).reshape(a);return h},n.prototype.reverse=function(e,t){G(e,"reverse");for(var o=se(e.shape,e.dtype),a=this.bufferSync(e),i=function(u){var c=o.indexToLoc(u),h=c.slice();t.forEach(function(d){return h[d]=e.shape[d]-1-h[d]}),o.set.apply(o,[a.get.apply(a,h)].concat(c))},s=0;s<o.size;s++)i(s);return o.toTensor()},n.prototype.concat=function(e,t){var o=this;if("complex64"===e[0].dtype){var a=e.map(function(p){return gt(p)}),i=e.map(function(p){return Pt(p)});return Ye(this.concat(a,t),this.concat(i,t))}var s=e.map(function(p){var v=$(p.shape.slice(t));return p.as2D(-1,v)}),u=Cn(s.map(function(p){return p.shape}),1),c=se(u,e[0].dtype).values;if(1===s[0].shape[0]){var h=0;s.forEach(function(p){c.set(o.readSync(p.dataId),h),h+=p.size})}else{var d=0;s.forEach(function(p){for(var v=o.readSync(p.dataId),m=0,g=0;g<p.shape[0];++g)for(var y=g*u[1]+d,x=0;x<p.shape[1];++x)c[y+x]=v[m++];d+=p.shape[1]})}var f=Cn(e.map(function(p){return p.shape}),t);return Xe(c,f,e[0].dtype)},n.prototype.neg=function(e){return G(e,"neg"),this.multiply(Z(-1),e)},n.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(o,a,i,s){return{real:o+i,imag:a+s}}):this.broadcastedBinaryOp(e,t,He(e.dtype,t.dtype),function(o,a){return o+a})},n.prototype.addN=function(e){var t=this;G(e,"addN");for(var o=e.map(function(h){return t.readSync(h.dataId)}),a=se(e[0].shape,e[0].dtype),i=a.values,s=0;s<e.length;s++)for(var u=o[s],c=0;c<i.length;c++)i[c]+=u[c];return a.toTensor()},n.prototype.softmax=function(e,t){var o=Be([t],e.shape),a=this.max(e,o),i=rt(a.shape,o),s=this.subtract(e,a.reshape(i)),u=this.exp(s),c=this.sum(u,o).reshape(i);return this.realDivide(u,c)},n.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(o,a,i,s){return{real:o-i,imag:a-s}}):this.broadcastedBinaryOp(e,t,He(e.dtype,t.dtype),function(o,a){return o-a})},n.prototype.pow=function(e,t){return G([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(o,a){return Math.pow(o,a)})},n.prototype.batchMatMul=function(e,t,o,a){G([e,t],"matMul");for(var i=o?e.shape[1]:e.shape[2],s=o?e.shape[2]:e.shape[1],u=a?t.shape[1]:t.shape[2],c=e.shape[0],h=this.readSync(e.dataId),d=this.readSync(t.dataId),f=o?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],p=f[0],v=f[1],m=f[2],g=a?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],y=g[0],x=g[1],b=g[2],_=s*u,w=se([c,s,u],e.dtype),T=w.values,A=this.blockSize,k=0;k<c;k++)for(var I=0;I<s;I+=A)for(var D=0;D<u;D+=A)for(var N=0;N<i;N+=A)for(var P=Math.min(I+A,s),W=Math.min(D+A,u),B=Math.min(N+A,i),L=I;L<P;L++)for(var q=D;q<W;q++){for(var V=0,U=N;U<B;U++)V+=h[k*p+L*v+U*m]*d[U*y+q*x+k*b];T[k*_+(L*u+q)]+=V}return w.toTensor()},n.prototype.fusedBatchMatMul=function(e){var s=e.bias,u=e.activation,c=e.preluActivationWeights,h=this.batchMatMul(e.a,e.b,e.transposeA,e.transposeB);return s&&(h=this.add(h,s)),u&&(h=ui(this,h,u,c)),h},n.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(o,a,i,s){return{real:o*i-a*s,imag:o*s+a*i}}):this.broadcastedBinaryOp(e,t,He(e.dtype,t.dtype),function(o,a){return o*a})},n.prototype.realDivide=function(e,t){return G([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(o,a){return o/a})},n.prototype.floorDiv=function(e,t){return G([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(o,a){return Math.floor(o/a)})},n.prototype.sum=function(e,t){G(e,"sum"),it("sum",t,e.rank);for(var o=Je(e.shape,t),i=o[1],s=De(o[0],He(e.dtype,"int32")),u=$(i),c=this.readSync(s.dataId),h=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,p=0,v=0;v<u;++v)p+=h[f+v];c[d]=p}return s},n.prototype.prod=function(e,t){G(e,"sum");for(var o=Je(e.shape,t),i=o[1],s=De(o[0],He(e.dtype,"int32")),u=$(i),c=this.readSync(s.dataId),h=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,p=1,v=0;v<u;++v)p*=h[f+v];c[d]=p}return s},n.prototype.unsortedSegmentSum=function(e,t,o){G(e,"unsortedSegmentSum");for(var a=[],i=e.rank-t.rank,s=0;s<i;++s)t=t.expandDims(s+1);for(s=0;s<o;++s){var u=Z(s,"int32"),c=Lc(u,t).asType("float32").mul(e).sum(0);a.push(c)}return dt(a)},n.prototype.argMin=function(e,t){G(e,"argMin");var o=[t];it("argMin",o,e.rank);for(var a=Je(e.shape,o),s=a[1],u=De(a[0],"int32"),c=$(s),h=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<h.length;++f){for(var p=f*c,v=d[p],m=0,g=0;g<c;++g){var y=d[p+g];y<v&&(v=y,m=g)}h[f]=m}return u},n.prototype.argMax=function(e,t){G(e,"argMax");var o=[t];it("argMax",o,e.rank);for(var a=Je(e.shape,o),s=a[1],u=De(a[0],"int32"),c=$(s),h=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<h.length;++f){for(var p=f*c,v=d[p],m=0,g=0;g<c;++g){var y=d[p+g];y>v&&(v=y,m=g)}h[f]=m}return u},n.prototype.cumsum=function(e,t,o,a){if(G(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=He(e.dtype,"int32"),s=De(e.shape,i),u=this.readSync(s.dataId),c=this.readSync(e.dataId),h=e.shape[e.rank-1],d=a?function(g,y){return g+h-y-1}:function(g,y){return g+y},f=0;f<c.length;f+=h)for(var p=0;p<h;p++){var v=d(f,p);if(0===p)u[v]=o?0:c[v];else{var m=d(f,p-1);u[v]=o?c[m]+u[m]:c[v]+u[m]}}return s},n.prototype.equal=function(e,t){return G([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(o,a){return o===a?1:0})},n.prototype.notEqual=function(e,t){return G([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(o,a){return o!==a?1:0})},n.prototype.less=function(e,t){return G([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(o,a){return o<a?1:0})},n.prototype.lessEqual=function(e,t){return G([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(o,a){return o<=a?1:0})},n.prototype.greater=function(e,t){return G([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(o,a){return o>a?1:0})},n.prototype.greaterEqual=function(e,t){return G([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(o,a){return o>=a?1:0})},n.prototype.logicalNot=function(e){G(e,"logicalNot");for(var t=this.readSync(e.dataId),o=new Uint8Array(t.length),a=0;a<t.length;++a)o[a]=t[a]?0:1;return this.makeOutput(o,e.shape,"bool")},n.prototype.logicalAnd=function(e,t){return G([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(o,a){return o&&a})},n.prototype.logicalOr=function(e,t){return G([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(o,a){return o||a})},n.prototype.select=function(e,t,o){G([e,t,o],"select");for(var a=this.readSync(e.dataId),i=this.readSync(t.dataId),s=this.readSync(o.dataId),u=De(t.shape,He(t.dtype,o.dtype)),c=this.readSync(u.dataId),h=0,d=0===e.rank||e.rank>1||1===t.rank?1:$(t.shape.slice(1)),f=0;f<a.length;f++)for(var p=0;p<d;p++)c[h++]=1===a[f]?i[f]:s[f];return u},n.prototype.where=function(e){G([e],"where");var t=this.readSync(e.dataId);return Oa(e.shape,t)},n.prototype.topk=function(e,t,o){return G(e,"topk"),Fu(this.readSync(e.dataId),e.shape,e.dtype,t)},n.prototype.min=function(e,t){G(e,"min"),it("min",t,e.rank);for(var o=Je(e.shape,t),i=o[1],s=De(o[0],e.dtype),u=$(i),c=this.readSync(s.dataId),h=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,p=h[f],v=0;v<u;++v){var m=h[f+v];m<p&&(p=m)}c[d]=p}return s},n.prototype.minimum=function(e,t){return G([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(o,a){return Math.min(o,a)})},n.prototype.mod=function(e,t){return G([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(o,a){var i=o%a;return o<0&&a<0||o>=0&&a>=0?i:(i+a)%a})},n.prototype.max=function(e,t){G(e,"max"),it("max",t,e.rank);for(var o=Je(e.shape,t),i=o[1],s=De(o[0],e.dtype),u=$(i),c=this.readSync(s.dataId),h=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,p=h[f],v=0;v<u;++v){var m=h[f+v];m>p&&(p=m)}c[d]=p}return s},n.prototype.maximum=function(e,t){return G([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(o,a){return Math.max(o,a)})},n.prototype.all=function(e,t){G(e,"all"),it("all",t,e.rank);for(var o=Je(e.shape,t),i=o[1],s=De(o[0],e.dtype),u=$(i),c=this.readSync(s.dataId),h=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,p=h[f],v=0;v<u;++v)p=p&&h[f+v];c[d]=p}return s},n.prototype.any=function(e,t){G(e,"any"),it("any",t,e.rank);for(var o=Je(e.shape,t),i=o[1],s=De(o[0],e.dtype),u=$(i),c=this.readSync(s.dataId),h=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,p=h[f],v=0;v<u;++v)p=p||h[f+v];c[d]=p}return s},n.prototype.squaredDifference=function(e,t){return G([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(o,a){var i=o-a;return i*i})},n.prototype.ceil=function(e){G(e,"ceil");for(var t=this.readSync(e.dataId),o=new Float32Array(t.length),a=0;a<t.length;++a)o[a]=Math.ceil(t[a]);return this.makeOutput(o,e.shape,"float32")},n.prototype.floor=function(e){G(e,"floor");for(var t=this.readSync(e.dataId),o=new Float32Array(t.length),a=0;a<t.length;++a)o[a]=Math.floor(t[a]);return this.makeOutput(o,e.shape,"float32")},n.prototype.sign=function(e){G(e,"x");for(var t=this.readSync(e.dataId),o=new Float32Array(t.length),a=0;a<t.length;++a)o[a]=t[a]<0?-1:t[a]>0?1:0;return this.makeOutput(o,e.shape,"float32")},n.prototype.isNaN=function(e){G(e,"x");for(var t=this.readSync(e.dataId),o=new Uint8Array(t.length),a=0;a<t.length;++a)Number.isNaN(t[a])&&(o[a]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.isInf=function(e){G(e,"x");for(var t=this.readSync(e.dataId),o=new Uint8Array(t.length),a=0;a<t.length;++a)Math.abs(t[a])===1/0&&(o[a]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.isFinite=function(e){G(e,"x");for(var t=this.readSync(e.dataId),o=new Uint8Array(t.length),a=0;a<t.length;++a)Number.isFinite(t[a])&&(o[a]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.round=function(e){G(e,"round");for(var t=this.readSync(e.dataId),o=new Float32Array(t.length),a=0;a<t.length;++a){var i=Math.floor(t[a]);o[a]=t[a]-i<.5?Math.floor(t[a]):t[a]-i>.5?Math.ceil(t[a]):i%2==0?i:i+1}return this.makeOutput(o,e.shape,"float32")},n.prototype.exp=function(e){G(e,"exp");for(var t=this.readSync(e.dataId),o=new Float32Array(t.length),a=0;a<t.length;++a)o[a]=Math.exp(t[a]);return this.makeOutput(o,e.shape,"float32")},n.prototype.expm1=function(e){G(e,"expm1");for(var t=this.readSync(e.dataId),o=new Float32Array(t.length),a=0;a<t.length;++a)o[a]=Math.expm1(t[a]);return this.makeOutput(o,e.shape,"float32")},n.prototype.log=function(e){G(e,"log");for(var t=this.readSync(e.dataId),o=new Float32Array(t.length),a=0;a<t.length;++a)o[a]=Math.log(t[a]);return this.makeOutput(o,e.shape,"float32")},n.prototype.log1p=function(e){G(e,"log1p");for(var t=this.readSync(e.dataId),o=new Float32Array(t.length),a=0;a<t.length;++a)o[a]=Math.log1p(t[a]);return this.makeOutput(o,e.shape,"float32")},n.prototype.sqrt=function(e){G(e,"sqrt");for(var t=this.readSync(e.dataId),o=new Float32Array(t.length),a=0;a<t.length;++a)o[a]=Math.sqrt(t[a]);return this.makeOutput(o,e.shape,"float32")},n.prototype.rsqrt=function(e){G(e,"rsqrt");for(var t=this.readSync(e.dataId),o=new Float32Array(t.length),a=0;a<t.length;++a)o[a]=1/Math.sqrt(t[a]);return this.makeOutput(o,e.shape,"float32")},n.prototype.reciprocal=function(e){G(e,"reciprocal");for(var t=this.readSync(e.dataId),o=new Float32Array(t.length),a=0;a<t.length;++a)o[a]=1/t[a];return this.makeOutput(o,e.shape,"float32")},n.prototype.linear=function(e){return e},n.prototype.relu=function(e){G(e,"relu");for(var t=De(e.shape,e.dtype),o=this.readSync(t.dataId),a=this.readSync(e.dataId),i=0;i<a.length;++i)o[i]=Math.max(0,a[i]);return t},n.prototype.relu6=function(e){G(e,"relu");for(var t=De(e.shape,e.dtype),o=this.readSync(t.dataId),a=this.readSync(e.dataId),i=0;i<a.length;++i)o[i]=Math.min(Math.max(0,a[i]),6);return t},n.prototype.prelu=function(e,t){return G([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(o,a){return o<0?a*o:o})},n.prototype.elu=function(e){G(e,"elu");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];t[a]=i>=0?i:Math.exp(i)-1}return this.makeOutput(t,e.shape,"float32")},n.prototype.eluDer=function(e,t){G([e,t],"eluDer");for(var o=new Float32Array(t.size),a=this.readSync(t.dataId),i=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>=1?i[s]:i[s]*(u+1)}return this.makeOutput(o,t.shape,"float32")},n.prototype.selu=function(e){G(e,"selu");for(var a=new Float32Array(e.size),i=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];a[s]=u>=0?1.0507009873554805*u:1.7580993408473768*(Math.exp(u)-1)}return this.makeOutput(a,e.shape,"float32")},n.prototype.clip=function(e,t,o){G(e,"clip");for(var a=new Float32Array(e.size),i=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];a[s]=u>o?o:u<t?t:u}return this.makeOutput(a,e.shape,"float32")},n.prototype.abs=function(e){for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.abs(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<e.size;++a)t[a]=Math.hypot(o[2*a],o[2*a+1]);return this.makeOutput(t,e.shape,"float32")},n.prototype.int=function(e){G(e,"int");for(var t=new Int32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=o[a];return this.makeOutput(t,e.shape,"int32")},n.prototype.sigmoid=function(e){G(e,"sigmoid");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=1/(1+Math.exp(-o[a]));return this.makeOutput(t,e.shape,"float32")},n.prototype.softplus=function(e){G(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,o=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var h,s=a[i]>-t,u=a[i]<t,c=Math.exp(a[i]);h=u?c:s?a[i]:Math.log(1+c),o[i]=h}return this.makeOutput(o,e.shape,"float32")},n.prototype.sin=function(e){G(e,"sin");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.sin(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.cos=function(e){G(e,"cos");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.cos(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.tan=function(e){G(e,"tan");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.tan(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.asin=function(e){G(e,"asin");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.asin(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.acos=function(e){G(e,"acos");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.acos(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.atan=function(e){G(e,"atan");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.atan(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.atan2=function(e,t){return G([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(o,a){return Math.atan2(o,a)})},n.prototype.sinh=function(e){G(e,"sinh");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.sinh(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.cosh=function(e){G(e,"cosh");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.cosh(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.tanh=function(e){G(e,"tanh");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=ws(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.asinh=function(e){G(e,"asinh");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.asinh(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.acosh=function(e){G(e,"acosh");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.acosh(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.atanh=function(e){G(e,"atanh");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)t[a]=Math.atanh(o[a]);return this.makeOutput(t,e.shape,"float32")},n.prototype.erf=function(e){G(e,"erf");for(var t=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=Math.sign(o[a]),s=Math.abs(o[a]),u=1/(1+.3275911*s);t[a]=i*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(t,e.shape,"float32")},n.prototype.step=function(e,t){void 0===t&&(t=0),G(e,"step");for(var o=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var s=a[i];o[i]=isNaN(s)?NaN:s>0?1:t}return this.makeOutput(o,e.shape,"float32")},n.prototype.fusedConv2d=function(e){var i=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.conv2d(e.input,e.filter,e.convInfo);return i&&(c=this.add(c,i)),s&&(c=ui(this,c,s,u)),c},n.prototype.conv2d=function(e,t,o){G([e,t],"conv2d");for(var a=o.filterHeight,i=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,h=o.padInfo.top,d="channelsLast"===o.dataFormat,f=se(o.outShape,e.dtype),p=e.strides[0],v=d?e.strides[1]:e.strides[2],m=d?e.strides[2]:1,g=d?1:e.strides[1],y=f.strides[0],x=d?f.strides[1]:f.strides[2],b=d?f.strides[2]:1,_=d?1:f.strides[1],w=this.readSync(e.dataId),T=this.readSync(t.dataId),A=f.values,k=0;k<o.batchSize;++k)for(var I=k*p,D=k*y,N=0;N<o.outHeight;++N)for(var P=D+N*x,W=N*o.strideHeight-h,B=0;B<a;B++){var L=W+B*s;if(!(L<0||L>=o.inHeight))for(var q=B*t.strides[0],V=I+L*v,U=0;U<o.outWidth;++U)for(var z=P+U*b,H=U*o.strideWidth-c,K=0;K<i;K++){var re=H+K*u;if(!(re<0||re>=o.inWidth))for(var oe=V+re*m,le=q+K*t.strides[1],he=0;he<o.inChannels;++he){for(var pe=w[oe+he*g],be=0;be<o.outChannels;++be)A[z+be*_]+=pe*T[le+be];le+=o.outChannels}}}return f.toTensor()},n.prototype.conv3d=function(e,t,o){for(var a=o.filterDepth,i=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,c=o.dilationHeight,h=o.dilationWidth,d=o.padInfo.front,f=o.padInfo.left,p=o.padInfo.top,v=se(o.outShape,e.dtype),m=this.readSync(e.dataId),g=this.readSync(t.dataId),y=v.values,x=0;x<o.batchSize;++x)for(var b=x*e.strides[0],_=x*v.strides[0],w=0;w<o.outDepth;++w)for(var T=_+w*v.strides[1],A=w*o.strideDepth-d,k=0;k<a;k++){var I=A+k*u;if(!(I<0||I>=o.inDepth))for(var D=k*t.strides[0],N=b+I*e.strides[1],P=0;P<o.outHeight;++P)for(var W=T+P*v.strides[2],B=P*o.strideHeight-p,L=0;L<i;L++){var q=B+L*c;if(!(q<0||q>=o.inHeight))for(var V=D+L*t.strides[1],U=N+q*e.strides[2],z=0;z<o.outWidth;++z)for(var H=W+z*o.outChannels,K=z*o.strideWidth-f,re=0;re<s;re++){var oe=K+re*h;if(!(oe<0||oe>=o.inWidth))for(var he=U+oe*o.inChannels,pe=V+re*t.strides[2],be=0;be<o.inChannels;++be){for(var ve=m[he+be],_e=0;_e<o.outChannels;++_e)y[H+_e]+=ve*g[pe+_e];pe+=o.outChannels}}}}return v.toTensor()},n.prototype.conv2dDerInput=function(e,t,o){G([e,t],"conv2dDerInput");for(var a=se(o.inShape,"float32"),i=a.values,s=this.readSync(e.dataId),u=this.readSync(t.dataId),c=t.strides,h=c[0],d=c[1],f=c[2],p=o.batchSize,v=o.filterHeight,m=o.filterWidth,g=o.inChannels,y=o.inHeight,x=o.inWidth,b=o.outChannels,_=o.outHeight,w=o.outWidth,T=o.strideHeight,A=o.strideWidth,I=v-1-o.padInfo.top,D=m-1-o.padInfo.left,N="channelsLast"===o.dataFormat,P=a.strides[0],W=N?a.strides[1]:a.strides[2],B=N?a.strides[2]:1,L=N?1:a.strides[1],q=e.strides[0],V=N?e.strides[1]:e.strides[2],U=N?e.strides[2]:1,z=N?1:e.strides[1],H=0;H<p;++H)for(var K=0;K<g;++K)for(var re=0;re<y;++re)for(var oe=re-I,le=Math.max(0,Math.ceil(oe/T)),he=Math.min(_,(v+oe)/T),pe=0;pe<x;++pe){for(var be=pe-D,ve=Math.max(0,Math.ceil(be/A)),_e=Math.min(w,(m+be)/A),Me=0,me=le;me<he;++me)for(var Te=me*T-oe,Ce=ve;Ce<_e;++Ce)for(var Fe=q*H+V*me+U*Ce,Re=h*(v-1-Te)+d*(m-1-(Ce*A-be))+f*K,Pe=0;Pe<b;++Pe)Me+=s[Fe+z*Pe]*u[Re+Pe];i[P*H+W*re+B*pe+L*K]=Me}return a.toTensor()},n.prototype.conv3dDerInput=function(e,t,o){for(var a=se(o.inShape,"float32"),i=a.values,s=a.strides,u=s[0],c=s[1],h=s[2],d=s[3],f=this.readSync(e.dataId),p=e.strides,v=p[0],m=p[1],g=p[2],y=p[3],x=this.readSync(t.dataId),b=t.strides,_=b[0],w=b[1],T=b[2],A=b[3],k=o.batchSize,I=o.filterDepth,D=o.filterHeight,N=o.filterWidth,P=o.inChannels,W=o.inDepth,B=o.inHeight,L=o.inWidth,q=o.outChannels,V=o.outDepth,U=o.outHeight,z=o.outWidth,H=o.strideDepth,K=o.strideHeight,re=o.strideWidth,oe=I-1-o.padInfo.front,le=D-1-o.padInfo.top,he=N-1-o.padInfo.left,pe=0;pe<k;++pe)for(var be=0;be<P;++be)for(var ve=0;ve<W;++ve)for(var _e=ve-oe,Me=Math.max(0,Math.ceil(_e/H)),me=Math.min(V,(I+_e)/H),Te=0;Te<B;++Te)for(var Ce=Te-le,Fe=Math.max(0,Math.ceil(Ce/K)),Re=Math.min(U,(D+Ce)/K),Pe=0;Pe<L;++Pe){for(var Ut=Pe-he,Vt=Math.max(0,Math.ceil(Ut/re)),mt=Math.min(z,(N+Ut)/re),ar=0,tn=Me;tn<me;++tn)for(var xn=tn*H-_e,nn=Fe;nn<Re;++nn)for(var ir=nn*K-Ce,rn=Vt;rn<mt;++rn)for(var cs=v*pe+m*tn+g*nn+y*rn,sr=_*(I-1-xn)+w*(D-1-ir)+T*(N-1-(rn*re-Ut))+A*be,Gt=0;Gt<q;++Gt)ar+=f[cs+Gt]*x[sr+Gt];i[u*pe+c*ve+h*Te+d*Pe+be]=ar}return a.toTensor()},n.prototype.conv2dDerFilter=function(e,t,o){G([e,t],"conv2dDerFilter");for(var a=o.strideHeight,i=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c="channelsLast"===o.dataFormat,h=se(o.filterShape,"float32"),d=o.padInfo.left,f=o.padInfo.top,p=this.bufferSync(e),v=this.bufferSync(t),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((f-m)/a)),y=Math.min(o.outHeight,(o.inHeight+f-m)/a),x=0;x<u;++x)for(var b=Math.max(0,Math.ceil((d-x)/i)),_=Math.min(o.outWidth,(o.inWidth+d-x)/i),w=0;w<o.inChannels;++w)for(var T=0;T<o.outChannels;++T){for(var A=0,k=0;k<o.batchSize;++k)for(var I=g;I<y;++I)for(var D=m+I*a-f,N=b;N<_;++N){var P=x+N*i-d;A+=c?p.get(k,D,P,w)*v.get(k,I,N,T):p.get(k,w,D,P)*v.get(k,T,I,N)}h.set(A,m,x,w,T)}return h.toTensor()},n.prototype.conv3dDerFilter=function(e,t,o){for(var a=o.strideDepth,i=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,h=o.filterWidth,d=se(o.filterShape,"float32"),f=d.values,p=d.strides,v=p[0],m=p[1],g=p[2],y=p[3],x=this.readSync(t.dataId),b=t.strides,_=b[0],w=b[1],T=b[2],A=b[3],k=this.readSync(e.dataId),I=e.strides,D=I[0],N=I[1],P=I[2],W=I[3],B=o.padInfo.front,L=o.padInfo.left,q=o.padInfo.top,V=0;V<u;++V)for(var U=Math.max(0,Math.ceil((B-V)/a)),z=Math.min(o.outDepth,(o.inDepth+B-V)/a),H=V*v,K=0;K<c;++K)for(var re=Math.max(0,Math.ceil((q-K)/i)),oe=Math.min(o.outHeight,(o.inHeight+q-K)/i),le=K*m+H,he=0;he<h;++he)for(var pe=Math.max(0,Math.ceil((L-he)/s)),be=Math.min(o.outWidth,(o.inWidth+L-he)/s),ve=he*g+le,_e=0;_e<o.inChannels;++_e)for(var Me=_e*y+ve,me=0;me<o.outChannels;++me){for(var Te=0,Ce=0;Ce<o.batchSize;++Ce)for(var Fe=Ce*D,Re=Ce*_,Pe=U;Pe<z;++Pe)for(var Ut=(V+Pe*a-B)*N+Fe,Vt=Pe*w+Re,mt=re;mt<oe;++mt)for(var ar=(K+mt*i-q)*P+Ut,tn=mt*T+Vt,xn=pe;xn<be;++xn)Te+=k[(he+xn*s-L)*W+ar+_e]*x[xn*A+tn+me];f[Me+me]=Te}return d.toTensor()},n.prototype.fusedDepthwiseConv2D=function(e){var i=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.depthwiseConv2D(e.input,e.filter,e.convInfo);return i&&(c=this.add(c,i)),s&&(c=ui(this,c,s,u)),c},n.prototype.depthwiseConv2D=function(e,t,o){G([e,t],"depthwiseConv2D");for(var a=o.filterHeight,i=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,h=o.padInfo.top,d=o.outChannels/o.inChannels,f=se(o.outShape,e.dtype),p=this.readSync(e.dataId),v=this.readSync(t.dataId),m=f.values,g=0;g<o.batchSize;++g)for(var y=g*e.strides[0],x=g*f.strides[0],b=0;b<o.outHeight;++b)for(var _=x+b*f.strides[1],w=b*o.strideHeight-c,T=0;T<a;++T){var A=w+T*s;if(!(A<0||A>=o.inHeight))for(var k=T*t.strides[0],I=y+A*e.strides[1],D=0;D<o.outWidth;++D)for(var N=_+D*f.strides[2],P=D*o.strideWidth-h,W=0;W<i;++W){var B=P+W*u;if(!(B<0||B>=o.inWidth))for(var q=I+B*o.inChannels,V=N,U=k+W*t.strides[1],z=0;z<o.inChannels;++z){for(var H=p[q+z],K=0;K<d;++K)m[V+K]+=H*v[U+K];V+=d,U+=d}}}return f.toTensor()},n.prototype.depthwiseConv2DDerInput=function(e,t,o){G([e,t],"depthwiseConv2DDerInput");for(var a=se(o.inShape,"float32"),i=a.values,s=a.strides,u=s[0],c=s[1],h=s[2],d=this.readSync(e.dataId),f=e.strides,p=f[0],v=f[1],m=f[2],g=this.readSync(t.dataId),y=t.strides,x=y[0],b=y[1],_=y[2],w=o.batchSize,T=o.filterHeight,A=o.filterWidth,k=o.inChannels,I=o.inHeight,D=o.inWidth,P=o.outHeight,W=o.outWidth,B=o.strideHeight,L=o.strideWidth,q=T-1-o.padInfo.top,V=A-1-o.padInfo.left,U=o.outChannels/k,z=0;z<w;++z)for(var H=0;H<k;++H)for(var K=0;K<I;++K)for(var re=K-q,oe=Math.max(0,Math.ceil(re/B)),le=Math.min(P,(T+re)/B),he=0;he<D;++he){for(var pe=he-V,be=Math.max(0,Math.ceil(pe/L)),ve=Math.min(W,(A+pe)/L),_e=0,Me=oe;Me<le;++Me)for(var me=Me*B-re,Te=be;Te<ve;++Te)for(var Ce=p*z+v*Me+m*Te,Fe=x*(T-1-me)+b*(A-1-(Te*L-pe))+_*H,Re=0;Re<U;++Re)_e+=d[Ce+(H*U+Re)]*g[Fe+Re];i[u*z+c*K+h*he+H]=_e}return a.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(e,t,o){G([e,t],"depthwiseConv2DDerFilter");for(var a=o.strideHeight,i=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=se(o.filterShape,"float32"),h=o.padInfo.left,d=o.padInfo.top,f=o.outChannels/o.inChannels,p=this.bufferSync(e),v=this.bufferSync(t),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((d-m)/a)),y=Math.min(o.outHeight,(o.inHeight+d-m)/a),x=0;x<u;++x)for(var b=Math.max(0,Math.ceil((h-x)/i)),_=Math.min(o.outWidth,(o.inWidth+h-x)/i),w=0;w<o.outChannels;++w){for(var T=Math.trunc(w/f),A=w%f,k=0,I=0;I<o.batchSize;++I)for(var D=g;D<y;++D)for(var N=m+D*a-d,P=b;P<_;++P)k+=p.get(I,N,x+P*i-h,T)*v.get(I,D,P,w);c.set(k,m,x,T,A)}return c.toTensor()},n.prototype.tile=function(e,t){return G(e,"tile"),Nu(this.bufferSync(e),t)},n.prototype.pad=function(e,t,o){G(e,"pad");var a=t.map(function(f,p){return f[0]+e.shape[p]+f[1]}),i=t.map(function(f){return f[0]}),s=this.bufferSync(e),u=se(a,e.dtype);0!==o&&u.values.fill(o);for(var c=0;c<e.size;c++){var h=s.indexToLoc(c),d=h.map(function(f,p){return f+i[p]});u.set.apply(u,[s.get.apply(s,h)].concat(d))}return u.toTensor()},n.prototype.transpose=function(e,t){G(e,"transpose");for(var o=new Array(e.rank),a=0;a<o.length;a++)o[a]=e.shape[t[a]];var i=this.readSync(e.dataId),s=se(o,e.dtype),u=this.bufferSync(e);for(a=0;a<e.size;++a){for(var c=u.indexToLoc(a),h=new Array(c.length),d=0;d<h.length;d++)h[d]=c[t[d]];var f=s.locToIndex(h);s.values[f]=i[a]}return s.toTensor()},n.prototype.gather=function(e,t,o){G([e,t],"gather");var a=e.shape.slice(),i=this.readSync(t.dataId);a[o]=i.length;for(var s=se(a,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var h=s.indexToLoc(c),d=h.slice();d[o]=i[h[o]];var f=u.locToIndex(d);s.values[c]=u.values[f]}return s.toTensor()},n.prototype.batchToSpaceND=function(e,t,o){G([e],"batchToSpaceND");var a=t.reduce(function(d,f){return d*f}),i=io(e.shape,t,a),s=so(i.length,t.length),u=uo(e.shape,t,a),c=bu(o,t.length),h=_u(u,o,t.length);return e.reshape(i).transpose(s).reshape(u).slice(c,h)},n.prototype.spaceToBatchND=function(e,t,o){G([e],"spaceToBatchND");var a=t.reduce(function(f,p){return f*p}),i=[[0,0]];i.push.apply(i,o);for(var s=1+t.length;s<e.shape.length;++s)i.push([0,0]);var u=e.pad(i),c=io(u.shape,t,a,!1),h=so(c.length,t.length,!1),d=uo(u.shape,t,a,!1);return u.reshape(c).transpose(h).reshape(d)},n.prototype.pool=function(e,t,o){G(e,"pool");for(var a=t.strideHeight,i=t.strideWidth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,f=t.padInfo.left,p="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(e.dataId),m=se(t.outShape,e.dtype),g=m.values,y=t.outShape[1]*t.outShape[2]*t.outShape[3],x=t.outShape[2]*t.outShape[3],b=t.outShape[3],_=0;_<t.batchSize;++_)for(var w=_*y,T=_*e.strides[0],A=0;A<t.inChannels;++A)for(var k=0;k<t.outHeight;++k)for(var I=k*a-d,D=Math.max(0,I),N=Math.min(t.inHeight,c+I),P=w+k*x,W=0;W<t.outWidth;++W){for(var B=W*i-f,L=Math.max(0,B),q=Math.min(t.inWidth,h+B),V=p,U=0,z=0,H=D;H<N;H+=s){for(var K=T+H*e.strides[1],re=L;re<q;re+=u){var oe=v[K+re*e.strides[2]+A];"max"===o&&oe>V?V=oe:"avg"===o&&(U+=oe,z++)}if(isNaN(V))break}g[P+W*b+A]="avg"===o?U/z:V}return m.toTensor()},n.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},n.prototype.maxPoolPositions=function(e,t){for(var o=se(t.outShape,"int32"),a=t.strideHeight,i=t.strideWidth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,f=t.padInfo.left,p=this.bufferSync(e),v=0;v<t.batchSize;++v)for(var m=0;m<t.inChannels;++m)for(var g=0;g<t.outHeight;++g){for(var y=g*a-d,x=y;x<0;)x+=s;for(var b=Math.min(t.inHeight,c+y),_=0;_<t.outWidth;++_){for(var w=_*i-f,T=w;T<0;)T+=u;for(var A=Math.min(t.inWidth,h+w),k=Number.NEGATIVE_INFINITY,I=-1,D=x;D<b;D+=s)for(var N=D-y,P=T;P<A;P+=u){var W=P-w,B=p.get(v,D,P,m);B>k&&(k=B,I=N*h+W)}o.set(I,v,g,_,m)}}return o.toTensor()},n.prototype.maxPoolBackprop=function(e,t,o,a){G([t,o],"maxPoolBackprop");for(var i=this.maxPoolPositions(t,a),s=a.strideHeight,u=a.strideWidth,c=a.dilationHeight,h=a.dilationWidth,d=a.effectiveFilterHeight,f=a.effectiveFilterWidth,p=f-1-a.padInfo.left,v=d-1-a.padInfo.top,m=se(t.shape,"float32"),g=this.bufferSync(i),y=this.bufferSync(e),x=0;x<a.batchSize;++x)for(var b=0;b<a.inChannels;++b)for(var _=0;_<a.inHeight;++_)for(var w=0;w<a.inWidth;++w){for(var T=_-v,A=w-p,k=0,I=0;I<d;I+=c){var D=(T+I)/s;if(!(D<0||D>=a.outHeight||Math.floor(D)!==D))for(var N=0;N<f;N+=h){var P=(A+N)/u;if(!(P<0||P>=a.outWidth||Math.floor(P)!==P)){var W=d*f-1-g.get(x,D,P,b)===I*f+N?1:0;0!==W&&(k+=y.get(x,D,P,b)*W)}}}m.set(k,x,_,w,b)}return m.toTensor()},n.prototype.avgPoolBackprop=function(e,t,o){G([e,t],"avgPoolBackprop");for(var a=o.strideHeight,i=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dilationHeight,h=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,p=f-1-o.padInfo.left,v=d-1-o.padInfo.top,m=se(t.shape,"float32"),g=1/(s*u),y=this.bufferSync(e),x=0;x<o.batchSize;++x)for(var b=0;b<o.inChannels;++b)for(var _=0;_<o.inHeight;++_)for(var w=0;w<o.inWidth;++w){for(var T=_-v,A=w-p,k=0,I=0;I<d;I+=c){var D=(T+I)/a;if(!(D<0||D>=o.outHeight||Math.floor(D)!==D))for(var N=0;N<f;N+=h){var P=(A+N)/i;P<0||P>=o.outWidth||Math.floor(P)!==P||(k+=y.get(x,D,P,b))}}m.set(k*g,x,_,w,b)}return m.toTensor()},n.prototype.pool3d=function(e,t,o){G(e,"pool3d");for(var a=t.strideDepth,i=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,f=t.effectiveFilterHeight,p=t.effectiveFilterWidth,v=t.padInfo.front,m=t.padInfo.top,g=t.padInfo.left,y="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=this.readSync(e.dataId),b=se(t.outShape,e.dtype),_=b.values,w=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],T=t.outShape[2]*t.outShape[3]*t.outShape[4],A=t.outShape[3]*t.outShape[4],k=t.outShape[4],I=0;I<t.batchSize;++I)for(var D=I*w,N=I*e.strides[0],P=0;P<t.inChannels;++P)for(var W=0;W<t.outDepth;++W){for(var B=W*a-v,L=B;L<0;)L+=u;for(var q=Math.min(t.inDepth,d+B),V=D+W*T,U=0;U<t.outHeight;++U){for(var z=U*i-m,H=z;H<0;)H+=c;for(var K=Math.min(t.inHeight,f+z),re=V+U*A,oe=0;oe<t.outWidth;++oe){for(var le=oe*s-g,he=le;he<0;)he+=h;for(var pe=Math.min(t.inWidth,p+le),be=re+oe*k,ve=y,_e=0,Me=0,me=L;me<q;me+=u){for(var Te=N+me*e.strides[1],Ce=H;Ce<K;Ce+=c){for(var Fe=Te+Ce*e.strides[2],Re=he;Re<pe;Re+=h){var Pe=x[Fe+Re*e.strides[3]+P];if("max"===o&&Pe>ve?ve=Pe:"avg"===o&&(_e+=Pe,Me++),isNaN(ve))break}if(isNaN(ve))break}if(isNaN(ve))break}_[be+P]="avg"===o?_e/Me:ve}}}return b.toTensor()},n.prototype.avgPool3d=function(e,t){return G(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(e,t,o){G([e,t],"avgPool3dBackprop");for(var a=o.strideDepth,i=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,h=o.filterWidth,d=o.dilationDepth,f=o.dilationHeight,p=o.dilationWidth,v=o.effectiveFilterDepth,m=o.effectiveFilterHeight,g=o.effectiveFilterWidth,y=v-1-o.padInfo.front,x=g-1-o.padInfo.left,b=m-1-o.padInfo.top,_=se(t.shape,"float32"),w=1/(u*c*h),T=this.bufferSync(e),A=0;A<o.batchSize;++A)for(var k=0;k<o.inChannels;++k)for(var I=0;I<o.inDepth;++I)for(var D=0;D<o.inHeight;++D)for(var N=0;N<o.inWidth;++N){for(var P=I-y,W=D-b,B=N-x,L=0,q=0;q<v;q+=d){var V=(P+q)/a;if(!(V<0||V>=o.outDepth||Math.floor(V)!==V))for(var U=0;U<m;U+=f){var z=(W+U)/i;if(!(z<0||z>=o.outHeight||Math.floor(z)!==z))for(var H=0;H<g;H+=p){var K=(B+H)/s;K<0||K>=o.outWidth||Math.floor(K)!==K||(L+=T.get(A,V,z,K,k))}}}_.set(L*w,A,I,D,N,k)}return _.toTensor()},n.prototype.maxPool3d=function(e,t){return G(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},n.prototype.maxPool3dPositions=function(e,t){for(var o=se(t.outShape,"int32"),a=t.strideDepth,i=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,f=t.effectiveFilterHeight,p=t.effectiveFilterWidth,v=t.padInfo.front,m=t.padInfo.top,g=t.padInfo.left,y=this.bufferSync(e),x=0;x<t.batchSize;++x)for(var b=0;b<t.inChannels;++b)for(var _=0;_<t.outDepth;++_){for(var w=_*a-v,T=w;T<0;)T+=u;for(var A=Math.min(t.inDepth,d+w),k=0;k<t.outHeight;++k){for(var I=k*i-m,D=I;D<0;)D+=c;for(var N=Math.min(t.inHeight,f+I),P=0;P<t.outWidth;++P){for(var W=P*s-g,B=W;B<0;)B+=h;for(var L=Math.min(t.inWidth,p+W),q=Number.NEGATIVE_INFINITY,V=-1,U=T;U<A;U+=u)for(var z=U-w,H=D;H<N;H+=c)for(var K=H-I,re=B;re<L;re+=h){var oe=re-W,le=y.get(x,U,H,re,b);le>=q&&(q=le,V=z*f*p+K*f+oe)}o.set(V,x,_,k,P,b)}}}return o.toTensor()},n.prototype.maxPool3dBackprop=function(e,t,o,a){G([t,o],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(t,a),s=a.strideDepth,u=a.strideHeight,c=a.strideWidth,h=a.dilationDepth,d=a.dilationHeight,f=a.dilationWidth,p=a.effectiveFilterDepth,v=a.effectiveFilterHeight,m=a.effectiveFilterWidth,g=p-1-a.padInfo.front,y=m-1-a.padInfo.left,x=v-1-a.padInfo.top,b=se(t.shape,"float32"),_=this.bufferSync(i),w=this.bufferSync(e),T=0;T<a.batchSize;++T)for(var A=0;A<a.inChannels;++A)for(var k=0;k<a.inDepth;++k)for(var I=0;I<a.inHeight;++I)for(var D=0;D<a.inWidth;++D){for(var N=k-g,P=I-x,W=D-y,B=0,L=0;L<p;L+=h){var q=(N+L)/s;if(!(q<0||q>=a.outDepth||Math.floor(q)!==q))for(var V=0;V<v;V+=d){var U=(P+V)/u;if(!(U<0||U>=a.outHeight||Math.floor(U)!==U))for(var z=0;z<m;z+=f){var H=(W+z)/c;if(!(H<0||H>=a.outWidth||Math.floor(H)!==H)){var K=p*v*m-1-_.get(T,q,U,H,A)===L*v*m+V*m+z?1:0;0!==K&&(B+=w.get(T,q,U,H,A)*K)}}}}b.set(B,T,k,I,D,A)}return b.toTensor()},n.prototype.cast=function(e,t){return Ra(e,t,this)},n.prototype.reshape=function(e,t){return mo(e,t)},n.prototype.avgPool=function(e,t){return G(e,"avgPool"),this.pool(e,t,"avg").toFloat()},n.prototype.resizeBilinear=function(e,t,o,a){G(e,"resizeBilinear");for(var i=e.shape,s=i[0],u=i[1],c=i[2],h=i[3],d=this.readSync(e.dataId),f=new Float32Array($([s,t,o,h])),p=[a&&t>1?u-1:u,a&&o>1?c-1:c],v=[a&&t>1?t-1:t,a&&o>1?o-1:o],m=0,g=p[0]/v[0],y=p[1]/v[1],x=0;x<s;x++)for(var b=0;b<t;b++)for(var _=g*b,w=Math.floor(_),T=_-w,A=Math.min(u-1,Math.ceil(_)),k=x*e.strides[0]+w*e.strides[1],I=x*e.strides[0]+A*e.strides[1],D=0;D<o;D++)for(var N=y*D,P=Math.floor(N),W=N-P,B=Math.min(c-1,Math.ceil(N)),L=k+P*e.strides[2],q=I+P*e.strides[2],V=k+B*e.strides[2],U=I+B*e.strides[2],z=0;z<h;z++){var H=d[L+z],K=d[q+z],re=H+(d[V+z]-H)*W;f[m++]=re+(K+(d[U+z]-K)*W-re)*T}return Xe(f,[s,t,o,h])},n.prototype.resizeBilinearBackprop=function(e,t,o){G([e,t],"resizeBilinearBackprop");for(var a=t.shape,i=a[0],s=a[1],u=a[2],c=a[3],h=e.shape,d=h[1],f=h[2],p=new Float32Array(i*s*u*c),v=[o&&d>1?s-1:s,o&&f>1?u-1:u],m=[o&&d>1?d-1:d,o&&f>1?f-1:f],g=v[0]/m[0],y=v[1]/m[1],x=this.readSync(e.dataId),b=0,_=0;_<i;_++)for(var w=_*t.strides[0],T=0;T<d;T++)for(var A=T*g,k=Math.floor(A),I=Math.min(Math.ceil(A),s-1),D=w+k*t.strides[1],N=w+I*t.strides[1],P=A-k,W=1-P,B=0;B<f;B++)for(var L=B*y,q=Math.floor(L),V=Math.min(Math.ceil(L),u-1),U=L-q,z=1-U,H=D+q*t.strides[2],K=D+V*t.strides[2],re=N+q*t.strides[2],oe=N+V*t.strides[2],le=W*z,he=W*U,pe=P*z,be=P*U,ve=0;ve<c;ve++){var _e=x[b++];p[H+ve]+=_e*le,p[K+ve]+=_e*he,p[re+ve]+=_e*pe,p[oe+ve]+=_e*be}return st(p,[i,u,s,c],t.dtype)},n.prototype.resizeNearestNeighbor=function(e,t,o,a){G(e,"resizeNearestNeighbor");for(var i=e.shape,s=i[0],u=i[1],c=i[2],h=i[3],d=this.readSync(e.dataId),f=new Float32Array(s*t*o*h),p=[a&&t>1?u-1:u,a&&o>1?c-1:c],v=[a&&t>1?t-1:t,a&&o>1?o-1:o],m=p[0]/v[0],g=p[1]/v[1],y=0,x=0;x<s;x++)for(var b=x*e.strides[0],_=0;_<t;_++)for(var w=m*_,T=b+Math.min(u-1,a?Math.round(w):Math.floor(w))*e.strides[1],A=0;A<o;A++)for(var k=g*A,I=T+Math.min(c-1,a?Math.round(k):Math.floor(k))*e.strides[2],D=0;D<h;D++)f[y++]=d[I+D];return Xe(f,[s,t,o,h],e.dtype)},n.prototype.resizeNearestNeighborBackprop=function(e,t,o){G([e,t],"resizeNearestNeighborBackprop");for(var a=t.shape,i=a[0],s=a[1],u=a[2],c=a[3],h=e.shape,d=h[1],f=h[2],p=new Float32Array(i*s*u*c),v=this.readSync(e.dataId),m=[o&&d>1?s-1:s,o&&f>1?u-1:u],g=[o&&d>1?d-1:d,o&&f>1?f-1:f],y=m[0]/g[0],x=m[1]/g[1],b=1/y,_=1/x,w=2*Math.ceil(b)+2,T=2*Math.ceil(_)+2,A=0;A<i;A++)for(var k=A*t.strides[0],I=0;I<s;I++)for(var D=k+I*t.strides[1],N=Math.floor(I*b),P=Math.floor(N-w/2),W=0;W<u;W++)for(var B=D+W*t.strides[2],L=Math.floor(W*_),q=Math.floor(L-T/2),V=0;V<c;V++){for(var U=0,z=0;z<w;z++){var H=z+P;if(!(H<0||H>=d)){var K=k+H*e.strides[1],re=H*y;if(I===Math.min(s-1,o?Math.round(re):Math.floor(re)))for(var oe=0;oe<T;oe++){var le=oe+q;if(!(le<0||le>=f)){var he=K+le*e.strides[2],pe=le*x;W===Math.min(u-1,o?Math.round(pe):Math.floor(pe))&&(U+=v[he+V])}}}}p[B+V]=U}return st(p,t.shape,t.dtype)},n.prototype.batchNormalization=function(e,t,o,a,i,s){G([e,t,o,i,s],"batchNorm");for(var u=this.readSync(e.dataId),c=this.readSync(t.dataId),h=this.readSync(o.dataId),d=i?this.readSync(i.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),p=new Float32Array(u.length),v=f.length,m=d.length,g=h.length,y=c.length,x=0,b=0,_=0,w=0,T=0;T<u.length;++T)p[T]=f[x++]+(u[T]-c[b++])*d[_++]/Math.sqrt(h[w++]+a),x>=v&&(x=0),b>=y&&(b=0),_>=m&&(_=0),w>=g&&(w=0);return st(p,e.shape)},n.prototype.localResponseNormalization4D=function(e,t,o,a,i){G(e,"localResponseNormalization4D");var s=e.shape[3],u=s-1,c=this.readSync(e.dataId),h=e.size,d=new Float32Array(h);function f(g){for(var y=g%s,x=g-y+Math.max(0,y-t),b=g-y+Math.min(y+t,u),_=0;x<=b;x++){var w=c[x];_+=w*w}return _}for(var p=0;p<h;p++){var v=f(p),m=c[p]*Math.pow(o+a*v,-i);d[p]=m}return st(d,e.shape)},n.prototype.LRNGrad=function(e,t,o,a,i,s,u){G(e,"LRNGrad");for(var c=e.shape[3],h=this.readSync(e.dataId),d=this.readSync(t.dataId),f=this.readSync(o.dataId),p=new Float32Array(e.size),v=e.size,m=0;m<v;m++){for(var g=m%c,y=m-g+Math.max(0,g-a),x=m-g+Math.min(c,g+a+1),b=0,_=y;_<x;_++)b+=Math.pow(d[_],2);for(b=s*b+i,_=y;_<x;_++){var w=-2*s*u*d[_]*f[m]/b;m===_&&(w+=Math.pow(b,-u)),p[_]+=w*=h[m]}}return st(p,e.shape)},n.prototype.multinomial=function(e,t,o,a){G(e,"multinomial");for(var i=t?e:Zt(e),s=i.shape[0],u=i.shape[1],c=De([s,o],"int32"),h=this.readSync(c.dataId),d=this.readSync(i.dataId),f=0;f<s;++f){var p=f*u,v=new Float32Array(u-1);v[0]=d[p];for(var m=1;m<v.length;++m)v[m]=v[m-1]+d[p+m];for(var g=ao(a.toString()),y=f*o,x=0;x<o;++x){var b=g();h[y+x]=v.length;for(var _=0;_<v.length;_++)if(b<v[_]){h[y+x]=_;break}}}return c},n.prototype.oneHot=function(e,t,o,a){G(e,"oneHot");var i=new Float32Array(e.size*t);i.fill(a);for(var s=this.readSync(e.dataId),u=0;u<e.size;++u)s[u]>=0&&s[u]<t&&(i[u*t+s[u]]=o);return cn(i,[e.size,t],"int32")},n.prototype.nonMaxSuppression=function(e,t,o,a,i){return G(e,"nonMaxSuppression"),Fa(this.readSync(e.dataId),this.readSync(t.dataId),o,a,i)},n.prototype.fft=function(e){return this.fftBatch(e,!1)},n.prototype.ifft=function(e){return this.fftBatch(e,!0)},n.prototype.fftBatch=function(e,t){for(var o=e.shape[0],a=e.shape[1],i=se(e.shape,"float32"),s=se(e.shape,"float32"),u=gt(e).as2D(o,a),c=Pt(e).as2D(o,a),h=0;h<o;h++)for(var d=u.slice([h,0],[1,a]),f=c.slice([h,0],[1,a]),p=Ye(d,f),v=this.readSync(this.fftImpl(p,t).dataId),m=0;m<a;m++){var g=Au(v,m);i.values[h*a+m]=g.real,s.values[h*a+m]=g.imag}return Ye(i.toTensor(),s.toTensor()).as2D(o,a)},n.prototype.fftImpl=function(e,t){var o=e.as1D(),a=o.size;if(this.isExponentOf2(a)){var i=this.fftRadix2(o,a,t).as2D(e.shape[0],e.shape[1]);return t&&(i=Ye(gt(i).div(Z(a)),Pt(i).div(Z(a)))),i}var s=this.readSync(e.dataId),u=function(c){for(var h=new Float32Array(c.length/2),d=new Float32Array(c.length/2),f=0;f<c.length;f+=2)h[f/2]=c[f],d[f/2]=c[f+1];return{real:h,imag:d}}(this.fourierTransformByMatmul(s,a,t));return Ye(u.real,u.imag).as2D(e.shape[0],e.shape[1])},n.prototype.isExponentOf2=function(e){return 0==(e&e-1)},n.prototype.fftRadix2=function(e,t,o){if(1===t)return e;var a=this.readSync(e.dataId),i=t/2,s=function(y){for(var x=Math.ceil(y.length/4),b=new Float32Array(x),_=new Float32Array(x),w=0;w<y.length;w+=4)b[Math.floor(w/4)]=y[w],_[Math.floor(w/4)]=y[w+1];return{real:b,imag:_}}(a),u=Ye(s.real,s.imag).as1D(),c=function(y){for(var x=Math.floor(y.length/4),b=new Float32Array(x),_=new Float32Array(x),w=2;w<y.length;w+=4)b[Math.floor(w/4)]=y[w],_[Math.floor(w/4)]=y[w+1];return{real:b,imag:_}}(a),h=Ye(c.real,c.imag).as1D();u=this.fftRadix2(u,i,o),h=this.fftRadix2(h,i,o);var d=function(y,x){for(var b=new Float32Array(y/2),_=new Float32Array(y/2),w=0;w<Math.ceil(y/2);w++){var T=(x?2:-2)*Math.PI*(w/y);b[w]=Math.cos(T),_[w]=Math.sin(T)}return{real:b,imag:_}}(t,o),f=Ye(d.real,d.imag).mul(h),p=u.add(f),v=u.sub(f),m=gt(p).concat(gt(v)),g=Pt(p).concat(Pt(v));return Ye(m,g).as1D()},n.prototype.fourierTransformByMatmul=function(e,t,o){for(var a=new Float32Array(2*t),i=0;i<t;i++){for(var s=0,u=0,c=0;c<t;c++){var h=Ad(i*c,t,o),d=Au(e,c);s+=d.real*h.real-d.imag*h.imag,u+=d.real*h.imag+d.imag*h.real}o&&(s/=t,u/=t),kd(a,s,u,i)}return a},n.prototype.depthToSpace=function(e,t,o){E("NHWC"===o,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),E(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var a=e.shape[0],i=e.shape[1],s=e.shape[2],u=e.shape[3],c=i*t,h=s*t,d=u/(t*t),f=this.readSync(e.dataId),p=new Float32Array(a*c*h*d),v=0,m=0;m<a;++m)for(var g=0;g<c;++g)for(var y=Math.floor(g/t),x=g%t,b=0;b<h;++b)for(var _=Math.floor(b/t),w=(x*t+b%t)*d,T=0;T<d;++T)p[v++]=f[T+w+u*(_+s*(y+i*m))];return st(p,[a,c,h,d])},n.prototype.broadcastedBinaryOp=function(e,t,o,a){var i=de(e.shape,t.shape),s=se(i,o),u=this.readSync(e.dataId),c=this.readSync(t.dataId),h=jt(e.shape,i),d=jt(t.shape,i),f=s.values;if(h.length+d.length===0)for(var p=0;p<f.length;++p)f[p]=a(u[p%u.length],c[p%c.length]);else{var v=this.bufferSync(e),m=this.bufferSync(t),g=function(y){var x=s.indexToLoc(y),b=x.slice(-e.rank);h.forEach(function(A){return b[A]=0});var _=v.locToIndex(b),w=x.slice(-t.rank);d.forEach(function(A){return w[A]=0});var T=m.locToIndex(w);f[y]=a(u[_],c[T])};for(p=0;p<f.length;++p)g(p)}return s.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(e,t,o){var a=de(e.shape,t.shape),i=se(a,"float32"),s=se(a,"float32"),u=this.readSync(e.dataId),c=this.readSync(t.dataId),h=jt(e.shape,a),d=jt(t.shape,a),f=i.values,p=s.values;if(h.length+d.length===0)for(var v=0;v<f.length;v++){var m=v%u.length,g=v%c.length,y=o(u[2*m],u[2*m+1],c[2*g],c[2*g+1]);f[v]=y.real,p[v]=y.imag}else{var x=this.bufferSync(this.data.get(e.dataId).complexTensors.real),b=this.bufferSync(this.data.get(t.dataId).complexTensors.real),_=function(w){var T=i.indexToLoc(w),A=T.slice(-e.rank);h.forEach(function(P){return A[P]=0});var k=x.locToIndex(A),I=T.slice(-t.rank);d.forEach(function(P){return I[P]=0});var D=b.locToIndex(I),N=o(u[2*k],u[2*k+1],c[2*D],c[2*D+1]);f[w]=N.real,p[w]=N.imag};for(v=0;v<f.length;v++)_(v)}return this.complex(i.toTensor(),s.toTensor())},n.prototype.split=function(e,t,o){return Pu(e,t,o)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(e,t,o,a,i,s){for(var u=e.shape,c=u[0],h=u[1],d=u[2],f=u[3],p=t.shape[0],v=a[0],m=a[1],g=se([p,v,m,f],"float32"),y=this.readSync(t.dataId),x=this.readSync(o.dataId),b=this.readSync(e.dataId),_=e.strides,w=g.strides,T=0;T<p;T++){var A=4*T,k=y[A],I=y[A+1],D=y[A+2],N=y[A+3],P=x[T];if(!(P>=c))for(var W=v>1?(D-k)*(h-1)/(v-1):0,B=m>1?(N-I)*(d-1)/(m-1):0,L=0;L<v;L++){var q=v>1?k*(h-1)+L*W:.5*(k+D)*(h-1);if(q<0||q>h-1)for(var V=0;V<m;V++)for(var U=0;U<f;U++){var z=U+V*w[2]+L*w[1]+T*w[0];g.values[z]=s}else if("bilinear"===i){var H=Math.floor(q),K=Math.ceil(q),re=q-H;for(V=0;V<m;V++)if((me=m>1?I*(d-1)+V*B:.5*(I+N)*(d-1))<0||me>d-1)for(U=0;U<f;U++)g.values[z=U+V*w[2]+L*w[1]+T*w[0]]=s;else{var oe=Math.floor(me),le=Math.ceil(me),he=me-oe;for(U=0;U<f;U++){var pe=b[z=U+oe*_[2]+H*_[1]+P*_[0]],be=b[z=U+le*_[2]+H*_[1]+P*_[0]],ve=b[z=U+oe*_[2]+K*_[1]+P*_[0]],_e=pe+(be-pe)*he,Me=ve+(b[z=U+le*_[2]+K*_[1]+P*_[0]]-ve)*he;g.values[z=U+V*w[2]+L*w[1]+T*w[0]]=_e+(Me-_e)*re}}}else for(V=0;V<m;++V){var me;if((me=m>1?I*(d-1)+V*B:.5*(I+N)*(d-1))<0||me>d-1)for(U=0;U<f;U++)g.values[z=U+V*w[2]+L*w[1]+T*w[0]]=s;else{var Te=Math.round(me),Ce=Math.round(q);for(U=0;U<f;U++)g.values[U+V*w[2]+L*w[1]+T*w[0]]=b[U+Te*_[2]+Ce*_[1]+P*_[0]]}}}}return g.toTensor()},n.prototype.sparseToDense=function(e,t,o,a){var i=Er(0,e,o);return this.scatter(e,t,o,i.outputSize,i.sliceSize,i.numUpdates,i.sliceRank,i.strides,a,!1)},n.prototype.gatherND=function(e,t){var o=t.shape,a=o[o.length-1],i=Ta(e,t),s=i[0],u=i[1],c=i[2],h=i[3];if(0===u)return Xe([],s,e.dtype);for(var d=new vr([u,c],e.dtype),f=this.readSync(t.dataId),p=this.readSync(e.dataId),v=0;v<u;v++){for(var m=[],g=0,y=0;y<a;y++){var x=f[v*a+y];g+=x*h[y],m.push(x)}if(g<0||g>=e.size/c)throw new Error("Invalid indices: "+m+" does not index into "+e.shape);for(var b=0;b<c;b++)d.values[v*c+b]=p[g*c+b]}return d.toTensor().reshape(s)},n.prototype.scatterND=function(e,t,o){var a=Er(0,e,o),i=a.sliceRank,s=a.numUpdates,u=a.sliceSize,c=a.strides,h=a.outputSize,d=Z(0);return this.scatter(e,t,o,h,u,s,i,c,d,!0)},n.prototype.fill=function(e,t,o){var a=lr(o=o||Wn(t),$(e));return a.fill(t),S.makeTensor(a,e,o,this)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){var t=lr(e.dtype,$(e.shape));return this.makeOutput(t,e.shape,e.dtype)},n.prototype.linspace=function(e,t,o){return Pa(e,t,o)},n.prototype.scatter=function(e,t,o,a,i,s,u,c,h,d){var f=[a/i,i],p=this.readSync(e.dataId),v=this.readSync(t.dataId);if(0===a)return Xe([],o,t.dtype);var m=new vr(f,t.dtype);m.values.fill(this.readSync(h.dataId)[0]);for(var g=0;g<s;g++){for(var y=[],x=0,b=0;b<u;b++){var _=p[g*u+b];y.push(_),x+=_*c[b]}if(x<0||x>=a/i)throw new Error("Invalid indices: "+y+" does not index into "+o);for(var w=0;w<i;w++)d?m.values[x*i+w]+=v[g*i+w]:m.values[x*i+w]=0===t.rank?v[0]:v[g*i+w]}return m.toTensor().reshape(o)},n}(ku);S.registerBackend("cpu",function(){return new Nm},1);for(var ci=0,ul=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(r){var n=r.inputs,t=r.attrs,a=n.boxes,i=n.scores,u=t.maxOutputSize,c=t.iouThreshold,h=t.scoreThreshold,d=t.softNmsSigma,f=r.backend;G(a,"NonMaxSuppressionWithScore");var p=Ma(f.data.get(a.dataId).values,f.data.get(i.dataId).values,u,c,h,d);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var t=r.inputs.x,o=r.backend;G(t,"square");for(var a=o.data.get(t.dataId).values,i=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];i[s]=u*u}return{dataId:o.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}},{kernelName:Rr,backendName:"cpu",kernelFunc:function(r){var n=r.inputs,o=n.a,a=n.b,i=r.backend;G([o,a],Rr);var s=i.data.get(o.dataId).values,u=i.data.get(a.dataId).values,c=function(f,p,v,m,g,y){var x=de(f,p),b=x.length,_=_t(x),w=Ln(g,$(x)),T=f.length,A=p.length,k=_t(f),I=_t(p),D=jt(f,x),N=jt(p,x);if(D.length+N.length===0)for(var P=0;P<w.length;++P)w[P]=y(v[P%v.length],m[P%m.length]);else{var W=function(B){var L=Rs(B,b,_),q=L.slice(-T);D.forEach(function(H){return q[H]=0});var V=oa(q,T,k),U=L.slice(-A);N.forEach(function(H){return U[H]=0});var z=oa(U,A,I);w[B]=y(v[V],m[z])};for(P=0;P<w.length;++P)W(P)}return[w,x]}(o.shape,a.shape,s,u,o.dtype,function(f,p){var v=f-p;return v*v}),d=c[1];return{dataId:i.write(c[0],d,o.dtype),shape:d,dtype:o.dtype}}}];ci<ul.length;ci++)xs(ul[ci]);for(var Yn,Fm=function(r){this.variableNames=["A"];var n=Qe(),e=r[0],t=r[1];this.outputShape=r,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+t+".0, "+e+".0);\n\n        vec4 values = "+n.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Mm=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Qe(),e=r[0],t=r[1];this.outputShape=r,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+t+".0, "+e+".0);\n            vec4 values = "+n.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+n.output+" = result;\n      }\n    "},li=0,cl=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(r){var e=r.backend,o=r.inputs.pixels,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],h=u[1],d=[h,c],f=[h,c,r.attrs.numChannels];(s||i)&&(null==Yn&&(Yn=document.createElement("canvas").getContext("2d")),Yn.canvas.width=c,Yn.canvas.height=h,Yn.drawImage(o,0,0,c,h),o=Yn.canvas);var p=e.makeTensorInfo(d,"int32");e.texData.get(p.dataId).usage=ct.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(p.dataId),o);var v=O().getBool("WEBGL_PACK")?new Mm(f):new Fm(f),m=e.runWebGLProgram(v,[p],"int32");return e.disposeData(p.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(r){var n=r.inputs,e=r.backend,t=r.attrs;no("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=n.scores,u=t.maxOutputSize,c=t.iouThreshold,h=t.scoreThreshold,d=t.softNmsSigma,f=e,p=Ma(f.readSync(n.boxes.dataId),f.readSync(i.dataId),u,c,h,d);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var t=r.inputs.x,o=r.backend,a=new ce(t.shape,"return x * x;");return o.runWebGLProgram(a,[t],t.dtype)}},{kernelName:Rr,backendName:"webgl",kernelFunc:function(r){var n=r.inputs,o=n.a,a=n.b,i=r.backend,s=O().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Kt("return (a - b) * (a - b);",o.shape,a.shape):new Ne("return (a - b) * (a - b);",o.shape,a.shape);return i.compileAndRun(s,[o,a])}}];li<cl.length;li++)xs(cl[li]);for(var hi=0,ll=[{kernelName:"Square",gradFunc:function(r,n){var e=n[0];return{x:function(){return r.mul(e.toFloat().mul(2))}}}},{kernelName:Rr,gradFunc:function(r,n){var e=n[0],t=n[1],o=Z(2);return{a:function(){return $e(r,$e(o,qe(e,t)))},b:function(){return $e(r,$e(o,qe(t,e)))}}}}];hi<ll.length;hi++)Bh(ll[hi]);var Om=function(){function r(){}return r.prototype.fetch=function(n,e){return fetch(n,e)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(n,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},r.prototype.decode=function(n,e){return new TextDecoder(e).decode(n)},r}();O().get("IS_BROWSER")&&O().setPlatform("browser",new Om);var di,Lm=function(){function r(){this.util=Ue(5118),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(n,e){return null!=O().global.fetch?O().global.fetch(n,e):(null==di&&(di=Ue(3655)),di(n,e))},r.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},r.prototype.encode=function(n,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(n)},r.prototype.decode=function(n,e){return 0===n.length?"":new this.util.TextDecoder(e).decode(n)},r}();O().get("IS_NODE")&&O().setPlatform("node",new Lm);var fi={float32:4,int32:4,uint16:2,uint8:1,bool:1},Ro=4;function hl(r,n){for(var e={},t=0,o=function(s){var u=s.name,c=s.dtype,h=s.shape,d=$(h),f=void 0;if("quantization"in s){var p=s.quantization;if("uint8"!==p.dtype&&"uint16"!==p.dtype)throw new Error("Weight "+s.name+" has unknown quantization dtype "+p.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var v=fi[p.dtype],m=r.slice(t,t+d*v),g="uint8"===p.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)f=Float32Array.from(g,function(T){return T*p.scale+p.min});else{if("int32"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=Int32Array.from(g,function(T){return Math.round(T*p.scale+p.min)})}t+=d*v}else if("string"===c){var y=$(s.shape);f=[];for(var x=0;x<y;x++){var b=new Uint32Array(r.slice(t,t+Ro))[0];t+=Ro;var _=new Uint8Array(r.slice(t,t+b));f.push(_),t+=b}}else{var w=fi[c];if(m=r.slice(t,t+d*w),"float32"===c)f=new Float32Array(m);else if("int32"===c)f=new Int32Array(m);else{if("bool"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=new Uint8Array(m)}t+=d*w}e[u]=Xe(f,h,c)},a=0,i=n;a<i.length;a++)o(i[a]);return e}function Wm(r){if(null===r)throw new Error("Invalid input value: "+JSON.stringify(r));var n=0,e=[];r.forEach(function(a){if(n+=a.byteLength,e.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)});var t=new Uint8Array(n),o=0;return e.forEach(function(a){t.set(new Uint8Array(a.buffer),o),o+=a.byteLength}),t.buffer}var pi=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function dl(r){return pi?Buffer.byteLength(r):new Blob([r]).size}function vi(r){var n=0;r.forEach(function(o){n+=o.byteLength});var e=new Uint8Array(n),t=0;return r.forEach(function(o){e.set(new Uint8Array(o),t),t+=o.byteLength}),e.buffer}function fl(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var n=r.split("/");return n[n.length-1]}function Mr(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==r.modelTopology?0:dl(JSON.stringify(r.modelTopology)),weightSpecsBytes:null==r.weightSpecs?0:dl(JSON.stringify(r.weightSpecs)),weightDataBytes:null==r.weightData?0:r.weightData.byteLength}}var ft=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return null==r.instance&&(r.instance=new r),r.instance},r.registerSaveRouter=function(n){r.getInstance().saveRouters.push(n)},r.registerLoadRouter=function(n){r.getInstance().loadRouters.push(n)},r.getSaveHandlers=function(n){return r.getHandlers(n,"save")},r.getLoadHandlers=function(n,e){return r.getHandlers(n,"load",e)},r.getHandlers=function(n,e,t){var o=[];return("load"===e?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(a){var i=a(n,t);null!==i&&o.push(i)}),o},r}(),Xn="://",dn=function(){function r(){this.managers={}}return r.getInstance=function(){return null==r.instance&&(r.instance=new r),r.instance},r.registerManager=function(n,e){E(null!=n,function(){return"scheme must not be undefined or null."}),n.endsWith(Xn)&&(n=n.slice(0,n.indexOf(Xn))),E(n.length>0,function(){return"scheme must not be an empty string."});var t=r.getInstance();E(null==t.managers[n],function(){return"A model store manager is already registered for scheme '"+n+"'."}),t.managers[n]=e},r.getManager=function(n){var e=this.getInstance().managers[n];if(null==e)throw new Error("Cannot find model manager for scheme '"+n+"'");return e},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r}();function Po(r){if(-1===r.indexOf(Xn))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+dn.getSchemes().join(","));return{scheme:r.split(Xn)[0],path:r.split(Xn)[1]}}function pl(r,n,e){return void 0===e&&(e=!1),X(this,void 0,void 0,function(){var t,o,a,i,s,u,c,h,d;return Q(this,function(f){switch(f.label){case 0:return E(r!==n,function(){return"Old path and new path are the same: '"+r+"'"}),E((t=ft.getLoadHandlers(r)).length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),E(t.length<2,function(){return"Copying failed because more than one ("+t.length+") load handlers for source URL "+r+"."}),o=t[0],E((a=ft.getSaveHandlers(n)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+n+"."}),E(a.length<2,function(){return"Copying failed because more than one ("+t.length+") save handlers for destination URL "+n+"."}),i=a[0],s=Po(r).scheme,u=Po(r).path,c=s===Po(r).scheme,[4,o.load()];case 1:return h=f.sent(),e&&c?[4,dn.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,i.save(h)];case 4:return d=f.sent(),!e||c?[3,6]:[4,dn.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var Rn="models_store",fn="model_info_store";function vl(){if(!O().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window||self,n=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(null==n)throw new Error("The current browser does not appear to support IndexedDB.");return n}function mi(r){var n=r.result;n.createObjectStore(Rn,{keyPath:"modelPath"}),n.createObjectStore(fn,{keyPath:"modelPath"})}var Qn=function(){function r(n){if(this.indexedDB=vl(),null==n||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return r.prototype.save=function(n){return X(this,void 0,void 0,function(){return Q(this,function(e){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]})})},r.prototype.load=function(){return X(this,void 0,void 0,function(){return Q(this,function(n){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(n,e){var t=this;return new Promise(function(o,a){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return mi(i)},i.onsuccess=function(){var s=i.result;if(null==e){var u=s.transaction(Rn,"readonly"),c=u.objectStore(Rn).get(t.modelPath);c.onsuccess=function(){if(null==c.result)return s.close(),a(new Error("Cannot find model with path '"+t.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(m){return s.close(),a(c.error)},u.oncomplete=function(){return s.close()}}else{var h,d=Mr(e),f=s.transaction(fn,"readwrite"),p=f.objectStore(fn),v=p.put({modelPath:t.modelPath,modelArtifactsInfo:d});v.onsuccess=function(){var m=(h=s.transaction(Rn,"readwrite")).objectStore(Rn).put({modelPath:t.modelPath,modelArtifacts:e,modelArtifactsInfo:d});m.onsuccess=function(){return o({modelArtifactsInfo:d})},m.onerror=function(g){var y=(p=f.objectStore(fn)).delete(t.modelPath);y.onsuccess=function(){return s.close(),a(m.error)},y.onerror=function(x){return s.close(),a(m.error)}}},v.onerror=function(m){return s.close(),a(v.error)},f.oncomplete=function(){null==h?s.close():h.oncomplete=function(){return s.close()}}}},i.onerror=function(s){return a(i.error)}})},r.URL_SCHEME="indexeddb://",r}(),ml=function(r){return O().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Qn.URL_SCHEME)?(n=r.slice(Qn.URL_SCHEME.length),new Qn(n)):null;var n};ft.registerSaveRouter(ml),ft.registerLoadRouter(ml);var Um=function(){function r(){this.indexedDB=vl()}return r.prototype.listModels=function(){return X(this,void 0,void 0,function(){var n=this;return Q(this,function(e){return[2,new Promise(function(t,o){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return mi(a)},a.onsuccess=function(){var i=a.result,s=i.transaction(fn,"readonly"),u=s.objectStore(fn).getAll();u.onsuccess=function(){for(var c={},h=0,d=u.result;h<d.length;h++){var f=d[h];c[f.modelPath]=f.modelArtifactsInfo}t(c)},u.onerror=function(c){return i.close(),o(u.error)},s.oncomplete=function(){return i.close()}},a.onerror=function(i){return o(a.error)}})]})})},r.prototype.removeModel=function(n){return X(this,void 0,void 0,function(){var e=this;return Q(this,function(t){var o;return n=(o=n).startsWith(Qn.URL_SCHEME)?o.slice(Qn.URL_SCHEME.length):o,[2,new Promise(function(a,i){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return mi(s)},s.onsuccess=function(){var u,c=s.result,h=c.transaction(fn,"readwrite"),d=h.objectStore(fn),f=d.get(n);f.onsuccess=function(){if(null==f.result)return c.close(),i(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var p=d.delete(n),v=function(){var m=(u=c.transaction(Rn,"readwrite")).objectStore(Rn).delete(n);m.onsuccess=function(){return a(f.result.modelArtifactsInfo)},m.onerror=function(g){return i(f.error)}};p.onsuccess=v,p.onerror=function(m){return v(),c.close(),i(f.error)}},f.onerror=function(p){return c.close(),i(f.error)},h.oncomplete=function(){null==u?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return i(s.error)}})]})})},r}();if(O().getBool("IS_BROWSER"))try{dn.registerManager(Qn.URL_SCHEME,new Um)}catch(r){}var Yt="/",$n="tensorflowjs_models",gl="info",Vm="model_topology",Gm="weight_specs",qm="weight_data",zm="model_metadata";function yl(r){return{info:[$n,r,gl].join(Yt),topology:[$n,r,Vm].join(Yt),weightSpecs:[$n,r,Gm].join(Yt),weightData:[$n,r,qm].join(Yt),modelMetadata:[$n,r,zm].join(Yt)}}function Hm(r){var n=r.split(Yt);if(n.length<3)throw new Error("Invalid key format: "+r);return n.slice(1,n.length-1).join(Yt)}var er=function(){function r(n){if(!O().getBool("IS_BROWSER")||typeof window>"u"||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==n||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=yl(this.modelPath)}return r.prototype.save=function(n){return X(this,void 0,void 0,function(){var e,t,o;return Q(this,function(a){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(n.modelTopology),t=JSON.stringify(n.weightSpecs),o=Mr(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,t),this.LS.setItem(this.keys.weightData,function(i){if(pi)return Buffer.from(i).toString("base64");for(var s=new Uint8Array(i),u="",c=0,h=s.length;c<h;c++)u+=String.fromCharCode(s[c]);return btoa(u)}(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch(i){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},r.prototype.load=function(){return X(this,void 0,void 0,function(){var n,e,t,o,a,i,s;return Q(this,function(u){if(null==(n=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==n.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(t=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=t,null==(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=o,null!=(a=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(a),e.format=i.format,e.generatedBy=i.generatedBy,e.convertedBy=i.convertedBy,e.userDefinedMetadata=i.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(c){if(pi){var h=Buffer.from(c,"base64");return h.buffer.slice(h.byteOffset,h.byteOffset+h.byteLength)}for(var d=atob(c),f=new Uint8Array(d.length),p=0;p<d.length;++p)f.set([d.charCodeAt(p)],p);return f.buffer}(s),[2,e]})})},r.URL_SCHEME="localstorage://",r}(),xl=function(r){return O().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(er.URL_SCHEME)?(n=r.slice(er.URL_SCHEME.length),new er(n)):null;var n};ft.registerSaveRouter(xl),ft.registerLoadRouter(xl);var Zm=function(){function r(){E(O().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),E(typeof window>"u"||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return X(this,void 0,void 0,function(){var n,e,t,o,a,i;return Q(this,function(s){for(n={},e=$n+Yt,t=Yt+gl,o=0;o<this.LS.length;++o)(a=this.LS.key(o)).startsWith(e)&&a.endsWith(t)&&(i=Hm(a),n[i]=JSON.parse(this.LS.getItem(a)));return[2,n]})})},r.prototype.removeModel=function(n){return X(this,void 0,void 0,function(){var e,t;return Q(this,function(o){var a;if(n=(a=n).startsWith(er.URL_SCHEME)?a.slice(er.URL_SCHEME.length):a,e=yl(n),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+n+"'");return t=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,t]})})},r}();if(O().getBool("IS_BROWSER"))try{dn.registerManager(er.URL_SCHEME,new Zm)}catch(r){}var jm="model",Km=".json",Jm=".weights.bin";function bl(r){return new Promise(function(n){return setTimeout(n)}).then(r)}var gi=function(){function r(n){if(!O().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(r.URL_SCHEME)&&(n=n.slice(r.URL_SCHEME.length)),null!=n&&0!==n.length||(n=jm),this.modelTopologyFileName=n+Km,this.weightDataFileName=n+Jm}return r.prototype.save=function(n){return X(this,void 0,void 0,function(){var e,a,i,s;return Q(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return a=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}]})],{type:"application/json"})),(i=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=a,[4,bl(function(){return i.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),null==n.weightData?[3,4]:((s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,[4,bl(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Mr(n)}]}})})},r.URL_SCHEME="downloads://",r}(),Ym=function(){function r(n){if(null==n||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return r.prototype.load=function(){return X(this,void 0,void 0,function(){var n,e,t=this;return Q(this,function(o){return n=this.files[0],e=this.files.slice(1),[2,new Promise(function(a,i){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),h=c.modelTopology;if(null!=h){0===e.length&&a({modelTopology:h});var d=c.weightsManifest;if(null!=d){var f;try{f=t.checkManifestAndWeightFiles(d,e)}catch(g){return void i(g)}var p=[],v=[],m=[];d.forEach(function(g){g.paths.forEach(function(y){v.push(y),m.push(null)}),p.push.apply(p,g.weights)}),d.forEach(function(g){g.paths.forEach(function(y){var x=new FileReader;x.onload=function(b){var _=b.target.result,w=v.indexOf(y);m[w]=_,-1===m.indexOf(null)&&a({modelTopology:h,weightSpecs:p,weightData:vi(m),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},x.onerror=function(b){return i("Failed to weights data from file of path '"+y+"'.")},x.readAsArrayBuffer(f[y])})})}else i(new Error("weightManifest field is missing from file "+n.name))}else i(new Error("modelTopology field is missing from file "+n.name))},s.onerror=function(u){return i("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(n)})]})})},r.prototype.checkManifestAndWeightFiles=function(n,e){for(var t=[],o=e.map(function(u){return fl(u.name)}),a={},i=0,s=n;i<s.length;i++)s[i].paths.forEach(function(u){var c=fl(u);if(-1!==t.indexOf(c))throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(t.push(c),-1===o.indexOf(c))throw new Error("Weight file with basename '"+c+"' is not provided.");a[u]=e[o.indexOf(c)]});if(t.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+t.length+") and the number of weight files provided ("+e.length+").");return a},r}();function _l(r,n,e,t){var a;E(null!=(a=r)&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"}),function(a,i){E(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a}),E(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+i}),E(i>=a,function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+i})}(e=null==e?0:e,t=null==t?1:t);var o=0;return Promise.all(r.map(function(a){return a.then(function(i){var s=e+ ++o/r.length*(t-e);return n(s),i}),a}))}function wl(r,n){return X(this,void 0,void 0,function(){var e,t,o,a,i,s,u,c,h;return Q(this,function(d){switch(d.label){case 0:return null==n&&(n={}),e=null==n.fetchFunc?O().platform.fetch:n.fetchFunc,t=r.map(function(f){return e(f,n.requestInit,{isBinary:!0})}),o=0,a=.5,null!=n.onProgress?[3,2]:[4,Promise.all(t)];case 1:return i=d.sent(),[3,4];case 2:return[4,_l(t,n.onProgress,o,a)];case 3:i=d.sent(),d.label=4;case 4:return s=i.map(function(f){return f.arrayBuffer()}),u=.5,c=1,null!=n.onProgress?[3,6]:[4,Promise.all(s)];case 5:return h=d.sent(),[3,8];case 6:return[4,_l(s,n.onProgress,u,c)];case 7:h=d.sent(),d.label=8;case 8:return[2,h]}})})}function Cl(r){var n=this;return function(e,t,o){return void 0===t&&(t=""),X(n,void 0,void 0,function(){var a,i,s,u,c,h,d,f,p,v;return Q(this,function(m){switch(m.label){case 0:if(a=e.map(function(){return!1}),i={},s=null!=o?o.map(function(){return!1}):[],u=[],e.forEach(function(g,y){var x=0;g.weights.forEach(function(b){var w=fi["quantization"in b?b.quantization.dtype:b.dtype]*$(b.shape),T=function(){a[y]=!0,null==i[y]&&(i[y]=[]),i[y].push({manifestEntry:b,groupOffset:x,sizeBytes:w})};null!=o?o.forEach(function(A,k){A===b.name&&(T(),s[k]=!0)}):T(),u.push(b.name),x+=w})}),!s.every(function(g){return g}))throw c=o.filter(function(g,y){return!s[y]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return h=a.reduce(function(g,y,x){return y&&g.push(x),g},[]),d=[],h.forEach(function(g){e[g].paths.forEach(function(y){var x=t+(t.endsWith("/")?"":"/")+y;d.push(x)})}),[4,r(d)];case 1:return f=m.sent(),p={},v=0,h.forEach(function(g){for(var y=e[g].paths.length,x=0,b=0;b<y;b++)x+=f[v+b].byteLength;for(var _=new ArrayBuffer(x),w=new Uint8Array(_),T=0,A=0;A<y;A++){var k=new Uint8Array(f[v+A]);w.set(k,T),T+=k.byteLength}i[g].forEach(function(I){var D=hl(_.slice(I.groupOffset,I.groupOffset+I.sizeBytes),[I.manifestEntry]);for(var N in D)p[N]=D[N]}),v+=y}),[2,p]}})})}}ft.registerSaveRouter(function(r){return O().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(gi.URL_SCHEME)?(void 0===(n=r.slice(gi.URL_SCHEME.length))&&(n="model"),new gi(n)):null;var n});var Tl=function(){function r(n,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(E("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=O().platform.fetch,E(null!=n&&n.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(n)&&E(2===n.length,function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."}),this.path=n,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return r.prototype.save=function(n){return X(this,void 0,void 0,function(){var e,a;return Q(this,function(i){switch(i.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:n.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=n.weightData&&e.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((a=i.sent()).ok)return[2,{modelArtifactsInfo:Mr(n),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}})})},r.prototype.load=function(){return X(this,void 0,void 0,function(){var n,e,t,o,a,i,s,u,c,h,d,f;return Q(this,function(p){switch(p.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=p.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");p.label=2;case 2:return p.trys.push([2,4,,5]),[4,n.json()];case 3:return e=p.sent(),[3,5];case 4:throw p.sent(),t="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t);case 5:if(a=e.weightsManifest,i=e.generatedBy,s=e.convertedBy,u=e.format,c=e.userDefinedMetadata,null==(o=e.modelTopology)&&null==a)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==a?[3,7]:[4,this.loadWeights(a)];case 6:f=p.sent(),h=f[0],d=f[1],p.label=7;case 7:return[2,{modelTopology:o,weightSpecs:h,weightData:d,userDefinedMetadata:c,generatedBy:i,convertedBy:s,format:u}]}})})},r.prototype.loadWeights=function(n){return X(this,void 0,void 0,function(){var t,o,a,i,s,u,c,d,f;return Q(this,function(p){switch(p.label){case 0:for(void 0,void 0,m=(v=Array.isArray(this.path)?this.path[1]:this.path).lastIndexOf("/"),g=v.lastIndexOf("?"),t=[v.substring(0,m)+"/",g>m?v.substring(g):""],o=t[0],a=t[1],i=this.weightPathPrefix||o,s=[],u=0,c=n;u<c.length;u++)s.push.apply(s,c[u].weights);return d=[],n.forEach(function(v){v.paths.forEach(function(m){d.push(i+m+a)})}),[4,wl(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=p.sent(),[2,[s,vi(f)]]}var v,m,g})})},r.URL_SCHEME_REGEX=/^https?:\/\//,r}();function yi(r){return null!=r.match(Tl.URL_SCHEME_REGEX)}var El=function(r,n){return typeof fetch>"u"?null:(Array.isArray(r)?r.every(function(e){return yi(e)}):yi(r))?xi(r,{onProgress:n}):null};function xi(r,n){return new Tl(r,n)}ft.registerSaveRouter(El),ft.registerLoadRouter(El);var tr,bi=function(){function r(n){this.modelArtifacts=n}return r.prototype.load=function(){return X(this,void 0,void 0,function(){return Q(this,function(n){return[2,this.modelArtifacts]})})},r}(),Xm=function(){function r(n){this.saveHandler=n}return r.prototype.save=function(n){return X(this,void 0,void 0,function(){return Q(this,function(e){return[2,this.saveHandler(n)]})})},r}(),Il=Object.freeze({browserFiles:function(r){return new Ym(r)},browserHTTPRequest:function(r,n){return xi(r,n)},concatenateArrayBuffers:vi,decodeWeights:hl,encodeWeights:function(r,n){return X(this,void 0,void 0,function(){var e,t,o,a,i,s=this;return Q(this,function(u){switch(u.label){case 0:for(e=[],t=[],o=Array.isArray(r)?r.map(function(c){return c.name}):Object.keys(r),a=function(c){var h=o[c],d=Array.isArray(r)?r[c].tensor:r[h];if("float32"!==d.dtype&&"int32"!==d.dtype&&"bool"!==d.dtype&&"string"!==d.dtype)throw new Error("Unsupported dtype in weight '"+h+"': "+d.dtype);var f={name:h,shape:d.shape,dtype:d.dtype};if("string"===d.dtype){var p=new Promise(function(v){return X(s,void 0,void 0,function(){var m,g,y,x,b,_,w;return Q(this,function(T){switch(T.label){case 0:return[4,d.bytes()];case 1:for(m=T.sent(),g=m.reduce(function(A,k){return A+k.length},0)+Ro*m.length,y=new Uint8Array(g),x=0,b=0;b<m.length;b++)_=m[b],w=new Uint8Array(new Uint32Array([_.length]).buffer),y.set(w,x),y.set(_,x+=Ro),x+=_.length;return v(y),[2]}})})});t.push(p)}else t.push(d.data());null!=n&&(f.group=n),e.push(f)},i=0;i<o.length;++i)a(i);return[4,Promise.all(t)];case 1:return[2,{data:Wm(u.sent()),specs:e}]}})})},fromMemory:function(r,n,e,t){return 1===arguments.length?null!=r.modelTopology||null!=r.weightSpecs?new bi(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new bi({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new bi({modelTopology:r,weightSpecs:n,weightData:e,trainingConfig:t}))},getLoadHandlers:function(r,n){return ft.getLoadHandlers(r,n)},getModelArtifactsInfoForJSON:Mr,getSaveHandlers:function(r){return ft.getSaveHandlers(r)},http:xi,isHTTPScheme:yi,loadWeights:function(r,n,e,t){return void 0===n&&(n=""),X(this,void 0,void 0,function(){return Q(this,function(o){return[2,Cl(function(a){return wl(a,{requestInit:t})})(r,n,e)]})})},registerLoadRouter:function(r){return ft.registerLoadRouter(r)},registerSaveRouter:function(r){return ft.registerSaveRouter(r)},weightsLoaderFactory:Cl,withSaveHandler:function(r){return new Xm(r)},copyModel:function(r,n){return X(this,void 0,void 0,function(){return Q(this,function(e){return[2,pl(r,n,!1)]})})},listModels:function(){return X(this,void 0,void 0,function(){var r,n,e,t,o,a,i;return Q(this,function(s){switch(s.label){case 0:r=dn.getSchemes(),n={},e=0,t=r,s.label=1;case 1:return e<t.length?[4,dn.getManager(o=t[e]).listModels()]:[3,4];case 2:for(i in a=s.sent())n[o+Xn+i]=a[i];s.label=3;case 3:return e++,[3,1];case 4:return[2,n]}})})},moveModel:function(r,n){return X(this,void 0,void 0,function(){return Q(this,function(e){return[2,pl(r,n,!0)]})})},removeModel:function(r){return X(this,void 0,void 0,function(){var n;return Q(this,function(e){return n=Po(r),[2,dn.getManager(n.scheme).removeModel(n.path)]})})}}),Qm=R({confusionMatrix_:function(r,n,e){var t=C(r,"labels","confusionMatrix"),o=C(n,"predictions","confusionMatrix");E(null==e||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),E(1===t.rank,function(){return"Expected the rank of labels to be 1, but got "+t.rank}),E(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),E(t.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+t.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),E(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var a=Ca(t.asType("int32"),e),i=Ca(o.asType("int32"),e);return a.transpose().matMul(i).asType("int32")}}),$m=(Object.freeze({confusionMatrix:Qm}),R({fromPixels_:function(r,n){if(void 0===n&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==r)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,t=!1,o=!1,a=!1,i=!1;if(r.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)t=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)a=!0;else{if(null==r.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+r.constructor.name);i=!0}if(o&&o&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=gs("FromPixels",S.backendName))return S.runKernel("FromPixels",{pixels:r},{numChannels:n});var s,u,c=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],h=c[0],d=c[1];if(i?s=r.getContext("2d").getImageData(0,0,h,d).data:t||e?s=r.data:(a||o)&&(null==tr&&(tr=document.createElement("canvas").getContext("2d")),tr.canvas.width=h,tr.canvas.height=d,tr.drawImage(r,0,0,h,d),s=tr.getImageData(0,0,h,d).data),4===n)u=new Int32Array(s);else{var f=h*d;u=new Int32Array(f*n);for(var p=0;p<f;p++)for(var v=0;v<n;++v)u[p*n+v]=s[4*p+v]}return ba(u,[d,h,n],"int32")}})),_i=Object.freeze({toPixels:function(r,n){return X(this,void 0,void 0,function(){var e,t,o,a,i,s,u,c,h,p,v,m,g,y,x,b,_,w,T,A,k;return Q(this,function(I){switch(I.label){case 0:if(e=C(r,"img","toPixels"),r instanceof Ee||(e=e.toInt()),2!==e.rank&&3!==e.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(t=e.shape.slice(0,2),o=t[0],a=t[1],(i=2===e.rank?1:e.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,e.data()];case 1:return s=I.sent(),u=e.min(),c=e.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(h=I.sent(),p=h[0][0],v=h[1][0],u.dispose(),c.dispose(),"float32"===e.dtype){if(p<0||v>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+v+"].")}else{if("int32"!==e.dtype)throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(p<0||v>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+v+"].")}for(m="float32"===e.dtype?255:1,g=new Uint8ClampedArray(a*o*4),y=0;y<o*a;++y)x=void 0,b=void 0,_=void 0,w=void 0,1===i?(x=s[y]*m,b=s[y]*m,_=s[y]*m,w=255):3===i?(x=s[3*y]*m,b=s[3*y+1]*m,_=s[3*y+2]*m,w=255):4===i&&(x=s[4*y]*m,b=s[4*y+1]*m,_=s[4*y+2]*m,w=s[4*y+3]*m),g[0+(T=4*y)]=Math.round(x),g[T+1]=Math.round(b),g[T+2]=Math.round(_),g[T+3]=Math.round(w);return null!=n&&(n.width=a,n.height=o,A=n.getContext("2d"),k=new ImageData(g,a,o),A.putImageData(k,0,0)),e!==r&&e.dispose(),[2,g]}})})},fromPixels:$m}),Dl=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(n,e){return new n(e)},r}(),kl=function(){function r(){this.classNameMap={}}return r.getMap=function(){return null==r.instance&&(r.instance=new r),r.instance},r.register=function(n){r.getMap().classNameMap[n.className]=[n,n.fromConfig]},r}();function pn(r){E(null!=r.className,function(){return"Class being registered does not have the static className property defined."}),E("string"==typeof r.className,function(){return"className is required to be a string, but got type "+typeof r.className}),E(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),kl.register(r)}Object.freeze({Serializable:Dl,SerializationMap:kl,registerClass:pn});var eg=.001,Al=.1;function wi(){return 32===S.backend.floatPrecision()?eg:Al}function Ci(r,n,e){var t=!0;if((Ke(r)||Ke(n))&&(t=!1),Ke(r)&&Ke(n)&&(t=!0),t){var o=r.constructor.name,a=n.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(r)&&Array.isArray(n)){var i=Rt(r),s=Rt(n);if(!Oe(i,s))throw new Error("Arrays have different shapes. Actual: ["+i+"]. Expected: ["+s+"]")}var u=Ke(r)?r:qt(r),c=Ke(n)?n:qt(n);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var h=0;h<c.length;++h){var d=u[h],f=c[h];if(!e(d,f))throw new Error("Arrays differ: actual["+h+"] = "+d+", expected["+h+"] = "+f+".\nActual:   "+u+".\nExpected: "+c+".")}}function Ti(r,n,e){return!isFinite(r)&&!isFinite(n)||!(isNaN(r)||isNaN(n)||Math.abs(r-n)>e)}Object.freeze({TEST_EPSILON_FLOAT16:Al,expectArraysClose:function(r,n,e){return null==e&&(e=wi()),Ci(r,n,function(t,o){return Ti(t,o,e)})},testEpsilon:wi,expectPromiseToFail:function(r,n){r().then(function(){return n.fail()},function(){return n()})},expectArraysEqual:function(r,n){var e="string"==typeof n||"number"==typeof n||"boolean"==typeof n?[n]:n;return an(r)||an(r[0])||an(n)||an(n[0])?Ci(r,e,function(t,o){return t==o}):Ci(r,n,function(t,o){return Ti(t,o,0)})},expectNumbersClose:function(r,n,e){if(null==e&&(e=wi()),!Ti(r,n,e))throw new Error("Numbers differ: actual === "+r+", expected === "+n)},expectValuesInRange:function(r,n,e){for(var t=0;t<r.length;t++)if(r[t]<n||r[t]>e)throw new Error("Value out of range:"+r[t]+" low: "+n+", high: "+e)},expectArrayBuffersEqual:function(r,n){expect(new Float32Array(r)).toEqual(new Float32Array(n))}}),Object.freeze({gpgpu_util:Cf,webgl_util:Zh,forceHalfFloat:function(){O().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Ic,setWebGLContext:Ws,GPGPUContext:cc});var Pn=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return bt(n,r),n.prototype.minimize=function(e,t,o){void 0===t&&(t=!1);var a=this.computeGradients(e,o),i=a.value,s=a.grads;if(null!=o){var u=o.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return at(s),t?i:(i.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(e,t){return function Id(r,n){E(sn(r),function(){return"The f passed in variableGrads(f) must be a function"}),E(null==n||Array.isArray(n)&&n.every(function(h){return h instanceof Vn}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=null!=n;if(!e)for(var t in n=[],S.registeredVariables)n.push(S.registeredVariables[t]);var o=e?n.filter(function(h){return!h.trainable}):null,a=n.length;E((n=n.filter(function(h){return h.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var i=S.gradients(r,n,null,!0),s=i.value,u=i.grads;E(u.some(function(h){return null!=h}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),E(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return n.forEach(function(h,d){null!=u[d]&&(c[h.name]=u[d])}),null!=o&&o.forEach(function(h){return c[h.name]=null}),{value:s,grads:c}}(e,t)},n.prototype.dispose=function(){null!=this.iterations_&&at(this.iterations_)},n.prototype.saveIterations=function(){return X(this,void 0,void 0,function(){return Q(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Z(this.iterations_,"int32")}]})})},n.prototype.getWeights=function(){return X(this,void 0,void 0,function(){return Q(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},n.prototype.setWeights=function(e){return X(this,void 0,void 0,function(){return Q(this,function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},n.prototype.extractIterations=function(e){return X(this,void 0,void 0,function(){var t;return Q(this,function(o){switch(o.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=o.sent()[0],[2,e.slice(1)]}})})},n}(Dl);Object.defineProperty(Pn,Symbol.hasInstance,{value:function(r){return null!=r.minimize&&null!=r.computeGradients&&null!=r.applyGradients}});var Sl=function(r){function n(e,t,o){void 0===o&&(o=null);var a=r.call(this)||this;return a.learningRate=e,a.rho=t,a.epsilon=o,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==o&&(a.epsilon=S.backend.epsilon()),a}return bt(n,r),n.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=S.registeredVariables[o];null==t.accumulatedGrads[a]&&(t.accumulatedGrads[a]={originalName:o+"/accum_grad",variable:J(function(){return ye(i).variable(!1)})}),null==t.accumulatedUpdates[a]&&(t.accumulatedUpdates[a]={originalName:o+"/accum_var",variable:J(function(){return ye(i).variable(!1)})});var s=Array.isArray(e)?e[a].tensor:e[o];if(null!=s){var u=t.accumulatedGrads[a].variable,c=t.accumulatedUpdates[a].variable;J(function(){var h=u.mul(t.rho).add(s.square().mul(1-t.rho)),d=c.add(t.epsilon).sqrt().div(u.add(t.epsilon).sqrt()).mul(s),f=c.mul(t.rho).add(d.square().mul(1-t.rho));u.assign(h),c.assign(f);var p=d.mul(-t.learningRate).add(i);i.assign(p)})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedUpdates&&(at(this.accumulatedGrads.map(function(e){return e.variable})),at(this.accumulatedUpdates.map(function(e){return e.variable})))},n.prototype.getWeights=function(){return X(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return X(this,void 0,void 0,function(){var t;return Q(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),this.accumulatedGrads=e.slice(0,t=e.length/2).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},n.className="Adadelta",n}(Pn);pn(Sl);var Rl=function(r){function n(e,t){void 0===t&&(t=.1);var o=r.call(this)||this;return o.learningRate=e,o.initialAccumulatorValue=t,o.accumulatedGrads=[],o}return bt(n,r),n.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=S.registeredVariables[o];null==t.accumulatedGrads[a]&&(t.accumulatedGrads[a]={originalName:o+"/accumulator",variable:J(function(){return Nt(i.shape,t.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(e)?e[a].tensor:e[o];if(null!=s){var u=t.accumulatedGrads[a].variable;J(function(){var c=u.add(s.square());u.assign(c);var h=s.div(c.add(S.backend.epsilon()).sqrt()).mul(-t.learningRate).add(i);i.assign(h)})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedGrads&&at(this.accumulatedGrads.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return X(this,void 0,void 0,function(){return Q(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},n.prototype.setWeights=function(e){return X(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},n.className="Adagrad",n}(Pn);pn(Rl);var Pl=function(r){function n(e,t,o,a){void 0===a&&(a=null);var i=r.call(this)||this;return i.learningRate=e,i.beta1=t,i.beta2=o,i.epsilon=a,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],J(function(){i.accBeta1=Z(t).variable(),i.accBeta2=Z(o).variable()}),null==a&&(i.epsilon=S.backend.epsilon()),i}return bt(n,r),n.prototype.applyGradients=function(e){var t=this,o=Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e);J(function(){var a=qe(1,t.accBeta1),i=qe(1,t.accBeta2);o.forEach(function(s,u){var c=S.registeredVariables[s];null==t.accumulatedFirstMoment[u]&&(t.accumulatedFirstMoment[u]={originalName:s+"/m",variable:J(function(){return ye(c).variable(!1)})}),null==t.accumulatedSecondMoment[u]&&(t.accumulatedSecondMoment[u]={originalName:s+"/v",variable:J(function(){return ye(c).variable(!1)})});var h=Array.isArray(e)?e[u].tensor:e[s];if(null!=h){var d=t.accumulatedFirstMoment[u].variable,f=t.accumulatedSecondMoment[u].variable,p=d.mul(t.beta1).add(h.mul(1-t.beta1)),v=f.mul(t.beta2).add(h.square().mul(1-t.beta2)),m=p.div(a),g=v.div(i);d.assign(p),f.assign(v);var y=m.div(g.sqrt().add(t.epsilon)).mul(-t.learningRate).add(c);c.assign(y)}}),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&at(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&at(this.accumulatedSecondMoment.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return X(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return X(this,void 0,void 0,function(){var t,o=this;return Q(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(e)];case 1:return e=a.sent(),J(function(){o.accBeta1.assign(Eo(o.beta1,o.iterations_+1)),o.accBeta2.assign(Eo(o.beta2,o.iterations_+1))}),this.accumulatedFirstMoment=e.slice(0,t=e.length/2).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},n.className="Adam",n}(Pn);pn(Pl);var Nl=function(r){function n(e,t,o,a,i){void 0===a&&(a=null),void 0===i&&(i=0);var s=r.call(this)||this;return s.learningRate=e,s.beta1=t,s.beta2=o,s.epsilon=a,s.decay=i,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],J(function(){s.iteration=Z(0).variable(),s.accBeta1=Z(t).variable()}),null==a&&(s.epsilon=S.backend.epsilon()),s}return bt(n,r),n.prototype.applyGradients=function(e){var t=this,o=Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e);J(function(){var a=qe(1,t.accBeta1),i=Dt(-t.learningRate,t.iteration.mul(t.decay).add(1));o.forEach(function(s,u){var c=S.registeredVariables[s];null==t.accumulatedFirstMoment[u]&&(t.accumulatedFirstMoment[u]={originalName:s+"/m",variable:ye(c).variable(!1)}),null==t.accumulatedWeightedInfNorm[u]&&(t.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:ye(c).variable(!1)});var h=Array.isArray(e)?e[u].tensor:e[s];if(null!=h){var d=t.accumulatedFirstMoment[u].variable,f=t.accumulatedWeightedInfNorm[u].variable,p=d.mul(t.beta1).add(h.mul(1-t.beta1)),v=f.mul(t.beta2),m=h.abs(),g=v.maximum(m);d.assign(p),f.assign(g);var y=i.div(a).mul(p.div(g.add(t.epsilon))).add(c);c.assign(y)}}),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&at(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&at(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return X(this,void 0,void 0,function(){return Q(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},n.prototype.setWeights=function(e){return X(this,void 0,void 0,function(){return Q(this,function(t){throw new Error("setWeights() is not implemented for Adamax yet.")})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},n.className="Adamax",n}(Pn);pn(Nl);var Ei=function(r){function n(e){var t=r.call(this)||this;return t.learningRate=e,t.setLearningRate(e),t}return bt(n,r),n.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=Array.isArray(e)?e[a].tensor:e[o];if(null!=i){var s=S.registeredVariables[o];J(function(){var u=t.c.mul(i).add(s);s.assign(u)})}}),this.incrementIterations()},n.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function jh(r){return S.keep(r)}(Z(-e))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return X(this,void 0,void 0,function(){return Q(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},n.prototype.setWeights=function(e){return X(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(e,t){return new e(t.learningRate)},n.className="SGD",n}(Pn);pn(Ei);var Fl=function(r){function n(e,t,o){void 0===o&&(o=!1);var a=r.call(this,e)||this;return a.learningRate=e,a.momentum=t,a.useNesterov=o,a.accumulations=[],a.m=Z(a.momentum),a}return bt(n,r),n.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=S.registeredVariables[o];null==t.accumulations[a]&&(t.accumulations[a]={originalName:o+"/momentum",variable:J(function(){return ye(i).variable(!1)})});var s=t.accumulations[a].variable,u=Array.isArray(e)?e[a].tensor:e[o];null!=u&&J(function(){var c,h=t.m.mul(s).add(u);c=t.useNesterov?t.c.mul(u.add(h.mul(t.m))).add(i):t.c.mul(h).add(i),s.assign(h),i.assign(c)})}),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&at(this.accumulations.map(function(e){return e.variable}))},n.prototype.setMomentum=function(e){this.momentum=e},n.prototype.getWeights=function(){return X(this,void 0,void 0,function(){return Q(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},n.prototype.setWeights=function(e){return X(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},n.className="Momentum",n}(Ei);pn(Fl);var Ml=function(r){function n(e,t,o,a,i){void 0===t&&(t=.9),void 0===o&&(o=0),void 0===a&&(a=null),void 0===i&&(i=!1);var s=r.call(this)||this;if(s.learningRate=e,s.decay=t,s.momentum=o,s.epsilon=a,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=i,null==a&&(s.epsilon=S.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return bt(n,r),n.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=S.registeredVariables[o];null==t.accumulatedMeanSquares[a]&&(t.accumulatedMeanSquares[a]={originalName:o+"/rms",variable:J(function(){return ye(i).variable(!1)})}),null==t.accumulatedMoments[a]&&(t.accumulatedMoments[a]={originalName:o+"/momentum",variable:J(function(){return ye(i).variable(!1)})}),null==t.accumulatedMeanGrads[a]&&t.centered&&(t.accumulatedMeanGrads[a]={originalName:o+"/mg",variable:J(function(){return ye(i).variable(!1)})});var s=Array.isArray(e)?e[a].tensor:e[o];if(null!=s){var u=t.accumulatedMeanSquares[a].variable,c=t.accumulatedMoments[a].variable;J(function(){var h=u.mul(t.decay).add(s.square().mul(1-t.decay));if(t.centered){var d=t.accumulatedMeanGrads[a].variable,f=d.mul(t.decay).add(s.mul(1-t.decay)),p=c.mul(t.momentum).add(s.mul(t.learningRate).div(h.sub(f.square().add(t.epsilon)).sqrt()));u.assign(h),d.assign(f),c.assign(p);var v=i.sub(p);i.assign(v)}else{var m=u.mul(t.decay).add(s.square().mul(1-t.decay));p=c.mul(t.momentum).add(s.mul(t.learningRate).div(m.add(t.epsilon).sqrt())),u.assign(m),c.assign(p),v=i.sub(p),i.assign(v)}})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&at(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&at(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&at(this.accumulatedMoments.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return X(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return X(this,void 0,void 0,function(){var t;return Q(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),this.accumulatedMeanSquares=e.slice(0,t=this.centered?e.length/3:e.length/2).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},n.className="RMSProp",n}(Pn);function Fn(r,n,e){if(void 0===e&&(e=!1),r.beginPath(),n.slice(1).forEach(function(a,i){var s=a.x,u=a.y,c=n[i];r.moveTo(c.x,c.y),r.lineTo(s,u)}),e){var t=n[n.length-1],o=n[0];if(!t||!o)return;r.moveTo(t.x,t.y),r.lineTo(o.x,o.y)}r.stroke()}pn(Ml),function(){function r(){}r.sgd=function(n){return new Ei(n)},r.momentum=function(n,e,t){return void 0===t&&(t=!1),new Fl(n,e,t)},r.rmsprop=function(n,e,t,o,a){return void 0===e&&(e=.9),void 0===t&&(t=0),void 0===o&&(o=null),void 0===a&&(a=!1),new Ml(n,e,t,o,a)},r.adam=function(n,e,t,o){return void 0===n&&(n=.001),void 0===e&&(e=.9),void 0===t&&(t=.999),void 0===o&&(o=null),new Pl(n,e,t,o)},r.adadelta=function(n,e,t){return void 0===n&&(n=.001),void 0===e&&(e=.95),void 0===t&&(t=null),new Sl(n,e,t)},r.adamax=function(n,e,t,o,a){return void 0===n&&(n=.002),void 0===e&&(e=.9),void 0===t&&(t=.999),void 0===o&&(o=null),void 0===a&&(a=0),new Nl(n,e,t,o,a)},r.adagrad=function(n,e){return void 0===e&&(e=.1),new Rl(n,e)}}(),typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"&&setImmediate,Ee.prototype.squaredDifference=function(r){return Dc(this,r)},M=Pm;var Ii=function(r,n){return(Ii=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(r,n)};function ie(r,n){function e(){this.constructor=r}Ii(r,n),r.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var tt=function(){return tt=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var a in e=arguments[t])Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n},tt.apply(this,arguments)};function te(r,n,e,t){return new(e||(e=Promise))(function(a,i){function s(h){try{c(t.next(h))}catch(d){i(d)}}function u(h){try{c(t.throw(h))}catch(d){i(d)}}function c(h){h.done?a(h.value):function o(a){return a instanceof e?a:new e(function(i){i(a)})}(h.value).then(s,u)}c((t=t.apply(r,n||[])).next())})}function ne(r,n){var t,o,a,i,e={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(c){return function(h){return function u(c){if(t)throw new TypeError("Generator is already executing.");for(;e;)try{if(t=1,o&&(a=2&c[0]?o.return:c[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,c[1])).done)return a;switch(o=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,o=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(!(a=(a=e.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){e=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){e.label=c[1];break}if(6===c[0]&&e.label<a[1]){e.label=a[1],a=c;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(c);break}a[2]&&e.ops.pop(),e.trys.pop();continue}c=n.call(r,e)}catch(h){c=[6,h],o=0}finally{t=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,h])}}}function Or(){for(var r=0,n=0,e=arguments.length;n<e;n++)r+=arguments[n].length;var t=Array(r),o=0;for(n=0;n<e;n++)for(var a=arguments[n],i=0,s=a.length;i<s;i++,o++)t[o]=a[i];return t}var Mn=function(){function r(n,e){if(!On(n)||!On(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:e}));this._width=n,this._height=e}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r}();function Br(r,n){return r instanceof Ee&&r.shape.length===n}function Fo(r){return Br(r,3)}function vn(r){return Br(r,4)}function Bl(r){return r%2==0}function Di(r,n){void 0===n&&(n=2);var e=Math.pow(10,n);return Math.floor(r*e)/e}function Ll(r){return r&&r.width&&r.height}function ki(r){return r.reduce(function(n,e){return n.add(e)},new we(0,0)).div(new we(r.length,r.length))}function Lr(r,n,e){return Array(r).fill(0).map(function(t,o){return n+o*e})}function On(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||0===r}function Wl(r){return On(r)&&0<=r&&r<=1}var we=function(){function r(n,e){this._x=n,this._y=e}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(n){return new r(this.x+n.x,this.y+n.y)},r.prototype.sub=function(n){return new r(this.x-n.x,this.y-n.y)},r.prototype.mul=function(n){return new r(this.x*n.x,this.y*n.y)},r.prototype.div=function(n){return new r(this.x/n.x,this.y/n.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r}(),Mt=function(){function r(n,e){void 0===e&&(e=!0);var t=n||{},o=[t.left,t.top,t.right,t.bottom].every(On),a=[t.x,t.y,t.width,t.height].every(On);if(!a&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(t));var i=a?[t.x,t.y,t.width,t.height]:[t.left,t.top,t.right-t.left,t.bottom-t.top],s=i[0],u=i[1],c=i[2],h=i[3];r.assertIsValidBox({x:s,y:u,width:c,height:h},"Box.constructor",e),this._x=s,this._y=u,this._width=c,this._height=h}return r.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(On)},r.assertIsValidBox=function(n,e,t){if(void 0===t&&(t=!1),!r.isRect(n))throw new Error(e+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!t&&(n.width<0||n.height<0))throw new Error(e+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new we(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new we(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new we(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new we(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(i){return Math.round(i)});return new r({x:n[0],y:n[1],width:n[2],height:n[3]})},r.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(i){return Math.floor(i)});return new r({x:n[0],y:n[1],width:n[2],height:n[3]})},r.prototype.toSquare=function(){var n=this,e=n.x,t=n.y,o=n.width,a=n.height,i=Math.abs(o-a);return o<a&&(e-=i/2,o+=i),a<o&&(t-=i/2,a+=i),new r({x:e,y:t,width:o,height:a})},r.prototype.rescale=function(n){var e=Ll(n)?n.width:n,t=Ll(n)?n.height:n;return new r({x:this.x*e,y:this.y*t,width:this.width*e,height:this.height*t})},r.prototype.pad=function(n,e){var t=[this.x-n/2,this.y-e/2,this.width+n,this.height+e];return new r({x:t[0],y:t[1],width:t[2],height:t[3]})},r.prototype.clipAtImageBorders=function(n,e){var t=this,a=t.y,i=t.right,s=t.bottom,u=Math.max(t.x,0),c=Math.max(a,0),d=s-c;return new r({x:u,y:c,width:Math.min(i-u,n-u),height:Math.min(d,e-c)}).floor()},r.prototype.shift=function(n,e){return new r({x:this.x+n,y:this.y+e,width:this.width,height:this.height})},r.prototype.padAtBorders=function(n,e){var t=this.width+1,o=this.height+1,s=t,u=o,c=this.left,h=this.top,d=this.right,f=this.bottom;return d>e&&(s=-d+e+t,d=e),f>n&&(u=-f+n+o,f=n),c<1&&(u=2-c,c=1),h<1&&(u=2-h,h=1),{dy:1,edy:u,dx:1,edx:s,y:h,ey:f,x:c,ex:d,w:t,h:o}},r.prototype.calibrate=function(n){return new r({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},r}(),Mo=function(r){function n(e,t,o,a,i){return void 0===i&&(i=!1),r.call(this,{left:e,top:t,right:o,bottom:a},i)||this}return ie(n,r),n}(Mt),Ul=function(){function r(n,e,t,o,a){this._imageDims=new Mn(a.width,a.height),this._score=n,this._classScore=e,this._className=t,this._box=new Mt(o).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new Mt(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(n,e){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:e})},r}(),pt=function(r){function n(e,t,o){return r.call(this,e,e,"",t,o)||this}return ie(n,r),n.prototype.forSize=function(e,t){var o=r.prototype.forSize.call(this,e,t);return new n(o.score,o.relativeBox,o.imageDims)},n}(Ul);function sg(r,n,e){void 0===e&&(e=!0);var a=Math.max(0,Math.min(r.right,n.right)-Math.max(r.left,n.left))*Math.max(0,Math.min(r.bottom,n.bottom)-Math.max(r.top,n.top));return e?a/(r.area+n.area-a):a/Math.min(r.area,n.area)}function Wr(r,n,e,t){void 0===t&&(t=!0);for(var o=n.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),a=[],i=function(){var s=o.pop();a.push(s);for(var u=o,c=[],h=0;h<u.length;h++)c.push(sg(r[s],r[u[h]],t));o=o.filter(function(v,m){return c[m]<=e})};o.length>0;)i();return a}function Ur(r,n){return J(function(){var e=n[0],t=n[1],o=n[2],a=Nt(Or(r.shape.slice(0,3),[1]),e),i=Nt(Or(r.shape.slice(0,3),[1]),t),s=Nt(Or(r.shape.slice(0,3),[1]),o),u=Ve([a,i,s],3);return qe(r,u)})}function Ai(r){return 1/(1+Math.exp(-r))}var ze,Si=function(r){function n(e,t,o,a,i){return void 0===i&&(i=!1),r.call(this,{x:e,y:t,width:o,height:a},i)||this}return ie(n,r),n}(Mt),nr=function(){function r(n,e,t){void 0===t&&(t=new we(0,0));var o=e.width,a=e.height;this._imgDims=new Mn(o,a),this._shift=t,this._positions=n.map(function(i){return i.mul(new we(o,a)).add(t)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new we(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(e){return e.sub(n._shift).div(new we(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(n,e){return new this.constructor(this.relativePositions,{width:n,height:e})},r.prototype.shiftBy=function(n,e){return new this.constructor(this.relativePositions,this._imgDims,new we(n,e))},r.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},r.prototype.align=function(n,e){if(void 0===e&&(e={}),n){var t=n instanceof pt?n.box.floor():new Mt(n);return this.shiftBy(t.x,t.y).align(null,e)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),i=o.minBoxPadding;return o.useDlibAlignment?this.alignDlib():this.alignMinBbox(i)},r.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),t=n[1],o=n[2],a=function(d){return o.sub(d).magnitude()},i=(a(n[0])+a(t))/2,s=Math.floor(i/.45),u=ki(n),c=Math.floor(Math.max(0,u.x-.5*s)),h=Math.floor(Math.max(0,u.y-.43*s));return new Si(c,h,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+h))},r.prototype.alignMinBbox=function(n){var e=function ig(r){var n=r.map(function(s){return s.x}),e=r.map(function(s){return s.y}),t=n.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return u<s?u:s},1/0),a=n.reduce(function(s,u){return s<u?u:s},0),i=e.reduce(function(s,u){return s<u?u:s},0);return new Mo(t,o,a,i)}(this.positions);return e.pad(e.width*n,e.height*n)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r}(),dg=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],ki([e[3],e[4]])]},n}(nr),Vl=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(ki)},n}(nr),Gl=function(){function r(n,e){this._label=n,this._distance=e}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(n){return void 0===n&&(n=!0),this.label+(n?" ("+Di(this.distance)+")":"")},r}(),ql=function(r){function n(e,t){var o=r.call(this,e)||this;return o._label=t,o}return ie(n,r),n.assertIsValidLabeledBox=function(e,t){if(Mt.assertIsValidBox(e,t),!On(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n}(Mt),Oo=function(){function r(n,e){if("string"!=typeof n)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(t){return!(t instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=e}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},r.fromJSON=function(n){var e=n.descriptors.map(function(t){return new Float32Array(t)});return new r(n.label,e)},r}();function Vr(r){return r.detection instanceof pt}function Gr(r,n){return Object.assign({},r,{detection:n})}function zl(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function Hl(r){var n="";if(!r)try{r=Ue(8730)}catch(t){n=t.toString()}return{readFile:r?function(t){return new Promise(function(o,a){r.readFile(t,function(i,s){return i?a(i):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)}}}function Zl(){var r=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=Hl();return tt({Canvas:r||function i(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function i(){},Image:n||function i(){},ImageData:global.ImageData||function i(){},Video:global.HTMLVideoElement||function i(){},createCanvasElement:function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:o},a)}function jl(){return"object"==typeof window&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function Kl(){return"object"==typeof global&&typeof process<"u"&&!!process.version}function Ri(r){ze=r}function Pi(){jl()&&Ri(zl()),Kl()&&Ri(Zl())}!function(r){function n(e,t,o,a){var i=r.call(this,e,t)||this;return i._score=o,i._classScore=a,i}ie(n,r),n.assertIsValidPredictedBox=function(e,t){if(ql.assertIsValidLabeledBox(e,t),!Wl(e.score)||!Wl(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(ql);var nt={getEnv:function fg(){if(!ze)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ze},setEnv:Ri,initialize:Pi,createBrowserEnv:zl,createFileSystem:Hl,createNodejsEnv:Zl,monkeyPatch:function pg(r){if(ze||Pi(),!ze)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=r.Canvas,e=void 0===n?ze.Canvas:n,t=r.Image,o=void 0===t?ze.Image:t;ze.Canvas=e,ze.Image=o,ze.createCanvasElement=r.createCanvasElement||function(){return new e},ze.createImageElement=r.createImageElement||function(){return new o},ze.ImageData=r.ImageData||ze.ImageData,ze.Video=r.Video||ze.Video,ze.fetch=r.fetch||ze.fetch,ze.readFile=r.readFile||ze.readFile},isBrowser:jl,isNodejs:Kl};function Ni(r){return nt.isNodejs()||"string"!=typeof r?r:document.getElementById(r)}function Ot(r){var n=nt.getEnv(),e=n.Canvas;if(r instanceof n.CanvasRenderingContext2D)return r;var o=Ni(r);if(!(o instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=o.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}Pi();var Xt=(()=>(function(r){r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Xt||(Xt={})),Xt))(),Jl=function r(n){void 0===n&&(n={});var t=n.backgroundColor,o=n.fontColor,a=n.fontSize,i=n.fontStyle,s=n.padding;this.anchorPosition=n.anchorPosition||Xt.TOP_LEFT,this.backgroundColor=t||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=a||14,this.fontStyle=i||"Georgia",this.padding=s||4},Yl=function(){function r(n,e,t){void 0===t&&(t={}),this.text="string"==typeof n?[n]:n instanceof r?n.text:n,this.anchor=e,this.options=new Jl(t)}return r.prototype.measureWidth=function(n){var e=this.options.padding;return this.text.map(function(t){return n.measureText(t).width}).reduce(function(t,o){return t<o?o:t},0)+2*e},r.prototype.measureHeight=function(){var n=this.options;return this.text.length*n.fontSize+2*n.padding},r.prototype.getUpperLeft=function(n,e){var t=this.options.anchorPosition,o=t===Xt.BOTTOM_RIGHT||t===Xt.TOP_RIGHT,a=t===Xt.BOTTOM_LEFT||t===Xt.BOTTOM_RIGHT,i=this.measureWidth(n),s=this.measureHeight(),u=o?this.anchor.x-i:this.anchor.x,c=a?this.anchor.y-s:this.anchor.y;if(e){var d=e.height;return{x:Math.max(Math.min(u,e.width-i),0),y:Math.max(Math.min(c,d-s),0)}}return{x:u,y:c}},r.prototype.draw=function(n){var e=Ni(n),t=Ot(e),o=this.options,a=o.backgroundColor,i=o.fontColor,s=o.fontSize,c=o.padding;t.font=s+"px "+o.fontStyle;var h=this.measureWidth(t),d=this.measureHeight();t.fillStyle=a;var f=this.getUpperLeft(t,e);t.fillRect(f.x,f.y,h,d),t.fillStyle=i,this.text.forEach(function(p,v){t.fillText(p,c+f.x,c+f.y+(v+1)*s)})},r}(),vg=function r(n){void 0===n&&(n={});var t=n.lineWidth,o=n.label,a=n.drawLabelOptions;this.boxColor=n.boxColor||"rgba(0, 0, 255, 1)",this.lineWidth=t||2,this.label=o,this.drawLabelOptions=new Jl(Object.assign({},{anchorPosition:Xt.BOTTOM_LEFT,backgroundColor:this.boxColor},a))},Xl=function(){function r(n,e){void 0===e&&(e={}),this.box=new Mt(n),this.options=new vg(e)}return r.prototype.draw=function(n){var e=Ot(n),t=this.options,a=t.lineWidth,i=this.box,s=i.x,u=i.y,c=i.width,h=i.height;e.strokeStyle=t.boxColor,e.lineWidth=a,e.strokeRect(s,u,c,h);var d=this.options.label;d&&new Yl([d],{x:s-a/2,y:u},this.options.drawLabelOptions).draw(n)},r}();function Ql(r){var n=nt.getEnv();return r instanceof n.Image&&r.complete||r instanceof n.Video&&r.readyState>=3}function Fi(r){var n=nt.getEnv(),t=n.Video;return r instanceof n.Image?new Mn(r.naturalWidth,r.naturalHeight):r instanceof t?new Mn(r.videoWidth,r.videoHeight):new Mn(r.width,r.height)}function Bo(r){var n=r.width,e=r.height,o=(0,nt.getEnv().createCanvasElement)();return o.width=n,o.height=e,o}function Lo(r,n){var e=nt.getEnv().ImageData;if(!(r instanceof e||Ql(r)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var t=n||Fi(r),o=t.width,a=t.height,i=Bo({width:o,height:a});return r instanceof e?Ot(i).putImageData(r,0,0):Ot(i).drawImage(r,0,0,o,a),i}function yg(r,n){return te(this,void 0,void 0,function(){var e,t,o,a,i,s;return ne(this,function(u){switch(u.label){case 0:return e=n||nt.getEnv().createCanvasElement(),t=r.shape.slice(vn(r)?1:0),o=t[0],a=t[1],i=t[2],s=J(function(){return r.as3D(o,a,i).toInt()}),[4,_i.toPixels(s,e)];case 1:return u.sent(),s.dispose(),[2,e]}})})}function $l(r){var n=nt.getEnv();return r instanceof n.Image||r instanceof n.Canvas||r instanceof n.Video}var Wo=function(){function r(n,e){var t=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=e,this._batchSize=n.length,n.forEach(function(o,a){if(Fo(o))return t._imageTensors[a]=o,void(t._inputDimensions[a]=o.shape);if(vn(o)){var i=o.shape[0];if(1!==i)throw new Error("NetInput - tf.Tensor4D with batchSize "+i+" passed, but not supported in input array");return t._imageTensors[a]=o,void(t._inputDimensions[a]=o.shape.slice(1))}var s=o instanceof nt.getEnv().Canvas?o:Lo(o);t._canvases[a]=s,t._inputDimensions[a]=[s.height,s.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var n=this;return Lr(this.batchSize,0,1).map(function(e,t){return n.getReshapedInputDimensions(t)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},r.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},r.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},r.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},r.prototype.getReshapedInputDimensions=function(n){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function ag(r,n){var e=r.width,t=r.height,o=n/Math.max(t,e);return new Mn(Math.round(e*o),Math.round(t*o))}({width:this.getInputWidth(n),height:this.getInputHeight(n)},this.inputSize)},r.prototype.toBatchTensor=function(n,e){var t=this;return void 0===e&&(e=!0),this._inputSize=n,J(function(){var o=Lr(t.batchSize,0,1).map(function(i){var s=t.getInput(i);if(s instanceof Ee){var u=vn(s)?s:s.expandDims();return u=function ug(r,n){return void 0===n&&(n=!1),J(function(){var e=r.shape.slice(1),t=e[0],o=e[1];if(t===o)return r;var a=Math.abs(t-o),i=Math.round(a*(n?.5:1)),s=t>o?2:1,u=function(p){var v=r.shape.slice();return v[s]=p,Nt(v,0)},c=u(i),h=a-c.shape[s],f=[n&&h?u(h):null,r,c].filter(function(p){return!!p}).map(function(p){return p.toFloat()});return Ve(f,s)})}(u,e),(u.shape[1]!==n||u.shape[2]!==n)&&(u=ri.resizeBilinear(u,[n,n])),u.as3D(n,n,3)}if(s instanceof nt.getEnv().Canvas)return _i.fromPixels(function xg(r,n,e){void 0===e&&(e=!1);var t=nt.getEnv(),a=t.Canvas;if(!(r instanceof t.Image||r instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=Fi(r),s=n/Math.max(i.height,i.width),u=s*i.width,c=s*i.height,h=Bo({width:n,height:n}),d=r instanceof a?r:Lo(r),f=Math.abs(u-c)/2,p=e&&u<c?f:0,v=e&&c<u?f:0;return Ot(h).drawImage(d,p,v,u,c),h}(s,n,e));throw new Error("toBatchTensor - at batchIdx "+i+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)});return dt(o.map(function(i){return i.toFloat()})).as4D(t.batchSize,n,n,3)})},r}();function je(r){return te(this,void 0,void 0,function(){var n,e,t;return ne(this,function(o){switch(o.label){case 0:if(r instanceof Wo)return[2,r];if(!(n=Array.isArray(r)?r:[r]).length)throw new Error("toNetInput - empty array passed as input");return e=function(a){return Array.isArray(r)?" at input index "+a+":":""},(t=n.map(Ni)).forEach(function(a,i){if(!$l(a)&&!Fo(a)&&!vn(a))throw"string"==typeof n[i]?new Error("toNetInput -"+e(i)+" string passed, but could not resolve HTMLElement for element id "+n[i]):new Error("toNetInput -"+e(i)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(vn(a)){var s=a.shape[0];if(1!==s)throw new Error("toNetInput -"+e(i)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(t.map(function(a){return $l(a)&&function gg(r){return new Promise(function(n,e){if(r instanceof nt.getEnv().Canvas||Ql(r))return n();function t(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",t),a.currentTarget.removeEventListener("error",o),n(a))}function o(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",t),a.currentTarget.removeEventListener("error",o),e(a))}r.addEventListener("load",t),r.addEventListener("error",o)})}(a)}))];case 1:return o.sent(),[2,new Wo(t,Array.isArray(r))]}})})}function Mi(r,n){return te(this,void 0,void 0,function(){var e,t,o,a,i,s;return ne(this,function(c){switch(c.label){case 0:return e=nt.getEnv().Canvas,t=r,r instanceof e?[3,5]:[4,je(r)];case 1:if((o=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(a=o.getInput(0))instanceof e?(i=a,[3,4]):[3,2];case 2:return[4,yg(a)];case 3:i=c.sent(),c.label=4;case 4:t=i,c.label=5;case 5:return s=Ot(t),[2,n.map(function(h){return h instanceof pt?h.forSize(t.width,t.height).box.floor():h}).map(function(h){return h.clipAtImageBorders(t.width,t.height)}).map(function(h){var d=h.x,f=h.y,p=h.width,v=h.height,m=Bo({width:p,height:v});return Ot(m).putImageData(s.getImageData(d,f,p,v),0,0),m})]}})})}function Oi(r,n){return te(this,void 0,void 0,function(){return ne(this,function(e){if(!Fo(r)&&!vn(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(vn(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,J(function(){var t=r.shape.slice(vn(r)?1:0),o=t[0],a=t[1],i=t[2];return n.map(function(c){return c instanceof pt?c.forSize(a,o).box:c}).map(function(c){return c.clipAtImageBorders(a,o)}).map(function(c){var h=c.x,d=c.y,f=c.width,p=c.height;return Yc(r.as3D(o,a,i),[d,h,0],[p,f,i])})})]})})}function bg(r,n){return te(this,void 0,void 0,function(){var t;return ne(this,function(o){switch(o.label){case 0:return[4,(0,nt.getEnv().fetch)(r,n)];case 1:if(!((t=o.sent()).status<400))throw new Error("failed to fetch: ("+t.status+") "+t.statusText+", from url: "+t.url);return[2,t]}})})}function _g(r){return te(this,void 0,void 0,function(){return ne(this,function(n){switch(n.label){case 0:return[4,bg(r)];case 1:return[2,n.sent().json()]}})})}function eh(r,n){var e=n+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:e};if("/"===r)return{modelBaseUri:"/",manifestUri:"/"+e};var t=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"",o=(r=r.replace(t,"")).split("/").filter(function(s){return s}),a=r.endsWith(".json")?o[o.length-1]:e,i=t+(r.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:i=r.startsWith("/")?"/"+i:i,manifestUri:"/"===i?"/"+a:i+"/"+a}}function wg(r,n){return te(this,void 0,void 0,function(){var e,o,a;return ne(this,function(i){switch(i.label){case 0:return e=eh(r,n),o=e.modelBaseUri,[4,_g(e.manifestUri)];case 1:return a=i.sent(),[2,Il.loadWeights(a,o)]}})})}var Qt=function(){function r(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(n){var e=this.traversePropertyPath(n);return e.obj[e.objProp]},r.prototype.reassignParamFromPath=function(n,e){var t=this.traversePropertyPath(n),o=t.obj,a=t.objProp;o[a].dispose(),o[a]=e},r.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(e){var t=e.paramPath;return{path:t,tensor:n.getParamFromPath(t)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof Vn})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof Vn)})},r.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(e){n.reassignParamFromPath(e.path,e.tensor.variable())})},r.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(e){var t=e.path,o=e.tensor,a=Xe(o.dataSync());o.dispose(),n.reassignParamFromPath(t,a)})},r.prototype.dispose=function(n){void 0===n&&(n=!0),this.getParamList().forEach(function(e){if(n&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){return Array.from(n.tensor.dataSync())}).reduce(function(n,e){return n.concat(e)}))},r.prototype.load=function(n){return te(this,void 0,void 0,function(){return ne(this,function(e){switch(e.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return e.sent(),[2]}})})},r.prototype.loadFromUri=function(n){return te(this,void 0,void 0,function(){var e;return ne(this,function(t){switch(t.label){case 0:if(n&&"string"!=typeof n)throw new Error(this._name+".loadFromUri - expected model uri");return[4,wg(n,this.getDefaultModelName())];case 1:return e=t.sent(),this.loadFromWeightMap(e),[2]}})})},r.prototype.loadFromDisk=function(n){return te(this,void 0,void 0,function(){var e,t,o,a,s,u,c,h,d;return ne(this,function(f){switch(f.label){case 0:if(n&&"string"!=typeof n)throw new Error(this._name+".loadFromDisk - expected model file path");return e=nt.getEnv().readFile,t=eh(n,this.getDefaultModelName()),o=t.manifestUri,a=t.modelBaseUri,s=Il.weightsLoaderFactory(function(p){return Promise.all(p.map(function(v){return e(v).then(function(m){return m.buffer})}))}),h=(c=JSON).parse,[4,e(o)];case 1:return u=h.apply(c,[f.sent().toString()]),[4,s(u,a)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},r.prototype.loadFromWeightMap=function(n){var e=this.extractParamsFromWeigthMap(n),o=e.params;this._paramMappings=e.paramMappings,this._params=o},r.prototype.extractWeights=function(n){var e=this.extractParams(n),o=e.params;this._paramMappings=e.paramMappings,this._params=o},r.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=n.split("/").reduce(function(a,i){if(!a.nextObj.hasOwnProperty(i))throw new Error("traversePropertyPath - object does not have property "+i+", for path "+n);return{obj:a.nextObj,objProp:i,nextObj:a.nextObj[i]}},{nextObj:this.params}),t=e.obj,o=e.objProp;if(!(t&&o&&t[o]instanceof Ee))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:t,objProp:o}},r}();function vt(r,n,e){return J(function(){var t=Qa(r,n.depthwise_filter,n.pointwise_filter,e,"same");return fe(t,n.bias)})}function Bi(r,n,e){return void 0===e&&(e=!1),J(function(){var t=Se(e?fe(xt(r,n.conv0.filters,[2,2],"same"),n.conv0.bias):vt(r,n.conv0,[2,2])),o=vt(t,n.conv1,[1,1]),i=vt(Se(fe(t,o)),n.conv2,[1,1]);return Se(fe(t,fe(o,i)))})}function Uo(r,n,e,t){return void 0===e&&(e=!1),void 0===t&&(t=!0),J(function(){var o=Se(e?fe(xt(r,n.conv0.filters,t?[2,2]:[1,1],"same"),n.conv0.bias):vt(r,n.conv0,t?[2,2]:[1,1])),a=vt(o,n.conv1,[1,1]),s=vt(Se(fe(o,a)),n.conv2,[1,1]),c=vt(Se(fe(o,fe(a,s))),n.conv3,[1,1]);return Se(fe(o,fe(a,fe(s,c))))})}function kt(r,n,e,t){return void 0===e&&(e="same"),void 0===t&&(t=!1),J(function(){var o=fe(xt(r,n.filters,[1,1],e),n.bias);return t?Se(o):o})}function $t(r,n){Object.keys(r).forEach(function(e){n.some(function(t){return t.originalPath===e})||r[e].dispose()})}function Vo(r,n){return function(e,t,o,a){var i=st(r(e*t*o*o),[o,o,e,t]),s=Le(r(t));return n.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}}function Li(r,n){return function(e,t,o){var a=cn(r(e*t),[e,t]),i=Le(r(t));return n.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:a,bias:i}}}var th=function r(n,e,t){this.depthwise_filter=n,this.pointwise_filter=e,this.bias=t};function Wi(r,n){return function(e,t,o){var a=st(r(9*e),[3,3,e,1]),i=st(r(e*t),[1,1,e,t]),s=Le(r(t));return n.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new th(a,i,s)}}function Ui(r){return function(n){var e=r(n+"/depthwise_filter",4),t=r(n+"/pointwise_filter",4),o=r(n+"/bias",1);return new th(e,t,o)}}function mn(r,n){return function(e,t,o){var a=r[e];if(!Br(a,t))throw new Error("expected weightMap["+e+"] to be a Tensor"+t+"D, instead have "+a);return n.push({originalPath:e,paramPath:o||e}),a}}function en(r){var n=r;return{extractWeights:function e(o){var a=n.slice(0,o);return n=n.slice(o),a},getRemainingWeights:function t(){return n}}}function nh(r,n){var e=Vo(r,n),t=Wi(r,n);function o(i,s,u,c){return void 0===c&&(c=!1),{conv0:c?e(i,s,3,u+"/conv0"):t(i,s,u+"/conv0"),conv1:t(s,s,u+"/conv1"),conv2:t(s,s,u+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function a(i,s,u,c){void 0===c&&(c=!1);var h=o(i,s,u,c);return{conv0:h.conv0,conv1:h.conv1,conv2:h.conv2,conv3:t(s,s,u+"/conv3")}}}}function rh(r){return function(n){return{filters:r(n+"/filters",4),bias:r(n+"/bias",1)}}}function oh(r,n){var e=mn(r,n),t=rh(e),o=Ui(e);return{extractDenseBlock3Params:function a(s,u){return void 0===u&&(u=!1),{conv0:u?t(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2")}},extractDenseBlock4Params:function i(s,u){return void 0===u&&(u=!1),{conv0:u?t(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2"),conv3:o(s+"/conv3")}}}}var ah=function(r){function n(){return r.call(this,"FaceFeatureExtractor")||this}return ie(n,r),n.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return J(function(){var s=Uo(Ur(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Z(255)),t.dense0,!0);return s=Uo(s,t.dense1),s=Uo(s,t.dense2),s=Uo(s,t.dense3),Fr(s,[7,7],[2,2],"valid")})},n.prototype.forward=function(e){return te(this,void 0,void 0,function(){var t;return ne(this,function(o){switch(o.label){case 0:return t=this.forwardInput,[4,je(e)];case 1:return[2,t.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function Eg(r){var n=[],e=oh(r,n).extractDenseBlock4Params,t={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return $t(r,n),{params:t,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function Tg(r){var n=[],e=en(r),o=e.getRemainingWeights,a=nh(e.extractWeights,n).extractDenseBlock4Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2"),c=a(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:i,dense1:s,dense2:u,dense3:c}}}(e)},n}(Qt);function Bt(r,n){return J(function(){return fe(Do(r,n.weights),n.bias)})}function ih(r){var n={},e={};return Object.keys(r).forEach(function(t){(t.startsWith("fc")?e:n)[t]=r[t]}),{featureExtractorMap:n,classifierMap:e}}var sh=function(r){function n(e,t){var o=r.call(this,e)||this;return o._faceFeatureExtractor=t,o}return ie(n,r),Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var t=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return J(function(){var a=e instanceof Wo?t.faceFeatureExtractor.forwardInput(e):e;return Bt(a.as2D(a.shape[0],-1),o.fc)})},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),r.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),a=t.paramMappings;this._params=t.params,this._paramMappings=a},n.prototype.extractClassifierParams=function(e){return function Ig(r,n,e){var t=[],o=en(r),i=o.getRemainingWeights,u=Li(o.extractWeights,t)(n,e,"fc");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{fc:u}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(e){var t=ih(e),a=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(t.featureExtractorMap),function Dg(r){var n=[],e=mn(r,n),o={fc:function t(a){return{weights:e(a+"/weights",2),bias:e(a+"/bias",1)}}("fc")};return $t(r,n),{params:o,paramMappings:n}}(a)},n.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),a=o*t+o,i=e.slice(0,e.length-a),s=e.slice(e.length-a);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(s)},n}(Qt),uh=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Vi=function(){function r(n){var e=this;if(7!==n.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);uh.forEach(function(t,o){e[t]=n[o]})}return r.prototype.asSortedArray=function(){var n=this;return uh.map(function(e){return{expression:e,probability:n[e]}}).sort(function(e,t){return t.probability-e.probability})},r}(),kg=function(r){function n(e){return void 0===e&&(e=new ah),r.call(this,"FaceExpressionNet",e)||this}return ie(n,r),n.prototype.forwardInput=function(e){var t=this;return J(function(){return Zt(t.runNet(e))})},n.prototype.forward=function(e){return te(this,void 0,void 0,function(){var t;return ne(this,function(o){switch(o.label){case 0:return t=this.forwardInput,[4,je(e)];case 1:return[2,t.apply(this,[o.sent()])]}})})},n.prototype.predictExpressions=function(e){return te(this,void 0,void 0,function(){var t,o,a,i,s=this;return ne(this,function(u){switch(u.label){case 0:return[4,je(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return o=u.sent(),[4,Promise.all(Ge(o).map(function(c){return te(s,void 0,void 0,function(){var h;return ne(this,function(d){switch(d.label){case 0:return[4,c.data()];case 1:return h=d.sent(),c.dispose(),[2,h]}})})}))];case 3:return a=u.sent(),o.dispose(),i=a.map(function(c){return new Vi(c)}),[2,t.isBatchInput?i:i[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n}(sh);function ch(r,n){return Object.assign({},r,{expressions:n})}function Gi(r){return Vr(r)&&r.landmarks instanceof nr&&r.unshiftedLandmarks instanceof nr&&r.alignedRect instanceof pt}function Go(r,n){var e=r.detection.box,t=n.shiftBy(e.x,e.y),o=t.align(),a=r.detection.imageDims,i=new pt(r.detection.score,o.rescale(a.reverse()),a);return Object.assign({},r,{landmarks:t,unshiftedLandmarks:n,alignedRect:i})}var Rg=function r(n){void 0===n&&(n={});var e=n.drawLines,o=n.drawPoints,a=void 0===o||o,i=n.lineWidth,s=n.lineColor,u=n.pointSize,c=n.pointColor;this.drawLines=void 0===e||e,this.drawPoints=a,this.lineWidth=i||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"},Pg=function(){function r(n,e){void 0===e&&(e={}),this.faceLandmarks=n,this.options=new Rg(e)}return r.prototype.draw=function(n){var e=Ot(n),t=this.options,a=t.drawPoints,i=t.lineWidth,u=t.pointSize,c=t.pointColor;t.drawLines&&this.faceLandmarks instanceof Vl&&(e.strokeStyle=t.lineColor,e.lineWidth=i,Fn(e,this.faceLandmarks.getJawOutline()),Fn(e,this.faceLandmarks.getLeftEyeBrow()),Fn(e,this.faceLandmarks.getRightEyeBrow()),Fn(e,this.faceLandmarks.getNose()),Fn(e,this.faceLandmarks.getLeftEye(),!0),Fn(e,this.faceLandmarks.getRightEye(),!0),Fn(e,this.faceLandmarks.getMouth(),!0)),a&&(e.strokeStyle=c,e.fillStyle=c,this.faceLandmarks.positions.forEach(function(d){e.beginPath(),e.arc(d.x,d.y,u,0,2*Math.PI),e.fill()}))},r}();function lh(r,n,e){return fe(xt(r,n.filters,e,"same"),n.bias)}function qi(r,n,e){void 0===e&&(e=!0);var t=e?Se(r):r;return t=vt(t,n.separable_conv0,[1,1]),t=vt(Se(t),n.separable_conv1,[1,1]),t=Ze(t,[3,3],[2,2],"same"),fe(t,lh(r,n.expansion_conv,[2,2]))}var Wg=function(r){function n(e){var t=r.call(this,"TinyXception")||this;return t._numMainBlocks=e,t}return ie(n,r),n.prototype.forwardInput=function(e){var t=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return J(function(){var s=Ur(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Z(256)),u=Se(lh(s,o.entry_flow.conv_in,[2,2]));return u=qi(u,o.entry_flow.reduction_block_0,!1),u=qi(u,o.entry_flow.reduction_block_1),Lr(t._numMainBlocks,0,1).forEach(function(c){u=function Lg(r,n){var e=vt(Se(r),n.separable_conv0,[1,1]);return e=vt(Se(e),n.separable_conv1,[1,1]),e=vt(Se(e),n.separable_conv2,[1,1]),fe(e,r)}(u,o.middle_flow["main_block_"+c])}),u=qi(u,o.exit_flow.reduction_block),u=Se(vt(u,o.exit_flow.separable_conv,[1,1]))})},n.prototype.forward=function(e){return te(this,void 0,void 0,function(){var t;return ne(this,function(o){switch(o.label){case 0:return t=this.forwardInput,[4,je(e)];case 1:return[2,t.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function Bg(r,n){var e=[],t=function Og(r,n){var e=mn(r,n),t=rh(e),o=Ui(e);return{extractConvParams:t,extractSeparableConvParams:o,extractReductionBlockParams:function a(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),expansion_conv:t(s+"/expansion_conv")}},extractMainBlockParams:function i(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),separable_conv2:o(s+"/separable_conv2")}}}}(r,e),a=t.extractSeparableConvParams,i=t.extractReductionBlockParams,s=t.extractMainBlockParams,d={conv_in:(0,t.extractConvParams)("entry_flow/conv_in"),reduction_block_0:i("entry_flow/reduction_block_0"),reduction_block_1:i("entry_flow/reduction_block_1")},f={};Lr(n,0,1).forEach(function(g){f["main_block_"+g]=s("middle_flow/main_block_"+g)});var m={reduction_block:i("exit_flow/reduction_block"),separable_conv:a("exit_flow/separable_conv")};return $t(r,e),{params:{entry_flow:d,middle_flow:f,exit_flow:m},paramMappings:e}}(e,this._numMainBlocks)},n.prototype.extractParams=function(e){return function Mg(r,n){var e=[],t=en(r),a=t.getRemainingWeights,i=function Fg(r,n){var e=Vo(r,n),t=Wi(r,n);return{extractConvParams:e,extractSeparableConvParams:t,extractReductionBlockParams:function o(i,s,u){return{separable_conv0:t(i,s,u+"/separable_conv0"),separable_conv1:t(s,s,u+"/separable_conv1"),expansion_conv:e(i,s,1,u+"/expansion_conv")}},extractMainBlockParams:function a(i,s){return{separable_conv0:t(i,i,s+"/separable_conv0"),separable_conv1:t(i,i,s+"/separable_conv1"),separable_conv2:t(i,i,s+"/separable_conv2")}}}}(t.extractWeights,e),u=i.extractSeparableConvParams,c=i.extractReductionBlockParams,h=i.extractMainBlockParams,v={conv_in:(0,i.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},m={};Lr(n,0,1).forEach(function(b){m["main_block_"+b]=h(128,"middle_flow/main_block_"+b)});var x={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:e,params:{entry_flow:v,middle_flow:m,exit_flow:x}}}(e,this._numMainBlocks)},n}(Qt),qr=(()=>(function(r){r.FEMALE="female",r.MALE="male"}(qr||(qr={})),qr))(),Gg=function(r){function n(e){void 0===e&&(e=new Wg(2));var t=r.call(this,"AgeGenderNet")||this;return t._faceFeatureExtractor=e,t}return ie(n,r),Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var t=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return J(function(){var a=e instanceof Wo?t.faceFeatureExtractor.forwardInput(e):e,i=Fr(a,[7,7],[2,2],"valid").as2D(a.shape[0],-1);return{age:Bt(i,o.fc.age).as1D(),gender:Bt(i,o.fc.gender)}})},n.prototype.forwardInput=function(e){var t=this;return J(function(){var o=t.runNet(e);return{age:o.age,gender:Zt(o.gender)}})},n.prototype.forward=function(e){return te(this,void 0,void 0,function(){var t;return ne(this,function(o){switch(o.label){case 0:return t=this.forwardInput,[4,je(e)];case 1:return[2,t.apply(this,[o.sent()])]}})})},n.prototype.predictAgeAndGender=function(e){return te(this,void 0,void 0,function(){var t,o,a,i,s,u,c=this;return ne(this,function(h){switch(h.label){case 0:return[4,je(e)];case 1:return t=h.sent(),[4,this.forwardInput(t)];case 2:return o=h.sent(),a=Ge(o.age),i=Ge(o.gender),s=a.map(function(d,f){return{ageTensor:d,genderTensor:i[f]}}),[4,Promise.all(s.map(function(d){var f=d.ageTensor,p=d.genderTensor;return te(c,void 0,void 0,function(){var v,m,g,y,x;return ne(this,function(b){switch(b.label){case 0:return[4,f.data()];case 1:return v=b.sent()[0],[4,p.data()];case 2:return m=b.sent()[0],y=(g=m>.5)?qr.MALE:qr.FEMALE,x=g?m:1-m,f.dispose(),p.dispose(),[2,{age:v,gender:y,genderProbability:x}]}})})}))];case 3:return u=h.sent(),o.age.dispose(),o.gender.dispose(),[2,t.isBatchInput?u:u[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),r.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),a=t.paramMappings;this._params=t.params,this._paramMappings=a},n.prototype.extractClassifierParams=function(e){return function Ug(r){var n=[],e=en(r),o=e.getRemainingWeights,a=Li(e.extractWeights,n),i=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{fc:{age:i,gender:s}}}}(e)},n.prototype.extractParamsFromWeigthMap=function(e){var t=ih(e),a=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(t.featureExtractorMap),function Vg(r){var n=[],e=mn(r,n);function t(a){return{weights:e(a+"/weights",2),bias:e(a+"/bias",1)}}var o={fc:{age:t("fc/age"),gender:t("fc/gender")}};return $t(r,n),{params:o,paramMappings:n}}(a)},n.prototype.extractParams=function(e){var o=e.slice(0,e.length-1539),a=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(a)},n}(Qt),hh=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.postProcess=function(e,t,o){var a=o.map(function(s){var u=s.width,c=s.height,h=t/Math.max(c,u);return{width:u*h,height:c*h}}),i=a.length;return J(function(){var s=function(f,p){return dt([Nt([68],f),Nt([68],p)],1).as2D(1,136).as1D()},u=function(f,p){var v=a[f],m=v.width,g=v.height;return p(m,g)?Math.abs(m-g)/2:0};return e.mul(Nt([i,136],t)).sub(dt(Array.from(Array(i),function(f,p){return s(function(f){return u(f,function(p,v){return p<v})}(p),function(f){return u(f,function(p,v){return v<p})}(p))}))).div(dt(Array.from(Array(i),function(f,p){return s(a[p].width,a[p].height)})))})},n.prototype.forwardInput=function(e){var t=this;return J(function(){var o=t.runNet(e);return t.postProcess(o,e.inputSize,e.inputDimensions.map(function(a){return{height:a[0],width:a[1]}}))})},n.prototype.forward=function(e){return te(this,void 0,void 0,function(){var t;return ne(this,function(o){switch(o.label){case 0:return t=this.forwardInput,[4,je(e)];case 1:return[2,t.apply(this,[o.sent()])]}})})},n.prototype.detectLandmarks=function(e){return te(this,void 0,void 0,function(){var t,o,a,i=this;return ne(this,function(s){switch(s.label){case 0:return[4,je(e)];case 1:return t=s.sent(),o=J(function(){return Ge(i.forwardInput(t))}),[4,Promise.all(o.map(function(u,c){return te(i,void 0,void 0,function(){var h,d,f,p,v;return ne(this,function(m){switch(m.label){case 0:return f=(d=Array).from,[4,u.data()];case 1:return h=f.apply(d,[m.sent()]),p=h.filter(function(g,y){return Bl(y)}),v=h.filter(function(g,y){return!Bl(y)}),[2,new Vl(Array(68).fill(0).map(function(g,y){return new we(p[y],v[y])}),{height:t.getInputHeight(c),width:t.getInputWidth(c)})]}})})}))];case 2:return a=s.sent(),o.forEach(function(u){return u.dispose()}),[2,t.isBatchInput?a:a[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n}(sh),dh=function(r){function n(e){return void 0===e&&(e=new ah),r.call(this,"FaceLandmark68Net",e)||this}return ie(n,r),n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n}(hh),Hg=function(r){function n(){return r.call(this,"TinyFaceFeatureExtractor")||this}return ie(n,r),n.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return J(function(){var s=Bi(Ur(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Z(255)),t.dense0,!0);return s=Bi(s,t.dense1),s=Bi(s,t.dense2),Fr(s,[14,14],[2,2],"valid")})},n.prototype.forward=function(e){return te(this,void 0,void 0,function(){var t;return ne(this,function(o){switch(o.label){case 0:return t=this.forwardInput,[4,je(e)];case 1:return[2,t.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function qg(r){var n=[],e=oh(r,n).extractDenseBlock3Params,t={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return $t(r,n),{params:t,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function zg(r){var n=[],e=en(r),o=e.getRemainingWeights,a=nh(e.extractWeights,n).extractDenseBlock3Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:i,dense1:s,dense2:u}}}(e)},n}(Qt),Zg=function(r){function n(e){return void 0===e&&(e=new Hg),r.call(this,"FaceLandmark68TinyNet",e)||this}return ie(n,r),n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n}(hh);function zi(r,n,e,t,o){void 0===o&&(o="same");var a=n.conv,s=a.bias,u=xt(r,a.filters,e,o);return u=function jg(r,n){return fe($e(r,n.weights),n.biases)}(u=fe(u,s),n.scale),t?Se(u):u}function fh(r,n){return zi(r,n,[1,1],!1)}function ph(r,n){return zi(r,n,[2,2],!0,"valid")}function Jg(r,n){function a(s,u,c,h){var d=function t(s,u,c,h){var d=function e(s,u,c){var h=r(s),d=h.length/(u*c*c);if(function og(r){return r%1!=0}(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+h.length+", numFilters: "+u+", filterSize: "+c);return J(function(){return hn(st(h,[u,d,c,c]),[2,3,1,0])})}(s,u,c),f=Le(r(u));return n.push({paramPath:h+"/filters"},{paramPath:h+"/bias"}),{filters:d,bias:f}}(s,u,c,h+"/conv"),f=function o(s,u){var c=Le(r(s)),h=Le(r(s));return n.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:h}}(u,h+"/scale");return{conv:d,scale:f}}return{extractConvLayerParams:a,extractResidualLayerParams:function i(s,u,c,h,d){return void 0===d&&(d=!1),{conv1:a((d?.5:1)*s,u,c,h+"/conv1"),conv2:a(s,u,c,h+"/conv2")}}}}function Qg(r){var n=[],e=function Xg(r,n){var e=mn(r,n);function o(i){var s=e(i+"/conv/filters",4),u=e(i+"/conv/bias",1),c=function t(i){return{weights:e(i+"/scale/weights",1),biases:e(i+"/scale/biases",1)}}(i);return{conv:{filters:s,bias:u},scale:c}}return{extractConvLayerParams:o,extractResidualLayerParams:function a(i){return{conv1:o(i+"/conv1"),conv2:o(i+"/conv2")}}}}(r,n),o=e.extractResidualLayerParams,a=(0,e.extractConvLayerParams)("conv32_down"),i=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),h=o("conv64_1"),d=o("conv64_2"),f=o("conv64_3"),p=o("conv128_down"),v=o("conv128_1"),m=o("conv128_2"),g=o("conv256_down"),y=o("conv256_1"),x=o("conv256_2"),b=o("conv256_down_out"),_=r.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!function rg(r){return Br(r,2)}(_))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+_);var w={conv32_down:a,conv32_1:i,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:h,conv64_2:d,conv64_3:f,conv128_down:p,conv128_1:v,conv128_2:m,conv256_down:g,conv256_1:y,conv256_2:x,conv256_down_out:b,fc:_};return $t(r,n),{params:w,paramMappings:n}}function Lt(r,n){var e=function Kg(r,n){return zi(r,n,[1,1],!0)}(r,n.conv1);return e=fh(e,n.conv2),e=fe(e,r),Se(e)}function qo(r,n){var e=ph(r,n.conv1);e=fh(e,n.conv2);var t=Fr(r,2,2,"valid"),o=De(t.shape),a=t.shape[3]!==e.shape[3];if(t.shape[1]!==e.shape[1]||t.shape[2]!==e.shape[2]){var s=Or(e.shape);s[1]=1;var u=De(s),c=Or((e=Ve([e,u],1)).shape);c[2]=1;var h=De(c);e=Ve([e,h],2)}return t=a?Ve([t,o],3):t,e=fe(t,e),Se(e)}!function(r){ie(function n(){return null!==r&&r.apply(this,arguments)||this},r)}(dh);var $g=function(r){function n(){return r.call(this,"FaceRecognitionNet")||this}return ie(n,r),n.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return J(function(){var s=ph(Ur(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Z(256)),t.conv32_down);s=Lt(s=Ze(s,3,2,"valid"),t.conv32_1),s=Lt(s,t.conv32_2),s=Lt(s,t.conv32_3),s=Lt(s=qo(s,t.conv64_down),t.conv64_1),s=Lt(s,t.conv64_2),s=Lt(s,t.conv64_3),s=Lt(s=qo(s,t.conv128_down),t.conv128_1),s=Lt(s,t.conv128_2),s=Lt(s=qo(s,t.conv256_down),t.conv256_1);var u=(s=qo(s=Lt(s,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Do(u,t.fc)})},n.prototype.forward=function(e){return te(this,void 0,void 0,function(){var t;return ne(this,function(o){switch(o.label){case 0:return t=this.forwardInput,[4,je(e)];case 1:return[2,t.apply(this,[o.sent()])]}})})},n.prototype.computeFaceDescriptor=function(e){return te(this,void 0,void 0,function(){var t,o,a,i=this;return ne(this,function(s){switch(s.label){case 0:return[4,je(e)];case 1:return t=s.sent(),o=J(function(){return Ge(i.forwardInput(t))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return a=s.sent(),o.forEach(function(u){return u.dispose()}),[2,t.isBatchInput?a:a[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(e){return Qg(e)},n.prototype.extractParams=function(e){return function Yg(r){var n=en(r),e=n.extractWeights,t=n.getRemainingWeights,o=[],a=Jg(e,o),s=a.extractResidualLayerParams,u=(0,a.extractConvLayerParams)(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),h=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),p=s(36864,64,3,"conv64_1"),v=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),y=s(147456,128,3,"conv128_1"),x=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),_=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),T=s(589824,256,3,"conv256_down_out"),A=J(function(){return hn(cn(e(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==t().length)throw new Error("weights remaing after extract: "+t().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:h,conv32_3:d,conv64_down:f,conv64_1:p,conv64_2:v,conv64_3:m,conv128_down:g,conv128_1:y,conv128_2:x,conv256_down:b,conv256_1:_,conv256_2:w,conv256_down_out:T,fc:A},paramMappings:o}}(e)},n}(Qt);function vh(r,n,e){return Object.assign({},r,{gender:n,genderProbability:e})}var mh=function(){function r(n){var e=void 0===n?{}:n,t=e.minFaceSize,o=e.scaleFactor,a=e.maxNumScales,i=e.scoreThresholds,s=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=t||20,this._scaleFactor=o||.709,this._maxNumScales=a||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=s,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(u){return"number"!=typeof u}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return"number"!=typeof u})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r}();function Wt(r,n,e){return J(function(){var t=xt(r,n.filters,e,"same");return t=fe(t,n.batch_norm_offset),Za(t,0,6)})}var o1=.0010000000474974513;function c1(r,n,e){var t=r.arraySync(),o=Math.min(t[n][0],t[n][2]),a=Math.min(t[n][1],t[n][3]),i=Math.max(t[n][0],t[n][2]),s=Math.max(t[n][1],t[n][3]),u=Math.min(t[e][0],t[e][2]),c=Math.min(t[e][1],t[e][3]),h=Math.max(t[e][0],t[e][2]),d=Math.max(t[e][1],t[e][3]),f=(i-o)*(s-a),p=(h-u)*(d-c);if(f<=0||p<=0)return 0;var v=Math.max(o,u),m=Math.max(a,c),g=Math.min(i,h),y=Math.min(s,d),x=Math.max(g-v,0)*Math.max(y-m,0);return x/(f+p-x)}function rr(r,n){return J(function(){var e=r.shape[0];return{boxPredictionEncoding:Et(kt(r,n.box_encoding_predictor),[e,-1,1,4]),classPrediction:Et(kt(r,n.class_predictor),[e,-1,3])}})}var zo=function(){function r(n){var e=void 0===n?{}:n,t=e.minConfidence,o=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=t||.5,this._maxResults=o||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r}(),gh=function(r){function n(){return r.call(this,"SsdMobilenetv1")||this}return ie(n,r),n.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return J(function(){var o=e.toBatchTensor(512,!1).toFloat(),i=function s1(r,n){return J(function(){var e=null,t=Wt(r,n.conv_0,[2,2]);if([n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13].forEach(function(a,i){var s=i+1,u=function i1(r){return[2,4,6,12].some(function(n){return n===r})?[2,2]:[1,1]}(s);t=function a1(r,n,e){return J(function(){var t=Io(r,n.filters,e,"same");return t=Nc(t,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,o1),Za(t,0,6)})}(t,a.depthwise_conv,u),t=Wt(t,a.pointwise_conv,[1,1]),11===s&&(e=t)}),null===e)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:t,conv11:e}})}(qe($e(o,Z(.007843137718737125)),Z(1)),t.mobilenetv1),s=function f1(r,n,e){return J(function(){var t=Wt(r,e.conv_0,[1,1]),o=Wt(t,e.conv_1,[2,2]),a=Wt(o,e.conv_2,[1,1]),i=Wt(a,e.conv_3,[2,2]),s=Wt(i,e.conv_4,[1,1]),u=Wt(s,e.conv_5,[2,2]),c=Wt(u,e.conv_6,[1,1]),h=Wt(c,e.conv_7,[2,2]),d=rr(n,e.box_predictor_0),f=rr(r,e.box_predictor_1),p=rr(o,e.box_predictor_2),v=rr(i,e.box_predictor_3),m=rr(u,e.box_predictor_4),g=rr(h,e.box_predictor_5);return{boxPredictions:Ve([d.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:Ve([d.classPrediction,f.classPrediction,p.classPrediction,v.classPrediction,m.classPrediction,g.classPrediction],1)}})}(i.out,i.conv11,t.prediction_layer);return function d1(r,n,e){return J(function(){var t=r.shape[0],o=function h1(r,n){var e=function l1(r){var n=Ge(hn(r,[1,0])),e=[qe(n[2],n[0]),qe(n[3],n[1])];return{sizes:e,centers:[fe(n[0],Dt(e[0],Z(2))),fe(n[1],Dt(e[1],Z(2)))]}}(r),t=e.sizes,o=e.centers,a=Ge(hn(n,[1,0])),i=Dt($e(ja(Dt(a[2],Z(5))),t[0]),Z(2)),s=fe($e(Dt(a[0],Z(10)),t[0]),o[0]),u=Dt($e(ja(Dt(a[3],Z(5))),t[1]),Z(2)),c=fe($e(Dt(a[1],Z(10)),t[1]),o[1]);return hn(dt([qe(s,i),qe(c,u),fe(s,i),fe(c,u)]),[1,0])}(Et(qn(e.extra_dim,[t,1,1]),[-1,4]),Et(r,[-1,4]));o=Et(o,[t,o.shape[0]/t,4]);var a=Ac(Ft(n,[0,0,1],[-1,-1,-1])),i=Ft(a,[0,0,0],[-1,-1,1]);return i=Et(i,[t,i.shape[1]]),{boxes:Ge(o),scores:Ge(i)}})}(s.boxPredictions,s.classPredictions,t.output_layer)})},n.prototype.forward=function(e){return te(this,void 0,void 0,function(){var t;return ne(this,function(o){switch(o.label){case 0:return t=this.forwardInput,[4,je(e)];case 1:return[2,t.apply(this,[o.sent()])]}})})},n.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),te(this,void 0,void 0,function(){var o,a,i,s,u,c,h,d,f,p,v,m,g,x,b,_,w,T,A,k;return ne(this,function(I){switch(I.label){case 0:return o=new zo(t),a=o.maxResults,i=o.minConfidence,[4,je(e)];case 1:for(s=I.sent(),u=this.forwardInput(s),d=(c=u.boxes)[0],f=(h=u.scores)[0],p=1;p<c.length;p++)c[p].dispose(),h[p].dispose();return g=(m=Array).from,[4,f.data()];case 2:return v=g.apply(m,[I.sent()]),x=function u1(r,n,e,t,o){var i=Math.min(e,r.shape[0]),s=n.map(function(h,d){return{score:h,boxIndex:d}}).filter(function(h){return h.score>o}).sort(function(h,d){return d.score-h.score}),u=function(h){return h<=t?1:0},c=[];return s.forEach(function(h){if(!(c.length>=i)){for(var d=h.score,f=c.length-1;f>=0;--f){var p=c1(r,h.boxIndex,c[f]);if(0!==p&&(h.score*=u(p),h.score<=o))break}d===h.score&&c.push(h.boxIndex)}}),c}(d,v,a,.5,i),b=s.getReshapedInputDimensions(0),w=(_=s.inputSize)/b.width,T=_/b.height,A=d.arraySync(),k=x.map(function(D){var N=[Math.max(0,A[D][0]),Math.min(1,A[D][2])].map(function(V){return V*T}),P=N[0],W=N[1],B=[Math.max(0,A[D][1]),Math.min(1,A[D][3])].map(function(V){return V*w}),L=B[0];return new pt(v[D],new Si(L,P,B[1]-L,W-P),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,k]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function r1(r){var n=[],e=function n1(r,n){var e=mn(r,n);function t(c,h,d){return{filters:e(c+"/Conv2d_"+h+"_pointwise/weights",4,d+"/filters"),batch_norm_offset:e(c+"/Conv2d_"+h+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset")}}function o(c){var h="mobilenetv1/conv_"+c,d="MobilenetV1/Conv2d_"+c+"_depthwise",f=h+"/depthwise_conv",p=h+"/pointwise_conv";return{depthwise_conv:{filters:e(d+"/depthwise_weights",4,f+"/filters"),batch_norm_scale:e(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),batch_norm_offset:e(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),batch_norm_mean:e(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),batch_norm_variance:e(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance")},pointwise_conv:t("MobilenetV1",c,p)}}function i(c,h){return{filters:e(c+"/weights",4,h+"/filters"),bias:e(c+"/biases",1,h+"/bias")}}function s(c){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor")}}return{extractMobilenetV1Params:function a(){return{conv_0:t("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function u(){return{conv_0:t("Prediction",0,"prediction_layer/conv_0"),conv_1:t("Prediction",1,"prediction_layer/conv_1"),conv_2:t("Prediction",2,"prediction_layer/conv_2"),conv_3:t("Prediction",3,"prediction_layer/conv_3"),conv_4:t("Prediction",4,"prediction_layer/conv_4"),conv_5:t("Prediction",5,"prediction_layer/conv_5"),conv_6:t("Prediction",6,"prediction_layer/conv_6"),conv_7:t("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}}}(r,n),t=e.extractMobilenetV1Params,o=e.extractPredictionLayerParams,a=r["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Fo(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var i={mobilenetv1:t(),prediction_layer:o(),output_layer:{extra_dim:a}};return $t(r,n),{params:i,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function t1(r){var n=[],e=en(r),t=e.extractWeights,o=e.getRemainingWeights,a=function e1(r,n){function t(u,c,h,d,f){var p=st(r(u*c*h*h),[h,h,u,c]),v=Le(r(c));return n.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:p,bias:v}}function o(u,c,h,d){var f=t(u,c,h,d,!0);return{filters:f.filters,batch_norm_offset:f.bias}}function a(u,c,h){var d=function e(u,c){var h=st(r(9*u),[3,3,u,1]),d=Le(r(u)),f=Le(r(u)),p=Le(r(u)),v=Le(r(u));return n.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:h,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:p,batch_norm_variance:v}}(u,h+"/depthwise_conv");return{depthwise_conv:d,pointwise_conv:o(u,c,1,h+"/pointwise_conv")}}return{extractMobilenetV1Params:function i(){return{conv_0:o(3,32,3,"mobilenetv1/conv_0"),conv_1:a(32,64,"mobilenetv1/conv_1"),conv_2:a(64,128,"mobilenetv1/conv_2"),conv_3:a(128,128,"mobilenetv1/conv_3"),conv_4:a(128,256,"mobilenetv1/conv_4"),conv_5:a(256,256,"mobilenetv1/conv_5"),conv_6:a(256,512,"mobilenetv1/conv_6"),conv_7:a(512,512,"mobilenetv1/conv_7"),conv_8:a(512,512,"mobilenetv1/conv_8"),conv_9:a(512,512,"mobilenetv1/conv_9"),conv_10:a(512,512,"mobilenetv1/conv_10"),conv_11:a(512,512,"mobilenetv1/conv_11"),conv_12:a(512,1024,"mobilenetv1/conv_12"),conv_13:a(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function s(){return{conv_0:o(1024,256,1,"prediction_layer/conv_0"),conv_1:o(256,512,3,"prediction_layer/conv_1"),conv_2:o(512,128,1,"prediction_layer/conv_2"),conv_3:o(128,256,3,"prediction_layer/conv_3"),conv_4:o(256,128,1,"prediction_layer/conv_4"),conv_5:o(128,256,3,"prediction_layer/conv_5"),conv_6:o(256,64,1,"prediction_layer/conv_6"),conv_7:o(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:t(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:t(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:t(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:t(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:t(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:t(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:t(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:t(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:t(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:t(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:t(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:t(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(t,n),s=a.extractPredictionLayerParams,u=(0,a.extractMobilenetV1Params)(),c=s(),d={extra_dim:ba(t(20472),[1,5118,4])};if(n.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:d},paramMappings:n}}(e)},n}(Qt);!function(r){ie(function n(){return null!==r&&r.apply(this,arguments)||this},r)}(gh);var v1=.4,m1=[new we(.738768,.874946),new we(2.42204,2.65704),new we(4.30971,7.04493),new we(10.246,4.59428),new we(12.6868,11.8741)],g1=[new we(1.603231,2.094468),new we(6.041143,7.080126),new we(2.882459,3.518061),new we(4.266906,5.178857),new we(9.041765,10.66308)],y1=[117.001,114.697,97.404],Ho=function(r){return"number"==typeof r};function Hi(r){return J(function(){var n=$e(r,Z(.10000000149011612));return fe(Se(qe(r,n)),n)})}function gn(r,n){return J(function(){var e=In(r,[[0,0],[1,1],[1,1],[0,0]]);return e=xt(e,n.conv.filters,[1,1],"valid"),e=qe(e,n.bn.sub),e=$e(e,n.bn.truediv),Hi(e=fe(e,n.conv.bias))})}function yn(r,n){return J(function(){var e=In(r,[[0,0],[1,1],[1,1],[0,0]]);return e=Qa(e,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),Hi(e=fe(e,n.bias))})}var Zi=function(){function r(n){var e=void 0===n?{}:n,t=e.inputSize,o=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=t||416,this._scoreThreshold=o||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r}(),yh=function(r){function n(e){var t=r.call(this,"TinyYolov2")||this;return function _1(r){if(!r)throw new Error("invalid config: "+r);if("boolean"!=typeof r.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!Ho(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(n){return"string"==typeof n}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(n){return n||{}}).every(function(n){return Ho(n.x)&&Ho(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||3!==r.meanRgb.length||!r.meanRgb.every(Ho)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}(e),t._config=e,t}return ie(n,r),Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(e,t){var o=gn(e,t.conv0);return o=gn(o=Ze(o,[2,2],[2,2],"same"),t.conv1),o=gn(o=Ze(o,[2,2],[2,2],"same"),t.conv2),o=gn(o=Ze(o,[2,2],[2,2],"same"),t.conv3),o=gn(o=Ze(o,[2,2],[2,2],"same"),t.conv4),o=gn(o=Ze(o,[2,2],[2,2],"same"),t.conv5),o=gn(o=Ze(o,[2,2],[1,1],"same"),t.conv6),kt(o=gn(o,t.conv7),t.conv8,"valid",!1)},n.prototype.runMobilenet=function(e,t){var o=this.config.isFirstLayerConv2d?Hi(kt(e,t.conv0,"valid",!1)):yn(e,t.conv0);return o=yn(o=Ze(o,[2,2],[2,2],"same"),t.conv1),o=yn(o=Ze(o,[2,2],[2,2],"same"),t.conv2),o=yn(o=Ze(o,[2,2],[2,2],"same"),t.conv3),o=yn(o=Ze(o,[2,2],[2,2],"same"),t.conv4),o=yn(o=Ze(o,[2,2],[2,2],"same"),t.conv5),o=Ze(o,[2,2],[1,1],"same"),o=t.conv6?yn(o,t.conv6):o,kt(o=t.conv7?yn(o,t.conv7):o,t.conv8,"valid",!1)},n.prototype.forwardInput=function(e,t){var o=this,a=this.params;if(!a)throw new Error("TinyYolov2 - load model before inference");return J(function(){var i=e.toBatchTensor(t,!1).toFloat();return i=(i=o.config.meanRgb?Ur(i,o.config.meanRgb):i).div(Z(256)),o.config.withSeparableConvs?o.runMobilenet(i,a):o.runTinyYolov2(i,a)})},n.prototype.forward=function(e,t){return te(this,void 0,void 0,function(){var o;return ne(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,je(e)];case 1:return[4,o.apply(this,[a.sent(),t])];case 2:return[2,a.sent()]}})})},n.prototype.detect=function(e,t){return void 0===t&&(t={}),te(this,void 0,void 0,function(){var o,a,i,s,u,c,h,d,f,p,v,m,x=this;return ne(this,function(b){switch(b.label){case 0:return o=new Zi(t),a=o.inputSize,i=o.scoreThreshold,[4,je(e)];case 1:return s=b.sent(),[4,this.forwardInput(s,a)];case 2:return u=b.sent(),c=J(function(){return Ge(u)[0].expandDims()}),h={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),i)];case 3:return d=b.sent(),u.dispose(),c.dispose(),f=d.map(function(_){return _.box}),p=d.map(function(_){return _.score}),v=d.map(function(_){return _.classScore}),m=d.map(function(_){return x.config.classes[_.label]}),[2,Wr(f.map(function(_){return _.rescale(a)}),p,this.config.iouThreshold,!0).map(function(_){return new Ul(p[_],v[_],m[_],f[_],h)})]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(e){return function E1(r,n){var s,e=[],t=function T1(r,n){var e=mn(r,n);function o(s){return{filters:e(s+"/filters",4),bias:e(s+"/bias",1)}}return{extractConvParams:o,extractConvWithBatchNormParams:function a(s){var u=o(s+"/conv"),c=function t(s){return{sub:e(s+"/sub",1),truediv:e(s+"/truediv",1)}}(s+"/bn");return{conv:u,bn:c}},extractSeparableConvParams:Ui(e)}}(r,e),o=t.extractConvParams,a=t.extractConvWithBatchNormParams,i=t.extractSeparableConvParams;if(n.withSeparableConvs){var u=n.filterSizes&&n.filterSizes.length||9;s={conv0:n.isFirstLayerConv2d?o("conv0"):i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:u>7?i("conv6"):void 0,conv7:u>8?i("conv7"):void 0,conv8:o("conv8")}}else s={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:o("conv8")};return $t(r,e),{params:s,paramMappings:e}}(e,this.config)},n.prototype.extractParams=function(e){var t=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,o=t?t.length:void 0;if(7!==o&&8!==o&&9!==o)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return function C1(r,n,e,t){var f,o=en(r),i=o.getRemainingWeights,s=[],u=function w1(r,n){var e=Vo(r,n),a=Wi(r,n);return{extractConvParams:e,extractConvWithBatchNormParams:function o(i,s,u){var c=e(i,s,3,u+"/conv"),h=function t(i,s){var u=Le(r(i)),c=Le(r(i));return n.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}(s,u+"/bn");return{conv:c,bn:h}},extractSeparableConvParams:a}}(o.extractWeights,s),c=u.extractConvParams,h=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams;if(n.withSeparableConvs){var p=t[0],v=t[1],m=t[2],g=t[3],y=t[4],x=t[5],b=t[6],_=t[7],w=t[8];f={conv0:n.isFirstLayerConv2d?c(p,v,3,"conv0"):d(p,v,"conv0"),conv1:d(v,m,"conv1"),conv2:d(m,g,"conv2"),conv3:d(g,y,"conv3"),conv4:d(y,x,"conv4"),conv5:d(x,b,"conv5"),conv6:_?d(b,_,"conv6"):void 0,conv7:w?d(_,w,"conv7"):void 0,conv8:c(w||_||b,5*e,1,"conv8")}}else m=t[2],g=t[3],y=t[4],x=t[5],b=t[6],_=t[7],w=t[8],f={conv0:h(p=t[0],v=t[1],"conv0"),conv1:h(v,m,"conv1"),conv2:h(m,g,"conv2"),conv3:h(g,y,"conv3"),conv4:h(y,x,"conv4"),conv5:h(x,b,"conv5"),conv6:h(b,_,"conv6"),conv7:h(_,w,"conv7"),conv8:c(w,5*e,1,"conv8")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:f,paramMappings:s}}(e,this.config,this.boxEncodingSize,t)},n.prototype.extractBoxes=function(e,t,o){return te(this,void 0,void 0,function(){var a,i,s,u,c,h,d,f,p,v,m,g,y,x,b,_,w,T,A,k,I,D,N,P,W,B,L,q,V,U=this;return ne(this,function(z){switch(z.label){case 0:return a=t.width,i=t.height,s=Math.max(a,i),u=s/a,c=s/i,h=e.shape[1],d=this.config.anchors.length,f=J(function(){var H=e.reshape([h,h,d,U.boxEncodingSize]);return[H.slice([0,0,0,0],[h,h,d,4]),H.slice([0,0,0,4],[h,h,d,1]),U.withClassScores?Zt(H.slice([0,0,0,5],[h,h,d,U.config.classes.length]),3):Z(0)]}),p=f[0],m=f[2],g=[],[4,(v=f[1]).array()];case 1:return y=z.sent(),[4,p.array()];case 2:x=z.sent(),b=0,z.label=3;case 3:if(!(b<h))return[3,12];_=0,z.label=4;case 4:if(!(_<h))return[3,11];w=0,z.label=5;case 5:return w<d?(T=Ai(y[b][_][w][0]),!o||T>o?(A=(_+Ai(x[b][_][w][0]))/h*u,k=(b+Ai(x[b][_][w][1]))/h*c,I=Math.exp(x[b][_][w][2])*this.config.anchors[w].x/h*u,D=Math.exp(x[b][_][w][3])*this.config.anchors[w].y/h*c,N=A-I/2,P=k-D/2,W={row:b,col:_,anchor:w},this.withClassScores?[4,this.extractPredictedClass(m,W)]:[3,7]):[3,9]):[3,10];case 6:return V=z.sent(),[3,8];case 7:V={classScore:1,label:0},z.label=8;case 8:L=(B=V).classScore,q=B.label,g.push(tt({box:new Mo(N,P,N+I,P+D),score:T,classScore:T*L,label:q},W)),z.label=9;case 9:return w++,[3,5];case 10:return _++,[3,4];case 11:return b++,[3,3];case 12:return p.dispose(),v.dispose(),m.dispose(),[2,g]}})})},n.prototype.extractPredictedClass=function(e,t){return te(this,void 0,void 0,function(){var o,a,i,s;return ne(this,function(u){switch(u.label){case 0:return o=t.row,a=t.col,i=t.anchor,[4,e.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,h){return s[o][a][i][h]}).map(function(c,h){return{classScore:c,label:h}}).reduce(function(c,h){return c.classScore>h.classScore?c:h})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n}(Qt),I1=function(r){function n(e){void 0===e&&(e=!0);var o=Object.assign({},{withSeparableConvs:e,iouThreshold:v1,classes:["face"]},e?{anchors:g1,meanRgb:y1}:{anchors:m1,withClassScores:!0});return r.call(this,o)||this}return ie(n,r),Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,t){return te(this,void 0,void 0,function(){return ne(this,function(a){switch(a.label){case 0:return[4,this.detect(e,t)];case 1:return[2,a.sent().map(function(i){return new pt(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},n.prototype.extractParamsFromWeigthMap=function(e){return r.prototype.extractParamsFromWeigthMap.call(this,e)},n}(yh),xh=function(r){function n(){var e=null!==r&&r.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return ie(n,r),n}(Zi),zr=function(){function r(){}return r.prototype.then=function(n){return te(this,void 0,void 0,function(){var e;return ne(this,function(t){switch(t.label){case 0:return e=n,[4,this.run()];case 1:return[2,e.apply(void 0,[t.sent()])]}})})},r.prototype.run=function(){return te(this,void 0,void 0,function(){return ne(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},r}();function bh(r,n){return Object.assign({},r,{descriptor:n})}function Zo(r,n,e,t,o){return void 0===o&&(o=function(a){return a.alignedRect}),te(this,void 0,void 0,function(){var a,i,s,u,c;return ne(this,function(h){switch(h.label){case 0:return a=r.map(function(d){return Gi(d)?o(d):d.detection}),(s=t)?[3,5]:n instanceof Ee?[4,Oi(n,a)]:[3,2];case 1:return u=h.sent(),[3,4];case 2:return[4,Mi(n,a)];case 3:u=h.sent(),h.label=4;case 4:s=u,h.label=5;case 5:return[4,e(i=s)];case 6:return c=h.sent(),i.forEach(function(d){return d instanceof Ee&&d.dispose()}),[2,c]}})})}function ji(r,n,e,t,o){return te(this,void 0,void 0,function(){var a=this;return ne(this,function(i){return[2,Zo([r],n,function(s){return te(a,void 0,void 0,function(){return ne(this,function(u){return[2,e(s[0])]})})},t,o)]})})}var jo=2,Ko=12;function Ki(r,n){var t=n[1];return{height:Math.floor(n[0]*r),width:Math.floor(t*r)}}var Ji=function(r){function n(e,t,o,a){return r.call(this,{left:e,top:t,right:o,bottom:a},!0)||this}return ie(n,r),n}(Mt);function _h(r){return J(function(){return $e(qe(r,Z(127.5)),Z(.0078125))})}function or(r,n){return J(function(){return fe(Se(r),$e(n,_o(Se(_o(r)))))})}function Yi(r,n,e){return void 0===e&&(e=!1),J(function(){var t=kt(r,n.conv1,"valid");return t=or(t,n.prelu1_alpha),t=or(t=kt(t=Ze(t,e?[2,2]:[3,3],[2,2],"same"),n.conv2,"valid"),n.prelu2_alpha),or(t=kt(t=e?t:Ze(t,[3,3],[2,2],"valid"),n.conv3,"valid"),n.prelu3_alpha)})}function O1(r,n,e,t,o){o.stage1=[];var a=n.map(function(f){return J(function(){var p={scale:f},v=function F1(r,n){return J(function(){var e=Ki(n,r.shape.slice(1)),i=_h(ri.resizeBilinear(r,[e.height,e.width]));return hn(i,[0,2,1,3])})}(r,f),m=Date.now(),g=function N1(r,n){return J(function(){var e=Yi(r,n,!0),t=kt(e,n.conv4_1,"valid"),o=yt(ko(t,3),3);return{prob:Zt(qe(t,o),3),regions:kt(e,n.conv4_2,"valid")}})}(v,t),y=g.prob,x=g.regions;return p.pnet=Date.now()-m,{scoresTensor:Ge(Ge(y,3)[1])[0],regionsTensor:Ge(x)[0],scale:f,statsForScale:p}})}),i=a.map(function(f){var p=f.scoresTensor,v=f.regionsTensor,g=f.statsForScale,y=function M1(r,n,e,t){for(var o=[],a=r.arraySync(),i=0;i<r.shape[0];i++)for(var s=0;s<r.shape[1];s++)a[i][s]>=t&&o.push(new we(s,i));return o.map(function(c){var h=new Mo(Math.round((c.y*jo+1)/e),Math.round((c.x*jo+1)/e),Math.round((c.y*jo+Ko)/e),Math.round((c.x*jo+Ko)/e)),d=a[c.y][c.x],f=n.arraySync();return{cell:h,score:d,region:new Ji(f[c.y][c.x][0],f[c.y][c.x][1],f[c.y][c.x][2],f[c.y][c.x][3])}})}(p,v,f.scale,e);if(p.dispose(),v.dispose(),!y.length)return o.stage1.push(g),[];var x=Date.now(),b=Wr(y.map(function(_){return _.cell}),y.map(function(_){return _.score}),.5);return g.nms=Date.now()-x,g.numBoxes=b.length,o.stage1.push(g),b.map(function(_){return y[_]})}),s=i.reduce(function(f,p){return f.concat(p)},[]),u=[],c=[];if(s.length>0){var h=Date.now(),d=Wr(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);o.stage1_nms=Date.now()-h,c=d.map(function(f){return s[f].score}),u=d.map(function(f){return s[f]}).map(function(f){var p=f.cell,v=f.region;return new Mo(p.left+v.left*p.width,p.top+v.top*p.height,p.right+v.right*p.width,p.bottom+v.bottom*p.height).toSquare().round()})}return{boxes:u,scores:c}}function wh(r,n,e){var t=e.width,o=e.height;return te(this,void 0,void 0,function(){var a,i,s,u=this;return ne(this,function(c){switch(c.label){case 0:return a=Ot(r),[4,Promise.all(n.map(function(h){return te(u,void 0,void 0,function(){var d,g,y,x;return ne(this,function(b){return d=h.padAtBorders(r.height,r.width),x=a.getImageData(g=d.x-1,y=d.y-1,d.ex-g,d.ey-y),[2,nt.isNodejs()?Lo(x):createImageBitmap(x)]})})}))];case 1:return i=c.sent(),s=[],i.forEach(function(h){var f=Ot(Bo({width:t,height:o}));f.drawImage(h,0,0,t,o);for(var p=f.getImageData(0,0,t,o).data,v=[],m=0;m<p.length;m+=4)v.push(p[m+2]),v.push(p[m+1]),v.push(p[m]);s.push(v)}),[2,s.map(function(h){return J(function(){return _h(hn(st(h,[1,t,o,3]),[0,2,1,3]).toFloat())})})]}})})}function L1(r,n,e,t,o){return te(this,void 0,void 0,function(){var a,i,s,u,c,h,d,f,p,v,m,g,y,x;return ne(this,function(b){switch(b.label){case 0:return a=Date.now(),[4,wh(r,n,{width:24,height:24})];case 1:return i=b.sent(),o.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(_){var w=function B1(r,n){return J(function(){var e=Yi(r,n),a=or(Bt(Et(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu4_alpha),i=Bt(a,n.fc2_1),s=yt(ko(i,1),1),u=Zt(qe(i,s),1),c=Bt(a,n.fc2_2);return{scores:Ge(u,1)[1],regions:c}})}(_,t);return _.dispose(),w}),o.stage2_rnet=Date.now()-a,u=s.length>1?Ve(s.map(function(_){return _.scores})):s[0].scores,d=(h=Array).from,[4,u.data()];case 2:return c=d.apply(h,[b.sent()]),u.dispose(),f=c.map(function(_,w){return{score:_,idx:w}}).filter(function(_){return _.score>e}).map(function(_){return _.idx}),p=f.map(function(_){return n[_]}),v=f.map(function(_){return c[_]}),m=[],g=[],p.length>0&&(a=Date.now(),y=Wr(p,v,.7),o.stage2_nms=Date.now()-a,x=y.map(function(_){var w=s[f[_]].regions.arraySync();return new Ji(w[0][0],w[0][1],w[0][2],w[0][3])}),g=y.map(function(_){return v[_]}),m=y.map(function(_,w){return p[_].calibrate(x[w])})),s.forEach(function(_){_.regions.dispose(),_.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function U1(r,n,e,t,o){return te(this,void 0,void 0,function(){var a,i,s,u,c,h,d,f,p,v,m,g,y,x,b;return ne(this,function(_){switch(_.label){case 0:return a=Date.now(),[4,wh(r,n,{width:48,height:48})];case 1:return i=_.sent(),o.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(w){var T=function W1(r,n){return J(function(){var e=Yi(r,n);e=or(e=kt(e=Ze(e,[2,2],[2,2],"same"),n.conv4,"valid"),n.prelu4_alpha);var a=or(Bt(Et(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu5_alpha),i=Bt(a,n.fc2_1),s=yt(ko(i,1),1),u=Zt(qe(i,s),1),c=Bt(a,n.fc2_2),h=Bt(a,n.fc2_3);return{scores:Ge(u,1)[1],regions:c,points:h}})}(w,t);return w.dispose(),T}),o.stage3_onet=Date.now()-a,u=s.length>1?Ve(s.map(function(w){return w.scores})):s[0].scores,d=(h=Array).from,[4,u.data()];case 2:return c=d.apply(h,[_.sent()]),u.dispose(),f=c.map(function(w,T){return{score:w,idx:T}}).filter(function(w){return w.score>e}).map(function(w){return w.idx}),p=f.map(function(w){var T=s[w].regions.arraySync();return new Ji(T[0][0],T[0][1],T[0][2],T[0][3])}),v=f.map(function(w,T){return n[w].calibrate(p[T])}),m=f.map(function(w){return c[w]}),g=[],y=[],x=[],v.length>0&&(a=Date.now(),b=Wr(v,m,.7,!1),o.stage3_nms=Date.now()-a,g=b.map(function(w){return v[w]}),y=b.map(function(w){return m[w]}),x=b.map(function(w,T){return Array(5).fill(0).map(function(A,k){var I=s[w].points.arraySync();return new we(I[0][k]*(g[T].width+1)+g[T].left,I[0][k+5]*(g[T].height+1)+g[T].top)})})),s.forEach(function(w){w.regions.dispose(),w.scores.dispose(),w.points.dispose()}),[2,{boxes:g,scores:y,points:x}]}})})}var V1=function(r){function n(){return r.call(this,"Mtcnn")||this}return ie(n,r),n.prototype.load=function(e){return te(this,void 0,void 0,function(){return ne(this,function(t){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.load.call(this,e)]})})},n.prototype.loadFromDisk=function(e){return te(this,void 0,void 0,function(){return ne(this,function(t){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.loadFromDisk.call(this,e)]})})},n.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),te(this,void 0,void 0,function(){var o,a,i,s,u,c,h,d,f,p,v,m,g,y,b,_,w,T,A,k;return ne(this,function(I){switch(I.label){case 0:if(!(o=this.params))throw new Error("Mtcnn - load model before inference");if(!(a=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},s=Date.now(),u=J(function(){return function D1(r){return J(function(){return dt(Ge(r,3).reverse(),3)})}(yt(_i.fromPixels(a)).toFloat())}),c=function(D){return u.dispose(),i.total=Date.now()-s,D},h=u.shape.slice(1),d=h[0],f=h[1],p=new mh(t),v=p.minFaceSize,m=p.scaleFactor,g=p.maxNumScales,y=p.scoreThresholds,b=(p.scaleSteps||function P1(r,n,e){for(var a=Ko/r,i=[],s=Math.min(e[0],e[1])*a,u=0;s>=12;)i.push(a*Math.pow(n,u)),s*=n,u+=1;return i}(v,m,[d,f])).filter(function(D){var N=Ki(D,[d,f]);return Math.min(N.width,N.height)>Ko}).slice(0,g),i.scales=b,i.pyramid=b.map(function(D){return Ki(D,[d,f])}),_=Date.now(),[4,O1(u,b,y[0],o.pnet,i)];case 1:return w=I.sent(),i.total_stage1=Date.now()-_,w.boxes.length?(i.stage2_numInputBoxes=w.boxes.length,_=Date.now(),[4,L1(a,w.boxes,y[1],o.rnet,i)]):[2,c({results:[],stats:i})];case 2:return T=I.sent(),i.total_stage2=Date.now()-_,T.boxes.length?(i.stage3_numInputBoxes=T.boxes.length,_=Date.now(),[4,U1(a,T.boxes,y[2],o.onet,i)]):[2,c({results:[],stats:i})];case 3:return A=I.sent(),i.total_stage3=Date.now()-_,k=A.boxes.map(function(D,N){return Go(Gr({},new pt(A.scores[N],new Si(D.left/f,D.top/d,D.width/f,D.height/d),{height:d,width:f})),new dg(A.points[N].map(function(P){return P.sub(new we(D.left,D.top)).div(new we(D.width,D.height))}),{width:D.width,height:D.height}))}),[2,c({results:k,stats:i})]}})})},n.prototype.forward=function(e,t){return void 0===t&&(t={}),te(this,void 0,void 0,function(){var o;return ne(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,je(e)];case 1:return[4,o.apply(this,[a.sent(),t])];case 2:return[2,a.sent().results]}})})},n.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),te(this,void 0,void 0,function(){var o;return ne(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,je(e)];case 1:return[2,o.apply(this,[a.sent(),t])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function R1(r){var n=[],e=function S1(r,n){var e=mn(r,n);function t(h){return{filters:e(h+"/weights",4,h+"/filters"),bias:e(h+"/bias",1)}}function o(h){return{weights:e(h+"/weights",2),bias:e(h+"/bias",1)}}function a(h){return e(h,1)}function i(h){return{conv1:t(h+"/conv1"),prelu1_alpha:a(h+"/prelu1_alpha"),conv2:t(h+"/conv2"),prelu2_alpha:a(h+"/prelu2_alpha"),conv3:t(h+"/conv3"),prelu3_alpha:a(h+"/prelu3_alpha")}}return{extractPNetParams:function s(){var h=i("pnet"),d=t("pnet/conv4_1"),f=t("pnet/conv4_2");return tt(tt({},h),{conv4_1:d,conv4_2:f})},extractRNetParams:function u(){var h=i("rnet"),d=o("rnet/fc1"),f=a("rnet/prelu4_alpha"),p=o("rnet/fc2_1"),v=o("rnet/fc2_2");return tt(tt({},h),{fc1:d,prelu4_alpha:f,fc2_1:p,fc2_2:v})},extractONetParams:function c(){var h=i("onet"),d=t("onet/conv4"),f=a("onet/prelu4_alpha"),p=o("onet/fc1"),v=a("onet/prelu5_alpha"),m=o("onet/fc2_1"),g=o("onet/fc2_2"),y=o("onet/fc2_3");return tt(tt({},h),{conv4:d,prelu4_alpha:f,fc1:p,prelu5_alpha:v,fc2_1:m,fc2_2:g,fc2_3:y})}}}(r,n),o=e.extractRNetParams,a=e.extractONetParams,i=(0,e.extractPNetParams)(),s=o(),u=a();return $t(r,n),{params:{pnet:i,rnet:s,onet:u},paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function A1(r){var n=en(r),t=n.getRemainingWeights,o=[],a=function k1(r,n){var e=Vo(r,n),t=Li(r,n);function o(c,h){var d=Le(r(c));return n.push({paramPath:h}),d}function a(c,h,d){return void 0===d&&(d=!1),{conv1:e(c[0],c[1],3,h+"/conv1"),prelu1_alpha:o(c[1],h+"/prelu1_alpha"),conv2:e(c[1],c[2],3,h+"/conv2"),prelu2_alpha:o(c[2],h+"/prelu2_alpha"),conv3:e(c[2],c[3],d?2:3,h+"/conv3"),prelu3_alpha:o(c[3],h+"/prelu3_alpha")}}return{extractPNetParams:function i(){var c=a([3,10,16,32],"pnet"),h=e(32,2,1,"pnet/conv4_1"),d=e(32,4,1,"pnet/conv4_2");return tt(tt({},c),{conv4_1:h,conv4_2:d})},extractRNetParams:function s(){var c=a([3,28,48,64],"rnet",!0),h=t(576,128,"rnet/fc1"),d=o(128,"rnet/prelu4_alpha"),f=t(128,2,"rnet/fc2_1"),p=t(128,4,"rnet/fc2_2");return tt(tt({},c),{fc1:h,prelu4_alpha:d,fc2_1:f,fc2_2:p})},extractONetParams:function u(){var c=a([3,32,64,64],"onet"),h=e(64,128,2,"onet/conv4"),d=o(128,"onet/prelu4_alpha"),f=t(1152,256,"onet/fc1"),p=o(256,"onet/prelu5_alpha"),v=t(256,2,"onet/fc2_1"),m=t(256,4,"onet/fc2_2"),g=t(256,10,"onet/fc2_3");return tt(tt({},c),{conv4:h,prelu4_alpha:d,fc1:f,prelu5_alpha:p,fc2_1:v,fc2_2:m,fc2_3:g})}}}(n.extractWeights,o),s=a.extractRNetParams,u=a.extractONetParams,c=(0,a.extractPNetParams)(),h=s(),d=u();if(0!==t().length)throw new Error("weights remaing after extract: "+t().length);return{params:{pnet:c,rnet:h,onet:d},paramMappings:o}}(e)},n}(Qt),G1=.4,q1=[new we(1.603231,2.094468),new we(6.041143,7.080126),new we(2.882459,3.518061),new we(4.266906,5.178857),new we(9.041765,10.66308)],z1=[117.001,114.697,97.404],H1=function(r){function n(){return r.call(this,{withSeparableConvs:!0,iouThreshold:G1,classes:["face"],anchors:q1,meanRgb:z1,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return ie(n,r),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,t){return te(this,void 0,void 0,function(){return ne(this,function(a){switch(a.label){case 0:return[4,this.detect(e,t)];case 1:return[2,a.sent().map(function(i){return new pt(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(e){return r.prototype.extractParamsFromWeigthMap.call(this,e)},n}(yh),xe={ssdMobilenetv1:new gh,tinyFaceDetector:new H1,tinyYolov2:new I1,mtcnn:new V1,faceLandmark68Net:new dh,faceLandmark68TinyNet:new Zg,faceRecognitionNet:new $g,faceExpressionNet:new kg,ageGenderNet:new Gg};function Ch(r,n){return Object.assign({},r,{age:n})}var Th=function(r){function n(e,t,o){var a=r.call(this)||this;return a.parentTask=e,a.input=t,a.extractedFaces=o,a}return ie(n,r),n}(zr),Xi=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.run=function(){return te(this,void 0,void 0,function(){var e,t,o=this;return ne(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return[4,Zo(e=a.sent(),this.input,function(i){return te(o,void 0,void 0,function(){return ne(this,function(s){switch(s.label){case 0:return[4,Promise.all(i.map(function(u){return xe.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return t=a.sent(),[2,e.map(function(i,s){return ch(i,t[s])})]}})})},n.prototype.withAgeAndGender=function(){return new ts(this,this.input)},n}(Th),Qi=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.run=function(){return te(this,void 0,void 0,function(){var e,t;return ne(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(e=o.sent())?[4,ji(e,this.input,function(a){return xe.faceExpressionNet.predictExpressions(a)},this.extractedFaces)]:[2];case 2:return t=o.sent(),[2,ch(e,t)]}})})},n.prototype.withAgeAndGender=function(){return new ns(this,this.input)},n}(Th),$i=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.withAgeAndGender=function(){return new rs(this,this.input)},n.prototype.withFaceDescriptors=function(){return new as(this,this.input)},n}(Xi),es=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.withAgeAndGender=function(){return new os(this,this.input)},n.prototype.withFaceDescriptor=function(){return new is(this,this.input)},n}(Qi),Eh=function(r){function n(e,t,o){var a=r.call(this)||this;return a.parentTask=e,a.input=t,a.extractedFaces=o,a}return ie(n,r),n}(zr),ts=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.run=function(){return te(this,void 0,void 0,function(){var e,t,o=this;return ne(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return[4,Zo(e=a.sent(),this.input,function(i){return te(o,void 0,void 0,function(){return ne(this,function(s){switch(s.label){case 0:return[4,Promise.all(i.map(function(u){return xe.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return t=a.sent(),[2,e.map(function(i,s){var u=t[s],c=u.age;return Ch(vh(i,u.gender,u.genderProbability),c)})]}})})},n.prototype.withFaceExpressions=function(){return new Xi(this,this.input)},n}(Eh),ns=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.run=function(){return te(this,void 0,void 0,function(){var e,t,o;return ne(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(e=s.sent())?[4,ji(e,this.input,function(u){return xe.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return t=s.sent(),o=t.age,[2,Ch(vh(e,t.gender,t.genderProbability),o)]}})})},n.prototype.withFaceExpressions=function(){return new Qi(this,this.input)},n}(Eh),rs=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.withFaceExpressions=function(){return new $i(this,this.input)},n.prototype.withFaceDescriptors=function(){return new as(this,this.input)},n}(ts),os=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.withFaceExpressions=function(){return new es(this,this.input)},n.prototype.withFaceDescriptor=function(){return new is(this,this.input)},n}(ns),Ih=function(r){function n(e,t){var o=r.call(this)||this;return o.parentTask=e,o.input=t,o}return ie(n,r),n}(zr),as=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.run=function(){return te(this,void 0,void 0,function(){var e;return ne(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,Zo(e=o.sent(),this.input,function(a){return Promise.all(a.map(function(i){return xe.faceRecognitionNet.computeFaceDescriptor(i)}))},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,o.sent().map(function(a,i){return bh(e[i],a)})]}})})},n.prototype.withFaceExpressions=function(){return new $i(this,this.input)},n.prototype.withAgeAndGender=function(){return new rs(this,this.input)},n}(Ih),is=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.run=function(){return te(this,void 0,void 0,function(){var e,t;return ne(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(e=o.sent())?[4,ji(e,this.input,function(a){return xe.faceRecognitionNet.computeFaceDescriptor(a)},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return t=o.sent(),[2,bh(e,t)]}})})},n.prototype.withFaceExpressions=function(){return new es(this,this.input)},n.prototype.withAgeAndGender=function(){return new os(this,this.input)},n}(Ih),Dh=function(r){function n(e,t,o){var a=r.call(this)||this;return a.parentTask=e,a.input=t,a.useTinyLandmarkNet=o,a}return ie(n,r),Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?xe.faceLandmark68TinyNet:xe.faceLandmark68Net},enumerable:!0,configurable:!0}),n}(zr),Z1=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.run=function(){return te(this,void 0,void 0,function(){var e,t,o,a,i,s=this;return ne(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),t=e.map(function(c){return c.detection}),this.input instanceof Ee?[4,Oi(this.input,t)]:[3,3];case 2:return a=u.sent(),[3,5];case 3:return[4,Mi(this.input,t)];case 4:a=u.sent(),u.label=5;case 5:return o=a,[4,Promise.all(o.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return i=u.sent(),o.forEach(function(c){return c instanceof Ee&&c.dispose()}),[2,e.map(function(c,h){return Go(c,i[h])})]}})})},n.prototype.withFaceExpressions=function(){return new $i(this,this.input)},n.prototype.withAgeAndGender=function(){return new rs(this,this.input)},n.prototype.withFaceDescriptors=function(){return new as(this,this.input)},n}(Dh),j1=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.run=function(){return te(this,void 0,void 0,function(){var e,t,o,a,i;return ne(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(e=s.sent())?(t=e.detection,this.input instanceof Ee?[4,Oi(this.input,[t])]:[3,3]):[2];case 2:return a=s.sent(),[3,5];case 3:return[4,Mi(this.input,[t])];case 4:a=s.sent(),s.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((o=a)[0])];case 6:return i=s.sent(),o.forEach(function(u){return u instanceof Ee&&u.dispose()}),[2,Go(e,i)]}})})},n.prototype.withFaceExpressions=function(){return new es(this,this.input)},n.prototype.withAgeAndGender=function(){return new os(this,this.input)},n.prototype.withFaceDescriptor=function(){return new is(this,this.input)},n}(Dh),kh=function(r){function n(e,t){void 0===t&&(t=new zo);var o=r.call(this)||this;return o.input=e,o.options=t,o}return ie(n,r),n}(zr),Ah=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return ie(n,r),n.prototype.run=function(){return te(this,void 0,void 0,function(){var e,t,o,a;return ne(this,function(i){switch(i.label){case 0:return t=(e=this).input,(o=e.options)instanceof mh?[4,xe.mtcnn.forward(t,o)]:[3,2];case 1:return[2,i.sent().map(function(s){return s.detection})];case 2:if(!(a=o instanceof xh?function(s){return xe.tinyFaceDetector.locateFaces(s,o)}:o instanceof zo?function(s){return xe.ssdMobilenetv1.locateFaces(s,o)}:o instanceof Zi?function(s){return xe.tinyYolov2.locateFaces(s,o)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,a(t)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(t){return te(e,void 0,void 0,function(){var o;return ne(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return o=a.sent(),[2,t(o.map(function(i){return Gr({},i)}))]}})})})},n.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new Z1(this.runAndExtendWithFaceDetections(),this.input,e)},n.prototype.withFaceExpressions=function(){return new Xi(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new ts(this.runAndExtendWithFaceDetections(),this.input)},n}(kh);function Sh(r,n){var e=new Mn(n.width,n.height),t=e.width,o=e.height;if(t<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:t,height:o}));if(Array.isArray(r))return r.map(function(s){return Sh(s,{width:t,height:o})});if(Gi(r)){var a=r.detection.forSize(t,o),i=r.unshiftedLandmarks.forSize(a.box.width,a.box.height);return Go(Gr(r,a),i)}return Vr(r)?Gr(r,r.detection.forSize(t,o)):r instanceof nr||r instanceof pt?r.forSize(t,o):r}!function(r){function n(){return null!==r&&r.apply(this,arguments)||this}ie(n,r),n.prototype.run=function(){return te(this,void 0,void 0,function(){var e,t;return ne(this,function(o){switch(o.label){case 0:return[4,new Ah(this.input,this.options)];case 1:return e=o.sent(),t=e[0],e.forEach(function(a){a.score>t.score&&(t=a)}),[2,t]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(t){return te(e,void 0,void 0,function(){var o;return ne(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return o=a.sent(),[2,t(o?Gr({},o):void 0)]}})})})},n.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new j1(this.runAndExtendWithFaceDetection(),this.input,e)},n.prototype.withFaceExpressions=function(){return new Qi(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new ns(this.runAndExtendWithFaceDetection(),this.input)}}(kh),function(){function r(n,e){void 0===e&&(e=.6),this._distanceThreshold=e;var t=Array.isArray(n)?n:[n];if(!t.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,a=function(){return"person "+o++};this._labeledDescriptors=t.map(function(i){if(i instanceof Oo)return i;if(i instanceof Float32Array)return new Oo(a(),[i]);if(i.descriptor&&i.descriptor instanceof Float32Array)return new Oo(a(),[i.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(n,e){return e.map(function(t){return function J1(r,n){if(r.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(r),t=Array.from(n);return Math.sqrt(e.map(function(o,a){return o-t[a]}).reduce(function(o,a){return o+Math.pow(a,2)},0))}(t,n)}).reduce(function(t,o){return t+o},0)/(e.length||1)},r.prototype.matchDescriptor=function(n){var e=this;return this.labeledDescriptors.map(function(t){return new Gl(t.label,e.computeMeanDistance(n,t.descriptors))}).reduce(function(t,o){return t.distance<o.distance?t:o})},r.prototype.findBestMatch=function(n){var e=this.matchDescriptor(n);return e.distance<this.distanceThreshold?e:new Gl("unknown",e.distance)},r.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},r.fromJSON=function(n){return new r(n.labeledDescriptors.map(function(t){return Oo.fromJSON(t)}),n.distanceThreshold)}}();var Rh=Ue(997),Ph=Ue(5114),Nh=Ue(7924),Y1=Ue(9975),X1=Ue(8965);const Q1=["modal1"],$1=["modal2"],e0=["modal3"],t0=["modal4"],n0=["modal5"],r0=["modal6"],o0=["modal7"],a0=["videoContainer"],i0=["accordionGroup"];function s0(r,n){if(1&r&&l._UZ(0,"ion-img",57),2&r){const e=l.oxw();l.Q6J("src",e.hubImag.fotoperfil.webviewPath)}}function u0(r,n){1&r&&l._UZ(0,"ion-img",58)}function c0(r,n){if(1&r&&(l.TgZ(0,"ion-select-option",59),l._uU(1),l.qZA()),2&r){const e=n.$implicit;l.Q6J("value",e.id),l.xp6(1),l.hij(" ",e.name," ")}}function l0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",60),l.NdJ("click",function(){l.CHM(e),l.oxw();const o=l.MAs(101);return l.KtG(o.dismiss())}),l._uU(4,"Cancelar"),l.qZA()(),l.TgZ(5,"ion-title",1),l._uU(6,"Datos Conducotor"),l.qZA(),l.TgZ(7,"ion-buttons",61)(8,"ion-button",62),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.onSubmitDriver())}),l._uU(9,"Guardar"),l.qZA()()()(),l._UZ(10,"ion-content")}2&r&&(l.xp6(8),l.Q6J("strong",!0))}function h0(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(2);l.Q6J("src",e.hubImag.cedula1.webviewPath)}}function d0(r,n){1&r&&l._UZ(0,"div",78)}function f0(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(2);l.Q6J("src",e.hubImag.cedula2.webviewPath)}}function p0(r,n){1&r&&l._UZ(0,"div",78)}function v0(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(2);l.Q6J("src",e.hubImag.licencia1.webviewPath)}}function m0(r,n){1&r&&l._UZ(0,"div",78)}function g0(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(2);l.Q6J("src",e.hubImag.licencia2.webviewPath)}}function y0(r,n){1&r&&l._UZ(0,"div",78)}function x0(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(2);l.Q6J("src",e.hubImag.seguridadSocial.webviewPath)}}function b0(r,n){1&r&&l._UZ(0,"div",78)}const _0=function(){return["first"]};function w0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",60),l.NdJ("click",function(){l.CHM(e),l.oxw();const o=l.MAs(104);return l.KtG(o.dismiss())}),l._uU(4,"Cancelar"),l.qZA()(),l.TgZ(5,"ion-title",63),l._uU(6,"Carga Documentos"),l.qZA(),l.TgZ(7,"ion-buttons",61)(8,"ion-button",62),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.saveDocumentos())}),l._uU(9,"Confirmar"),l.qZA()()()(),l.TgZ(10,"ion-content")(11,"ion-list")(12,"form",26),l.NdJ("ngSubmit",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.saveDocumentos())}),l.TgZ(13,"ion-accordion-group",59,64)(15,"ion-col")(16,"div",27)(17,"strong")(18,"h1"),l._uU(19,"Documentos"),l.qZA()()()(),l.TgZ(20,"ion-accordion",65)(21,"ion-item",66)(22,"ion-label"),l._uU(23,"Cedula de Ciudadania"),l.qZA()(),l.TgZ(24,"div",67)(25,"ion-row")(26,"ion-col")(27,"div",68)(28,"strong")(29,"h1"),l._uU(30,"Cedula Cara Fontal"),l.qZA()()(),l.TgZ(31,"ion-item")(32,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return o.addToCamera("cedula1"),l.KtG(o.validateDocument("cedula1"))}),l.YNc(33,h0,1,1,"ion-img",70),l.YNc(34,d0,1,0,"div",71),l.qZA()()()(),l.TgZ(35,"ion-row")(36,"ion-col")(37,"div",68)(38,"strong")(39,"h1"),l._uU(40,"Cedula Cara Posterior"),l.qZA()()(),l.TgZ(41,"ion-item")(42,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return o.addToCamera("cedula2"),l.KtG(o.validateDocument("cedula2"))}),l.YNc(43,f0,1,1,"ion-img",70),l.YNc(44,p0,1,0,"div",71),l.qZA()()()()()(),l.TgZ(45,"ion-accordion",72)(46,"ion-item",66)(47,"ion-label"),l._uU(48,"Licencia de conduccion"),l.qZA()(),l.TgZ(49,"div",67)(50,"ion-row")(51,"ion-col")(52,"div",68)(53,"strong")(54,"h1"),l._uU(55,"Licencia Cara Frontal"),l.qZA()()(),l.TgZ(56,"ion-item")(57,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.addToCamera("licencia1"))}),l.YNc(58,v0,1,1,"ion-img",70),l.YNc(59,m0,1,0,"div",71),l.qZA()()()(),l.TgZ(60,"ion-row")(61,"ion-col")(62,"div",68)(63,"strong")(64,"h1"),l._uU(65,"Licencia Cara Posterior"),l.qZA()()(),l.TgZ(66,"ion-item")(67,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.addToCamera("licencia2"))}),l.YNc(68,g0,1,1,"ion-img",70),l.YNc(69,y0,1,0,"div",71),l.qZA()()()(),l.TgZ(70,"div",68)(71,"strong")(72,"h3"),l._uU(73,"Fecha Vencimiento Licencia"),l.qZA()()(),l.TgZ(74,"ion-row")(75,"ion-col",73)(76,"ion-item"),l._UZ(77,"ion-datetime",74),l.qZA()()()()(),l.TgZ(78,"ion-accordion",75)(79,"ion-item",66)(80,"ion-label"),l._uU(81,"Seguridad social"),l.qZA()(),l.TgZ(82,"div",67)(83,"ion-row")(84,"ion-col")(85,"div",68)(86,"strong")(87,"h1"),l._uU(88,"Seguridad Social"),l.qZA()()(),l.TgZ(89,"ion-item")(90,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.addToCamera("seguridadSocial"))}),l.YNc(91,x0,1,1,"ion-img",70),l.YNc(92,b0,1,0,"div",71),l.qZA()()()(),l.TgZ(93,"div",68)(94,"strong")(95,"h3"),l._uU(96,"Fecha Vencimiento"),l.qZA()()(),l.TgZ(97,"ion-row")(98,"ion-col",73)(99,"ion-item"),l._UZ(100,"ion-datetime",76),l.qZA()()()()()()()()()}if(2&r){const e=l.oxw();l.xp6(8),l.Q6J("strong",!0),l.xp6(4),l.Q6J("formGroup",e.formDocumentDriver),l.xp6(1),l.Q6J("value",l.DdM(15,_0)),l.xp6(20),l.Q6J("ngIf",e.hubImag.cedula1.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.cedula1.webviewPath),l.xp6(9),l.Q6J("ngIf",e.hubImag.cedula2.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.cedula2.webviewPath),l.xp6(14),l.Q6J("ngIf",e.hubImag.licencia1.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.licencia1.webviewPath),l.xp6(9),l.Q6J("ngIf",e.hubImag.licencia2.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.licencia2.webviewPath),l.xp6(8),l.Q6J("ngModel",e.vehiculo.fechaLicencia),l.xp6(14),l.Q6J("ngIf",e.hubImag.seguridadSocial.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.seguridadSocial.webviewPath),l.xp6(8),l.Q6J("ngModel",e.conductor.fechaSeguridad)}}function C0(r,n){if(1&r&&(l.TgZ(0,"ion-item")(1,"ion-label",81),l._uU(2,"Clase vehiculo"),l.qZA(),l._UZ(3,"ion-input",87),l.qZA()),2&r){const e=l.oxw(2);l.xp6(3),l.Q6J("ngModel",e.vehiculo.claseVehiculo)("disabled",e.isDisabled)}}function T0(r,n){if(1&r&&(l.TgZ(0,"ion-item")(1,"ion-label",81),l._uU(2,"Marca"),l.qZA(),l._UZ(3,"ion-input",88),l.qZA()),2&r){const e=l.oxw(2);l.xp6(3),l.Q6J("ngModel",e.marcaVeh)("disabled",e.isDisabled1)}}function E0(r,n){if(1&r&&(l.TgZ(0,"ion-item")(1,"ion-label",81),l._uU(2,"Carroceria"),l.qZA(),l._UZ(3,"ion-input",89),l.qZA()),2&r){const e=l.oxw(2);l.xp6(3),l.Q6J("ngModel",e.carroceVeh)("disabled",e.isDisabled2)}}function I0(r,n){1&r&&(l.TgZ(0,"ion-button",90),l._uU(1," Cambiar "),l.qZA())}function D0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",60),l.NdJ("click",function(){l.CHM(e),l.oxw();const o=l.MAs(107);return l.KtG(o.dismiss())}),l._uU(4," Cancelar "),l.qZA()(),l.TgZ(5,"ion-title",79),l._uU(6,"Nuevo Vehiculo"),l.qZA(),l.TgZ(7,"ion-buttons",61)(8,"ion-button",62),l.NdJ("click",function(){l.CHM(e),l.oxw();const o=l.MAs(107);return l.KtG(o.dismiss())}),l._uU(9," Confirmar "),l.qZA()()()(),l.TgZ(10,"ion-content")(11,"form",26),l.NdJ("ngSubmit",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.onChange())}),l.TgZ(12,"ion-row",28)(13,"ion-col",80)(14,"ion-item")(15,"ion-label",81),l._uU(16,"Placa Vehiculo"),l.qZA(),l.TgZ(17,"ion-input",82),l.NdJ("ionChange",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.upperPlaca(o))}),l.qZA()()(),l.TgZ(18,"ion-col",83)(19,"ion-button",84),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.changeVehicle())}),l._uU(20," Buscar "),l.qZA()()(),l._UZ(21,"ion-item"),l.YNc(22,C0,4,2,"ion-item",85),l.YNc(23,T0,4,2,"ion-item",85),l.YNc(24,E0,4,2,"ion-item",85),l.YNc(25,I0,2,0,"ion-button",86),l.qZA()()}if(2&r){const e=l.oxw();l.xp6(8),l.Q6J("strong",!0),l.xp6(3),l.Q6J("formGroup",e.dataChange),l.xp6(6),l.s9C("value",e.searchTerm),l.Q6J("ngModel",e.claseNewVh),l.xp6(5),l.Q6J("ngIf",e.placaChange),l.xp6(1),l.Q6J("ngIf",e.placaChange),l.xp6(1),l.Q6J("ngIf",e.placaChange),l.xp6(1),l.Q6J("ngIf",e.placaChange)}}function k0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",60),l.NdJ("click",function(){l.CHM(e),l.oxw();const o=l.MAs(110);return l.KtG(o.dismiss())}),l._uU(4,"Cancelar"),l.qZA()(),l.TgZ(5,"ion-title",63),l._uU(6,"Mis Vehiculos"),l.qZA(),l.TgZ(7,"ion-buttons",61)(8,"ion-button",91),l._uU(9,"Confirmar"),l.qZA()()()(),l._UZ(10,"ion-content")}2&r&&(l.xp6(8),l.Q6J("strong",!0))}function A0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-icon",121),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(3);return l.KtG(o.nuevoPropietario())}),l.qZA()}}function S0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"div",122)(1,"ion-icon",123),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(3);return l.KtG(o.editPropietario())}),l.qZA(),l._UZ(2,"ion-icon",124),l.qZA()}}function R0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"div",122)(1,"ion-icon",123),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(3);return l.KtG(o.editPropietario())}),l.qZA(),l._UZ(2,"ion-icon",125),l.qZA()}}function P0(r,n){1&r&&l._UZ(0,"ion-icon",126)}function N0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-row",115)(1,"label",116),l._uU(2,"Propietario"),l.qZA(),l.TgZ(3,"input",117),l.NdJ("change",function(o){l.CHM(e);const a=l.oxw(2);return l.KtG(a.searchPropietario(o))}),l.qZA(),l.YNc(4,A0,1,0,"ion-icon",118),l.YNc(5,S0,3,0,"div",119),l.YNc(6,R0,3,0,"div",119),l.YNc(7,P0,1,0,"ion-icon",120),l.qZA()}if(2&r){const e=l.oxw(2);l.xp6(3),l.Q6J("ngModel",e.propietario.cedula),l.xp6(1),l.Q6J("ngIf",e.newPropiet),l.xp6(1),l.Q6J("ngIf",e.checkPropi),l.xp6(1),l.Q6J("ngIf",e.incompletoPropiet),l.xp6(1),l.Q6J("ngIf",e.alertPropi)}}function F0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-icon",121),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(3);return l.KtG(o.nuevoTenedor())}),l.qZA()}}function M0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"div",122)(1,"ion-icon",123),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(3);return l.KtG(o.editTenedor())}),l.qZA(),l._UZ(2,"ion-icon",124),l.qZA()}}function O0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"div",122)(1,"ion-icon",123),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(3);return l.KtG(o.editTenedor())}),l.qZA(),l._UZ(2,"ion-icon",125),l.qZA()}}function B0(r,n){1&r&&l._UZ(0,"ion-icon",126)}function L0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-row",115)(1,"label",116),l._uU(2,"Tenedor"),l.qZA(),l.TgZ(3,"input",127),l.NdJ("change",function(o){l.CHM(e);const a=l.oxw(2);return l.KtG(a.searchTenedor(o))}),l.qZA(),l.YNc(4,F0,1,0,"ion-icon",118),l.YNc(5,M0,3,0,"div",119),l.YNc(6,O0,3,0,"div",119),l.YNc(7,B0,1,0,"ion-icon",120),l.qZA()}if(2&r){const e=l.oxw(2);l.xp6(3),l.Q6J("ngModel",e.tenedor.cedula),l.xp6(1),l.Q6J("ngIf",e.newTenedor),l.xp6(1),l.Q6J("ngIf",e.checkTened),l.xp6(1),l.Q6J("ngIf",e.incompletoTenedor),l.xp6(1),l.Q6J("ngIf",e.alertTened)}}function W0(r,n){1&r&&l._UZ(0,"a",128),2&r&&l.Q6J("innerHTML",n.$implicit.name,l.oJD)}function U0(r,n){1&r&&l._UZ(0,"div",128),2&r&&l.Q6J("innerHTML",n.$implicit,l.oJD)}function V0(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(3);l.Q6J("src",e.hubImag.remolque.fotoremol.webviewPath)}}function G0(r,n){1&r&&l._UZ(0,"div",78)}function q0(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(3);l.Q6J("src",e.hubImag.remolque.tarjePro1.webviewPath)}}function z0(r,n){1&r&&l._UZ(0,"div",78)}function H0(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(3);l.Q6J("src",e.hubImag.remolque.tarjePro2.webviewPath)}}function Z0(r,n){1&r&&l._UZ(0,"div",78)}function j0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"div",129)(1,"ion-row")(2,"ion-col")(3,"label",29),l._uU(4,"Placa Remolque"),l.qZA(),l._UZ(5,"input",130),l.qZA()(),l.TgZ(6,"ion-row")(7,"ion-col")(8,"div",68)(9,"strong")(10,"h1"),l._uU(11,"Foto Remolque"),l.qZA()()(),l.TgZ(12,"ion-item")(13,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(2);return l.KtG(o.addToCameraRemolque("fotoremol"))}),l.YNc(14,V0,1,1,"ion-img",70),l.YNc(15,G0,1,0,"div",71),l.qZA()()()(),l.TgZ(16,"ion-row")(17,"ion-col")(18,"div",68)(19,"strong")(20,"h1"),l._uU(21,"Tarjeta de propiedad Frontal"),l.qZA()()(),l.TgZ(22,"ion-item")(23,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(2);return l.KtG(o.addToCameraRemolque("tarjePro1"))}),l.YNc(24,q0,1,1,"ion-img",70),l.YNc(25,z0,1,0,"div",71),l.qZA()()()(),l.TgZ(26,"ion-row")(27,"ion-col")(28,"div",68)(29,"strong")(30,"h1"),l._uU(31,"Tarjeta de propiedad posterior"),l.qZA()()(),l.TgZ(32,"ion-item")(33,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(2);return l.KtG(o.addToCameraRemolque("tarjePro2"))}),l.YNc(34,H0,1,1,"ion-img",70),l.YNc(35,Z0,1,0,"div",71),l.qZA()()()()()}if(2&r){const e=l.oxw(2);l.xp6(5),l.Q6J("ngModel",e.vehiculo.remolque),l.xp6(9),l.Q6J("ngIf",e.hubImag.remolque.fotoremol.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.remolque.fotoremol.webviewPath),l.xp6(9),l.Q6J("ngIf",e.hubImag.remolque.tarjePro1.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.remolque.tarjePro1.webviewPath),l.xp6(9),l.Q6J("ngIf",e.hubImag.remolque.tarjePro2.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.remolque.tarjePro2.webviewPath)}}function K0(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",92),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.setOpenVehiculo(!1))}),l._uU(4,"Cancelar"),l.qZA()(),l.TgZ(5,"ion-title",63),l._uU(6,"Datos Vehiculo"),l.qZA(),l.TgZ(7,"ion-buttons",61)(8,"ion-button",62),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.onSubmitVehicle())}),l._uU(9,"Confirmar"),l.qZA()()()(),l.TgZ(10,"ion-content")(11,"form",26),l.NdJ("ngSubmit",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.onSubmitVehicle())}),l.TgZ(12,"ion-list",25)(13,"ion-grid")(14,"div",93)(15,"ion-row",94)(16,"ion-col",95)(17,"ion-item",96)(18,"ion-label"),l._uU(19),l.qZA(),l.TgZ(20,"ion-toggle",97),l.NdJ("ionChange",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.changePropietario(o))}),l.qZA()()(),l.TgZ(21,"ion-col",98)(22,"ion-item",96)(23,"ion-label"),l._uU(24),l.qZA(),l.TgZ(25,"ion-toggle",97),l.NdJ("ionChange",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.changeTenedor(o))}),l.qZA()()()()(),l.TgZ(26,"ion-col")(27,"div",27)(28,"strong")(29,"h1"),l._uU(30,"Datos del vehiculo"),l.qZA()()()(),l.YNc(31,N0,8,5,"ion-row",99),l.YNc(32,L0,8,5,"ion-row",99),l.TgZ(33,"ion-row",28)(34,"ion-col")(35,"label",29),l._uU(36,"Modelo"),l.qZA(),l._UZ(37,"input",100),l.qZA()(),l.TgZ(38,"ion-row")(39,"ion-col")(40,"div",101)(41,"ion-label",81),l._uU(42,"Clase Vehiculo"),l.qZA(),l.TgZ(43,"ng-autocomplete",102),l.NdJ("selected",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.selectEvent(o))})("inputChanged",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onChangeSearch(o))})("inputFocused",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onFocused(o))}),l.qZA()()()(),l.TgZ(44,"ion-row")(45,"ion-col")(46,"div",101)(47,"ion-label",81),l._uU(48,"Marca"),l.qZA(),l.TgZ(49,"ng-autocomplete",103),l.NdJ("selected",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.selectMarca(o))})("inputChanged",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onChangeMarca(o))})("inputFocused",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onFocusedMarca(o))}),l.qZA()()()(),l.TgZ(50,"ion-row")(51,"ion-col")(52,"div",101)(53,"ion-label",81),l._uU(54,"Clase Linea"),l.qZA(),l.TgZ(55,"ng-autocomplete",104),l.NdJ("selected",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.selectLinea(o))})("inputChanged",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onChangeLinea(o))})("inputFocused",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onFocusedLinea(o))}),l.qZA()()()(),l.TgZ(56,"ion-row")(57,"ion-col")(58,"div",101)(59,"ion-label",81),l._uU(60,"Carroceria"),l.qZA(),l.TgZ(61,"ng-autocomplete",105),l.NdJ("selected",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.selectCarroceria(o))})("inputChanged",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onChangeCarroceria(o))})("inputFocused",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onFocusedCarroceria(o))}),l.qZA()()()(),l.TgZ(62,"ion-row")(63,"ion-col")(64,"div",101)(65,"ion-label",81),l._uU(66,"Color "),l.qZA(),l.TgZ(67,"ng-autocomplete",106),l.NdJ("selected",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.selectColor(o))})("inputChanged",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onChangeColor(o))})("inputFocused",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onFocusedColor(o))}),l.qZA()()()(),l.TgZ(68,"ion-row")(69,"ion-col")(70,"div",101)(71,"ion-label",81),l._uU(72,"Empresa GPS"),l.qZA(),l.TgZ(73,"ng-autocomplete",107),l.NdJ("selected",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.selectSatelital(o))})("inputChanged",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onChangeSatelital(o))})("inputFocused",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.onFocusedSatelital(o))}),l.qZA()()()(),l.YNc(74,W0,1,1,"ng-template",null,108,l.W1O),l.YNc(76,U0,1,1,"ng-template",null,109,l.W1O),l.TgZ(78,"ion-row",28)(79,"ion-col")(80,"label",29),l._uU(81,"Usuario Gps"),l.qZA(),l._UZ(82,"input",110),l.qZA()(),l.TgZ(83,"ion-row",28)(84,"ion-col")(85,"label",29),l._uU(86,"Clave Gps"),l.qZA(),l._UZ(87,"input",111),l.qZA()(),l.YNc(88,j0,36,7,"div",112),l.TgZ(89,"div",113)(90,"ion-button",114),l._uU(91," Guardar "),l.qZA()()()()()()}if(2&r){const e=l.MAs(75),t=l.MAs(77),o=l.oxw();l.xp6(8),l.Q6J("strong",!0),l.xp6(3),l.Q6J("formGroup",o.formVehicle),l.xp6(1),l.Q6J("inset",!0),l.xp6(7),l.hij(" ",o.vehiculo.isPropietario?"Soy el Propietario":"No soy el Propietario"," "),l.xp6(1),l.Q6J("checked",o.vehiculo.isPropietario),l.xp6(4),l.hij(" ",o.vehiculo.isTenedor?"Soy el Tenedor":"No soy el Tenedor"," "),l.xp6(1),l.Q6J("checked",o.vehiculo.isTenedor),l.xp6(6),l.Q6J("ngIf",!o.vehiculo.isPropietario),l.xp6(1),l.Q6J("ngIf",!o.vehiculo.isTenedor),l.xp6(5),l.Q6J("ngModel",o.vehiculo.modelo),l.xp6(6),l.Q6J("ngModel",o.vehiculo.claseVehiculo)("data",o.dataClases)("searchKeyword",o.keyword)("itemTemplate",e)("notFoundTemplate",t),l.xp6(6),l.Q6J("ngModel",o.vehiculo.marca)("data",o.dataMarcas)("searchKeyword",o.keyword)("itemTemplate",e)("notFoundTemplate",t),l.xp6(6),l.Q6J("ngModel",o.vehiculo.linea)("data",o.dataLineas)("searchKeyword",o.keyword)("itemTemplate",e)("notFoundTemplate",t),l.xp6(6),l.Q6J("ngModel",o.vehiculo.carroceria)("data",o.dataCarroc)("searchKeyword",o.keyword)("itemTemplate",e)("notFoundTemplate",t),l.xp6(6),l.Q6J("ngModel",o.vehiculo.color)("data",o.dataColores)("searchKeyword",o.keyword)("itemTemplate",e)("notFoundTemplate",t),l.xp6(6),l.Q6J("ngModel",o.vehiculo.empresaSatelital)("data",o.dataSatelital)("searchKeyword",o.keyword)("itemTemplate",e)("notFoundTemplate",t),l.xp6(9),l.Q6J("ngModel",o.vehiculo.usuarioSatelital),l.xp6(5),l.Q6J("ngModel",o.vehiculo.claveSatelital),l.xp6(1),l.Q6J("ngIf",o.vehiculo.articulado)}}function J0(r,n){1&r&&(l.TgZ(0,"ion-col")(1,"div",27)(2,"strong")(3,"h1"),l._uU(4,"Datos Personales"),l.qZA()()()())}function Y0(r,n){if(1&r&&(l.TgZ(0,"ion-row",28)(1,"ion-col")(2,"label",134),l._uU(3,"Nombres"),l.qZA(),l._UZ(4,"input",135),l.qZA()()),2&r){const e=l.oxw(2);l.xp6(4),l.Q6J("ngModel",e.propietario.nombres)}}function X0(r,n){if(1&r&&(l.TgZ(0,"ion-row",28)(1,"ion-col")(2,"label",136),l._uU(3,"Apellidos"),l.qZA(),l._UZ(4,"input",137),l.qZA()()),2&r){const e=l.oxw(2);l.xp6(4),l.Q6J("ngModel",e.propietario.apellidos)}}function Q0(r,n){if(1&r&&(l.TgZ(0,"ion-row",28)(1,"ion-col")(2,"label",138),l._uU(3,"Correo"),l.qZA(),l._UZ(4,"input",139),l.qZA()()),2&r){const e=l.oxw(2);l.xp6(4),l.Q6J("ngModel",e.propietario.correo)}}function $0(r,n){if(1&r&&(l.TgZ(0,"ion-row",28)(1,"ion-col")(2,"label",140),l._uU(3,"Celular"),l.qZA(),l._UZ(4,"input",141),l.qZA()()),2&r){const e=l.oxw(2);l.xp6(4),l.Q6J("ngModel",e.propietario.celular)}}function ey(r,n){if(1&r&&(l.TgZ(0,"ion-row",28)(1,"ion-col")(2,"label",142),l._uU(3,"Direccion"),l.qZA(),l._UZ(4,"input",143),l.qZA()()),2&r){const e=l.oxw(2);l.xp6(4),l.Q6J("ngModel",e.propietario.direccion)}}function ty(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(3);l.Q6J("src",e.hubImag.cedula_pro1.webviewPath)}}function ny(r,n){1&r&&l._UZ(0,"div",78)}function ry(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(3);l.Q6J("src",e.hubImag.cedula_pro2.webviewPath)}}function oy(r,n){1&r&&l._UZ(0,"div",78)}function ay(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-accordion-group")(1,"ion-accordion",65)(2,"ion-item",66)(3,"ion-label"),l._uU(4,"Cedula de Ciudadania"),l.qZA()(),l.TgZ(5,"div",67)(6,"ion-row")(7,"ion-col")(8,"div",68)(9,"strong")(10,"h1"),l._uU(11,"Cedula Cara Frontal"),l.qZA()()(),l.TgZ(12,"ion-item")(13,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(2);return l.KtG(o.addToCamera("cedula_pro1"))}),l.YNc(14,ty,1,1,"ion-img",70),l.YNc(15,ny,1,0,"div",71),l.qZA()()()(),l.TgZ(16,"ion-row")(17,"ion-col")(18,"div",68)(19,"strong")(20,"h1"),l._uU(21,"Cedula Cara Posterior"),l.qZA()()(),l.TgZ(22,"ion-item")(23,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(2);return l.KtG(o.addToCamera("cedula_pro2"))}),l.YNc(24,ry,1,1,"ion-img",70),l.YNc(25,oy,1,0,"div",71),l.qZA()()()()()()()}if(2&r){const e=l.oxw(2);l.xp6(14),l.Q6J("ngIf",e.hubImag.cedula_pro1.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.cedula_pro1.webviewPath),l.xp6(9),l.Q6J("ngIf",e.hubImag.cedula_pro2.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.cedula_pro2.webviewPath)}}function iy(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",60),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.setOpenPropietario(!1))}),l._uU(4,"Cancelar"),l.qZA()(),l.TgZ(5,"ion-title",63),l._uU(6,"Propietario"),l.qZA(),l.TgZ(7,"ion-buttons",61)(8,"ion-button",62),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.onSubmitNewProp())}),l._uU(9,"Confirmar"),l.qZA()()()(),l.TgZ(10,"ion-content")(11,"ion-list",25)(12,"form",26),l.NdJ("ngSubmit",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.onSubmitNewProp())}),l.TgZ(13,"ion-grid")(14,"ion-row",28)(15,"ion-col")(16,"label",131),l._uU(17,"Cedula"),l.qZA(),l._UZ(18,"input",132),l.qZA()(),l.YNc(19,J0,5,0,"ion-col",85),l.YNc(20,Y0,5,1,"ion-row",133),l.YNc(21,X0,5,1,"ion-row",133),l.YNc(22,Q0,5,1,"ion-row",133),l.YNc(23,$0,5,1,"ion-row",133),l.YNc(24,ey,5,1,"ion-row",133),l.YNc(25,ay,26,4,"ion-accordion-group",85),l.TgZ(26,"div",113)(27,"ion-button",114),l._uU(28," Guardar "),l.qZA()()()()()()}if(2&r){const e=l.oxw();l.xp6(8),l.Q6J("strong",!0),l.xp6(3),l.Q6J("inset",!0),l.xp6(1),l.Q6J("formGroup",e.formNewProp),l.xp6(6),l.Q6J("ngModel",e.propietario.cedula),l.xp6(1),l.Q6J("ngIf",e.propietario.cedula),l.xp6(1),l.Q6J("ngIf",e.propietario.cedula),l.xp6(1),l.Q6J("ngIf",e.propietario.cedula),l.xp6(1),l.Q6J("ngIf",e.propietario.cedula),l.xp6(1),l.Q6J("ngIf",e.propietario.cedula),l.xp6(1),l.Q6J("ngIf",e.propietario.cedula),l.xp6(1),l.Q6J("ngIf",e.propietario.cedula)}}function sy(r,n){1&r&&(l.TgZ(0,"ion-col")(1,"div",27)(2,"strong")(3,"h1"),l._uU(4,"Datos Personales"),l.qZA()()()())}function uy(r,n){if(1&r&&(l.TgZ(0,"ion-row",28)(1,"ion-col")(2,"label",134),l._uU(3,"Nombres"),l.qZA(),l._UZ(4,"input",135),l.qZA()()),2&r){const e=l.oxw(2);l.xp6(4),l.Q6J("ngModel",e.tenedor.nombres)}}function cy(r,n){if(1&r&&(l.TgZ(0,"ion-row",28)(1,"ion-col")(2,"label",136),l._uU(3,"Apellidos"),l.qZA(),l._UZ(4,"input",137),l.qZA()()),2&r){const e=l.oxw(2);l.xp6(4),l.Q6J("ngModel",e.tenedor.apellidos)}}function ly(r,n){if(1&r&&(l.TgZ(0,"ion-row",28)(1,"ion-col")(2,"label",138),l._uU(3,"Correo"),l.qZA(),l._UZ(4,"input",139),l.qZA()()),2&r){const e=l.oxw(2);l.xp6(4),l.Q6J("ngModel",e.tenedor.correo)}}function hy(r,n){if(1&r&&(l.TgZ(0,"ion-row",28)(1,"ion-col")(2,"label",140),l._uU(3,"Celular"),l.qZA(),l._UZ(4,"input",141),l.qZA()()),2&r){const e=l.oxw(2);l.xp6(4),l.Q6J("ngModel",e.tenedor.celular)}}function dy(r,n){if(1&r&&(l.TgZ(0,"ion-row",28)(1,"ion-col")(2,"label",142),l._uU(3,"Direccion"),l.qZA(),l._UZ(4,"input",143),l.qZA()()),2&r){const e=l.oxw(2);l.xp6(4),l.Q6J("ngModel",e.tenedor.direccion)}}function fy(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(3);l.Q6J("src",e.hubImag.cedula_ten1.webviewPath)}}function py(r,n){1&r&&l._UZ(0,"div",78)}function vy(r,n){if(1&r&&l._UZ(0,"ion-img",77),2&r){const e=l.oxw(3);l.Q6J("src",e.hubImag.cedula_ten2.webviewPath)}}function my(r,n){1&r&&l._UZ(0,"div",78)}function gy(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-accordion-group")(1,"ion-accordion",65)(2,"ion-item",66)(3,"ion-label"),l._uU(4,"Cedula de Ciudadania"),l.qZA()(),l.TgZ(5,"div",67)(6,"ion-row")(7,"ion-col")(8,"div",68)(9,"strong")(10,"h1"),l._uU(11,"Cedula Cara Frontal"),l.qZA()()(),l.TgZ(12,"ion-item")(13,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(2);return l.KtG(o.addToCamera("cedula_ten1"))}),l.YNc(14,fy,1,1,"ion-img",70),l.YNc(15,py,1,0,"div",71),l.qZA()()()(),l.TgZ(16,"ion-row")(17,"ion-col")(18,"div",68)(19,"strong")(20,"h1"),l._uU(21,"Cedula Cara Posterior"),l.qZA()()(),l.TgZ(22,"ion-item")(23,"div",69),l.NdJ("click",function(){l.CHM(e);const o=l.oxw(2);return l.KtG(o.addToCamera("cedula_ten2"))}),l.YNc(24,vy,1,1,"ion-img",70),l.YNc(25,my,1,0,"div",71),l.qZA()()()()()()()}if(2&r){const e=l.oxw(2);l.xp6(14),l.Q6J("ngIf",e.hubImag.cedula_ten1.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.cedula_ten1.webviewPath),l.xp6(9),l.Q6J("ngIf",e.hubImag.cedula_ten2.webviewPath),l.xp6(1),l.Q6J("ngIf",!e.hubImag.cedula_ten2.webviewPath)}}function yy(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",60),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.setOpenTenedor(!1))}),l._uU(4,"Cancelar"),l.qZA()(),l.TgZ(5,"ion-title",63),l._uU(6,"Tenedor"),l.qZA(),l.TgZ(7,"ion-buttons",61)(8,"ion-button",62),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.onSubmitNewTen())}),l._uU(9,"Confirmar"),l.qZA()()()(),l.TgZ(10,"ion-content")(11,"ion-list",25)(12,"form",26),l.NdJ("ngSubmit",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.onSubmitNewTen())}),l.TgZ(13,"ion-grid")(14,"ion-row",28)(15,"ion-col")(16,"label",131),l._uU(17,"Cedula"),l.qZA(),l._UZ(18,"input",144),l.qZA()(),l.YNc(19,sy,5,0,"ion-col",85),l.YNc(20,uy,5,1,"ion-row",133),l.YNc(21,cy,5,1,"ion-row",133),l.YNc(22,ly,5,1,"ion-row",133),l.YNc(23,hy,5,1,"ion-row",133),l.YNc(24,dy,5,1,"ion-row",133),l.YNc(25,gy,26,4,"ion-accordion-group",85),l.TgZ(26,"div",113)(27,"ion-button",114),l._uU(28," Guardar "),l.qZA()()()()()()}if(2&r){const e=l.oxw();l.xp6(8),l.Q6J("strong",!0),l.xp6(3),l.Q6J("inset",!0),l.xp6(1),l.Q6J("formGroup",e.formNewTene),l.xp6(6),l.Q6J("ngModel",e.tenedor.cedula),l.xp6(1),l.Q6J("ngIf",e.tenedor.cedula),l.xp6(1),l.Q6J("ngIf",e.tenedor.cedula),l.xp6(1),l.Q6J("ngIf",e.tenedor.cedula),l.xp6(1),l.Q6J("ngIf",e.tenedor.cedula),l.xp6(1),l.Q6J("ngIf",e.tenedor.cedula),l.xp6(1),l.Q6J("ngIf",e.tenedor.cedula),l.xp6(1),l.Q6J("ngIf",e.tenedor.cedula)}}function xy(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"app-documentos-data",145),l.NdJ("save",function(o){l.CHM(e);const a=l.oxw();return l.KtG(a.saveDocs(o))})("cancel",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.cancelDocs())}),l.qZA()}if(2&r){const e=l.oxw();l.Q6J("dataTercero",e.dataTercero)}}let ss=(()=>{class r{constructor(e,t,o,a,i,s,u,c,h,d,f,p){this.menu=e,this.alertController=t,this.formBuilder=o,this.userService=a,this.router=i,this.photo=s,this.reg=u,this.loading=c,this.app=h,this.actionSheetCtrl=d,this.platform=f,this.auth=p,this.canDismissOverride=!1,this.presentingElement=void 0,this.dismissChange=new l.vpe,this.isModalOpen=!1,this.isModalOpen1=!1,this.isModalOpen2=!1,this.isModalOpen3=!1,this.isModalOpen4=!1,this.isModalOpen5=!1,this.isModalOpen6=!1,this.isModalOpen7=!1,this.startCamera=!1,this.dataTercero=[],this.dataForm=j.cw,this.dataChange=j.cw,this.formDriver=j.cw,this.formVehicle=j.cw,this.formNewProp=j.cw,this.formNewTene=j.cw,this.formDocumentDriver=j.cw,this.completeData=!1,this.checkVehicle=!1,this.checkDatos=!1,this.checkDocs=!1,this.hiddenDocs=!0,this.numDocs=0,this.openDocs=!1,this.editDataItem=void 0,this.isNew=void 0,this.documents_conductor=[],this.documents_vehiculo=[],this.propietario={cedula:"",nombres:"",apellidos:"",correo:"",celular:"",direccion:"",fechaNacimiento:"",nombreContacto:"",celularContacto:"",parentesco:""},this.tenedor={cedula:"",nombres:"",apellidos:"",correo:"",celular:"",direccion:"",fechaNacimiento:"",nombreContacto:"",celularContacto:"",parentesco:""},this.vehiculo={placa:"",cedulaProp:"",nombreProp:"",cedulaTene:"",nombreTene:"",claseVehiculo:"",codigoClase:"",carroceria:"",codigoCarroceria:"",fechaSoat:"",fechaTecno:"",color:"",codigoColor:"",linea:"",codigoLinea:"",modelo:"",repoten:"",articulado:"",marca:"",codigoMarca:"",remolque:"",empresaSatelital:"",codigoSatelital:"",usuarioSatelital:"",claveSatelital:"",cuentaSatelital:"",isPropietario:!0,isTenedor:!0},this.conductor={cedula:"",nombres:"",apellidos:"",correo:"",celular:"",direccion:"",fechaNacimiento:"",nombreContacto:"",celularContacto:"",parentesco:"",codigoParentesco:"",fechaSeguridad:"",fechaLicencia:""},this.licencia=[],this.licencia2=[],this.cedula1=[],this.cedula2=[],this.seguridad_social=[],this.jsonDocs=[],this.jsonPhoto=[],this.params=[],this.dataFotoUser=[],this.fotoUser=!1,this.apiLicencia1=[],this.apiLicencia2=[],this.soat1=[],this.apiTecno1=[],this.cedulaProp=!1,this.cedulaTene=!1,this.isDisabled=!1,this.isDisabled1=!1,this.isDisabled2=!1,this.dataClases=[],this.dataMarcas=[],this.dataCarroc=[],this.dataLineas=[],this.dataColores=[],this.dataParentes=[],this.dataVehiculos=[],this.dataSatelital=[],this.filteredData=[],this.searchControl=new j.NI,this.keyword="name",this.articulado=!1,this.docs=[],this.terms={con_rec_pub:[],grd_pod_pub:[],rec_pub_gnr:[],vin_per_pub:[],per_tri_eco:[],gre_rec_pub:[],gre_rec_pub_pro:[],gre_rec_pub_ten:[]},this.hubImag={licencia1:{webviewPath:!1},licencia2:{webviewPath:!1},cedula1:{webviewPath:!1},cedula2:{webviewPath:!1},tarjePro1:{webviewPath:!1},tarjePro2:{webviewPath:!1},soat1:{webviewPath:!1},tecnomecanica:{webviewPath:!1},remolque:{fotoremol:{webviewPath:!1},tarjePro1:{webviewPath:!1},tarjePro2:{webviewPath:!1}},cedula_pro1:{webviewPath:!1},cedula_pro2:{webviewPath:!1},cedula_ten1:{webviewPath:!1},cedula_ten2:{webviewPath:!1},fotovehi1:{webviewPath:!1},fotovehi2:{webviewPath:!1},fotovehi3:{webviewPath:!1},fotovehi4:{webviewPath:!1},fotoperfil:{webviewPath:!1},seguridadsocial:{webviewPath:!1}},this.dataCorrect="https://3slogistica.com/tr_aldia/files/checklist/dataCorrect.png",this.dataInCorrect="https://3slogistica.com/tr_aldia/files/checklist/dataInCorrect.png",this.modulos=[{id:1,tag:"personal-data",nombre:"Datos Personales",icon:"https://3slogistica.com/tr_aldia/files/checklist/person.png",desc:"Nombres, Telefono, Direccion, ",img:this.dataCorrect,status:!0},{id:2,tag:!1,nombre:"Documentos",icon:"https://3slogistica.com/tr_aldia/files/checklist/document.png",desc:"Cerdula, Licencia de conduccion, Seguridad social",img:this.dataCorrect,status:!0},{id:3,tag:"propietario-data",nombre:"Propietario",icon:"https://3slogistica.com/tr_aldia/files/checklist/person.png",desc:"Nombres, Telefono, Direccion",img:this.dataCorrect,status:!1},{id:4,tag:"tenedor-data",nombre:"Tenedor",icon:"https://3slogistica.com/tr_aldia/files/checklist/person.png",desc:"Nombres, Telefono, Direccion",img:this.dataCorrect,status:!1},{id:5,tag:"my-vehicles",nombre:"Vehiculo",icon:"https://3slogistica.com/tr_aldia/files/checklist/vehicle.png",desc:"Placa, Marca, Clase, Carroceria",img:this.dataCorrect,status:!1}],this.confirmCancelVehicule=()=>(0,ue.mG)(this,void 0,void 0,function*(){if(this.canDismissOverride)return!0;let v=yield this.actionSheetCtrl.create({header:"Seguro desea Salir?",backdropDismiss:!1,buttons:[{text:"Si",role:"confirm",handler:()=>{this.canDismissOverride=!0}},{text:"No",role:"cancel",data:{action:"cancel"},handler:()=>{this.canDismissOverride=!1}}]});v.present();const{role:m}=yield v.onWillDismiss();return this.canDismissOverride=!1,"confirm"===m}),this.initializeApp(),this.formDriver=o.group({nombres:["",[j.kI.required]],apellidos:["",[j.kI.required]],correo:["",[j.kI.required]],celular:["",[j.kI.required]],direccion:["",[j.kI.required]],fechaNacimiento:["",[j.kI.required]],nombreContacto:["",[j.kI.required]],celularContacto:["",[j.kI.required]],parentesco:["",[j.kI.required]],fechaSeguridad:[],fechaLicencia:[]}),this.formVehicle=this.formBuilder.group({claseVehiculo:["",[j.kI.required]],carroceria:["",[j.kI.required]],linea:["",[j.kI.required]],color:["",[j.kI.required]],fechaSoat:[""],fechaTecno:[""],marca:["",[j.kI.required]],modelo:["",[j.kI.required]],remolque:[""],empresaSatelital:["",[j.kI.required]],usuarioSatelital:["",j.kI.required],claveSatelital:["",j.kI.required],cuentaSatelital:[""],isPropietario:[""],propietario:[""],codigoPropietario:[""],isTenedor:[""],tenedor:[""],codigoTenedor:[""]}),this.dataForm=this.formBuilder.group({cedula:["",[j.kI.required]],nombres:["",[j.kI.required]],apellidos:["",[j.kI.required]],correo:["",[j.kI.required]],celular:["",[j.kI.required]],direccion:["",[j.kI.required]],fechaNacimiento:["",[j.kI.required]],ciudad:["",[j.kI.required]],nombreContacto:["",[j.kI.required]],celularContacto:["",[j.kI.required]],parentesco:["",[j.kI.required]],placa:["",[j.kI.required]],claseVehiculo:["",[j.kI.required]],marca:["",[j.kI.required]],carroceria:["",[j.kI.required]],fechaTecno:["",[j.kI.required]],fechaSoat:["",[j.kI.required]],fechaLicencia:["",[j.kI.required]]}),this.formNewProp=o.group({cedula:["",[j.kI.required]],nombres:["",[j.kI.required]],apellidos:["",[j.kI.required]],correo:["",[j.kI.required]],celular:["",[j.kI.required]],direccion:["",[j.kI.required]],fechaNacimiento:[""],nombreContacto:[""],celularContacto:[""],parentesco:[""]}),this.formNewTene=o.group({cedula:["",[j.kI.required]],nombres:["",[j.kI.required]],apellidos:["",[j.kI.required]],correo:["",[j.kI.required]],celular:["",[j.kI.required]],direccion:["",[j.kI.required]],fechaNacimiento:[""],nombreContacto:[""],celularContacto:[""],parentesco:[""]}),this.formDocumentDriver=o.group({fechaLicencia:["",[j.kI.required]],fechaSeguridad:["",[j.kI.required]]}),this.documents_vehiculo=this.userService.documents_vehiculo,this.documents_conductor=this.userService.documents_conductor}get f(){return this.dataForm.controls}ngOnInit(){return(0,ue.mG)(this,void 0,void 0,function*(){this.token=this.userService.getToken(),this.conductor.cedula=this.userService.getCedula(),this.vehiculo.placa=this.userService.getPlaca(),this.numDocs=0,yield this.userService.validateCap(),null==this.userService.getToken()&&this.router.navigate(["/login"]);const e=yield this.loading.create({message:"Generando Datos..."});e.present();var t=!0,a="<ul>";this.reg.getDataTercero(this.conductor.cedula).subscribe(i=>{if(this.getParentesco().then(f=>{const p=this.dataParentes.find(v=>v.name===i.data[0].nombreParentes);null!=p?(this.conductor.codigoParentesco=p.id,this.conductor.parentesco=p.name):(t=!1,a+="<li>Parentesco </li>")},f=>{401==f.status&&this.auth.logout()}),i.data[0].numeroPlacaxxx!=this.vehiculo.placa&&(this.presentAlert("Alerta","El vehiculo ha cambiado vuelva a iniciar sesion","","Cerrar"),this.userService.logout(),e.dismiss()),i.data[0].nombreTercerox?this.conductor.nombres=i.data[0].nombreTercerox:(t=!1,a+="<li>Nombres</li>"),i.data[0].apell1Tercerox||i.data[0].apell2Tercerox?this.conductor.apellidos=i.data[0].apell1Tercerox+" "+i.data[0].apell2Tercerox:(t=!1,a+="<li>Apellidos</li>"),i.data[0].emailxTercerox?this.conductor.correo=i.data[0].emailxTercerox:(t=!1,a+="<li>Correo</li>"),i.data[0].movilxContacto?this.conductor.celular=i.data[0].movilxContacto:(t=!1,a+="<li>Celular </li>"),i.data[0].direccTercerox?this.conductor.direccion=i.data[0].direccTercerox:(t=!1,a+="<li>Direccion </li>"),i.data[0].fechaxNacimien?this.conductor.fechaNacimiento=i.data[0].fechaxNacimien:(t=!1,a+="<li>Fecha Nacimiento </li>"),i.data[0].nombreContacto?this.conductor.nombreContacto=i.data[0].nombreContacto:(t=!1,a+="<li>Nombre Contacto</li>"),i.data[0].movilxContacto?this.conductor.celularContacto=i.data[0].movilxContacto:(t=!1,a+="<li>Celular Contacto</li>"),i.data[0].nombreParentes?this.conductor.parentesco=i.data[0].nombreParentes:(t=!1,a+="<li>Parentesco</li>"),"ARTICULADO"==i.data[0].tipoxxVehiculo?(this.vehiculo.articulado=!0,this.dataTercero.articulado=!0):(this.vehiculo.articulado=!1,this.dataTercero.articulado=!1),i.data[0].fechaxLicencia&&(this.conductor.fechaLicencia=i.data[0].fechaxLicencia),i.data[0].foto&&(this.hubImag.fotoperfil.webviewPath=i.data[0].foto),a+="</ul>",this.getDocument(this.conductor.cedula,"fotoperfil","conductor").then(f=>{"204"!==f.code&&(console.log(f.data.fotoperfil),this.hubImag.fotoperfil.webviewPath=f.data.fotoperfil)}),t){var u="<ul>",c=[],h=!1,d=!0;this.userService.getFechasDocs(this.token).then(f=>{console.log(f),this.checkDocs=f.statusDoc,this.hiddenDocs=!1;var p=f.docs;if(p.length>0){d=!1;for(let v=0;v<p.length;v++){const m=p[v],g=this.separarCamelCase(m.nombre);u+="<li>"+g+"</li>";const y=this.buscarCodigoEnDocumentos(m.nombre);y?c.push(y):h=!0}u+="<ul>"}c.length>0?this.openDocumentController(c):h&&(console.log("datos vehiculo"),this.loadVehicle()),this.numDocs=p.length,e.dismiss(),d||this.presentAlert("Alerta","Documento pendientes por actualizar",u,"Cerrar")},f=>{401==f.status&&this.auth.logout()})}else this.presentAlert("Alerta","Es necesario ingresar:",a,"Cerrar"),e.dismiss()},i=>{401==i.status&&this.auth.logout(),this.presentAlert("ERROR","Error en servicio",i,"Cerrar")})})}initializeApp(){this.platform.ready().then(()=>{this.setStatusBarColor()})}setStatusBarColor(){this.platform.is("android")?Jo.A_.setBackgroundColor({color:"#3c8ccd"}):this.platform.is("ios")&&Jo.A_.setStyle({style:Jo.bg.Dark})}loadVehicle(){return(0,ue.mG)(this,void 0,void 0,function*(){const o=yield this.loading.create({message:"Generando datos..."}),a=this.app.docs;o.present();const u=(yield this.reg.getDataVehiculo(this.vehiculo.placa)).data[0];if(this.vehiculo.codigoMarca=u.codigoVehmarca,this.vehiculo.codigoLinea=u.codigoVehlinea,this.vehiculo.codigoClase=u.codigoVehclase,this.vehiculo.codigoColor=u.codigoVehcolor,this.vehiculo.codigoCarroceria=u.codigoVehcarro,this.vehiculo.marca=u.nombreVehmarca,this.vehiculo.carroceria=u.nombreVehcarro,this.vehiculo.claseVehiculo=u.nombreClaseVeh,this.vehiculo.linea=u.nombreVehlinea,this.vehiculo.color=u.nombreVehcolor,this.vehiculo.modelo=u.numeroModeloxx,this.vehiculo.usuarioSatelital=u.sateliUsuariox,this.vehiculo.claveSatelital=u.satelContrasen,this.vehiculo.codigoSatelital=u.sateliEmpresax,this.vehiculo.empresaSatelital=u.nombreAppempgp,this.vehiculo.cuentaSatelital=u.satelCuentaxx,this.vehiculo.remolque=u.placaRemolque,this.propietario.cedula=u.codigoPropieta,this.tenedor.cedula=u.codigoTenedorx,this.tenedor.nombres=u.nombreTenedor,this.tenedor.apellidos=u.apellidoTenedor,this.tenedor.correo=u.emailTenedor,this.tenedor.celular=u.movilTenedor,this.tenedor.direccion=u.direccionTenedor,this.propietario.nombres=u.nombrePropietario,this.propietario.apellidos=u.apellidoPropietario,this.propietario.correo=u.emailPropietario,this.propietario.celular=u.movilPropietario,this.propietario.direccion=u.direccionPropietario,u.codigoPropieta?(this.vehiculo.isPropietario=!1,this.checkPropi=!0):(this.vehiculo.isPropietario=!0,this.checkPropi=!1),u.codigoTenedorx?(this.vehiculo.isTenedor=!1,this.checkTened=!0):(this.vehiculo.isTenedor=!0,this.checkTened=!1),this.formVehicle.patchValue({isPropietario:u.indicaIgualpro,codigoPropietario:u.codigoPropieta,isTenedor:u.indicaIgualten,codigoTenedor:u.codigoTenedorx}),a.length>0)for(const v of a)"fechaSatelital"==v.nombre&&(this.vehiculo.usuarioSatelital="",this.vehiculo.claveSatelital="",this.vehiculo.codigoSatelital="",this.vehiculo.empresaSatelital="",this.vehiculo.cuentaSatelital="");!!u.numeroModeloxx&&(this.vehiculo.modelo=u.numeroModeloxx),u.fechaxSoatxxxx&&(this.vehiculo.fechaSoat=u.fechaxSoatxxxx),u.fechaxTecnimec&&(this.vehiculo.fechaTecno=u.fechaxTecnimec),"ARTICULADO"==u.tipoxxVehiculo?(console.log("ARTICULADO"),this.vehiculo.articulado=!0,this.dataTercero.articulado=!0):(this.vehiculo.articulado=!1,this.dataTercero.articulado=!1);const h=this.getClases(),d=this.getMarcas(),f=this.getColores();this.getSatelital(),Promise.all([h,d,f]).then(([v,m,g])=>{o.dismiss(),this.setOpenVehiculo(!0);const y=this.dataClases.find(b=>b.name===u.nombreClaseVeh);null==y||(this.vehiculo.codigoClase=y.id,this.vehiculo.claseVehiculo=y.name,this.getCarroc(y.id));const x=this.dataMarcas.find(b=>b.name===u.nombreVehmarca);null!=x?(this.getClaseLinea(x.id),this.vehiculo.codigoMarca=x.id,this.vehiculo.marca=x.name):(this.vehiculo.marca="",this.vehiculo.codigoMarca="")}),["fotoremol","tarjePro1","tarjePro2"].forEach(v=>(0,ue.mG)(this,void 0,void 0,function*(){yield this.processDocuments(this.vehiculo.remolque,v,"remolque")})),console.log(this.hubImag)})}processDocuments(e,t,o){return(0,ue.mG)(this,void 0,void 0,function*(){yield this.getDocument(e,t,o).then(a=>{"204"!==a.code&&(this.hubImag.remolque[t].webviewPath=a.data[t])})})}startVideo(){return(0,ue.mG)(this,void 0,void 0,function*(){try{this.startCamera=!0;var e=yield navigator.mediaDevices.getUserMedia({video:!0});yield xe.tinyFaceDetector.loadFromUri("/assets/models"),yield xe.faceLandmark68Net.loadFromUri("/assets/models"),yield xe.faceExpressionNet.loadFromUri("/assets/models"),yield xe.ageGenderNet.loadFromUri("/assets/models");let t=this.videoContainer.nativeElement;t.srcObject=e,t.addEventListener("loadedmetadata",()=>this.PlayEvn())}catch(t){console.error("Error al acceder a la c\xe1mara:",t)}})}PlayEvn(){this.videoContainer.nativeElement.addEventListener("play",()=>{const e=Lo(this.videoContainer.nativeElement);document.body.append(e);const t={width:this.videoContainer.nativeElement.width,height:this.videoContainer.nativeElement.height};(function Cg(r,n,e){void 0===e&&(e=!1);var t=e?Fi(n):n,o=t.width,a=t.height;r.width=o,r.height=a})(e,t),setInterval(()=>(0,ue.mG)(this,void 0,void 0,function*(){var o;const a=yield function K1(r,n){return void 0===n&&(n=new zo),new Ah(r,n)}(this.videoContainer.nativeElement,new xh).withFaceLandmarks().withFaceExpressions().withAgeAndGender(),i=Sh(a,t);null===(o=e.getContext("2d"))||void 0===o||o.clearRect(0,0,e.width,e.height),function mg(r,n){(Array.isArray(n)?n:[n]).forEach(function(t){var o=t instanceof pt?t.score:Vr(t)?t.detection.score:void 0,a=t instanceof pt?t.box:Vr(t)?t.detection.box:new Mt(t),i=o?""+Di(o):void 0;new Xl(a,{label:i}).draw(r)})}(e,i),function Ng(r,n){(Array.isArray(n)?n:[n]).forEach(function(t){var o=t instanceof nr?t:Gi(t)?t.landmarks:void 0;if(!o)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Pg(o).draw(r)})}(e,i),function Sg(r,n,e,t){void 0===e&&(e=.1),(Array.isArray(n)?n:[n]).forEach(function(a){var i=a instanceof Vi?a:function Ag(r){return r.expressions instanceof Vi}(a)?a.expressions:void 0;if(!i)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var u=i.asSortedArray().filter(function(d){return d.probability>e}),c=Vr(a)?a.detection.box.bottomLeft:t||new we(0,0);new Yl(u.map(function(d){return d.expression+" ("+Di(d.probability)+")"}),c).draw(r)})}(e,i),i.forEach(s=>{new Xl(s.detection.box,{label:Math.round(s.age)+" year old "+s.gender}).draw(e)})}),1e3)})}getParentesco(){return(0,ue.mG)(this,void 0,void 0,function*(){try{const e=yield this.reg.getParent(this.token).toPromise();if(e.status){const t=e.data;for(let o=0;o<t.length;o++){const a=t[o];this.dataParentes.push({id:a.codigoParentes,name:a.nombreParentes})}}}catch(e){console.log(e)}})}saveDocs(e){}cancelDocs(){}loadDocs(){var e=[];this.documents_vehiculo.forEach(t=>{e.push(t)}),this.documents_conductor.forEach(t=>{e.push(t)}),console.log(e),this.openDocumentController(e)}openDocumentController(e){this.dataTercero.cedula=this.conductor.cedula,this.dataTercero.placa=this.vehiculo.placa,this.dataTercero.docs=e,this.openDocs=!0}ngAfterViewInit(){}changePropietario(e){this.vehiculo.isPropietario=e.detail.checked}changeTenedor(e){this.vehiculo.isTenedor=e.detail.checked}setOpenPropietario(e){this.isModalOpen5=e}setOpenTenedor(e){this.isModalOpen6=e}setOpenVehiculo(e){this.isModalOpen3=e}setOpenHubVehicles(e){this.isModalOpen7=e,this.modal7.dismiss()}selectEvent(e){return(0,ue.mG)(this,void 0,void 0,function*(){const t=yield this.loading.create({message:"Cargando Datos..."});t.present(),this.formVehicle.patchValue({carroceria:""}),"ARTICULADO"==e.tipo?(this.vehiculo.articulado=!0,this.dataTercero.articulado=!0,this.documents_vehiculo[3].hidden=!1,this.formVehicle.get("remolque").setValidators(j.kI.required)):(this.vehiculo.articulado=!1,this.vehiculo.remolque="",this.dataTercero.articulado=!1,this.formVehicle.patchValue({remolque:""})),this.vehiculo.claseVehiculo=e.name,this.vehiculo.codigoClase=e.id,this.getCarroc(e.id).then(o=>{t.dismiss()})})}onChangeSearch(e){}onFocused(e){}selectMarca(e){return(0,ue.mG)(this,void 0,void 0,function*(){const t=yield this.loading.create({message:"Cargando Datos..."});t.present(),this.formVehicle.patchValue({linea:""}),this.vehiculo.codigoMarca=e.id,this.vehiculo.marca=e.name,this.getClaseLinea(e.id).then(o=>{t.dismiss()})})}onChangeMarca(e){}onFocusedMarca(e){}selectLinea(e){this.vehiculo.linea=e.name,this.vehiculo.codigoLinea=e.id}onChangeLinea(e){}onFocusedLinea(e){}selectColor(e){this.vehiculo.color=e.name,this.vehiculo.codigoColor=e.id}onChangeColor(e){}onFocusedColor(e){}selectCarroceria(e){this.vehiculo.codigoCarroceria=e.id,this.vehiculo.carroceria=e.name}onChangeCarroceria(e){}onFocusedCarroceria(e){}onEditVehicle(){}selectParente(e){this.conductor.parentesco=e.name,this.conductor.codigoParentesco=e.id}onChangeParente(e){}onFocusedParente(e){}selectSatelital(e){this.vehiculo.empresaSatelital=e.name,this.vehiculo.codigoSatelital=e.id}onChangeSatelital(e){}onFocusedSatelital(e){}getSatelital(){return(0,ue.mG)(this,void 0,void 0,function*(){try{const e=yield this.reg.getSatelital(this.token).toPromise();if(e.status){const t=e.data;for(let o=0;o<t.length;o++){const a=t[o];this.dataSatelital.push({id:a.codigoVehgpsxx,name:a.nombreVehgpsxx})}}console.log(this.dataSatelital)}catch(e){console.log(e)}})}getClases(){return(0,ue.mG)(this,void 0,void 0,function*(){try{const e=yield this.reg.getClasevehiculo(this.token).toPromise();if(e.status){const t=e.data;for(let o=0;o<t.length;o++){const a=t[o];this.dataClases.push({id:a.codigoVehclase,name:a.nombreSiatxxxx,tipo:a.tipoxxVehiculo})}}}catch(e){console.log(e)}})}getMarcas(){return(0,ue.mG)(this,void 0,void 0,function*(){try{const e=yield this.reg.getMarcas(this.token).toPromise();if(e.status){const t=e.data;for(let o=0;o<t.length;o++){const a=t[o];this.dataMarcas.push({id:a.codigoVehmarca,name:a.nombreVehmarca})}}}catch(e){console.log(e)}})}getCarroc(e){return(0,ue.mG)(this,void 0,void 0,function*(){try{this.dataCarroc=[];const t=yield this.reg.getCarrocerias(e,this.token).toPromise();if(t.status){const o=t.data;for(let a=0;a<o.length;a++){const i=o[a];this.dataCarroc.push({id:i.codigoVehcarro,name:i.nombrevehcarcl})}}}catch(t){console.log(t)}})}getClaseLinea(e){return(0,ue.mG)(this,void 0,void 0,function*(){this.dataLineas=[];const t=yield this.reg.getLineas(e,"",this.token).toPromise();if(t.status){const o=t.data;for(let a=0;a<o.length;a++){const i=o[a];this.dataLineas.push({id:i.codigoVehlinea,name:i.nombreVehlinea})}}})}getColores(){return(0,ue.mG)(this,void 0,void 0,function*(){try{const e=yield this.reg.getColores(this.token).toPromise();if(e.status){const t=e.data;for(let o=0;o<t.length;o++){const a=t[o];this.dataColores.push({id:a.codigoVehcolor,name:a.nombreVehcolor})}}}catch(e){console.log(e)}})}onSubmit(){this.presentAlert("Envio de datos a 3SL","","","Cerrar");const e=this.dataForm.value;let t={codigoTercerox:this.conductor.cedula,numeroPlacaxxx:this.vehiculo.placa,codigoRxxxxxxx:"",codigoPropieta:this.propietario.cedula,codigoTenedorx:this.tenedor.cedula,indicaIgualpro:this.vehiculo.isPropietario,indicaIgualten:this.vehiculo.isTenedor,nombreContacto:e.nombreContacto,movilxContacto:e.celularContacto,parentContacto:e.parentesco,nombreReferen1:"",movilxReferen1:"",empresReferen1:"",fechaxTecnicox:this.vehiculo.fechaTecno,fechaxSoatxxxx:this.vehiculo.fechaSoat,indicaProptene:"",numeroEstadoxx:"",estadoSiatxx:"",usuariCreacion:"",fechaxCreacion:"",ciudadCreacion:"",apiSeguridad:"",apiFotoConductor:this.hubImag.fotoperfil.webviewPath,indicaApruebax:"",usuariApruebax:"",fechaxApruebax:"",indicaSatelital:"",fechaxLicencia:this.vehiculo.fechaLicencia,nombreTercerox:this.conductor.nombre,apell1Tercerox:this.conductor.apellidos.split(" ")[0],apell2Tercerox:this.conductor.apellidos.split(" ")[1],codigoCiudadxx:"",movilxTercerox:this.conductor.celular,emailxTercerox:this.conductor.correo,numeroModeloxx:"",numeroRepotenc:"",fechaxTecnimec:this.vehiculo.fechaTecno,codigoVehmarca:"",codigoVehlinea:"",codigoVehclase:"",codigoVehcolor:"",codigoVehcarro:"",sateliFechaxxx:"",propietario:{indicaIgualpro:!this.vehiculo.isPropietario,codigoTercerox:this.propietario.cedula,nombreTercerox:this.propietario.nombres,apell1Tercerox:this.propietario.apellidos,apell2Tercerox:"",codigoCiudadxx:"",movilxTercerox:this.propietario.celular,emailxTercerox:this.propietario.correo,AppGrerecpubPro:this.terms.gre_rec_pub_pro},tenedor:{indicaIgualten:!this.vehiculo.isTenedor,codigoTercerox:this.propietario.cedula,nombreTercerox:this.propietario.nombres,apell1Tercerox:this.propietario.apellidos,apell2Tercerox:"",codigoCiudadxx:"",movilxTercerox:this.propietario.celular,emailxTercerox:this.propietario.correo,AppGrerecpubTen:this.terms.gre_rec_pub_ten}};this.userService.registroApiAldia(t,this.token).then(o=>{console.log(o),this.presentAlert("Envio Exitoso","","","Cerrar")},o=>{this.presentAlert("Error al enviar","",o.message,"Cerrar")})}onSubmitDriver(){return(0,ue.mG)(this,void 0,void 0,function*(){try{this.hubImag.fotoperfil.base64?(yield this.saveFotoApi(),this.saveData()):this.saveData()}catch(e){console.error("Error al ejecutar saveFotoApi",e)}})}saveData(){return(0,ue.mG)(this,void 0,void 0,function*(){const e=yield this.loading.create({message:"Guardando Datos..."});e.present();var t=!0,o={},a="<ul>";for(const i in this.formDriver.controls)this.formDriver.controls[i].invalid?(t=!1,a+="<li>"+i.charAt(0).toUpperCase()+i.slice(1)+"</li>"):(this.conductor[i]=this.formDriver.value[i],o[i]=this.formDriver.value[i]);o.codigoTercerox=this.conductor.cedula,o.conductor=!0,this.hubImag.fotoperfil.base64&&(o.fotoperfil=this.hubImag.fotoperfil.webviewPath),t?(yield this.reg.sendDataTercero(o),e.dismiss(),this.router.navigate(["/home"])):(this.checkDatos=!0,this.presentAlert("Error","Es necesario ingresar:",a,"Cerrar"),e.dismiss())})}onSubmitVehicle(){return(0,ue.mG)(this,void 0,void 0,function*(){var e=!0,t={};t.placa=this.vehiculo.placa;const o=yield this.loading.create({message:"Guardando Datos..."});o.present();try{this.vehiculo.isPropietario&&this.formVehicle.patchValue({codigoPropietario:""}),this.vehiculo.isTenedor&&this.formVehicle.patchValue({codigoTenedor:""});var a="<ul>";for(const i in this.formVehicle.controls)this.formVehicle.controls[i].invalid?(e=!1,a+="<li>"+i.charAt(0).toUpperCase()+i.slice(1)+"</li>"):(this.vehiculo[i]=this.formVehicle.value[i],t[i]=this.formVehicle.value[i]);this.vehiculo.articulado&&(this.formVehicle.value.remolque?this.vehiculo.remolque=this.formVehicle.value.remolque:(e=!1,a+="<li> Placa Remolque </li>"),this.hubImag.remolque.tarjePro1.webviewPath||(e=!1,a+="<li> Terjeta de propiedad Remolque Frontal </li>"),this.hubImag.remolque.tarjePro2.webviewPath||(e=!1,a+="<li> Terjeta de propiedad Remolque Posterior </li>"),this.hubImag.remolque.fotoremol.webviewPath||(e=!1,a+="<li> Foto Remolque </li>")),this.vehiculo.articulado&&e&&(yield this.saveDocumentVehicle()),a+="</ul>",console.log(this.hubImag),this.hubImag.cedula_pro1={},this.hubImag.cedula_pro2={},this.hubImag.remolque={},e?(yield this.reg.sendDataVehiculo(t),this.checkVehicle=!0,this.onDismissChange(!0),this.setOpenVehiculo(!1)):(this.checkVehicle=!1,this.presentAlert("Error","Es necesario ingresar:",a,"Cerrar"))}catch(i){console.error("Error en onSubmitVehicle",i),this.presentAlert("Error","Ocurri\xf3 un error inesperado.","","Cerrar")}finally{o.dismiss()}})}saveDocumentVehicle(){var e,t,o,a,i,s,u,c,h,d,f,p,v,m,g;return(0,ue.mG)(this,void 0,void 0,function*(){let y=!1;this.jsonDocs={files:[]},null!==(t=null===(e=this.hubImag)||void 0===e?void 0:e.tarjePro)&&void 0!==t&&t.base64&&(this.jsonDocs.files.push({codigo:this.vehiculo.placa,tipo:"tarjePro",tipoRegistro:"vehiculo",data64:this.hubImag.tarjePro.base64}),y=!0),null!==(a=null===(o=this.hubImag)||void 0===o?void 0:o.soat1)&&void 0!==a&&a.base64&&(this.jsonDocs.files.push({codigo:this.vehiculo.placa,tipo:"soat1",tipoRegistro:"vehiculo",data64:this.hubImag.soat1.base64}),y=!0),null!==(s=null===(i=this.hubImag)||void 0===i?void 0:i.tecnomecanica)&&void 0!==s&&s.base64&&(this.jsonDocs.files.push({codigo:this.vehiculo.placa,tipo:"tecnomecanica",tipoRegistro:"vehiculo",data64:this.hubImag.tecnomecanica.base64}),y=!0),null!==(c=null===(u=this.hubImag)||void 0===u?void 0:u.fotovehi1)&&void 0!==c&&c.base64&&(this.jsonDocs.files.push({codigo:this.vehiculo.placa,tipo:"fotovehi1",tipoRegistro:"vehiculo",data64:this.hubImag.fotovehi1.base64}),y=!0),null!==(d=null===(h=this.hubImag)||void 0===h?void 0:h.fotovehi2)&&void 0!==d&&d.base64&&(this.jsonDocs.files.push({codigo:this.vehiculo.placa,tipo:"fotovehi2",tipoRegistro:"vehiculo",data64:this.hubImag.fotovehi2.base64}),y=!0),null!==(p=null===(f=this.hubImag)||void 0===f?void 0:f.fotovehi3)&&void 0!==p&&p.base64&&(this.jsonDocs.files.push({codigo:this.vehiculo.placa,tipo:"fotovehi3",tipoRegistro:"vehiculo",data64:this.hubImag.fotovehi3.base64}),y=!0),null!==(m=null===(v=this.hubImag)||void 0===v?void 0:v.fotovehi4)&&void 0!==m&&m.base64&&(this.jsonDocs.files.push({codigo:this.vehiculo.placa,tipo:"fotovehi4",tipoRegistro:"vehiculo",data64:this.hubImag.fotovehi4.base64}),y=!0),null!==(g=this.hubImag.remolque.fotoremol)&&void 0!==g&&g.base64&&(this.jsonDocs.files.push({codigo:this.vehiculo.remolque,tipo:"fotoremol",tipoRegistro:"remolque",data64:this.hubImag.remolque.fotoremol.base64}),y=!0),this.hubImag.remolque.tarjePro1.base64&&(this.jsonDocs.files.push({codigo:this.vehiculo.remolque,tipo:"tarjePro1",tipoRegistro:"remolque",data64:this.hubImag.remolque.tarjePro1.base64}),y=!0),this.hubImag.remolque.tarjePro2.base64&&(this.jsonDocs.files.push({codigo:this.vehiculo.remolque,tipo:"tarjePro2",tipoRegistro:"remolque",data64:this.hubImag.remolque.tarjePro2.base64}),y=!0),y&&this.userService.cargaDocumentos(this.jsonDocs).subscribe(x=>{const b=x.data;b.soat1&&(this.hubImag.soat1.webviewPath=b.soat1),b.tecno1&&(this.hubImag.tecno1.webviewPath=b.tecno1),b.tarjePro&&(this.hubImag.tarjePro.webviewPath=b.tarjePro),b.soat1&&(this.hubImag.soat1.webviewPath=b.soat1),b.tecno&&(this.hubImag.tecno.webviewPath=b.tecno),b.fotovehi1&&(this.hubImag.fotovehi1.webviewPath=b.fotovehi1),b.fotovehi2&&(this.hubImag.fotovehi2.webviewPath=b.fotovehi2),b.fotovehi3&&(this.hubImag.fotovehi3.webviewPath=b.fotovehi3),b.fotovehi4&&(this.hubImag.fotovehi4.webviewPath=b.fotovehi4),b.fotoremol&&(this.hubImag.remolque.fotoremol.webviewPath=b.fotoremol),b.tarjePro1&&(this.hubImag.remolque.tarjePro1.webviewPath=b.tarjePror),b.tarjePro2&&(this.hubImag.remolque.tarjePro2.webviewPath=b.tarjePror)},x=>x,()=>{this.setOpenVehiculo(!1)})})}onSubmitNewProp(){var e;return(0,ue.mG)(this,void 0,void 0,function*(){const t=yield this.loading.create({message:"Guardando Datos..."});t.present();try{var o=!0,a={},i="<ul>";for(const s in this.formNewProp.controls)this.formNewProp.controls[s].invalid?(o=!1,i+="<li>"+s.charAt(0).toUpperCase()+s.slice(1)+"</li>"):(this.propietario[s]=this.formNewProp.value[s],a[s]=this.formNewProp.value[s]);o?(a.codigoTercerox=this.formNewProp.value.cedula,a.conductor=!0,yield this.reg.sendDataTercero(a),this.formVehicle.patchValue({codigoPropietario:this.formNewProp.value.cedula}),this.setOpenPropietario(!1),this.vehiculo.isPropietario=!1,yield this.saveDocumentTercero("cedula_pro1","cedula_pro2",this.formNewProp.value.cedula)):this.presentAlert("Error","Es necesario ingresar:",i,"Cerrar")}catch(s){this.presentAlert("Error","",(null===(e=s.error)||void 0===e?void 0:e.message)||"Error inesperado","Cerrar")}finally{t.dismiss()}})}onSubmitNewTen(){var e;return(0,ue.mG)(this,void 0,void 0,function*(){const t=yield this.loading.create({message:"Guardando Datos..."});t.present();try{var o=!0,a={},i="<ul>";for(const s in this.formNewTene.controls)this.formNewTene.controls[s].invalid?(o=!1,i+="<li>"+s.charAt(0).toUpperCase()+s.slice(1)+"</li>"):(this.conductor[s]=this.formNewTene.value[s],a[s]=this.formNewTene.value[s]);o?(a.codigoTercerox=this.formNewTene.value.cedula,a.conductor=!0,yield this.reg.sendDataTercero(a),this.formVehicle.patchValue({codigoTenedor:this.formNewTene.value.cedula}),this.setOpenTenedor(!1),this.vehiculo.isTenedor=!1,yield this.saveDocumentTercero("cedula_ten1","cedula_ten2",this.formNewTene.value.cedula)):this.presentAlert("Error","Es necesario ingresar:",i,"Cerrar")}catch(s){this.presentAlert("Error","",(null===(e=s.error)||void 0===e?void 0:e.message)||"Error inesperado","Cerrar")}finally{t.dismiss()}})}saveDocumentTercero(e,t,o){return(0,ue.mG)(this,void 0,void 0,function*(){const a={files:[]};return this.hubImag[e].base64&&a.files.push({codigo:o,tipo:e,tipoRegistro:"conductor",data64:this.hubImag[e].base64}),this.hubImag[t].base64&&a.files.push({codigo:o,tipo:t,tipoRegistro:"conductor",data64:this.hubImag[t].base64}),new Promise((i,s)=>{this.userService.cargaDocumentos(a).subscribe(u=>i(u),u=>{this.presentAlert("Error al cargar documentos","","Por favor validar documentos","Cerrar"),s(u)})})})}editPropietario1(e){return(0,ue.mG)(this,void 0,void 0,function*(){const t=yield this.loading.create({message:"Cargando Datos..."});t.present(),this.propietario.cedula=e,this.setOpenPropietario(!0),this.reg.getDataTercero(e).subscribe(o=>{t.dismiss();const a=o.data[0];this.propietario.cedula=a.codigoTercerox,this.propietario.nombres=a.nombreTercerox,this.propietario.apellidos=a.apell1Tercerox,this.propietario.correo=a.emailxTercerox,this.propietario.celular=a.movilxTercerox,this.propietario.direccion=a.direccTercerox,this.propietario.fechaNacimeinto=a.fechaxNacimien})})}editTenedor1(e){return(0,ue.mG)(this,void 0,void 0,function*(){const t=yield this.loading.create({message:"Cargando Datos..."});t.present(),this.tenedor.cedula=e,this.setOpenTenedor(!0),this.reg.getDataTercero(e).subscribe(o=>{t.dismiss();const a=o.data[0];this.tenedor.cedula=a.codigoTercerox,this.tenedor.nombres=a.nombreTercerox,this.tenedor.apellidos=a.apell1Tercerox,this.tenedor.correo=a.emailxTercerox,this.tenedor.celular=a.movilxTercerox,this.tenedor.direccion=a.direccTercerox,this.tenedor.fechaNacimeinto=a.fechaxNacimien})})}onDismissChange(e){this.dismissChange.emit(e),this.canDismissOverride=e}onWillPresent(){this.canDismissOverride=!1}handleRefresh(e){setTimeout(()=>{window.location.reload(),e.target.complete()},2e3)}delTenedor(){this.vehiculo.isTenedor=!0,this.tenedor.cedula="",this.tenedor.nombres="",this.formVehicle.patchValue({codigoTenedor:""})}delPropietario(){this.vehiculo.isPropietario=!0,this.propietario.cedula="",this.propietario.nombres="",this.formVehicle.patchValue({codigoPropietario:""})}checkTenedor(){var e=document.getElementById("tenedor");this.vehiculo.isTenedor?(this.tenedor.cedula||this.setOpenTenedor(!0),e.classList.remove("select-card"),this.vehiculo.isTenedor=!1,this.formVehicle.patchValue({isTenedor:!1}),this.completeData=!1,this.modulos[3].status=!0):(e.classList.add("select-card"),this.vehiculo.isTenedor=!0,this.formVehicle.patchValue({isTenedor:!0}),this.modulos[3].status=!1,this.formNewTene.reset(),this.vehiculo.isPropietario&&(this.completeData=!0))}unCheckPropietario(){document.getElementById("propietario").classList.add("select-card"),this.vehiculo.isPropietario=!0,this.setOpenPropietario(!1)}checkPropietario(e,t){var o=document.getElementById(e);switch(console.log(o),e){case"propietario":t?(o.classList.add("select-card"),this.vehiculo.isPropietario=!0,this.formVehicle.patchValue({isPropietario:!0})):(o.classList.remove("select-card"),this.vehiculo.isPropietario=!1,this.formVehicle.patchValue({isPropietario:!1}));break;case"tenedor":t?(o.classList.add("select-card"),this.vehiculo.isTenedor=!0,this.formVehicle.patchValue({isTenedor:!0})):(o.classList.remove("select-card"),this.vehiculo.isTenedor=!1,this.formVehicle.patchValue({isTenedor:!1}))}}saveFotoApi(){return(0,ue.mG)(this,void 0,void 0,function*(){const e=yield this.loading.create({message:"Guardando Foto..."});return e.present(),this.userService.cargaDocumentos({files:[{codigo:this.conductor.cedula,tipo:"fotoperfil",tipoRegistro:"conductor",data64:this.hubImag.fotoperfil.base64}]}).toPromise().then(o=>{console.log(o);const a=o.data;a.fotoperfil&&(this.hubImag.fotoperfil.webviewPath=a.fotoperfil),e.dismiss()},o=>{this.presentAlert("Error al cargar documentos","","Por favor validar documentos","Cerrar"),console.log(o)})})}saveDocumentos(){var e=!0,t="";t+="<ul>",console.log(this.formDocumentDriver.controls);for(const o in this.formDocumentDriver.controls)this.formDocumentDriver.controls[o].invalid?(e=!1,console.log(o),t+="<li>"+o.charAt(0).toUpperCase()+o.slice(1)+"</li>"):this.conductor[o]=this.formDocumentDriver.value[o];this.jsonDocs={files:[]},this.hubImag.cedula1.base64&&this.jsonDocs.files.push({codigo:this.conductor.cedula,tipo:"cedula1",data64:this.hubImag.cedula1.base64}),this.hubImag.cedula2.base64&&this.jsonDocs.files.push({codigo:this.conductor.cedula,tipo:"cedula2",data64:this.hubImag.cedula2.base64}),this.hubImag.licencia1.base64&&this.jsonDocs.files.push({codigo:this.conductor.cedula,tipo:"licencia1",data64:this.hubImag.licencia1.base64}),this.hubImag.licencia2.base64&&this.jsonDocs.files.push({codigo:this.conductor.cedula,tipo:"licencia2",data64:this.hubImag.licencia2.base64}),this.hubImag.seguridadsocial.base64&&this.jsonDocs.files.push({codigo:this.conductor.cedula,tipo:"seguridadsocial",data64:this.hubImag.seguridadsocial.base64}),t+="<ul>",e?this.userService.cargaDocumentos(this.jsonDocs).subscribe(o=>{const a=o.data;a.cedula1&&(this.hubImag.cedula1.webviewPath=a.cedula1),a.cedula2&&(this.hubImag.cedula2.webviewPath=a.cedula2),a.licencia1&&(this.hubImag.licencia1.webviewPath=a.licencia1),a.licencia2&&(this.hubImag.licencia2.webviewPath=a.licencia2),a.seguridadsocial&&(this.hubImag.seguridadsocial.webviewPath=a.seguridadsocial),this.modal2.dismiss()},o=>{this.presentAlert("Error al cargan documentos","","Por favor validar documentos","Cerrar"),console.log(o),console.log(this.jsonDocs)}):this.presentAlert("Error","Es Necesario ingresar: ",t,"Cerrar")}datosVehiculo(){const e=this.dataForm.value;this.vehiculo.fechaSoat=e.fechaSoat,this.vehiculo.fechaTecno=e.fechaTecno,this.jsonDocs={files:[]},this.hubImag.soat1.base64&&this.jsonDocs.files.push({codigo:this.cedula,tipo:"soat1",data64:this.hubImag.soat1.base64}),this.hubImag.apiTecno1.base64&&this.jsonDocs.files.push({codigo:this.cedula,tipo:"tecno1",data64:this.hubImag.apiTecno1.base64}),this.userService.cargaDocumentos(this.jsonDocs).subscribe(t=>{const o=t.data;o.soat1&&(this.hubImag.soat1.webviewPath=o.soat1),o.tecno1&&(this.hubImag.apiTecno1.webviewPath=o.tecno1),this.modal3.dismiss()},t=>{this.presentAlert("Error al cargan documentos Vehiculo","","Por favor validar documentos","Cerrar"),console.log(t),console.log(this.jsonDocs)})}upperPlaca(e){this.searchTerm=e.detail.value.toUpperCase()}changeVehicle(){this.dataChange=this.formBuilder.group({claseVehiculo:["",[j.kI.required]],marca:["",[j.kI.required]],carroceria:["",[j.kI.required]]});var e=this.userService.getCedula();const t=document.getElementById("placa"),o=null==t?void 0:t.value;null!=o&&o.length&&(null==o?void 0:o.length)>5&&(this.placaChange=o,this.claseNewVh="",this.marcaVeh="",this.carroceVeh="",this.isDisabled=!1,this.isDisabled1=!1,this.isDisabled2=!1,this.userService.get3SLbyplaca(o,this.token).subscribe(a=>{console.log(a),a.status&&a.data[0].codigoTercerox!=e&&this.presentAlert("Alerta","","La placa que intenta registrar esta asociada a otro conductor.","Cerrar")},a=>{401==a.status&&this.userService.logout()}),this.userService.getVehiculoByPlaca(o).subscribe(a=>{const i=a.view.data[0];i.clase_vehiculo.length>3&&(this.claseNewVh=i.clase_vehiculo,this.isDisabled=!0),i.marca.length>3&&(this.marcaVeh=i.marca,this.isDisabled1=!0),i.carroceria.length>3&&(this.carroceVeh=i.carroceria,this.isDisabled2=!0)},a=>{this.presentAlert("Alerta","","No registran datos para esa placa","Cerrar"),this.claseNewVh="",this.marcaVeh="",this.carroceVeh=""}))}searchInfoVeh(e,t,o){const a=this.dataClases.find(c=>c.name===e);this.codigoClase=null==a?void 0:a.id;const i=this.dataMarcas.find(c=>c.name===t);this.codigoMarca=null==i?void 0:i.id,this.getCarroc(null==a?void 0:a.id);var s=o.toString();s=s.replace(/\s/g,"");const u=this.dataCarroc.find(c=>c.name===s);return null==u?(this.carroceria="",this.codigoCarroceria="",this.formVehicle.patchValue({carroceria:""}),!1):(this.codigoCarroceria=null==u?void 0:u.id,this.carroceria=s,!0)}separarCamelCase(e){let o=e.replace(/([a-z])([A-Z])/g,"$1 $2");return o=o.toLowerCase(),o=o.charAt(0).toLowerCase()+o.slice(1),o}nuevoPropietario(){this.setOpenPropietario(!0)}editPropietario(){this.setOpenPropietario(!0)}searchPropietario(e){var t=!0;const o=e.target.value;o.length>6&&this.userService.getTerceroByCedula(o).subscribe(a=>{console.log(a);const i=a.data[0];this.propietario.cedula=o,this.propietario.nombres=i.nombre,this.propietario.Apellidos=i.apellido,this.propietario.correo=i.email,this.propietario.celular=i.celular,this.propietario.direccion=i.direccion,this.propietario.fechaNacimiento=i.fecha_nacimiento,i.cedula1?this.hubImag.cedula_pro1.webviewPath=i.cedula1:t=!1,i.cedula2?this.hubImag.cedula_pro2.webviewPath=i.cedula2:t=!1,t?(this.incompletoPropiet=!1,this.checkPropi=!0):(this.incompletoPropiet=!0,this.checkPropi=!1,this.setOpenPropietario(!0))},a=>{this.newPropiet=!0,this.setOpenPropietario(!0),this.formNewProp.reset(),this.propietario.cedula=o})}nuevoTenedor(){this.setOpenTenedor(!0)}editTenedor(){this.setOpenTenedor(!0)}searchTenedor(e){const t=e.target.value;var o=!0;t.length>6&&this.userService.getTerceroByCedula(t).subscribe(a=>{const i=a.data[0];this.tenedor.cedula=t,this.tenedor.nombres=i.nombre,this.tenedor.apellidos=i.apellido,this.tenedor.correo=i.email,this.tenedor.celular=i.celular,this.tenedor.direccion=i.direccion,this.tenedor.fechaNacimiento=i.fecha_nacimiento,i.cedula1?this.hubImag.cedula_pro1.webviewPath=i.cedula1:o=!1,i.cedula2?this.hubImag.cedula_pro2.webviewPath=i.cedula2:o=!1,o?(this.incompletoTenedor=!1,this.checkTened=!0):(this.incompletoTenedor=!0,this.checkTened=!1,this.setOpenTenedor(!0))},a=>{this.newTenedor=!0,this.setOpenTenedor(!0),this.formNewTene.reset(),this.tenedor.cedula=t})}validateDocument(e){}buscarCodigoEnDocumentos(e){for(const t of this.documents_conductor){if(t.fechaTag&&t.fechaTag===e)return t;for(const o of t.docs)if(o.codigo===e)return t}for(const t of this.documents_vehiculo){if(t.fechaTag&&t.fechaTag===e)return t;for(const o of t.docs)if(o.codigo===e)return t}}getDocument(e,t,o){return(0,ue.mG)(this,void 0,void 0,function*(){return yield this.photo.getFotoTercero(e,t,o).toPromise()})}onChange(){console.log(this.dataChange.value)}cargaDatosfinal(e){}changeInput(e){document.querySelector("#fecha input").type=e}addToGalery(e){this.photo.addNewToGallery(e).then(t=>{this.hubImag[e]=t})}addToCamera(e){this.photo.addNewToCamera(e).then(t=>{this.hubImag[e]=t})}addToCameraRemolque(e){this.photo.addNewToCamera(e).then(t=>{console.log(t),this.hubImag.remolque[e]=t})}loadProfile(){return(0,ue.mG)(this,void 0,void 0,function*(){this.loadingData=yield this.loading.create({message:"Guradando Datos.."}),this.photo.addNewToCameraProfile("fotoperfil").then(e=>{this.loadingData.present(),this.processImage(e,"fotoperfil",!1)})})}processImage(e,t,o){return(0,ue.mG)(this,void 0,void 0,function*(){try{const s={webPath:yield this.photo.processAndRotationImage(e.base64,o),format:"jpeg",saved:!1},u=yield this.photo.readAsBase64(s),d=yield this.photo.processImage(u),f={webPath:d,format:"jpeg",saved:!1};e.webviewPath=d,e.base64=yield this.photo.readAsBase64(f),this.hubImag[t]=e,this.loadingData.dismiss()}catch(i){console.error("Error al procesar la imagen:",i)}})}presentAlert(e,t,o,a){return(0,ue.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:""+e,subHeader:""+t,message:""+o,buttons:[""+a]})).present()})}presentAlertRoute(e,t,o,a,i){return(0,ue.mG)(this,void 0,void 0,function*(){yield this.alertController.create({header:""+e,subHeader:""+t,message:""+o,buttons:[{text:"Aceptar",handler:()=>{"NO"!=i&&this.router.navigateByUrl("/"+i)}}]})})}}return r.\u0275fac=function(e){return new(e||r)(l.Y36(ee._q),l.Y36(ee.Br),l.Y36(j.qu),l.Y36(Rh.K),l.Y36(Hr.F0),l.Y36(Ph.T),l.Y36(Nh.r),l.Y36(ee.HT),l.Y36(Y1.y),l.Y36(ee.BX),l.Y36(ee.t4),l.Y36(X1.e))},r.\u0275cmp=l.Xpm({type:r,selectors:[["app-datos"]],viewQuery:function(e,t){if(1&e&&(l.Gf(Q1,5),l.Gf($1,5),l.Gf(e0,5),l.Gf(t0,5),l.Gf(n0,5),l.Gf(r0,5),l.Gf(o0,5),l.Gf(a0,5),l.Gf(i0,7)),2&e){let o;l.iGM(o=l.CRH())&&(t.modal1=o.first),l.iGM(o=l.CRH())&&(t.modal2=o.first),l.iGM(o=l.CRH())&&(t.modal3=o.first),l.iGM(o=l.CRH())&&(t.modal4=o.first),l.iGM(o=l.CRH())&&(t.modal5=o.first),l.iGM(o=l.CRH())&&(t.modal6=o.first),l.iGM(o=l.CRH())&&(t.modal7=o.first),l.iGM(o=l.CRH())&&(t.videoContainer=o.first),l.iGM(o=l.CRH())&&(t.accordionGroup=o.first)}},inputs:{dataTercero:"dataTercero"},outputs:{dismissChange:"dismissChange"},decls:122,vars:35,consts:[["slot","start"],[1,"ml-3"],[1,"ion-user"],["slot","fixed",3,"ionRefresh"],[3,"formGroup","ngSubmit"],[1,"container","panel-user"],[1,"row","p-3"],[1,"containerPhoto","col","col-12","d-flex","justify-content-center","p-2","mb-3"],["alt","person","class","rounded-circle me-2",3,"src",4,"ngIf"],["alt","person","class","rounded-circle me-2","src","../../assets/img/userDefault.png",4,"ngIf"],["id","changePhoto",3,"click"],["src","../../assets/icon/camara_min.png","alt",""],[1,"col","col-12","text-center"],[1,"list-unstyled","ps-0","ml-3"],[1,"mb-1"],[1,"text-white"],["id","nameUser"],[1,"doc-container",3,"hidden"],["id","documentos",3,"click"],["src","../../assets/icon/document.png","alt",""],["color","danger","slot","start"],[1,"veh-container"],["id","vehiculos",3,"click"],["src","../../assets/icon/vehicle.png","alt",""],["color","primary","slot","start"],[1,"p-2",3,"inset"],["method","post",3,"formGroup","ngSubmit"],[1,"col-md-12","d-flex","mt-4","mb-4","justify-content-center","text-center","title-form"],[1,"mb-4"],["for",""],["type","text","formControlName","nombres",1,"input-registro",3,"ngModel"],["type","text","formControlName","apellidos",1,"input-registro",3,"ngModel"],["type","text","formControlName","correo",1,"input-registro",3,"ngModel"],["type","text","formControlName","celular",1,"input-registro",3,"ngModel"],["type","text","formControlName","direccion",1,"input-registro",3,"ngModel"],["type","date","id","fechaNacimiento","formControlName","fechaNacimiento",1,"input-registro",3,"ngModel"],["type","text","formControlName","nombreContacto",1,"input-registro",3,"ngModel"],["type","text","formControlName","celularContacto",1,"input-registro",3,"ngModel"],["formControlName","parentesco","interface","action-sheet","label","Fixed label","label-placement","fixed",1,"input-registro",3,"ngModel","placeholder","ionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"mt-1","p-2","d-flex","justify-content-center"],["type","submit",1,"btn","btn-primary","btn-submit"],["trigger","personal-data",3,"isOpen"],["modal1",""],["trigger","document-data",3,"isOpen"],["modal2",""],["trigger","change-vehicle",3,"isOpen"],["modal4",""],["trigger","my-vehicles",3,"isOpen"],["modal7",""],["trigger","vehicle-data",3,"isOpen","presentingElement"],["modal3",""],["trigger","propietario-data",3,"isOpen"],["modal5",""],["trigger","tenedor-data",3,"isOpen"],["modal6",""],["appTipoDocumento","dataTercero",3,"dataTercero","save","cancel",4,"ngIf"],["alt","person",1,"rounded-circle","me-2",3,"src"],["alt","person","src","../../assets/img/userDefault.png",1,"rounded-circle","me-2"],[3,"value"],["color","medium",3,"click"],["slot","end"],[3,"strong","click"],[1,"ml-4"],["accordionGroup",""],["value","first"],["slot","header","color","light"],["slot","content",1,"ion-padding"],[1,"col-md-12","d-flex","mt-4","mb-1","justify-content-center","text-center","title-form"],[1,"container-upload","mb-3",3,"click"],[3,"src",4,"ngIf"],["class","camera",4,"ngIf"],["value","second"],[1,"d-flex","justify-content-center"],["formControlName","fechaLicencia","presentation","date",3,"ngModel"],["value","third"],["formControlName","fechaSeguridad","presentation","date",3,"ngModel"],[3,"src"],[1,"camera"],[1,"ml-2"],["size","8",1,"d-flex","justify-content-center","p-3"],["position","floating"],["formControlName","placa","id","placa","type","text",3,"ngModel","value","ionChange"],["size","4",1,"d-flex","justify-content-center","align-centr","p-3"],["color","primary",3,"click"],[4,"ngIf"],["expand","block","color","primary","type","submit",4,"ngIf"],["formControlName","claseVehiculo",3,"ngModel","disabled"],["formControlName","marca",3,"ngModel","disabled"],["formControlName","carroceria",3,"ngModel","disabled"],["expand","block","color","primary","type","submit"],[3,"strong"],["color","write ",3,"click"],[1,"prop-flotante"],[1,"ion-align-items-center","mt-4"],["size","12","size-sm","6",1,"mb-2"],["lines","none"],["slot","end",3,"checked","ionChange"],["size","12","size-sm","6"],["class","mb-4 icon-edit",4,"ngIf"],["type","text","formControlName","modelo",1,"input-registro",3,"ngModel"],[1,"autocomplete-container2","mb-4","col-md-12"],["formControlName","claseVehiculo","placeholder","",3,"ngModel","data","searchKeyword","itemTemplate","notFoundTemplate","selected","inputChanged","inputFocused"],["formControlName","marca","placeholder","",3,"ngModel","data","searchKeyword","itemTemplate","notFoundTemplate","selected","inputChanged","inputFocused"],["formControlName","linea","placeholder","",3,"ngModel","data","searchKeyword","itemTemplate","notFoundTemplate","selected","inputChanged","inputFocused"],["formControlName","carroceria","placeholder","",3,"ngModel","data","searchKeyword","itemTemplate","notFoundTemplate","selected","inputChanged","inputFocused"],["formControlName","color","placeholder","",3,"ngModel","data","searchKeyword","itemTemplate","notFoundTemplate","selected","inputChanged","inputFocused"],["formControlName","empresaSatelital","placeholder","",3,"ngModel","data","searchKeyword","itemTemplate","notFoundTemplate","selected","inputChanged","inputFocused"],["itemTemplate",""],["notFoundTemplate",""],["type","text","formControlName","usuarioSatelital",1,"input-registro",3,"ngModel"],["type","text","formControlName","claveSatelital",1,"input-registro",3,"ngModel"],["class","ion-padding",4,"ngIf"],[1,"mt-5","p-4"],["expand","block","type","submit"],[1,"mb-4","icon-edit"],["for","floatingInput"],["type","number","formControlName","codigoPropietario","name","propietario","matInput","","id","propietario",1,"input-registro",3,"ngModel","change"],["class","icon","name","add-circle",3,"click",4,"ngIf"],["class","group-icons",4,"ngIf"],["class","icon","name","close-circle",4,"ngIf"],["name","add-circle",1,"icon",3,"click"],[1,"group-icons"],["name","create",1,"icon-a",3,"click"],["name","checkmark-circle",1,"icon-a"],["name","close-circle",1,"icon-a"],["name","close-circle",1,"icon"],["type","number","formControlName","codigoTenedor","name","tenedor","matInput","","id","tenedor",1,"input-registro",3,"ngModel","change"],[3,"innerHTML"],[1,"ion-padding"],["type","text","formControlName","remolque",1,"input-registro",3,"ngModel"],["for","cedula"],["type","text","readonly","","formControlName","cedula","id","cedula",1,"input-registro",3,"ngModel"],["class","mb-4",4,"ngIf"],["for","nombres"],["type","text","formControlName","nombres","id","nombres",1,"input-registro",3,"ngModel"],["for","apellidos"],["type","text","formControlName","apellidos","id","apellidos",1,"input-registro",3,"ngModel"],["for","correo"],["type","text","formControlName","correo","id","correo",1,"input-registro",3,"ngModel"],["for","celular"],["type","text","formControlName","celular","id","celular",1,"input-registro",3,"ngModel"],["for","direccion"],["type","text","formControlName","direccion","id","direccion",1,"input-registro",3,"ngModel"],["type","number","id","cedula","readonly","","formControlName","cedula",1,"input-registro",3,"ngModel"],["appTipoDocumento","dataTercero",3,"dataTercero","save","cancel"]],template:function(e,t){1&e&&(l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),l._UZ(3,"ion-menu-button"),l.qZA(),l.TgZ(4,"ion-title",1),l._uU(5,"Informaci\xf3n Conductor"),l.qZA()()(),l.TgZ(6,"ion-content",2)(7,"ion-refresher",3),l.NdJ("ionRefresh",function(a){return t.handleRefresh(a)}),l._UZ(8,"ion-refresher-content"),l.qZA(),l.TgZ(9,"form",4),l.NdJ("ngSubmit",function(){return t.onSubmit()}),l.TgZ(10,"div",5)(11,"div",6)(12,"div",7)(13,"ion-avatar",0),l.YNc(14,s0,1,1,"ion-img",8),l.YNc(15,u0,1,0,"ion-img",9),l.qZA(),l.TgZ(16,"span",10),l.NdJ("click",function(){return t.loadProfile()}),l._UZ(17,"img",11),l.qZA()(),l.TgZ(18,"div",12)(19,"ul",13)(20,"li",14)(21,"h2",15)(22,"strong",16),l._uU(23),l.qZA()()(),l.TgZ(24,"li",14)(25,"h2",15)(26,"strong",16),l._uU(27),l.qZA()()()()(),l.TgZ(28,"div",17)(29,"span",18),l.NdJ("click",function(){return t.loadDocs()}),l._UZ(30,"img",19),l.qZA(),l.TgZ(31,"ion-badge",20),l._uU(32),l.qZA()(),l.TgZ(33,"div",21)(34,"span",22),l.NdJ("click",function(){return t.loadVehicle()}),l._UZ(35,"img",23),l.qZA(),l.TgZ(36,"ion-badge",24),l._uU(37),l.qZA()()()(),l.TgZ(38,"ion-list",25)(39,"form",26),l.NdJ("ngSubmit",function(){return t.onSubmitDriver()}),l.TgZ(40,"ion-grid")(41,"ion-col")(42,"div",27)(43,"strong")(44,"h1"),l._uU(45,"Datos Personales"),l.qZA()()()(),l.TgZ(46,"ion-row",28)(47,"ion-col")(48,"label",29),l._uU(49,"Nombres"),l.qZA(),l._UZ(50,"input",30),l.qZA()(),l.TgZ(51,"ion-row",28)(52,"ion-col")(53,"label",29),l._uU(54,"Apellidos"),l.qZA(),l._UZ(55,"input",31),l.qZA()(),l.TgZ(56,"ion-row",28)(57,"ion-col")(58,"label",29),l._uU(59,"Correo"),l.qZA(),l._UZ(60,"input",32),l.qZA()(),l.TgZ(61,"ion-row",28)(62,"ion-col")(63,"label",29),l._uU(64,"Celular"),l.qZA(),l._UZ(65,"input",33),l.qZA()(),l.TgZ(66,"ion-row",28)(67,"ion-col")(68,"label",29),l._uU(69,"Direccion"),l.qZA(),l._UZ(70,"input",34),l.qZA()(),l.TgZ(71,"ion-row",28)(72,"ion-col")(73,"label",29),l._uU(74,"Fecha nacimiento"),l.qZA(),l._UZ(75,"input",35),l.qZA()(),l.TgZ(76,"ion-col")(77,"div",27)(78,"strong")(79,"h1"),l._uU(80,"Datos Referencia"),l.qZA()()()(),l.TgZ(81,"ion-row",28)(82,"ion-col")(83,"label",29),l._uU(84,"Nombre contacto"),l.qZA(),l._UZ(85,"input",36),l.qZA()(),l.TgZ(86,"ion-row",28)(87,"ion-col")(88,"label",29),l._uU(89,"Celular contacto"),l.qZA(),l._UZ(90,"input",37),l.qZA()(),l.TgZ(91,"ion-row")(92,"ion-col")(93,"label",29),l._uU(94,"Parentesco"),l.qZA(),l.TgZ(95,"ion-select",38),l.NdJ("ionChange",function(a){return t.onChangeParente(a)}),l.YNc(96,c0,2,2,"ion-select-option",39),l.qZA()()(),l.TgZ(97,"div",40)(98,"button",41),l._uU(99," Guardar "),l.qZA()()()()(),l.TgZ(100,"ion-modal",42,43),l.YNc(102,l0,11,1,"ng-template"),l.qZA(),l.TgZ(103,"ion-modal",44,45),l.YNc(105,w0,101,16,"ng-template"),l.qZA(),l.TgZ(106,"ion-modal",46,47),l.YNc(108,D0,26,8,"ng-template"),l.qZA(),l.TgZ(109,"ion-modal",48,49),l.YNc(111,k0,11,1,"ng-template"),l.qZA(),l.TgZ(112,"ion-modal",50,51),l.YNc(114,K0,92,43,"ng-template"),l.qZA(),l.TgZ(115,"ion-modal",52,53),l.YNc(117,iy,29,11,"ng-template"),l.qZA(),l.TgZ(118,"ion-modal",54,55),l.YNc(120,yy,29,11,"ng-template"),l.qZA()()(),l.YNc(121,xy,1,1,"app-documentos-data",56)),2&e&&(l.xp6(9),l.Q6J("formGroup",t.dataForm),l.xp6(4),l.Udp("width","130px")("height","130px"),l.xp6(1),l.Q6J("ngIf",t.hubImag.fotoperfil.webviewPath),l.xp6(1),l.Q6J("ngIf",!t.hubImag.fotoperfil.webviewPath),l.xp6(8),l.AsE("",t.conductor.nombres," ",t.conductor.apellidos,""),l.xp6(4),l.hij("CC. ",t.conductor.cedula,""),l.xp6(1),l.Q6J("hidden",t.hiddenDocs),l.xp6(4),l.Oqu(t.numDocs),l.xp6(5),l.Oqu(t.vehiculo.placa),l.xp6(1),l.Q6J("inset",!0),l.xp6(1),l.Q6J("formGroup",t.formDriver),l.xp6(11),l.Q6J("ngModel",t.conductor.nombres),l.xp6(5),l.Q6J("ngModel",t.conductor.apellidos),l.xp6(5),l.Q6J("ngModel",t.conductor.correo),l.xp6(5),l.Q6J("ngModel",t.conductor.celular),l.xp6(5),l.Q6J("ngModel",t.conductor.direccion),l.xp6(5),l.Q6J("ngModel",t.conductor.fechaNacimiento),l.xp6(10),l.Q6J("ngModel",t.conductor.nombreContacto),l.xp6(5),l.Q6J("ngModel",t.conductor.celularContacto),l.xp6(5),l.Q6J("ngModel",t.conductor.parentesco)("placeholder",t.conductor.parentesco?t.conductor.parentesco:"Seleccionar parentesco"),l.xp6(1),l.Q6J("ngForOf",t.dataParentes),l.xp6(4),l.Q6J("isOpen",t.isModalOpen1),l.xp6(3),l.Q6J("isOpen",t.isModalOpen2),l.xp6(3),l.Q6J("isOpen",t.isModalOpen4),l.xp6(3),l.Q6J("isOpen",t.isModalOpen7),l.xp6(3),l.Q6J("isOpen",t.isModalOpen3)("presentingElement",t.presentingElement),l.xp6(3),l.Q6J("isOpen",t.isModalOpen5),l.xp6(3),l.Q6J("isOpen",t.isModalOpen6),l.xp6(3),l.Q6J("ngIf",t.openDocs))},styles:[".tercero-cont[_ngcontent-%COMP%]{padding:.5rem}.tercero-cont[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:10px}.container-prop[_ngcontent-%COMP%], .prop-flotante[_ngcontent-%COMP%]{height:auto;padding:10px;box-sizing:border-box}ion-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%}ion-col[_ngcontent-%COMP%]{height:auto;padding:10px;box-sizing:border-box}.select-card[_ngcontent-%COMP%]{background-color:#0094da;color:#fff}app-documentos-data[_ngcontent-%COMP%]{width:100%;height:97%;position:absolute}ion-toolbar[_ngcontent-%COMP%]{--background: #3C8CCD;--color: white}ion-title[_ngcontent-%COMP%]{--margin-start: 15px}.custom-title[_ngcontent-%COMP%]{text-align:center;width:100%}ion-menu-button[_ngcontent-%COMP%]{color:var(white)}.icon-edit[_ngcontent-%COMP%]{position:relative}.icon[_ngcontent-%COMP%]{position:absolute;cursor:pointer;color:#007bff;font-size:25px;right:20px;top:25px}.icon-calendar[_ngcontent-%COMP%]{position:absolute;cursor:pointer;color:#007bff;font-size:25px;right:20px;top:30px}.group-icons[_ngcontent-%COMP%]{position:absolute;right:20px;top:25px}.icon-a[_ngcontent-%COMP%]{cursor:pointer;color:#007bff;font-size:25px}.write[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .write[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .write[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff}.autocomplete-container2[_ngcontent-%COMP%]{position:relative}.col-n[_ngcontent-%COMP%]{flex:revert-layer!important}"]}),r})();const by=[{path:"",component:ss}];let _y=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=l.oAB({type:r}),r.\u0275inj=l.cJS({imports:[Hr.Bz.forChild(by),Hr.Bz]}),r})();var us=Ue(8626);function wy(r,n){if(1&r&&(l.TgZ(0,"ion-text")(1,"span",16),l._uU(2),l.qZA(),l._uU(3," - "),l.qZA()),2&r){const e=n.$implicit;l.xp6(2),l.hij(" ",e.nombre," ")}}function Cy(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-card",14),l.NdJ("click",function(){const a=l.CHM(e).index,i=l.oxw();return l.KtG(i.selectDocument(a))}),l.TgZ(1,"ion-card-header")(2,"ion-card-title"),l._uU(3),l.qZA(),l.TgZ(4,"ion-card-subtitle"),l.YNc(5,wy,4,1,"ion-text",15),l.qZA()(),l.TgZ(6,"ion-card-content"),l._uU(7),l.qZA()()}if(2&r){const e=n.$implicit;l.xp6(3),l.Oqu(e.nombre),l.xp6(2),l.Q6J("ngForOf",e.docs),l.xp6(1),l.Tol(e.status?"confirm":"pending"),l.xp6(1),l.hij(" ",e.status?"En revision":"Pendiente"," ")}}function Ty(r,n){if(1&r&&l._UZ(0,"ion-img",26),2&r){const e=l.oxw(2).$implicit,t=l.oxw(3);l.Q6J("src",t.getImagen(e.codigo))}}function Ey(r,n){1&r&&l._UZ(0,"div",27)}function Iy(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"div",23),l.NdJ("click",function(){l.CHM(e);const o=l.oxw().$implicit,a=l.oxw(3);return l.KtG(a.addToCamera(o.codigo,a.documentActive.rotate))}),l.YNc(1,Ty,1,1,"ion-img",24),l.YNc(2,Ey,1,0,"div",25),l.qZA()}if(2&r){const e=l.oxw().$implicit,t=l.oxw(3);l.xp6(1),l.Q6J("ngIf",t.getImagen(e.codigo)),l.xp6(1),l.Q6J("ngIf",!t.getImagen(e.codigo))}}function Dy(r,n){if(1&r&&l._UZ(0,"ion-img",26),2&r){const e=l.oxw(2).$implicit,t=l.oxw(3);l.Q6J("src",t.getImagen(e.codigo))}}function ky(r,n){1&r&&l._UZ(0,"div",27)}function Ay(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"div",23),l.NdJ("click",function(){l.CHM(e);const o=l.oxw().$implicit,a=l.oxw(3);return l.KtG(a.selectTypeDocument(o.codigo,a.documentActive.rotate))}),l.YNc(1,Dy,1,1,"ion-img",24),l.YNc(2,ky,1,0,"div",25),l.qZA()}if(2&r){const e=l.oxw().$implicit,t=l.oxw(3);l.xp6(1),l.Q6J("ngIf",t.getImagen(e.codigo)),l.xp6(1),l.Q6J("ngIf",!t.getImagen(e.codigo))}}function Sy(r,n){if(1&r&&(l.TgZ(0,"ion-row")(1,"ion-col")(2,"div",21)(3,"strong")(4,"h1"),l._uU(5),l.qZA()()(),l.TgZ(6,"ion-item"),l.YNc(7,Iy,3,2,"div",22),l.YNc(8,Ay,3,2,"div",22),l.qZA()()()),2&r){const e=n.$implicit,t=l.oxw(3);l.xp6(5),l.Oqu(e.nombre),l.xp6(2),l.Q6J("ngIf","camera"==t.documentActive.capture),l.xp6(1),l.Q6J("ngIf","galery"==t.documentActive.capture)}}function Ry(r,n){if(1&r&&(l.TgZ(0,"div",21)(1,"strong")(2,"h3"),l._uU(3),l.qZA()()()),2&r){const e=l.oxw(3);l.xp6(3),l.Oqu(e.documentActive.fechaTitle)}}function Py(r,n){if(1&r&&(l.TgZ(0,"ion-row")(1,"ion-col",28),l._UZ(2,"input",29),l.qZA()()),2&r){const e=l.oxw(3);l.xp6(2),l.s9C("id",e.documentActive.fechaTag),l.Q6J("ngModel",e.fechaL[e.documentActive.fechaTag])}}function Ny(r,n){if(1&r&&(l.TgZ(0,"ion-grid"),l.YNc(1,Sy,9,3,"ion-row",15),l.YNc(2,Ry,4,1,"div",20),l.YNc(3,Py,3,2,"ion-row",18),l.qZA()),2&r){const e=l.oxw(2);l.xp6(1),l.Q6J("ngForOf",e.documentActive.docs),l.xp6(1),l.Q6J("ngIf",e.documentActive.fecha),l.xp6(1),l.Q6J("ngIf",e.documentActive.fecha)}}function Fy(r,n){if(1&r&&(l.TgZ(0,"ion-col",32)(1,"label",33),l._uU(2),l.qZA(),l._UZ(3,"input",34),l.qZA()),2&r){const e=l.oxw().$implicit,t=l.oxw(3);l.xp6(2),l.Oqu(e.nombre),l.xp6(1),l.s9C("value",t.fechaL[e.codigo])}}function My(r,n){1&r&&l._UZ(0,"a",41),2&r&&l.Q6J("innerHTML",n.$implicit.name,l.oJD)}function Oy(r,n){1&r&&l._UZ(0,"div",41),2&r&&l.Q6J("innerHTML",n.$implicit,l.oJD)}function By(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-row",35)(1,"ion-col")(2,"div",36)(3,"ion-label",37),l._uU(4),l.qZA(),l.TgZ(5,"ng-autocomplete",38),l.NdJ("selected",function(o){l.CHM(e);const a=l.oxw(4);return l.KtG(a.select(o))})("inputChanged",function(o){l.CHM(e);const a=l.oxw(4);return l.KtG(a.onChange(o))})("inputFocused",function(o){l.CHM(e);const a=l.oxw(4);return l.KtG(a.onFocused(o))}),l.qZA()()(),l.YNc(6,My,1,1,"ng-template",null,39,l.W1O),l.YNc(8,Oy,1,1,"ng-template",null,40,l.W1O),l.qZA()}if(2&r){const e=l.MAs(7),t=l.MAs(9),o=l.oxw().$implicit,a=l.oxw(3);l.xp6(4),l.hij(" ",o.nombre," "),l.xp6(1),l.Q6J("ngModel",a.dataAuto)("data",a.dataAutoComplete)("searchKeyword",a.keyword)("itemTemplate",e)("notFoundTemplate",t)}}function Ly(r,n){if(1&r&&(l.TgZ(0,"div")(1,"ion-row"),l.YNc(2,Fy,4,2,"ion-col",30),l.qZA(),l.YNc(3,By,10,6,"ion-row",31),l.qZA()),2&r){const e=n.$implicit;l.xp6(2),l.Q6J("ngIf","text"==e.type),l.xp6(1),l.Q6J("ngIf","data"==e.type)}}function Wy(r,n){if(1&r&&(l.TgZ(0,"ion-grid"),l.YNc(1,Ly,4,2,"div",15),l.qZA()),2&r){const e=l.oxw(2);l.xp6(1),l.Q6J("ngForOf",e.documentActive.docs)}}function Uy(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",16),l._uU(3,"Carga documentos"),l.qZA()()(),l.TgZ(4,"ion-content")(5,"ion-list",17),l.YNc(6,Ny,4,3,"ion-grid",18),l.YNc(7,Wy,2,1,"ion-grid",18),l.qZA()(),l.TgZ(8,"ion-footer")(9,"ion-button",19),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.checkDocument())}),l._uU(10," Confirmar Fotos "),l.qZA(),l.TgZ(11,"ion-button",19),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.resetFotos())}),l._uU(12," Cambiar fotos "),l.qZA()()}if(2&r){const e=l.oxw();l.xp6(5),l.Q6J("inset",!0),l.xp6(1),l.Q6J("ngIf","data"!=e.documentActive.capture),l.xp6(1),l.Q6J("ngIf","data"==e.documentActive.capture)}}function Vy(r,n){if(1&r){const e=l.EpF();l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",16),l._uU(3,"Tipo Carga"),l.qZA()()(),l.TgZ(4,"ion-content")(5,"ion-list")(6,"ion-item",42),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return o.addToCamera(o.codeImageSelect,o.rotateImageSelect),l.KtG(o.setModalType(!1))}),l._UZ(7,"ion-icon",43),l._uU(8," Camara "),l.qZA(),l.TgZ(9,"ion-item",42),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return o.addToGalery(o.codeImageSelect,o.rotateImageSelect),l.KtG(o.setModalType(!1))}),l._UZ(10,"ion-icon",44),l._uU(11," Galeria "),l.qZA(),l.TgZ(12,"ion-item",42),l.NdJ("click",function(){l.CHM(e);const o=l.oxw();return l.KtG(o.triggerFileInput())}),l.TgZ(13,"input",45),l.NdJ("change",function(o){l.CHM(e);const a=l.oxw();return a.onFileSelected(o,a.codeImageSelect),l.KtG(a.setModalType(!1))}),l.qZA(),l._UZ(14,"ion-icon",46),l.TgZ(15,"span"),l._uU(16,"Archivo"),l.qZA()()()()}}const Gy=function(){return[0,.25,.5,.75]};let qy=(()=>{class r{constructor(e,t,o,a,i,s,u){this.datos=e,this.route=t,this.photo=o,this.alertController=a,this.user=i,this.loading=s,this.reg=u,this.modalTypeInput=!1,this.listEvents=[],this.articulado=!0,this.dataAutoComplete=[],this.keyword="name",this.isModalOpen=!1,this.fechaL=[]}ngOnInit(){this.token=this.user.getToken();var t="";if(console.log(this.dataTercero),this.dataTercero.docs&&(this.documents=this.dataTercero.docs,console.log(this.documents)),this.dataTercero.articulado||(this.documents=this.deleteDocumentByName(this.documents,"Remolque")),this.documents)for(let i=0;i<this.documents.length;i++)for(let s=0;s<this.documents[i].docs.length;s++){const u=this.documents[i].docs[s].codigo;"galery"==this.documents[i].capture||"camera"==this.documents[i].capture?("conductor"==this.documents[i].type&&(t=this.dataTercero.cedula),"vehiculo"==this.documents[i].type&&(t=this.dataTercero.placa),this.getDocument(t,u,this.documents[i].type).then(c=>{"204"===c.code||!c.data[u]||(console.log(c.data),this.datos.hubImag[u].webviewPath=c.data[u],this.documents[i].docs[s].imagen=c.data[u],this.documents[i].docs[s].status=!0)})):"data"==this.documents[i].capture&&"vehiculo"==this.documents[i].type&&(this.fechaL[this.documents[i].docs[s].codigo]=this.datos.vehiculo[this.documents[i].docs[s].codigo])}}setModalType(e){this.modalTypeInput=e}dimmissModalType(e){this.modalTypeInput=!1,console.log(e)}selectTypeDocument(e,t){this.codeImageSelect=e,this.rotateImageSelect=t,this.setModalType(!0)}backdata(){this.datos.openDocs=!1,this.datos.ngOnInit()}setModal(e){this.isModalOpen=e}selectDocument(e){this.isModalOpen=!0,this.documentActive=this.documents[e],this.codeDocumentActive=e}addToGalery(e,t){return(0,ue.mG)(this,void 0,void 0,function*(){this.loadingData=yield this.loading.create({message:"Guradando Foto.."}),this.photo.addNewToGallery(e).then(o=>{this.loadingData.present(),this.processImage(o,e,t)})})}addToCamera(e,t){return(0,ue.mG)(this,void 0,void 0,function*(){this.loadingData=yield this.loading.create({message:"Guradando Foto.."}),this.photo.addNewToCamera(e).then(o=>{this.loadingData.present(),this.processImage(o,e,t)})})}processImage(e,t,o){return(0,ue.mG)(this,void 0,void 0,function*(){try{var a=0;o&&(a=90);const s={webPath:yield this.photo.processAndRotationImage(e.base64,a),format:"jpeg",saved:!1},u=yield this.photo.readAsBase64(s),d=yield this.photo.processImage(u),f={webPath:d,format:"jpeg",saved:!1};e.webviewPath=d,e.base64=yield this.photo.readAsBase64(f),this.datos.hubImag[t]=e,this.loadingData.dismiss()}catch(i){console.error("Error al procesar la imagen:",i)}})}onFileSelected(e,t){return(0,ue.mG)(this,void 0,void 0,function*(){this.loadingData=yield this.loading.create({message:"Guradando Foto.."}),this.loadingData.present();const o=e.target.files[0];o&&"application/pdf"===o.type&&this.processPdf(o,t)})}triggerFileInput(){document.getElementById("pdfInput").click()}processPdf(e,t){return(0,ue.mG)(this,void 0,void 0,function*(){const o={};console.log(t);const a=yield this.photo.convertFileToBase64(e);o.webviewPath="assets/icon/pdf.png",o.base64=a,this.datos.hubImag[t]=o,this.loadingData.dismiss()})}checkDocument(){return(0,ue.mG)(this,void 0,void 0,function*(){const e=yield this.loading.create({message:"Guradando Fotos.."});e.present();var t=!0,o="<ul>",a=!1,i={},s={};if("conductor"==this.documentActive.type&&(a=this.dataTercero.cedula),"vehiculo"==this.documentActive.type&&(a=this.dataTercero.placa),"camera"==this.documentActive.capture||"galery"==this.documentActive.capture){const c=this.documentActive.docs;for(let h=0;h<c.length;h++){const d=c[h];this.datos.hubImag[d.codigo].webviewPath?d.imagen=this.datos.hubImag[d.codigo].webviewPath:(t=!1,o+="<li>"+this.documentActive.nombre+d.nombre+"</li>")}if(console.log(this.documentActive),this.documentActive.fecha){const h=document.getElementById(this.documentActive.fechaTag);h.value?("conductor"==this.documentActive.type&&(this.datos.conductor[this.documentActive.fechaTag]=h.value,this.documents[this.codeDocumentActive].value=h.value,s.codigoTercerox=this.dataTercero.cedula,s.conductor=!0,s[this.documentActive.fechaTag]=h.value),"vehiculo"==this.documentActive.type&&(this.datos.vehiculo[this.documentActive.fechaTag]=h.value,this.documents[this.codeDocumentActive].value=h.value,i.placa=this.dataTercero.placa,i[this.documentActive.fechaTag]=h.value)):(t=!1,o+="<li>"+this.documentActive.fechaTag+"</li>")}else if(!this.documentActive.fecha&&this.documentActive.fechaTag&&"conductor"==this.documentActive.type){const h=new Date;this.documents[this.codeDocumentActive].value=h.toISOString().slice(0,10),s.codigoTercerox=this.dataTercero.cedula,s.conductor=!0,s[this.documentActive.fechaTag]=h.toISOString().slice(0,10)}if(o+="</ul>",t){if("vehiculo"==this.documentActive.type&&i.placa&&(yield this.reg.sendDataVehiculo(i)),"conductor"==this.documentActive.type&&s.conductor){const h=yield this.reg.sendDataTercero(s);console.log(h)}if(a){var u={files:[]};0==c.length&&(this.isModalOpen=!1);for(let h=0;h<c.length;h++){const d=c[h];this.datos.hubImag[d.codigo].base64&&u.files.push({codigo:a,tipo:d.codigo,tipoRegistro:this.documentActive.type,data64:this.datos.hubImag[d.codigo].base64})}if(0==u.files.length)return this.isModalOpen=!1,void e.dismiss();this.user.cargaDocumentos(u).subscribe(h=>{const d=h.data;for(let f=0;f<u.length;f++){const p=u[f];d[p.tipo]&&(this.datos.hubImag[p.tipo].webviewPath=d[p.tipo])}this.isModalOpen=!1,this.documentActive.status=!0},h=>{this.presentAlert("Error","Se presento una novedad en los datos","Volver a intentar","Cerrar"),e.dismiss()},()=>{e.dismiss()})}}else this.presentAlert("Error","En necesario cargar",o,"Cerrar"),e.dismiss()}})}documentValidate(){return(0,ue.mG)(this,void 0,void 0,function*(){this.datos.openDocs=!1,this.datos.ngOnInit()})}getFechas(){return(0,ue.mG)(this,void 0,void 0,function*(){return yield this.user.getFechas(this.token)})}resetFotos(){const e=this.documentActive.docs;for(let t=0;t<e.length;t++)this.datos.hubImag[e[t].codigo].webviewPath=""}select(e){}onChange(e){}onFocused(e){}getDocument(e,t,o){return(0,ue.mG)(this,void 0,void 0,function*(){try{return yield this.photo.getFotoTercero(e,t,o).toPromise()}catch(a){throw a}})}getImagen(e){const t=this.datos.hubImag[e];return t&&t.webviewPath?t.webviewPath:(console.error(`No se encontr\xf3 la imagen para el c\xf3digo: ${e}`),"")}presentAlert(e,t,o,a){return(0,ue.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:""+e,subHeader:""+t,message:""+o,buttons:[""+a]})).present()})}deleteDocumentByName(e,t){return e.filter(o=>o.nombre!==t)}}return r.\u0275fac=function(e){return new(e||r)(l.Y36(ss),l.Y36(Hr.F0),l.Y36(Ph.T),l.Y36(ee.Br),l.Y36(Rh.K),l.Y36(ee.HT),l.Y36(Nh.r))},r.\u0275cmp=l.Xpm({type:r,selectors:[["app-documentos-data"]],viewQuery:function(e,t){if(1&e&&l.Gf(ee.ki,5),2&e){let o;l.iGM(o=l.CRH())&&(t.modalType=o.first)}},inputs:{dataTercero:"dataTercero"},decls:29,vars:6,consts:[["slot","start"],["color","write ",3,"click"],[1,"ml-4"],["slot","end"],[1,"registro","text-center"],[1,"form-signin","w-100","m-auto"],[1,"p-2"],["class","w-100 ion-activatable ripple-parent rectangle",3,"click",4,"ngFor","ngForOf"],[1,"mt-1","mb-3","p-2","d-flex","justify-content-center"],["expand","block","type","submit",3,"click"],[3,"isOpen"],["modal1",""],["trigger","open-modal","handleBehavior","cycle",3,"isOpen","initialBreakpoint","breakpoints","ionModalDidDismiss"],["modalType",""],[1,"w-100","ion-activatable","ripple-parent","rectangle",3,"click"],[4,"ngFor","ngForOf"],[1,"ml-3"],[1,"p-2",3,"inset"],[4,"ngIf"],["expand","block","type","submit",1,"mb-4",3,"click"],["class","col-md-12 d-flex mt-4 mb-1 justify-content-center text-center title-form",4,"ngIf"],[1,"col-md-12","d-flex","mt-4","mb-1","justify-content-center","text-center","title-form"],["class","container-upload mb-3",3,"click",4,"ngIf"],[1,"container-upload","mb-3",3,"click"],[3,"src",4,"ngIf"],["class","camera",4,"ngIf"],[3,"src"],[1,"camera"],[1,"d-flex","justify-content-center"],["type","date",1,"input-registro",3,"ngModel","id"],["class","mb-2",4,"ngIf"],["class","mb-4",4,"ngIf"],[1,"mb-2"],["for",""],["type","text",1,"input-registro",3,"value"],[1,"mb-4"],[1,"autocomplete-container2","mb-4","col-md-12"],["position","floating"],["placeholder","",3,"ngModel","data","searchKeyword","itemTemplate","notFoundTemplate","selected","inputChanged","inputFocused"],["itemTemplate",""],["notFoundTemplate",""],[3,"innerHTML"],[3,"click"],["name","camera-outline",1,"mr-3"],["name","image-outline",1,"mr-3"],["type","file","id","pdfInput","accept",".pdf",2,"display","none",3,"change"],["name","clipboard-outline",1,"mr-3"]],template:function(e,t){1&e&&(l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),l.NdJ("click",function(){return t.backdata()}),l._uU(4,"Cancelar"),l.qZA()(),l.TgZ(5,"ion-title",2),l._uU(6,"Actualizar Documentos"),l.qZA(),l._UZ(7,"ion-buttons",3),l.qZA()(),l.TgZ(8,"ion-content")(9,"div",4)(10,"main",5)(11,"ion-grid")(12,"ion-text",6)(13,"h1"),l._uU(14,"Actualiza los documentos pendientes"),l.qZA(),l.TgZ(15,"p"),l._uU(16,"Carga la siguientes imagenes para continuar"),l.qZA()(),l.TgZ(17,"ion-row"),l.YNc(18,Cy,8,6,"ion-card",7),l.qZA(),l._UZ(19,"ion-row"),l.qZA(),l.TgZ(20,"div",8)(21,"ion-button",9),l.NdJ("click",function(){return t.documentValidate()}),l._uU(22," Guardar "),l.qZA()()()(),l.TgZ(23,"ion-modal",10,11),l.YNc(25,Uy,13,3,"ng-template"),l.qZA(),l.TgZ(26,"ion-modal",12,13),l.NdJ("ionModalDidDismiss",function(a){return t.dimmissModalType(a)}),l.YNc(28,Vy,17,0,"ng-template"),l.qZA()()),2&e&&(l.xp6(18),l.Q6J("ngForOf",t.documents),l.xp6(5),l.Q6J("isOpen",t.isModalOpen),l.xp6(3),l.Q6J("isOpen",t.modalTypeInput)("initialBreakpoint",.25)("breakpoints",l.DdM(5,Gy)))},dependencies:[ur.sg,ur.O5,j.Fj,j.JJ,j.On,ee.YG,ee.Sm,ee.PM,ee.FN,ee.Zi,ee.tO,ee.Dq,ee.wI,ee.W2,ee.fr,ee.jY,ee.Gu,ee.gu,ee.Xz,ee.Ie,ee.Q$,ee.q_,ee.Nd,ee.yW,ee.wd,ee.sr,ee.ki,us.YR],styles:["ion-content.color{--background: linear-gradient(#5b8bdf, #f4f5f8)}.full-list,.w-100{width:100%}.confirm{color:#0094da}.pending{color:red}.p-3{padding-left:30px;padding-right:30px}.p-2{padding-left:20px;padding-right:20px}.mb-3{margin-bottom:30px}\n"],encapsulation:3}),r})(),zy=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=l.oAB({type:r}),r.\u0275inj=l.cJS({imports:[ur.ez,j.u5,ee.Pc,_y,j.UX,us.rP]}),r})();l.B6R(ss,[ur.sg,ur.O5,j._Y,j.Fj,j.wV,j.JJ,j.JL,ee.We,ee.eh,ee.BJ,ee.yp,ee.YG,ee.Sm,ee.wI,ee.W2,ee.x4,ee.jY,ee.Gu,ee.gu,ee.Xz,ee.pK,ee.Ie,ee.Q$,ee.q_,ee.fG,ee.nJ,ee.Wo,ee.Nd,ee.t9,ee.n0,ee.wd,ee.ho,ee.sr,ee.ki,ee.w,ee.QI,ee.j9,j.sg,j.u,us.YR,qy],[])},8730:()=>{},8369:()=>{},3655:()=>{},5118:()=>{}}]);