"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1466],{1466:(x,v,r)=>{r.r(v),r.d(v,{TurnosPageModule:()=>y});var g=r(6895),s=r(433),l=r(603),h=r(3599),u=r(7582),p=r(6090);const f=(0,r(7423).fo)("InAppReview",{web:()=>r.e(628).then(r.bind(r,628)).then(n=>new n.InAppReviewWeb)});var e=r(1571),b=r(6591),T=r(5657),N=r(997),E=r(8965),I=r(1391),R=r(319),O=r(7924);function L(n,c){if(1&n&&(e.TgZ(0,"ion-select-option",21),e._uU(1),e.qZA()),2&n){const o=c.$implicit;e.s9C("value",o.nombre),e.xp6(1),e.Oqu(o.nombre)}}function G(n,c){if(1&n&&(e.TgZ(0,"ion-select-option",21),e._uU(1),e.qZA()),2&n){const o=c.$implicit;e.s9C("value",o.nombre),e.xp6(1),e.Oqu(o.nombre)}}function C(n,c){if(1&n&&(e.TgZ(0,"ion-select-option",21),e._uU(1),e.qZA()),2&n){const o=c.$implicit;e.s9C("value",o.nombre),e.xp6(1),e.Oqu(o.nombre)}}function Z(n,c){1&n&&(e.TgZ(0,"div",22)(1,"label",23),e._uU(2,"Tipo de Remolque"),e.qZA(),e.TgZ(3,"ion-select",24)(4,"ion-select-option",17),e._uU(5,"Seleccionar"),e.qZA(),e.TgZ(6,"ion-select-option",25),e._uU(7,"CONTENEDOR"),e.qZA(),e.TgZ(8,"ion-select-option",26),e._uU(9,"PLANCHA"),e.qZA()()())}const P=[{path:"",component:(()=>{class n{constructor(o,t,i,a,d,m,U,F,M,q,B,Y){this.router=o,this.formBuilder=t,this.geolocation=i,this.geodata=a,this.cookies=d,this.alertController=m,this.loading=U,this.userService=F,this.auth=M,this.alert=q,this.localNoti=B,this.reg=Y,this.turnoForm=s.cw,this.vehiculo={tipo:""},this.isSubmitting=!1,this.regionales=[{nombre:"REGIONAL ARAUCA"},{nombre:"REGIONAL ARMENIA"},{nombre:"REGIONAL BARRANQUILLA"},{nombre:"REGIONAL BOGOTA"},{nombre:"REGIONAL BUCARAMANGA"},{nombre:"REGIONAL BUENAVENTURA"},{nombre:"REGIONAL CALI"},{nombre:"REGIONAL CARTAGENA"},{nombre:"REGIONAL CUCUTA"},{nombre:"REGIONAL FLORENCIA"},{nombre:"REGIONAL IBAGUE"},{nombre:"REGIONAL IPIALES"},{nombre:"REGIONAL MANIZALES"},{nombre:"REGIONAL MEDELLIN"},{nombre:"REGIONAL MONTERIA"},{nombre:"REGIONAL NEIVA"},{nombre:"REGIONAL PASTO"},{nombre:"REGIONAL PEREIRA"},{nombre:"REGIONAL PERU"},{nombre:"REGIONAL POPAYAN"},{nombre:"REGIONAL RIOHACHA"},{nombre:"REGIONAL RIONEGRO"}],this.token=this.userService.getToken(),this.turnoForm=this.formBuilder.group({origen:[this.origen,[s.kI.required]],destino1:["",[s.kI.required]],destino2:["",[s.kI.required]],destino3:["",[s.kI.required]],remolque:[""],vehiculovac:["",[s.kI.required]],nuevo:[!1,[s.kI.required]]})}ngOnInit(){return(0,u.mG)(this,void 0,void 0,function*(){null==this.userService.getToken()&&this.router.navigate(["/login"]);const o=yield this.loading.create({message:"Cargando Datos..."});try{o.present(),yield this.getTurno(),yield this.getDataVehicle(),yield this.getLocation(),o.dismiss()}catch(t){o.dismiss(),401==t.status?this.auth.logout():this.presentAlert("Error","Fallo al cargar",t.message||"Ha ocurrido un error inesperado.","Reintentar")}})}onSubmit(){var o;return(0,u.mG)(this,void 0,void 0,function*(){if(!this.turnoForm.invalid&&!this.isSubmitting){this.isSubmitting=!0;var t="<ul>",i=!0;for(const a in this.turnoForm.controls)this.turnoForm.controls[a].invalid&&(i=!1,t+="<li>"+a.charAt(0).toUpperCase()+a.slice(1)+"</li>");if(t+="</ul>",!i)return void this.presentAlert("Falta informacion","",t,"Aceptar");if(null==this.turnoForm.value.origen&&this.presentAlert("Respuesta enturnamiento","","Refrescando ubicacion GPS...","Aceptar"),null!=this.turnoForm.value.origen)try{this.origen=this.turnoForm.value.origen.normalize("NFD").replace(/[\u0300-\u036f|.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").replace(/ +/g,"-").toLowerCase();const d={placa:null===(o=localStorage.getItem("placa"))||void 0===o?void 0:o.toUpperCase(),ciudad_origen:this.origen,ciudad_destino1:this.turnoForm.value.destino1,ciudad_destino2:this.turnoForm.value.destino2,ciudad_destino3:this.turnoForm.value.destino3,desacorasado:this.turnoForm.value.vehiculovac,estado_trailer:this.turnoForm.value.remolque,nuevo:this.turnoForm.value.nuevo},m=yield this.geodata.turnoCreacion(d);200==m.code&&(this.respuesta=JSON.stringify(m),this.respuesta=JSON.parse(this.respuesta),this.turnoForm.reset(),this.isSubmitting=!1,this.presentAlertRedirect("Respuesta enturnamiento","",this.respuesta.data,"Aceptar","/home"),this.localNoti.executeNotification(1,"IMPORTANTE","TURNO CREADO CON EXITO",this.respuesta.data,""),f.requestReview())}catch(a){if(this.isSubmitting=!1,401===a.status)return void this.auth.logout();this.presentAlert("Error","Fallo al cargar",a.error.data,"Cerrar")}}})}getTurno(){return(0,u.mG)(this,void 0,void 0,function*(){const o=yield this.userService.getTurnoUser();this.origen=o.data.origen_nombre,this.turnoForm.patchValue({origen:o.data.origen_nombre,destino1:o.data.destino1,destino2:o.data.destino2,destino3:o.data.destino3,remolque:o.data.tiporemolque,vehiculovac:o.data.vacio})})}getLocation(){return(0,u.mG)(this,void 0,void 0,function*(){try{const o=yield this.geodata.getCityFromCurrentLocation(this.token);this.nombre=o;const t=[{text:"Nuevo turno",handler:()=>(0,u.mG)(this,void 0,void 0,function*(){this.turnoForm.patchValue({nuevo:!0})})},{text:"Cancelar",handler:()=>(0,u.mG)(this,void 0,void 0,function*(){this.router.navigate(["/home"])})}];console.log(this.origen),console.log(this.nombre),this.origen&&this.origen!=this.nombre&&this.alert.presentAlertButtons("Novedad GPS","","Tiene un turno activo para "+this.origen+" y su ubicacion actual es "+this.nombre,"",t);const i=document.getElementById("origenLabel");o?(this.nombre=o,i.innerHTML="<ion-icon name='location'> </ion-icon> <strong>"+o+"</strong>"):i.innerHTML="<ion-icon name='location'> </ion-icon> <strong> Sin Ubicacion </strong>"}catch(o){this.alert.presentAlertRedirect("Error","GPS Desactivado",o.message,"Reintentar","/home")}})}getCurrentPosition(){return(0,u.mG)(this,void 0,void 0,function*(){document.getElementById("origen");const t=document.getElementById("origenLabel");yield p.b.getCurrentPosition().then(i=>(0,u.mG)(this,void 0,void 0,function*(){console.log(i),i.coords?yield this.geolocationService(i.coords.latitude,i.coords.longitude):(t.innerHTML="",t.innerHTML="Error al obtener GPS")})).catch(i=>{t.innerHTML="",t.innerHTML="Error GPS Desactivado",console.log("Error getting location",i)})})}getDataVehicle(){return(0,u.mG)(this,void 0,void 0,function*(){const o=yield this.reg.getDataVehiculo(this.userService.getPlaca());return this.vehiculo.tipo=o.data[0].tipoxxVehiculo,o})}presentAlert(o,t,i,a){return(0,u.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:""+o,subHeader:""+t,message:""+i,buttons:[""+a]})).present()})}presentAlertRedirect(o,t,i,a,d){return(0,u.mG)(this,void 0,void 0,function*(){const m=yield this.alertController.create({header:o,subHeader:t,message:i,buttons:[a]});yield m.present(),yield m.onDidDismiss(),d&&(location.href=d)})}geolocationService(o,t){return(0,u.mG)(this,void 0,void 0,function*(){const i=yield this.geodata.getCityByLatLon(o,t,this.token),a=document.getElementById("origenLabel");i.status?(this.nombre=i.data.ciudad_oigen_final,a.innerHTML="<ion-icon name='location'> </ion-icon> <strong>"+this.nombre+"</strong>"):a.innerHTML="<ion-icon name='location'> </ion-icon> <strong> Sin Ubicacion </strong>"})}getZona(o){return(0,u.mG)(this,void 0,void 0,function*(){try{return yield this.geodata.getGeoZona(o,"","",this.token).toPromise()}catch(t){throw t}})}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(h.F0),e.Y36(s.qu),e.Y36(p.b),e.Y36(b._),e.Y36(T.N),e.Y36(l.Br),e.Y36(l.HT),e.Y36(N.K),e.Y36(E.e),e.Y36(I.c),e.Y36(R.s),e.Y36(O.r))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-turnos"]],decls:42,vars:8,consts:[["slot","start"],[1,""],[1,"d-flex","justify-content-center"],[3,"formGroup","ngSubmit"],[1,"panel-turno"],[1,"col-md-12","p-4","d-flex","mb-4","justify-content-center","text-center","text-white"],["id","origenLabel","for",""],["type","hidden","id","origen","formControlName","origen",3,"ngModel"],[1,"form-row","p-2"],[1,"col-md-12","mt-2"],["formControlName","destino1","interface","action-sheet","placeholder","* Selecciona la ciudad de destino 1 ...",1,"input-registro"],[3,"value",4,"ngFor","ngForOf"],["formControlName","destino2","interface","action-sheet","placeholder","* Selecciona la ciudad de destino 2 ...",1,"input-registro"],["formControlName","destino3","interface","action-sheet","placeholder","* Selecciona la ciudad de destino 3 ...",1,"input-registro"],["class","col-md-12 mt-2 mb-3",4,"ngIf"],["id","labelPorcentaje",2,"margin-top","20px","color","#DB1824","font-size","12px"],["interface","action-sheet","formControlName","vehiculovac","id","vehiculovac","placeholder","Vehiculo Vacio*","required","",1,"input-registro"],["selected",""],["value","SI"],["value","NO"],["expand","full","type","submit",3,"disabled"],[3,"value"],[1,"col-md-12","mt-2","mb-3"],["for","remolque"],["interface","action-sheet","formControlName","remolque","id","remolque"],["value","CONTENEDOR"],["value","PLANCHA"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-menu-button"),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Enturnamiento"),e.qZA()()(),e.TgZ(6,"ion-content")(7,"div",1)(8,"div",2)(9,"form",3),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e.TgZ(10,"div",4)(11,"div",5)(12,"label",6),e._uU(13,"Bucando Ubicacion: "),e._UZ(14,"ion-spinner"),e.qZA(),e._UZ(15,"input",7),e.qZA()(),e.TgZ(16,"div",8)(17,"ion-item",9)(18,"ion-select",10),e._UZ(19,"ion-select-option"),e.YNc(20,L,2,2,"ion-select-option",11),e.qZA()(),e.TgZ(21,"ion-item",9)(22,"ion-select",12),e._UZ(23,"ion-select-option"),e.YNc(24,G,2,2,"ion-select-option",11),e.qZA()(),e.TgZ(25,"ion-item",9)(26,"ion-select",13),e._UZ(27,"ion-select-option"),e.YNc(28,C,2,2,"ion-select-option",11),e.qZA()(),e.YNc(29,Z,10,0,"div",14),e.TgZ(30,"h6",15),e._uU(31,"* De detectar que la informaci\xf3n brindada no es cierta podr\xe1 incurrir en sanciones dr\xe1sticas por parte de la compa\xf1\xeda."),e.qZA(),e.TgZ(32,"ion-item",9)(33,"ion-select",16)(34,"ion-select-option",17),e._uU(35,"Seleccionar"),e.qZA(),e.TgZ(36,"ion-select-option",18),e._uU(37,"SI"),e.qZA(),e.TgZ(38,"ion-select-option",19),e._uU(39,"NO"),e.qZA()()()(),e.TgZ(40,"ion-button",20),e._uU(41),e.qZA()()()()()),2&o&&(e.xp6(9),e.Q6J("formGroup",t.turnoForm),e.xp6(6),e.Q6J("ngModel",t.nombre),e.xp6(5),e.Q6J("ngForOf",t.regionales),e.xp6(4),e.Q6J("ngForOf",t.regionales),e.xp6(4),e.Q6J("ngForOf",t.regionales),e.xp6(1),e.Q6J("ngIf","ARTICULADO"==t.vehiculo.tipo),e.xp6(11),e.Q6J("disabled",t.turnoForm.invalid||t.isSubmitting),e.xp6(1),e.hij(" ",t.isSubmitting?"Enviando...":"Enturnarme"," "))},dependencies:[g.sg,g.O5,s._Y,s.Fj,s.JJ,s.JL,s.Q7,l.YG,l.Sm,l.W2,l.Gu,l.Ie,l.fG,l.t9,l.n0,l.PQ,l.wd,l.sr,l.QI,s.sg,s.u],styles:["ion-toolbar[_ngcontent-%COMP%]{--background: #3C8CCD;--color: white}ion-title[_ngcontent-%COMP%]{--margin-start: 15px}.custom-title[_ngcontent-%COMP%]{text-align:center;width:100%}ion-menu-button[_ngcontent-%COMP%]{color:var(white)}"]}),n})()}];let S=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[h.Bz.forChild(P),h.Bz]}),n})(),y=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[g.ez,s.u5,l.Pc,S,s.UX]}),n})()}}]);