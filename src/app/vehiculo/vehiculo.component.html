<!-- <div class="ion-page"> -->

<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title class="ml-3">Mis Vehiulos</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content>

  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-list class="p-3">


    <ion-card class="ion-activatable ripple-parent rectangle mt-4" *ngFor="let a of dataVehiculos; let i = index"
      (click)="selectChange(a.numeroPlacaxxx)" id="open-change">
      <ion-ripple-effect></ion-ripple-effect>
      <!-- <img *ngIf="!a.foto" alt="ejemplo" src="https://ionicframework.com/docs/img/demos/card-media.png"/>
      <img *ngIf="a.foto" alt="ejemplo" [src]="a.foto"/> -->
      <!-- <div class="fondo-vehiculo" [style.background-image]="a.foto ? 'url(' + a.foto + ')': 'https://ionicframework.com/docs/img/demos/card-media.png'">

      </div> -->

      <div class="containerPhoto">
        <ion-avatar [style.width]="'130px'" [style.height]="'130px'" slot="start">
          <ion-img alt="person" class="rounded-circle me-2"
            [src]="a.foto ? a.foto: 'https://ionicframework.com/docs/img/demos/card-media.png'"></ion-img>
        </ion-avatar>
        <!-- <span id="changePhoto" (click)="loadProfile()"> -->
        <!-- <img
              src="/camara_min.png"
              alt=""
            />
          </span> -->
      </div>

      <ion-card-header class="centerObject">
        <ion-card-title class="mt-2">
          <span>
            {{a.numeroPlacaxxx}}
          </span>

        </ion-card-title>

        <ion-card-subtitle class="mb-2 p-2">
          <span [class]="'badge text-bg-' + a.color"> {{a.estado}} </span>
        </ion-card-subtitle>
      </ion-card-header>
      <ion-card-content class="centerObject">
        <ion-grid>
          <ion-row class="align-center">

            <ion-col>
              <div class="container-change" *ngIf="a.numeroPlacaxxx != placaActual">
                <div class="prop-flotante">
                  <ion-row class="mt-2">

                    <ion-col class="mr-2 col-n align-center" size="6">
                      <ion-button (click)="editVehicule(a.numeroPlacaxxx)">
                         Asignar
                        </ion-button>
                    </ion-col>


                    <ion-col class="ml-2 col-n align-center" size="6">
                      <!-- <ion-button class="btndanger" (click)="deleteVehicle(a.numeroPlacaxxx)">
                        Eliminar
                      </ion-button> -->
                      <button class="btn btn-danger" (click)="deleteVehicle(a.numeroPlacaxxx)"> Eliminar </button>
                    </ion-col>

                  </ion-row>
                </div>
              </div>
            </ion-col>
            <!-- <ion-col>
              <span [class]="'badge text-bg-' + a.color"> {{a.estado}} </span>
            </ion-col> -->
          </ion-row>

          <!-- <ion-row class="align-center">
            <ion-col>
              <a> Asignar </a>
            </ion-col>
            <ion-col>
              <a (click)="deleteVehicle(a.numeroPlacaxxx)"> Eliminar </a>
            </ion-col>
          </ion-row> -->

        </ion-grid>

      </ion-card-content>
    </ion-card>

  </ion-list>


  <ion-modal #modal [isOpen]="isModalOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>

          <ion-title class="ml-4">Datos Vehiculo</ion-title>
          <ion-buttons slot="start">
            <ion-button color="medium" (click)="setOpenVehiculo(false);">Cancelar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>

        <form [formGroup]="formPlaca" (ngSubmit)="changeVehicle()" method="post">

          <ion-row class="mb-4" *ngIf="nuevoVehiculo">
            <ion-col size="8" class="d-flex justify-content-center p-3">
              <ion-item>
                <ion-label position="floating">Placa Vehiculo</ion-label>
                <ion-input formControlName="placa" value="{{searchTerm}}" (ionChange)="upperPlaca($event)"
                  [ngModel]="vehiculo.placa" id="placa" type="text"></ion-input>
              </ion-item>
            </ion-col>

            <ion-col size="4" class="d-flex justify-content-center align-centr p-3">
              <ion-button (click)="changeVehicle()" color="primary"> Buscar </ion-button>
            </ion-col>
          </ion-row>

        </form>

        <div class="container  mt-4" *ngIf="!nuevoVehiculo">

          <ion-card class="ion-activatable ripple-parent rectangle mt-4 card-preview">
            <ion-ripple-effect></ion-ripple-effect>

            <div class="containerPhoto">
              <ion-avatar [style.width]="'130px'" [style.height]="'130px'" slot="start">
                <ion-img alt="person" class="rounded-circle me-2"
                  [src]="vehiculo.foto ? vehiculo.foto: 'https://ionicframework.com/docs/img/demos/card-media.png'"></ion-img>
              </ion-avatar>

            </div>
            <ion-card-header class="centerObject">
              <ion-card-title class="mt-2">

                {{vehiculo.placa}}

              </ion-card-title>

              <ion-card-subtitle class="mb-2 p-2">
                {{vehiculo.claseVehiculo}}
              </ion-card-subtitle>
            </ion-card-header>
            <ion-card-content class="centerObject">
            </ion-card-content>
          </ion-card>


          <div class="container-change">
            <div class="prop-flotante">
              <ion-row class="mt-2">

                <ion-col class="mr-2 col-n align-center" size="6">
                  <a class="btn btn-success" (click)="changeVehicleDriver(vehiculo.placa, vehiculo.codigoTerce)"> Asignar </a>
                </ion-col>


                <ion-col class="ml-2 col-n align-center" size="6">
                  <a class="btn btn-primary" (click)="reseteVehicle()"> Nueva Busqueda </a>
                </ion-col>

              </ion-row>
            </div>
          </div>

        </div>

        <form *ngIf="nuevoVehiculo" [formGroup]="formVehicle" (ngSubmit)="onSubmitVehicle()" method="post">

          <ion-list class="p-2" [inset]="true" *ngIf="vehiculo.placa">
            <ion-grid>
              <!-- <ion-row> -->

              <input type="hidden" [value]="vehiculo.placa" formControlName="placa">


              <ion-col>
                <div class="col-md-12 d-flex mt-4 mb-4 justify-content-center text-center title-form">
                  <strong>
                    <h1>Datos del vehiculo</h1>
                  </strong>
                </div>
              </ion-col>


              <!-- <ion-input
                  [ngModel]="claseVehiculo"
                    id="claseVehiculo"
                    formControlName="claseVehiculo"
                    ></ion-input> -->
              <ion-row class="mb-4">
                <ion-col>
                  <label for="">Modelo</label>
                  <input type="text" [ngModel]="vehiculo.modelo" formControlName="modelo" class="input-registro">
                </ion-col>
              </ion-row>

              <ion-row>
                <ion-col>

                  <div class="autocomplete-container2 mb-4 col-md-12">
                    <ion-label position="floating">Clase Vehiculo</ion-label>

                    <ng-autocomplete formControlName="claseVehiculo" [ngModel]="vehiculo.claseVehiculo"
                      [data]="dataClases" [searchKeyword]="keyword" placeholder="" (selected)='selectEvent($event)'
                      (inputChanged)='onChangeSearch($event)' (inputFocused)='onFocused($event)'
                      [itemTemplate]="itemTemplate" [notFoundTemplate]="notFoundTemplate">
                    </ng-autocomplete>

                  </div>
                </ion-col>
              </ion-row>

              <ion-row>
                <ion-col>

                  <div class="autocomplete-container2 mb-4 col-md-12">
                    <ion-label position="floating">Marca</ion-label>

                    <ng-autocomplete formControlName="marca" [ngModel]="vehiculo.marca" [data]="dataMarcas"
                      [searchKeyword]="keyword" placeholder="" (selected)='selectMarca($event)'
                      (inputChanged)='onChangeMarca($event)' (inputFocused)='onFocusedMarca($event)'
                      [itemTemplate]="itemTemplate" [notFoundTemplate]="notFoundTemplate">
                    </ng-autocomplete>
                  </div>

                </ion-col>
              </ion-row>

              <ion-row>
                <ion-col>

                  <div class="autocomplete-container2 mb-4 col-md-12">
                    <ion-label position="floating">Clase Linea</ion-label>

                    <ng-autocomplete formControlName="linea" [ngModel]="vehiculo.linea" [data]="dataLineas"
                      [searchKeyword]="keyword" placeholder="" (selected)='selectLinea($event)'
                      (inputChanged)='onChangeLinea($event)' (inputFocused)='onFocusedLinea($event)'
                      [itemTemplate]="itemTemplate" [notFoundTemplate]="notFoundTemplate">
                    </ng-autocomplete>
                  </div>

                </ion-col>
              </ion-row>


              <ion-row>
                <ion-col>

                  <div class="autocomplete-container2 mb-4 col-md-12">
                    <ion-label position="floating">Carroceria</ion-label>

                    <ng-autocomplete formControlName="carroceria" [ngModel]="vehiculo.carroceria" [data]="dataCarroc"
                      [searchKeyword]="keyword" placeholder="" (selected)='selectCarroceria($event)'
                      (inputChanged)='onChangeCarroceria($event)' (inputFocused)='onFocusedCarroceria($event)'
                      [itemTemplate]="itemTemplate" [notFoundTemplate]="notFoundTemplate">
                    </ng-autocomplete>
                  </div>

                </ion-col>
              </ion-row>


              <ion-row>
                <ion-col>

                  <div class="autocomplete-container2 mb-4 col-md-12">
                    <ion-label position="floating">Color </ion-label>

                    <ng-autocomplete formControlName="color" [ngModel]="vehiculo.color" [data]="dataColores"
                      [searchKeyword]="keyword" placeholder="" (selected)='selectColor($event)'
                      (inputChanged)='onChangeColor($event)' (inputFocused)='onFocusedColor($event)'
                      [itemTemplate]="itemTemplate" [notFoundTemplate]="notFoundTemplate">
                    </ng-autocomplete>
                  </div>

                </ion-col>
              </ion-row>


              <ion-row>
                <ion-col>

                  <div class="autocomplete-container2 mb-4 col-md-12">
                    <ion-label position="floating">Empresa GPS</ion-label>

                    <ng-autocomplete formControlName="empresaSatelital" [ngModel]="vehiculo.empresaSatelital"
                      [data]="dataSatelital" [searchKeyword]="keyword" placeholder=""
                      (selected)='selectSatelital($event)' (inputChanged)='onChangeSatelital($event)'
                      (inputFocused)='onFocusedSatelital($event)' [itemTemplate]="itemTemplate"
                      [notFoundTemplate]="notFoundTemplate">
                    </ng-autocomplete>
                  </div>

                </ion-col>
              </ion-row>


              <ng-template #itemTemplate let-item>
                <a [innerHTML]="item.name"></a>
              </ng-template>

              <ng-template #notFoundTemplate let-notFound>
                <div [innerHTML]="notFound"></div>
              </ng-template>


              <ion-row class="mb-4">
                <ion-col>
                  <label for="">Usuario Gps</label>
                  <input type="text" [ngModel]="vehiculo.usuarioSatelital" formControlName="usuarioSatelital"
                    class="input-registro">
                </ion-col>
              </ion-row>

              <ion-row class="mb-4">
                <ion-col>
                  <label for="">Clave Gps</label>
                  <input type="text" [ngModel]="vehiculo.claveSatelital" formControlName="claveSatelital"
                    class="input-registro">
                </ion-col>
              </ion-row>



              <!-- <div class="container-prop">
                <div class="prop-flotante">
                  <ion-row class="mt-4">

                    <ion-col class="mr-2 col-n" size="6" (click)="checkPropietario()">
                      <ion-card class="{{isPropietario ? 'select-card' : '' }}" id="propietario">
                        <ion-card-content>

                          <div>
                            <span>Soy el Propietario</span>
                          </div>

                        </ion-card-content>
                      </ion-card>
                    </ion-col>


                    <ion-col class="ml-2 col-n" size="6" (click)="checkTenedor()">
                      <ion-card class="{{isTenedor ? 'select-card' : '' }}" id="tenedor">
                        <ion-card-content>
                          <div>
                            <span>Soy el Tenedor</span>
                          </div>
                        </ion-card-content>
                      </ion-card>
                    </ion-col>

                  </ion-row>
                </div>
              </div> -->

              <ion-row>
                <ion-col>

                  <div class="col-md-12 d-flex mt-4 mb-1 justify-content-center text-center title-form">
                    <strong>
                      <h1>Foto Frontal</h1>
                    </strong>
                  </div>
                  <ion-item>
                    <div (click)="addToCamera('fotovehi1', false)" class="container-upload mb-3">
                      <ion-img *ngIf="hubImag.fotovehi1.webviewPath" [src]="hubImag.fotovehi1.webviewPath"></ion-img>
                      <div *ngIf="!hubImag.fotovehi1.webviewPath" class="camera"></div>
                    </div>
                  </ion-item>

                </ion-col>
              </ion-row>

              <div *ngIf="vehiculo.articulado" class="ion-padding">

                <ion-row>
                  <ion-col>
                    <label for="">Placa Remolque</label>
                    <input type="text" [ngModel]="vehiculo.remolque" formControlName="remolque" class="input-registro">
                  </ion-col>
                </ion-row>


                <ion-row>
                  <ion-col>

                    <div class="col-md-12 d-flex mt-4 mb-1 justify-content-center text-center title-form">
                      <strong>
                        <h1>Foto Remolque</h1>
                      </strong>
                    </div>
                    <ion-item>
                      <div (click)="addToCamera('fotoremol', 0)" class="container-upload mb-3">
                        <ion-img *ngIf="hubImag.fotoremol.webviewPath"
                          [src]="hubImag.fotoremol.webviewPath"></ion-img>
                        <div *ngIf="!hubImag.fotoremol.webviewPath" class="camera"></div>
                      </div>
                    </ion-item>

                  </ion-col>
                </ion-row>

                <ion-row>
                  <ion-col>

                    <div class="col-md-12 d-flex mt-4 mb-1 justify-content-center text-center title-form">
                      <strong>
                        <h1>Tarjeta de propiedad Frontal</h1>
                      </strong>
                    </div>
                    <ion-item>
                      <div (click)="addToCamera('tarjePror1', 0)" class="container-upload mb-3">
                        <ion-img *ngIf="hubImag.tarjePror1.webviewPath"
                          [src]="hubImag.tarjePror1.webviewPath"></ion-img>
                        <div *ngIf="!hubImag.tarjePror1.webviewPath" class="camera"></div>
                      </div>
                    </ion-item>

                  </ion-col>
                </ion-row>

                <ion-row>
                  <ion-col>

                    <div class="col-md-12 d-flex mt-4 mb-1 justify-content-center text-center title-form">
                      <strong>
                        <h1>Tarjeta de propiedad posterior</h1>
                      </strong>
                    </div>
                    <ion-item>
                      <div (click)="addToCamera('tarjePror2', 0)" class="container-upload mb-3">
                        <ion-img *ngIf="hubImag.tarjePror2.webviewPath"
                          [src]="hubImag.tarjePror2.webviewPath"></ion-img>
                        <div *ngIf="!hubImag.tarjePror2.webviewPath" class="camera"></div>
                      </div>
                    </ion-item>

                  </ion-col>
                </ion-row>

              </div>


              <div class="mt-5 p-4">
                <ion-button expand="block" type="submit">
                  Guardar
                </ion-button>
              </div>

              <!-- </ion-row> -->
            </ion-grid>
          </ion-list>

        </form>



      </ion-content>
    </ng-template>
  </ion-modal>


  <ion-modal #modalcode [isOpen]="modalCodeOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>

          <ion-title class="ml-4">Valide su identidad</ion-title>
          <ion-buttons slot="start">
            <ion-button color="medium" (click)="setOpenCode(false); setOpenVehiculo(false);">Cancelar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <div class="container">

          <div class="mt-5 d-flex justify-content-center">
            <img class="mb-2" src="../../assets/img/verification.png" alt=""
              height="250" />
          </div>
          <div class="mt-2">
            <div class="col-12 title align-center">
              <h1> Verificacion de identidad </h1>
            </div>

            <div class="mt-3 mb-5 col-12 align-center">
              <p>
                Se enviara un mesnaje de texto al {{ vehiculo.celularPropietariox3 }} ****** {{
                vehiculo.celularPropietarioLast }}
              </p>

            </div>

            <div *ngIf="!codeValidation" class="mt-4 col-12 d-flex justify-content-center">

              <button type="submit" (click)="sendCodeValidation()" class="btn btn-primary"> Enviar </button>

            </div>

            <form [formGroup]="formSendCode" (ngSubmit)="approveCode()" method="post">

              <div *ngIf="codeValidation" class="mt-5 col-12 d-flex justify-content-center">
                <div class="form-group">
                  <input formControlName="codigo" class="input-code" placeholder="* * *  * * *" maxlength="6">
                </div>
              </div>

              <div *ngIf="codeValidation" class="mt-4 col-12 d-flex justify-content-center">
                <button type="submit" class="btn btn-primary"> Confirmar </button>
              </div>

            </form>

          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>


  <!-- <ion-modal #modalChange
  trigger="open-change"
  [initialBreakpoint]="0.25"
  [breakpoints]="[0, 0.25, 0.5, 0.75]"
  handleBehavior="cycle">
    <ng-template>
      <ion-content>



      </ion-content>
    </ng-template>
  </ion-modal> -->



  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button (click)="newVehicle(); modal.present()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>


</ion-content>
<!-- </div> -->
